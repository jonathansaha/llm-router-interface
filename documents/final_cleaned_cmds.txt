nokia service router linux command quick reference release r206 networkinstance route table show commands system show commands  show networkinstance routetable summary  show system application this quick reference provides a summary of commonly use sr linux commands and debugging strategies shows a summary of ipv4ipv6 route tables  show networkinstance routetable all hardware show commands  show platform shows all route table details prefix id active status owner metric nexthop typeid etc for the specified network instance networkinstance protocol show commands shows modules deployed administrative and operational state and the datetime the module type was last changed  show platform environment shows modules deployed administrative and operational state and temperature  show platform controlfabricfantraylinecardpowersupply shows specific modules deployed  show platform redundancyresourcemonitoring shows platform resource usage and redundancy  show networkinstance protocol name summary shows a summary of the specified protocol status  show networkinstance instance name protocols bgp neighbor shows bgp neighbors for all peer addresses for the specified network instance  show networkinstance instance name protocols bgp neighbor neighbor ip advertisedroutesreceived routesdetail shows the name state and version of currently running applications  show system logging shows log names type and directory  show system aaa authentication session session id shows aaa authentication sessions report  show system lldp neighbor interface interface name shows lldp neighbor interface details  show system sflow status shows sflow status debugging  view log messages view the default log messages 1 from the cli enter bash mode and use the cat command to view version show commands  show version shows current software version and chassis type interface show commands  show interface shows summary details for all interfaces and subinterfaces  show interface interface name shows summary details for the specified interface shows additional detail for a specified bgp neighbor ip  show networkinstance instance name protocols bgp routes ipv4ipv6 summary shows the bgp route report for the specified network instance the default log messages bash cat varlogsrlinuxbuffermessages 2 to exit bash and return to the cli type exit acl show commands  show acl summary shows a summary of configured acls  show acl ipv4filteripv6filter acl name shows details for a specified acl nokia is a registered trademark of nokia corporation other products and company names mentioned herein may be trademarks or tradenames of their respective owners the information presented is subject to change without notice no responsibility is assumed for inaccuracies contained herein copyright  2020 nokia the registered trademark linux is used pursuant to a sublicense from the linux foundation the exclusive licensee of linus torvalds owner of the mark on a worldwide basis 3he 16121 aaaa tqzza 01 july 2020 debugging  traceoptions trace options provide additional debug capabilities when enabled beneath a protocol messages log to the debug priority under the corresponding subsystem enable traceoptions 1 networkinstance name protocols type traceoptions flag flag type for example networkinstance default protocols bgp traceoptions flag keepalive view where traceoptions are enabled 1 info from state networkinstance default protocols bgp trace options 2 info from state networkinstance system logging configure log location example  send to a console using messages sourced from bgp with a severity of debug 1 system logging send to location subsystem name priority type value in brackets for example system logging console subsystem bgp priority matchexact debug nokia service router linux 7220 interconnect router 7250 interconnect router release 2410 advanced solutions guide 3he 20952 aaaa tqzza edition 01 november 2024  2024 nokia use subject to terms available at wwwnokiacomterms nokia is committed to diversity and inclusion we are continuously reviewing our customer documentation and consulting with standards bodies to ensure that terminology is inclusive and aligned with the industry our future customer documentation will be updated accordingly this document includes nokia proprietary and confidential information which may not be distributed or disclosed to any third parties without the prior written consent of nokia this document is intended for use by nokias customers youyour in connection with a product purchased or licensed from any company within nokia group of companies use this document as agreed you agree to notify nokia of any errors you may find in this document however should you elect to use this document for any purposes for which it is not intended you understand and warrant that any determinations you may make or actions you may take will be based upon your independent judgment and analysis of the content of this document nokia reserves the right to make changes to this document without notice at all times the controlling version is the one available on nokias site no part of this document may be modified no warranty of any kind either express or implied including but not limited to any warranty of availability accuracy reliability title non infringement merchantability or fitness for a particular purpose is made in relation to the content of this document in no event will nokia be liable for any damages including but not limited to special direct indirect incidental or consequential or any losses such as but not limited to loss of profit revenue business interruption business opportunity or data that may arise from the use of this document or the information in it even in the case of errors in or omissions from this document or its content copyright and trademark nokia is a registered trademark of nokia corporation other product names mentioned in this document may be trademarks of their respective owners the registered trademark linux is used pursuant to a sublicense from the linux foundation the exclusive licensee of linus torvalds owner of the mark on a worldwide basis  2024 nokia advanced solutions guide release 2410 table of contents table of contents 1 about this guide 6 11 precautionary and information messages6 12 conventions 6 2 whats new 8 3 bgp for underlay routing 9 31 bgp underlay routing example 9 311 advantages of bgp for underlay routing10 32 bgp configuration for underlay routing10 321 example configure router 3 for static ebgp session 10 322 example configure router 5 for static ebgp session 13 33 advanced configuration bgp timers 16 331 modifying timerrelated defaults16 34 advanced configuration bgp convergence optimization 17 341 configuring waitforfibinstall18 342 convergence process optimization after restarts 18 3421 configuring minwaittoadvertise to delay bgp route advertisement 19 3422 configuring maxwaittoadvertise 19 3423 bgp minmaxwaittoadvertise timers behavior 19 3424 displaying convergence snapshot 20 35 advanced configuration ipv4 route advertisement with ipv6 nexthops 21 351 advertising a bgp route for ipv4 nlri with an ipv6 bgp nexthop address22 352 receiving a bgp route for ipv4 nlri with an ipv6 bgp nexthop address22 353 accepting ipv4 packets on an ipv6only interface 22 4 macvrf networkinstances for server aggregation24 41 overview 24 42 configuration of macvrf networkinstances and irb subinterfaces25 421 example configure dut2 with macvrf irb and static bgp on irb 26 43 advanced configuration bridgetable settings 32 44 advanced configuration macduplication for loop protection 33 441 example configure macduplication and troubleshoot loops in dut2 34 442 using logs to detect duplicate macs 36 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 3 advanced solutions guide release 2410 table of contents 5 evpnvxlan for layer2 and multihoming 37 51 overview 37 52 configuration of evpnvxlan broadcast domains 38 521 configuring the underlay network 39 522 configuring leaf3 with an evpnvxlan enabled macvrf42 523 checking the evpnvxlan operation in macvrfs 45 5231 checking vxlaninterface configuration 45 5232 checking macvrf bgpvpn and bgpevpn parameters 46 5233 checking vxlan tunnels 46 5234 checking tunneltable entries 47 5235 checking statistics 47 5236 checking for received imet routes and multicast destination creation 48 5237 checking for multicastdestinations 51 5238 checking mactable and macip routes 52 5239 checking unicast destinations 53 524 checking mac mobility mac protection and mac loop protection in evpnvxlan bds53 5241 checking mac mobility54 5242 checking mac protection 55 5243 mac loop protection 57 53 multihoming configuration for evpn broadcast domains 58 531 allactive multihoming configurations 58 5311 ethernet segment configuration details 59 532 configuring leaf2 and leaf4 as multihomed nodes to server1 60 5321 use of multihoming as allactive mlag for nonevpn layer2 bds64 533 checking the multihoming operation 65 5331 checking the es status 65 5332 checking es and evi routes67 5333 checking the macip route 68 5334 checking the es destination 69 5335 checking mac programming70 5336 checking subinterface es association leaf270 5337 checking subinterface es association leaf471 5338 evpn related logs 72 6 evpnvxlan for layer 373 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 4 advanced solutions guide release 2410 table of contents 61 overview 73 62 configuration of evpnvxlan ipvrf domains 74 621 preconfiguring the underlay network 75 622 configuring the leaf3 ipvrf domain 75 623 configuring the ipvrf domain on leaf2 and leaf4 79 6231 irb subinterface considerations 88 624 configuring evpn ifl interoperability to evpn iff unnumbered model 89 625 checking the evpn ifl model in ipvrfs 90 6251 checking ipvrf10 state and connectivity 90 6252 checking for vxlan tunnel creation91 6253 checking for remote vteps and associated destinations 92 6254 checking ipvrf10 route table93 6255 checking routetable state for a rt5 94 6256 monitoring pings95 626 checking pece routing on an ipvrf with evpnifl 97 6261 checking pcce routing on ipvrf 97 6262 pece ebgp session import and export policies 98 6263 additional pece considerations 99 627 checking multihoming in an evpnvxlan layer 3 network101 6271 consistency check for anycastgw ips 101 6272 nonanycastgw ip addresses105 6273 additional anycast gateway considerations 107 63 testing and checking layer 3 host mobility109 631 configuring efficient host routing 110 632 mobility event  efficient host routing 113 64 evpnvxlan layer 3 feature parity for ipv6 prefixes117 641 configuring ipv6 container118 642 additional feature parity considerations119 7 security hardening using cpm filters 121 71 acl configuration for control plane protection 121 711 cpm filter rules 121 712 restricting source subnets for incoming traffic using cpm filter 122 8 configuring ipvpn services124 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 5 advanced solutions guide release 2410 about this guide 1 about this guide this document describes how to configure advanced solutions for the nokia service router linux sr linux advanced solutions are defined as more complex networklevel configurations where additional guidance and more detailed procedures may be required this document is intended for network technicians administrators operators service providers and others who need to understand how to use and configure advanced solutions this manual covers the current release and may also contain some content that will be released in later maintenance loads see the sr linux release notes for information about features supported in each load configuration and command outputs shown in this guide are examples only actual displays may differ depending on supported functionality and user configuration 11 precautionary and information messages the following are information symbols used in the documentation danger danger warns that the described activity or situation may result in serious personal injury or death an electric shock hazard could exist before you begin work on this equipment be aware of hazards involving electrical circuitry be familiar with networking environments and implement accident prevention procedures warning warning indicates that the described activity or situation may or will cause equipment damage serious performance problems or loss of data caution caution indicates that the described activity or situation may reduce your component or system performance note note provides additional operational information tip tip provides suggestions for use or best practices 12 conventions sr linux documentation uses the following command conventions  bold type indicates a command that the user must enter  input and output examples are displayed in courier text  an open rightangle bracket indicates a progression of menu choices or simple command sequence often selected from a user interface example start  connect to  a vertical bar  indicates a mutually exclusive argument 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 6 advanced solutions guide release 2410 about this guide  square brackets   indicate optional elements  braces   indicate a required choice when braces are contained within square brackets they indicate a required choice within an optional element  italic type indicates a variable generic ip addresses are used in examples replace these with the ip addresses used in the system 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 7 advanced solutions guide release 2410 whats new 2 whats new there have been no updates in this document since it was last released 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 8 advanced solutions guide release 2410 bgp for underlay routing 3 bgp for underlay routing a routing protocol is needed to dynamically discover the shortest loopfree path through the underlay of a dc fabric to reach every destination ip subnet the border gateway protocol bgp is one of the leading technologies for this purpose as a result of its simplicity scalability and ease of multivendor interoperability bgp also provides policy mechanisms to perform hopbyhop traffic engineering leveraging functionality originally designed for this same purpose in the public internet 31 bgp underlay routing example the following figure shows a 3stage clos fabric design using only bgp for underlay routing figure 1 bgp underlay routing example this design example shows the following  each topofrack tor switch is a bgp router assigned with its own unique autonomous system number asn  each tor switch is dualhomed to the two leaf switches in its same pod or container and adding more leaf switches later can achieve scale capacity  each tor forms one singlehop external border gateway protocol ebgp session to each of its upstream leaf switches from a tor perspective these sessions are singlehop because each leaf switch is a bgp neighbor in the same ip subnet as its interface address toward the leaf switch  each leaf switch is a bgp router all of the leaf switches in one pod or container belong to the same asn but this asn is unique in the data center  each leaf switch has two uplinks into the spine layer more uplinks could be added later to achieve scale capacity each leaf switch forms one singlehop ebgp session with each of its upstream spine switches 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 9 advanced solutions guide release 2410 bgp for underlay routing  each spine switch is a bgp router all of the spine switches in one data center belong to the same asn but this asn is unique in the network 311 advantages of bgp for underlay routing using bgp as shown in figure 1 bgp underlay routing example has the following advantages  standard operation of the bgp bestpath selection algorithm chooses the route to each destination with the aspath length this equates to the lowest hop count when each device prepends one asn to the aspath  standard operation of the bgp multipath algorithm sprays traffic across all paths with the same shortest aspath length  when a link goes down in the topology the bgp session is taken down immediately if fastfailover is enabled this may cause a new bgp best path to be advertised by the routers at each end of the failed session other routers may also advertise their own new best paths but typically the failure does not propagate beyond routers that do not change their best path  traffic can be rerouted around any node in the topology by having it prepend extra as numbers to the aspath  the best path or set of multipaths available to reach a destination tor are visible in any device by looking at the aspath attribute this can be helpful with troubleshooting 32 bgp configuration for underlay routing the following examples define how to bring up a static preconfigured ebgp session between router 3 and router 5 as shown in figure 1 bgp underlay routing example use the following two examples to define the minimum configuration required for each router  example configure router 3 for static ebgp session  example configure router 5 for static ebgp session 321 example configure router 3 for static ebgp session about this task use the following example to configure router 3 for the static ebgp session procedure step 1 in candidate mode create a networkinstance that owns the ip subinterface toward router 5 example  candidate shared default networkinstance default   info detail type default adminstate enable iploadbalancing   interface ethernet110   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 10 advanced solutions guide release 2410 bgp for underlay routing protocols   ensure the following  the networkinstance is operationally enabled  the subinterface is operationally enabled  the subinterface has at least one ipv4 or ipv6 address assigned step 2 add the bgp protocol to the networkinstance by default it is administratively enabled when the configuration is committed example  candidate shared default networkinstance default   protocols bgp step 3 assign a global asn to the bgp instance this is the asn reported to peers when this networkinstance opens a bgp session toward another router unless it is overridden by a localas configuration router 3 has a global asn of 65201 example  candidate shared default networkinstance default protocols bgp   autonomoussystem 65201 step 4 assign a routerid to the bgp instance this is the bgp identifier reported to peers when this networkinstance opens a bgp session toward another router this overrides the routerid configuration at the networkinstance level router 3 has a routerid of 192031 example  candidate shared default networkinstance default protocols bgp   routerid 192031 step 5 enable all address families that should be enabled globally as a default for all peers of the bgp instance when you later configure individual neighbors or groups you can override the enabled families at those levels example  candidate shared default networkinstance default protocols bgp   afisafi ipv4unicast adminstate enable  candidate shared default networkinstance default protocols bgp   afisafi ipv6unicast adminstate enable step 6 create a peer group to contain the neighbor session with router 5 a peergroup should include sessions that have a similar or almost identical configuration in this example the peer group is named spine because it is used to contain all spine layer peers new groups are administratively enabled by default 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 11 advanced solutions guide release 2410 bgp for underlay routing example  candidate shared default networkinstance default protocols bgp   group spine step 7 all of the configuration that is common to all peers in the group must be configured at the group level in this example this includes  peeras of the spine peers  exportpolicy the export policy named passall in the example in the configuration output below was previously created in this work flow if it does not exist the commit fails the export policy is required to advertise any routes to r5 this is because r5 is an ebgp peer and by default no routes are advertised to ebgp peers without an export policy note this can be controlled by a setting in the networkinstance protocols bgp ebgpdefaultpolicy container the passall export policy matches and accepts all bgp routes while rejecting all nonbgp routes example  candidate shared default  networkinstance default protocols bgp group spine   info peeras 65301 exportpolicy passall  candidate shared default    info from running routingpolicy routingpolicy  policy passall  defaultaction  reject    statement 10  match  protocol bgp  action  accept     step 8 configure the bgp session with router r5 in this example router r5 is reachable to r3 through the ethernet110 subinterface on this subnet router r5 has the globalunicast ipv6 address 2001db8c11 in this minimal configuration example the only required configuration for the neighbor is its association with the group spine that was previously created new neighbors are administratively enabled by default example  candidate shared default networkinstance default protocols bgp  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 12 advanced solutions guide release 2410 bgp for underlay routing  neighbor 2001db8c11 peergroup spine step 9 review all changes and if everything appears correct commit the changes example  commit stay 322 example configure router 5 for static ebgp session about this task use the following example to configure router 5 for the static ebgp session procedure step 1 in candidate mode create a networkinstance that owns the ip subinterface toward router 3 ensure that  the networkinstance is operationally enabled  the subinterface is operationally enabled  the subinterface has at least one ipv4 or ipv6 address assigned example  candidate shared default networkinstance default   info detail type default adminstate enable ipforwarding  receiveipv4check true receiveipv6check true  iploadbalancing   interface ethernet311   protocols   mtu  pathmtudiscovery true  step 2 add the bgp protocol to the networkinstance by default it is administratively enabled when the configuration is committed example  candidate shared default networkinstance default   protocols bgp step 3 assign a global autonomous system number to the bgp instance router 5 has a global autonomous system number of 65301 example  candidate shared default networkinstance default protocols bgp  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 13 advanced solutions guide release 2410 bgp for underlay routing  autonomoussystem 65301 step 4 assign a routerid to the bgp instance this is the bgp identifier reported to peers when this networkinstance opens a bgp session toward another router this overrides the routerid configuration at the networkinstance level router 5 has a routerid of 192051 example  candidate shared default networkinstance default protocols bgp   routerid 192051 step 5 enable all address families that should be enabled globally as a default for all peers of the bgp instance when you later configure individual neighbors or groups you can override the enabled families at those levels example  candidate shared default networkinstance default protocols bgp   afisafi ipv4unicast adminstate enable  candidate shared default networkinstance default protocols bgp   afisafi ipv6unicast adminstate enable step 6 create a peergroup to contain the neighbor session with router 3 a peergroup should include sessions that have a similar or almost identical configuration in this example the peergroup is named leafpod1 because it is used to contain all leaf peers in pod1 new groups are administratively enabled by default example  candidate shared default networkinstance default protocols bgp   group leafpod1 step 7 all of the configuration that is common to all peers in the group must be configured at the group level in this example this includes  peeras of the leaf peers in pod1  exportpolicy the export policy named passall in the example is shown in the following running configuration output and is required to advertise any routes to r3 this is because r3 is an ebgp peer and by default no routes are advertised to ebgp peers without an export policy note this can be controlled by a setting in the networkinstance protocols bgp ebgp defaultpolicy container the passall export policy is a simple policy that matches all bgp routes and accepts them while rejecting all nonbgp routes example  candidate shared default networkinstance default protocols bgp group leaf pod1   info 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 14 advanced solutions guide release 2410 bgp for underlay routing peeras 65201 exportpolicy passall  candidate  networkinstance default protocols bgp group leafpod1   exit all  candidate shared default   info from running routingpolicy routingpolicy  policy passall  defaultaction  reject    statement 10  match  protocol bgp  action  accept   step 8 configure the bgp session with router r3 in this example router r3 is reachable to r5 through the ethernet311 subinterface on this subnet router r5 has the globalunicast ipv6 address 2001db8c12 in this minimal configuration example the only required configuration for the neighbor is its association with the group leafpod1 that was previously created new neighbors are administratively enabled by default example  candidate shared default networkinstance default protocols bgp   neighbor 2001db8c12 peergroup leafpod1 step 9 review all changes and if everything looks correct commit the changes step 10 from router 3 verify that the session is up state is established using the show neighbor command under the networkinstance protocols bgp hierarchy example running networkinstance default protocols bgp  srlinux show neighbor  bgp neighbor summary for networkinstance default flags s static d dynamic l discovered by lldp b bfd enabled  disabled  slow    netinst  peer  group  flags  peer  state  uptime  afisafi  rx       as     active           tx    default  2001db8cli  spine  s  65301  established  0d0h  ipv4unicast  431         34min 7s  ipv6unicast  111    summary 1 configured neighbors 1 configured sessions are established 0 disabled peers none dynamic sessions are established 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 15 advanced solutions guide release 2410 bgp for underlay routing 33 advanced configuration bgp timers when two bgp routers form a session they each propose a value for the session holdtime in their open messages the lowest of the two proposed values becomes the operational holdtime for the lifetime of the session if the operational holdtime is greater than zero both routers are agreeing to send keepalive messages to each other this ensures that any loss of connectivity between them can be detected each router restarts its holdtimer every time it receives a message from the other peer if the operational holdtimer reaches zero without receiving any keepalive or related message from the peer the session is torn down returned to the idle state each router sends a keepalive message to its peer no more than one message every keepalive interval the default value for the keepalive interval is one third of the operational holdtime but it possible to configure a different interval in a data center environment an ebgp session failure is usually caused by an interface going down interface events are propagated to bgp if fastfailover is enabled the holdtimer expiry is not the usual mechanism for detecting connectivity problems however there may be some circumstances where some adjustment of the holdtime and the keepalive interval can be used 331 modifying timerrelated defaults about this task with sr linux the default holdtime is 90 seconds and the default keepalive interval is 30 seconds procedure to change the holdtime on a session to 24 seconds with a keepalive interval of 8 seconds 13 of 24 you only need to change the holdtime value to 24 as shown in the following example example change holdtime  candidate shared default networkinstance default protocols bgp neighbor 2001db8c11   timers holdtime 24 after this change is committed the affected session flaps and the new operational timer values are shown in the output of the show networkinstance protocols bgp neighbor detail command for example srlinux show networkinstance default protocols bgp neighbor 2001db8c11 detail  peer  2001db8c11 remote as 65301 local as 65201 type  static description  none group  spine export policies  passall import policies passall  adminstate is enable sessionstate is established up for 0d0h6m37s tcp connection is 2001db8c12 45492  2001db8c11 179 0 messages in input queue 0 messages in output queue  laststate was active lastevent was recvopen 24 peerflaps last received notification was errormessage header error suberror bad message type failure detection bfd is false fastfailover is false 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 16 advanced solutions guide release 2410 bgp for underlay routing  graceful restart restarts by the peer  0 last restart  na peer requested restarttime  300 stale routes time  360   timer  configuredoperational  next    connectretry  120     keepaliveinterval  308     holdtime  2424     minimumadvertisementinterval  5      cap sent mpbgp routerefresh extnhencoding 4octetasn cap recv mpbgp routerefresh extnhencoding 4octetasn    messages  sent  received    non updates  55  52   updates  424  2   malformed updates  0  0    ipv4unicast afisafi end of rib  sent not received received routes  4 rejected routes  none active routes  3 advertised routes  1 prefixlimit  none default originate  disabled advertise with ipv6 nexthops  false peer requested gr helper  none peer preserved forwarding state none  ipv6unicast afisafi end of rib  sent not received received routes  1 rejected routes  none active routes  1 advertised routes  1 prefixlimit  none default originate  disabled advertise with ipv6 nexthops  na peer requested gr helper  none peer preserved forwarding state none   candidate shared   34 advanced configuration bgp convergence optimization by default the sr linux bgp process running the bgp control plane does not advertise a route for an ipv4 or ipv6 prefix until it has positive confirmation from the fib manager process that the route is in the fib of all installed line cards this ensures that the router does not attract traffic destined for an ip prefix until all line cards have the ability to forward the traffic 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 17 advanced solutions guide release 2410 bgp for underlay routing note the bgp process does not delay route withdrawals until it knows that all line cards have removed the fib state as this is not needed 341 configuring waitforfibinstall about this task nokia recommends that the waitforfibinstall functionality remain enabled on routers that are in the datapath that is routers that set bgp nexthopself however this does cause the rate of ribout route advertisements to slow to the rate of fib programming procedure if the objective of a bgp performance test is to reach the highest possible route advertisement rate set the waitforfibinstall configuration leaf to false for example example set waitforfibinstall leaf to false  candidate shared defaultnetworkinstance default protocols bgp route advertisement  waitforfibinstall false 342 convergence process optimization after restarts the bgp protocol and its state machine must attempt to reconverge whenever the following occurs   the router starts up the bgp manager control plane application restarts  all peers of a networkinstance are hardreset by a tools resetpeer command when any of these conditions are met the router resynchronizes its bgp rib with the bgp rib of other routers in the network when resynchronization completes bgp has converged during convergence the following occurs to the restarting router    it must reestablish its sessions with configured and discovered bgp neighbors it must relearn all bgp routes advertised by its direct bgp neighbors their best paths plus potentially some additional paths it must advertise to its direct neighbors its own locally originated bgp routes plus the received routes that it considers its own set of best paths the default behavior of sr linux bgp is to execute all of the preceding steps in parallel as soon as the first bgp session has reestablished the restarting router begins to advertise its own best paths to that bgp neighbor even though it is still in the early stages of rebuilding its ribin database as more sessions come up and more routes are learned it is likely that routes previously considered best are no longer best leading to multiple route advertisements for the same prefix with each incrementally better than the previous one the best route is not determined until the last advertisement the intermediate route advertisements can substantially increase the processing workload on the restarting router as well as its bgp neighbors this can lengthen the overall convergence time and cause short term inefficiencies in traffic forwarding 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 18 advanced solutions guide release 2410 bgp for underlay routing 3421 configuring minwaittoadvertise to delay bgp route advertisement about this task instead of reconverging as previously described sr linux bgp can also be configured to delay the advertisement of bgp routes in a particular address family until convergence has occurred for that address family or until a configured time limit has expired procedure to activate this behavior configure a nonzero value for the minwaittoadvertise configuration leaf for example example set minwaittoadvertise  candidate shared default network instance default protocols bgp convergence   minwaittoadvertise 600 3422 configuring maxwaittoadvertise procedure you can configure the maxwaittoadvertise leaf value for the ipv4unicast and ipv6unicast address families or you can accept their default values 3x the minwaittoadvertise value to configure a max waittoadvertise leaf with a nondefault value the value must be greater than the configured minwaitto advertise timer in the following example the maxwaittoadvertise timer is set to 900 seconds for ipv4 unicast and set to 800 seconds for ipv6unicast example set maxwaittoadvertise  candidate shared default networkinstance default protocols bgp   afisafi ipv4unicast ipv4unicast convergence maxwaittoadvertise maxwaitto advertise 900  afisafi ipv6unicast ipv6unicast convergence maxwaittoadvertise 800 3423 bgp minmaxwaittoadvertise timers behavior the minwaittoadvertise timer begins after one of the following triggers occurs and the first bgp session becomes established  bgp instance admin state set to enable or disable  running tools clear networkinstance protocols bgp resetpeer  bgp application restart  node reboot when the first session that supports the exchange of ipv4unicast routes is established the maxwait toadvertise timer of the ipv4 address family starts likewise when the first session that supports the exchange of ipv6unicast routes is established the maxwaittoadvertise timer of the ipv6 address family starts 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 19 advanced solutions guide release 2410 bgp for underlay routing while the minwaittoadvertise timer is running bgp sessions come up and routes are learned and sorted according to preference by the bgp decision process however no routes are advertised to any of the peers when the minwaittoadvertise expires bgp makes a list of ipv4 and ipv6 peers that is peers that support the exchange of ipv4unicast routes and ipv6unicast routes it expects to receive the ipv4 unicast end of rib eor marker from each neighbor in the list of ipv4 peers and it expects to receive the ipv6unicast eor from each neighbor in the list of ipv6 peers when bgp in the restarting router receives the last expected ipv4unicast eor it declares that address family as converged and starts to advertise its best ipv4unicast routes likewise when bgp receives the last expected ipv6unicast eor it declares that address family as converged and starts to advertise its best ipv6unicast routes if the maxwaittoadvertise timer expires before the last expected eor is received for an address family the convergence state for the address family moves to timeout and a ribout advertisement is triggered this occurs even though convergence is not complete the maxwaittoadvertise timers are fail safe they handle the scenario when one or more peers come up within the minwaittoadvertise window but their eors are not sent 3424 displaying convergence snapshot procedure use the show networkinstance protocols bgp summary command to display a snapshot of the bgp convergence process in the example that follows the bgp convergence process is triggered by a hard reset of all peers of the bgp instance example trigger bgp convergence using resetpeer   candidate shared default   tools networkinstance default protocols bgp resetpeer networkinstancenamedefaultprotocolsbgp successfully executed the tools clear command if the show networkinstance protocols bgp summary command is issued a few minutes after the session restarts a snapshot of the convergence process can be viewed for example in the following output example ten ipv4unicast sessions are established when the minwaittoadvertise timer expires and ipv4unicast convergence takes 517 seconds example display convergence snapshot  show networkinstance default protocols bgp summary  bgp is enabled and up in networkinstance default global as number  65201 bgp identifier  192031  total paths  27 received routes  200000 received and active routes 200000 total up peers  20 configured peers  20 0 are disabled dynamic peers  none  default preferences bgp local preference attribute 100 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 20 advanced solutions guide release 2410 bgp for underlay routing ebgp routetable preference  170 ibgp routetable preference  170  wait for fib install to advertise true send rapid withdrawals  false  ipv4unicast afisafi received routes  100000 received and active routes  100000 max number of multipaths  8 1 multipath can transit multi as true  min adv delay after restartslow peer thresh 600s currently established sessions  10 sessions established at slow peer thresh  10 first session establishment after restart  5s last session established after restart  252s  max advertisement delay after first peer up 900s max adv delay exceeded after last restart  none current convergence state  converged converged peers  10 convergence time after last restart  517s  ipv6unicast afisafi received routes  100000 received and active routes  100000 max number of multipaths  11 multipath can transit multi as true  min adv delay after restartslow peer thresh 600s currently established sessions  10 sessions established at slow peer thresh  10 first session establishment after restart  8s last session established after restart  312s  max advertisement delay after first peer up 800s max adv delay exceeded after last restart  none current convergence state  converged converged peers  10 convergence time after last restart  705s  35 advanced configuration ipv4 route advertisement with ipv6 nexthops some data centers are migrating away from an ipv4ipv6 dualstack infrastructure and moving toward an ipv6only infrastructure in an ipv6only design each interface in the fabric such as the leafspine leaf tor is assigned one or more ipv6 addresses but no ipv4 addresses to route and forward ipv4 packets over an ipv6only fabric the leaf and spine switches must support the following  the ability to advertise a bgp route for ipv4 network level reachability information nlri with an ipv6 bgp nexthop address  the ability to receive a bgp route for ipv4 nlri with an ipv6 bgp nexthop address  the ability to accept ipv4 packets on an ipv6only interface 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 21 advanced solutions guide release 2410 bgp for underlay routing 351 advertising a bgp route for ipv4 nlri with an ipv6 bgp nexthop address about this task on sr linux the ability to advertise a bgp route for ipv4 nlri with an ipv6 bgp nexthop address is not enabled by default procedure to enable this functionality use the advertiseipv6nexthops command which is available on a per session basis the following is a sample configuration example advertise bgp route for ipv4 nlri with ipv6 bgp nexthop  candidate shared default networkinstance default protocols bgp   afisafi ipv4unicast ipv4unicast advertiseipv6nexthops true 352 receiving a bgp route for ipv4 nlri with an ipv6 bgp nexthop address about this task on sr linux the ability to receive a bgp route for ipv4 nlri with an ipv6 bgp nexthop address is not enabled by default to enable this functionality use the receiveipv6nexthops command which is available on a persession basis this command allows sr linux to advertise the extendednexthopencoding bgp capability defined in rfc 5549 to the peers included in the scope of the command this bgp capability encodes nlri afi 1 nlri safi 1 and nexthop afi 2 it informs peers that they can advertise mpbgp encoded ipv4 routes with ipv6 nexthops when the routes are received the router then attempts to resolve them using ipv6 routes if the router receives an ipv4 route with an ipv6 nexthop that is resolved by a static or direct ipv6 route and an ipv6 neighbor entry for the nexthop host address the ipv4 route is programmed in the fib so that matching ipv4 packets are sent without additional encapsulation packets are sent through the indicated interface with a mac destination address provided by the ipv6 neighbor entry procedure to enable receipt of bgp routes for ipv4 nlri with an ipv6 bgp nexthop address use the receiveipv6 nexthops command example receive bgp route for ipv4 nlri with ipv6 bgp nexthop  candidate shared  networkinstance default protocols bgp   afisafi ipv4unicast ipv4unicast receiveipv6nexthops true 353 accepting ipv4 packets on an ipv6only interface about this task the datapath of the sr linux checks for and discards all ipv4 packets that are received on an ipv6only subinterface that is a subinterface with no configured ipv4 addresses this is done for security reasons 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 22 advanced solutions guide release 2410 bgp for underlay routing however if the router has advertised ipv4 routes with ipv6 nexthops to a peer the check should be disabled on all subinterfaces that could be used by the peer when it installs the ipv4 route procedure to disable this check on all subinterfaces bound to a specific networkinstance set the ipv4receivecheck leaf to false example accept ipv4 packets on an ipv6only interface  candidate shared default networkinstance default   ipforwarding receiveipv4check false 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 23 advanced solutions guide release 2410 macvrf networkinstances for server aggregation 4 macvrf networkinstances for server aggregation macvrf networkinstances can provide aggregation for a group of servers into the same subnet this chapter defines concepts and procedures for configuring macvrf networkinstances and integrated routing and bridging irb subinterfaces 41 overview data center dc servers or hosts are connected to tor routers so that they can be reached from other tor routers in the same ip fabric the tor nodes use bgp to learn and propagate subnet reachability in the underlaying routing infrastructure the servers or hosts connected to these tor bgp routers use routed subinterfaces on the tor and static routes or a pece bgp session to learn or advertise reachability to the rest of the dc each server requires a separate routed subinterface and subnet on the tor and the number of subinterfaces and local routes in the routetable grows linearly as the number of servers increases the use of a macvrf networkinstance provides aggregation for a group of servers into the same subnet this saves routes and subinterfaces in the tor a macvrf is attached to the default networkinstance by a single irb interface and subnet instead of a separate subinterface and route per server the following figure shows an example of macvrf networkinstances for server aggregation 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 24 advanced solutions guide release 2410 macvrf networkinstances for server aggregation figure 2 macvrf networkinstances for server aggregation in this example leaf1 and leaf2 are configured with macvrf instances that aggregate a group of servers these servers are assigned ip addresses on the same subnet and are connected to the leaf default networkinstance by a single irb subinterface the servers use a pece bgp session with the irb ip address to exchange reachability the use of the macvrf with an irb subinterface saves routed subinterfaces on the default networkinstance only one routed subinterface is needed instead of one per server 42 configuration of macvrf networkinstances and irb subinterfaces the following figure shows an example of how to configure macvrf networkinstances and their irb subinterfaces to the default networkinstance and how ebgp sessions are configured with the servers in this example dut2 is the tor being configured dut1 and dut3 are servers that are running bgp against the dut2 irb subinterface 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 25 advanced solutions guide release 2410 macvrf networkinstances for server aggregation figure 3 macvrf and irb example in dut2 421 example configure dut2 with macvrf irb and static bgp on irb prerequisites this example assumes dut2 is preconfigured with a default networkinstance that runs bgp sessions to the spine routers as defined in the section bgp for underlay routing about this task this example shows how to configure the dut2 with a macvrf bridged subinterfaces to dut1 and dut3 and an irb subinterface see figure 3 macvrf and irb example in dut2 procedure step 1 in candidate mode create the interfaces and bridged subinterfaces to connect to dut1 and dut3 in this example  connect ethernet11 and ethernet12 to dut1 and dut3 respectively although these interfaces could be defined untagged this example configures them as tagged vlantagging true 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 26 advanced solutions guide release 2410 macvrf networkinstances for server aggregation  create a subinterface with index 1 under each interface the subinterface must be configured as type bridged bridged subinterfaces can be associated with macvrf instances so that mac learning and layer2 forwarding can be enabled on them  the subinterfaces use vlanid 100 because this is the vlan id used by the servers dut1 and dut2 to send and receive frames example  candidate shared default  interface   adut2 info interface ethernet11  description dut2dut1 vlantagging true subinterface 1  type bridged vlan  encap  singletagged  vlanid 100      interface ethernet12  description dut2dut3 vlantagging true subinterface 1  type bridged vlan  encap  singletagged  vlanid 100      step 2 configure an irb interface and subinterface to connect the macvrf to the existing default networkinstance the irb is configured in a similar way to a loopback interface and subinterfaces the irb subinterface must be type routed but does not need to be explicitly configured as routed example  candidate shared default  interface irb  adut2 info interface irb1  subinterface 1  ipv4  adminstate enable address 1000224    ipv6  adminstate enable address 2001db8264    3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 27 advanced solutions guide release 2410 macvrf networkinstances for server aggregation   step 3 configure the networkinstance type macvrf and associate it with the bridged and irb interfaces example  candidate shared default  networkinstance macvrf1  adut2 info type macvrf adminstate enable interface ethernet111   interface ethernet121   interface irb11   step 4 associate the same irb interface with the networkinstance default and configure the bgp ipv4 and ipv6 neighbors to dut1 and dut3 see bgp for underlay routing for more information about configuring bgp sessions example  candidate shared default  networkinstance default  adut2 info type default adminstate enable routerid 2222 interface irb11   interface lo01   protocols  bgp  adminstate enable afisafi ipv4unicast  adminstate enable  autonomoussystem 64502 routerid 10002 ebgpdefaultpolicy  importrejectall false  failuredetection  enablebfd true fastfailover true  group tor  adminstate enable exportpolicy passall afisafi ipv4unicast  adminstate enable  afisafi ipv6unicast  adminstate enable  localas asnumber 64502   timers  minimumadvertisementinterval 1  traceoptions  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 28 advanced solutions guide release 2410 macvrf networkinstances for server aggregation flag update   flag gracefulrestart   flag events   flag keepalive   flag notification   flag open   flag packets   flag route   flag socket   flag timers     afisafi ipv4unicast  adminstate enable  afisafi ipv6unicast  adminstate enable  neighbor 10001  peeras 64501 peergroup tor transport  localaddress 10002   neighbor 10003  peeras 64503 peergroup tor transport  localaddress 10002   neighbor 2001db81  peeras 64501 peergroup tor transport  localaddress 2001db82   neighbor 2001db83  peeras 64503 peergroup tor transport  localaddress 2001db82     step 5 review all the changes and commit if correct example  candidate shared default   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 29 advanced solutions guide release 2410 macvrf networkinstances for server aggregation adut2 commit stay step 6 check the state of the macvrf and the connectivity to dut1 and dut3 using the following commands  show networkinstance macvrf1 interfaces  show networkinstance default interfaces  show networkinstance macvrf1 bridgetable mactable all  show arpnd arpentries interface irb1  show arpnd neighbors interface irb1  show networkinstance default protocols bgp neighbor example adut2 show networkinstance macvrf1 interfaces  net instance  macvrf1 interface  ethernet111 type  bridged oper state  up  net instance  macvrf1 interface  ethernet121 type  bridged oper state  up  net instance  macvrf1 interface  irb11 oper state  up ip mtu  1500 prefix origin status  1000224 static 2001db8264 static preferred fe802012fffeff4164 linklayer preferred  adut2 show networkinstance default interfaces  net instance  default interface  irb11 oper state  up ip mtu  1500 prefix origin status  1000224 static 2001db8264 static preferred fe802012fffeff4164 linklayer preferred  net instance  default interface  lo01 oper state  up prefix origin status  222232 static 2001db812128 static preferred 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 30 advanced solutions guide release 2410 macvrf networkinstances for server aggregation  adut2 show networkinstance macvrf1 bridgetable mactable all  mactable of network instance macvrf1    address  destination  dest  type  active  aging  last update     index        000101ff0000  ethernet111  16  learnt  true  287  20200603t134025000z   000102ff0041  irbinterface  0  irb  true  na  20200602t135350000z      interface      000103ff0000  ethernet121  17  learnt  true  287  20200603t134025000z   total irb macs  1 total 1 active total static macs  0 total 0 active total duplicate macs  0 total 0 active total learnt macs  2 total 2 active total macs  3 total 3 active  adut2 show arpnd arpentries interface irb1   interface  subinterface  neighbor  origin  link layer address  expiry    irb1  1  10001  dynamic  000101ff0000  3 hours from now   irb1  1  10003  dynamic  000103ff0000  3 hours from now    total entries  2 0 static 2 dynamic  adut2 show arpnd neighbors interface irb1   interface  sub  neighbor  origin  link layer address  current  next state is    interface     state  change router   irb1  1  2001db81  dynamic  000101ff0000  stale  2 hours  true         from now    irb1  1  2001db83  dynamic  000103ff0000  stale  2 hours  true         from now    irb1  1  fe802011ff  dynamic  000101ff0000  stale  2 hours  true     feff0     from now    irb1  1  fe802013ff  dynamic  000103ff0000  stale  2 hours  true     feff0     from now     total entries  4 0 static 4 dynamic  adut2 show networkinstance default protocols bgp neighbor  bgp neighbor summary for networkinstance default flags s static d dynamic l discovered by lldp b bfd enabled  disabled  slow    netinst  peer groupflag peer  state  uptime  afisafi  rxactive       as     tx    default  10001  tor  sb  64501  established  0d3h12m33s  ipv4unicast  324  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 31 advanced solutions guide release 2410 macvrf networkinstances for server aggregation         ipv6unicast  324   default  10003  tor  sb  64503  established  0d3h10m55s  ipv4unicast  324          ipv6unicast  324   default  2001db81  tor  sb  64501  established  0d3h12m31s  ipv4unicast  000          ipv6unicast  606   default  2001db83  tor  sb  64503  established  0d3h10m52s  ipv4unicast  000          ipv6unicast  606    summary 4 configured neighbors 4 configured sessions are established0 disabled peers 0 dynamic peers 43 advanced configuration bridgetable settings a macvrf networkinstance uses a bridgetable to forward frames between its subinterfaces some bridgetable properties can be configured for example example   candidate shared default  networkinstance macvrf1 bridgetable  adut2 tree detail bridgetable netinstmgr  discardunknowndestmac netinstmgr  maclearning netinstmgr   adminstate netinstmgr   aging netinstmgr   adminstate netinstmgr   agetime netinstmgr  macduplication netinstmgr   adminstate netinstmgr   monitoringwindow netinstmgr   nummoves netinstmgr   holddowntime netinstmgr   action netinstmgr  maclimit netinstmgr   maximumentries netinstmgr   warningthresholdpct netinstmgr  staticmac l2staticmacmgr  mac address l2staticmacmgr  address l2staticmacmgr  destinationm l2staticmacmgr where  the maclearning container provides control over how macs are dynamically learned on the subinterfaces including whether learning is enabled adminstate or controlled by the aging timer for the mactable  the macduplication container controls how the system behaves when duplicate macs are detected  the maclimit container provides parameters for limiting the maximum number of macs installed for a specific macvrf  the staticmacs provides control to configure and associate to either a subinterface destination or with a blackhole incoming frames with the source or destination mac matching a configured blackholed mac are discarded by the system 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 32 advanced solutions guide release 2410 macvrf networkinstances for server aggregation 44 advanced configuration macduplication for loop protection sr linux supports macduplication detection and associated procedures to protect the system against network loops the following figure shows a simple loop and describes the associated configuration figure 4 macduplication for loop protection in this example macvrf 2 is connected using two bridged subinterfaces to a layer 2 switch when a host with mac m1 sends a broadcast frame a loop is created macduplication is by default enabled in mac vrf networkinstances with the following parameters   candidate shared default  networkinstance macvrf1 bridgetable mac duplication  adut2 info detail adminstate enable monitoringwindow 3 nummoves 5 holddowntime 10 action stoplearning the loops shown in this example are resolved in the following sequence 1 macduplication detection  a mac m1 is declared as duplicate when the number of moves across two or more subinterfaces exceeds the configured nummoves in the configured monitoringwindow  when m1 is duplicate it is kept in a duplicateentries list and stays associated with the last subinterface where the mac was learned before the number of moves exceed the nummoves value 2 macduplication action 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 33 advanced solutions guide release 2410 macvrf networkinstances for server aggregation  when the mac m1 is declared duplicate in a subinterface an action is taken in that subinterface the action is configurable per networkinstance and can be overridden on a persubinterface basis  possible actions on the subinterface are operdown blackhole and stoplearning  operdown  brings down the subinterface breaks the loop and discards all the frames arriving on the subinterface  blackhole  discards frames with a source or destination mac that matches the duplicate mac but allows the remaining frames to forward normally on the subinterface  stoplearning  does not discard any frame on the subinterface and keeps the existing macs learned against it no new macs are learned on the subinterface until the action is cleared   candidate shared default  networkinstance macvrf1 bridgetable macduplication  adut2 action value usage action blackholeoperdownstoplearning action to take on the subinterface whose action is usenetinstanceaction upon detecting one or more mac addresses as duplicate in particular  operdown if configured upon detecting a duplicate mac on the subinterface the subinterface will be brought operdown  blackhole upon detecting a duplicate mac on the subinterface the mac will be blackholed any frame received on this or any other subinterface with mac sa matching a blackhole mac is discarded  stoplearning this is the default action compliant with rfc7432 upon detecting a duplicate mac on the subinterface the mac will not be relearned anymore on this or any subinterface positional arguments value 3 macduplication holddowntime and process restart  when the configured holddowntime expires the duplicate mac is flushed from the mactable and the entire process restarts for the mac  the duplicate action on a subinterface clears when there are no longer duplicate mac addresses in the subinterface as a loop protection mechanism macduplication is selfcontained and does not require a control plane protocol that runs networkwide among network devices 441 example configure macduplication and troubleshoot loops in dut2 about this task use this example to assist in configuring macduplication this example assumes macvrf 1 is connected to a layer 2 switch not shown using two bridge subinterfaces ethernet112 and ethernet113 this creates a loop configure dut2 with the following macduplication settings to troubleshoot the loop procedure step 1 use the macduplication command to configure macduplication settings as shown in the following example example  candidate shared default  networkinstance macvrf1  adut2 info type macvrf adminstate enable 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 34 advanced solutions guide release 2410 macvrf networkinstances for server aggregation interface ethernet111   interface ethernet112   interface ethernet113   interface ethernet121   interface irb11   bridgetable  macduplication  nummoves 3 holddowntime 300 action stoplearning   step 2 configure the subinterfaces with the following macduplication actions in this example the macduplication action configured under the networkinstance is overridden by the more specific action under the subinterfaces 2 and 3 when traffic is generated by the remote layer 2 switch the same mac address moves between ethernet112 and ethernet113 after the third move the mac is declared a duplicate and appears in the duplicateentries list example   candidate shared default  interface  subinterface  bridgetable mac duplication  adut2 info interface ethernet11  subinterface 1  bridgetable  macduplication     subinterface 2  bridgetable  macduplication  action operdown    subinterface 3  bridgetable  macduplication  action operdown   step 3 use the show networkinstance bridgetable mactable command to display the duplicate mac entries example adut2 show networkinstance macvrf1 bridgetable mactable all  mactable of network instance macvrf1    address  destination  dest  type  active  aging  last update     index      3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 35 advanced solutions guide release 2410 macvrf networkinstances for server aggregation   000101ff0000  ethernet111  16  learnt  true  287  20200603t134025000z   000101ff0041  ethernet113  20  duplicate  true  na  20200605t200724000z   000102ff0041  irbinterface  0  irb  true  na  20200602t135350000z      interface      000103ff0000  ethernet121  17  learnt  true  287  20200603t134025000z   total irb macs  1 total 1 active total static macs  0 total 0 active total duplicate macs  1 total 1 active total learnt macs  2 total 2 active total macs  4 total 4 active  adut2 show networkinstance macvrf1 bridgetable macduplication duplicateentries  macduplication in network instance macvrf1  admin state  enable monitoring window  3 number of moves allowed 3 hold down time  300 action  stoplearning    duplicate mac  destination  dest index  detect time  hold time remaining    000101ff0041  ethernet113  20  20200605t200724000z  270   total duplicate macs  1 total 0 active  442 using logs to detect duplicate macs procedure you can use a log event to help troubleshoot when macs are detected as duplicate or when they are deleted after the holddowntimer for example example rootdut2 srlinux tail f varlogsrlinuxdebugsrl2macmgrlog 20200606t0622486790700000 dut2 local6noti srl2macmgr bridgetable2608260800035n a duplicate mac address 000101ff0000 was detected on macvrf1 20200606t0627489333120000 dut2 local6noti srl2macmgr bridgetable2608260800036n a duplicate mac address 000101ff0000 detected on macvrf1 is now deleted the networkinstance manager logs also show when the subinterfaces go down as a result of mac duplication for example example rootdut2 srlinux tail f varlogsrlinuxdebugsrnetinstmgrlog 20200606t0622486806090000 dut2 local6warn srnetinstmgr netinst2663266300080w the interface ethernet113 in networkinstance macvrf1 is now down for reason a duplicate mac address has been detected 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 36 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming 5 evpnvxlan for layer2 and multihoming ethernet virtual private network evpn is a standard technology in multitenant data centers dcs evpn provides a control frame framework for many functions this chapter details the configuration and operation of an evpn and vxlan evpnvxlan solution for the following components  bridged subinterfaces associated with a specific vlanid or default subinterfaces that capture untagged and nonexplicitly configured vlantagged frames in tagged subinterfaces  macvrf type networkinstances that are evpnenabled so that they can use virtual extended lan vxlan tunnels to connect to other macvrfs of the same broadcast domains bd  evpnvxlan control and data plane extensions as in rfc8365 including evpn route type 2 mac ip and route type 2 inclusive multicast ethernet tag imet  distributed security and protection for staticmacs  the mac duplication mechanism extended to support evpn to provide loop protection  evpn l2 multihoming including ethernet segment es model configuration for allactive multi homing 51 overview evpnvxlan provides layer2 connectivity in multitenant dcs evpnvxlan broadcast domains bd can span several leaf routers connected to the same ip fabric allowing hosts attached to the same bd to communicate as though they were connected to the same layer2 switch vxlan tunnels bridge the layer2 frames between leaf routers with evpn providing the control plane to automatically setup tunnels and use them efficiently the following diagram shows this concept in this example four leaf routers are attached to the same bd that is instantiated by a macvrf on each leaf sr linux leaf routers support standardbased evpn vxlan rfc8365 therefore thirdparty leaf routers leaf4 in this example can be attached to the same bd as the sr linux leaf routers as long as they follow standard rfc8365 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 37 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming figure 5 evpn broadcast domain in a multitenant dcs 52 configuration of evpnvxlan broadcast domains the following figure shows a configuration example of an evpnvxlan bd that is distributed in multiple leaf nodes in the same dc the bd is instantiated by macvrf1 in each of the three leaf nodes the sections that follow describe how to configure and operate macvrf1 in each node 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 38 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming figure 6 example of evpnvxlan broadcast domain 521 configuring the underlay network about this task before configuring the overlay bd the underlay connectivity must be configured in figure 6 example of evpnvxlan broadcast domain the leaf routers are connected to the spines using routed links a routing protocol is enabled in the default networkinstance of each leaf and spine node so that reachability of all the leaf vxlan termination end point vtep addresses is distributed throughout the ip fabric in sr linux you can use the following for the underlay routing protocol  isis  ospf  ebgp the evpn family must also be enabled for the distribution of evpn routes among leaf routers of the same tenant evpn is enabled using ibgp and typically a route reflector rr or ebgp procedure to configure the underlay network in this example configure an ebgpunderlay bgp group to enable the ipv4 and ipv6 unicast families and configure an ibgpevpn group for the distribution of the evpn routes as shown in the following configuration on leaf3 in this case a full mesh of ibgp evpn sessions is established among the three leaf routers but a pair of rrs is typical 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 39 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming example underlay configuration  factory  candidate shared default  networkinstance default  adut3 info type default adminstate enable description default network instance routerid 3333 interface ethernet111   interface ethernet131   interface system00   protocols  bgp  adminstate enable afisafi ipv4unicast  adminstate enable  autonomoussystem 3333 routerid 3333 group ebgpunderlay  adminstate enable exportpolicy exportall importpolicy importall timers  connectretry 5 holdtime 5 keepaliveinterval 2 minimumadvertisementinterval 2   group ibgpevpn  adminstate enable exportpolicy exportall importpolicy importall afisafi evpn  adminstate enable  localas asnumber 1234   timers  minimumadvertisementinterval 1   afisafi ipv4unicast  adminstate enable  afisafi ipv6unicast  adminstate enable  neighbor 1111  adminstate enable peeras 1234 peergroup ibgpevpn transport  localaddress 3333   neighbor 2222  adminstate enable peeras 1234 peergroup ibgpevpn 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 40 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming transport  localaddress 3333   neighbor 4444  adminstate enable peeras 1234 peergroup ibgpevpn transport  localaddress 3333   neighbor 10232  adminstate enable peeras 2222 peergroup ebgpunderlay  neighbor 10344  adminstate enable peeras 4444 peergroup ebgpunderlay  traceoptions  flag packets  modifier detail  flag update  modifier detail  flag route  modifier detail  flag socket  modifier detail  flag notification  modifier detail    linux  exportroutes true exportneighbors true   in the example above ebgp is used for underlay reachability and ibgp for overlay evpn route distribution the command localas overrides the configuration of the bgpautonomoussystem so that the overlay bgp sessions are established using the same autonomous system in the three leaf routers the system00 interface hosts the loopback address used to originate and typically terminate vxlan packets this address is also used by default as the nexthop of all evpn routes example system00 interface configuration the following example shows the configuration of the system00 interface in leaf3  factory  candidate shared default  interface system0  adut3 info adminstate enable subinterface 0  adminstate enable 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 41 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming ipv4  adminstate enable address 333332     522 configuring leaf3 with an evpnvxlan enabled macvrf about this task after leaf3 is configured as defined in configuring the underlay network use the following steps to enable evpnvxlan on leaf3 in this example ethernet12 connects host3 to leaf3 although this interface could be defined untagged this example configures the interface as tagged and using vlanid vlantagging true a subinterface with index 1 is created under the interface the subinterface must be configured as type bridged bridged subinterfaces can be associated with macvrf instances so that mac learning and layer2 forwarding can be enabled on each procedure step 1 in candidate mode create the interfaces and bridged subinterfaces to connect leaf3 to host3 example creation of interfacesbridged subinterfaces  factory  candidate shared default  interface ethernet12  adut3 info description dut3host3 adminstate enable vlantagging true subinterface 1  type bridged adminstate enable vlan  encap  singletagged  vlanid 1     in the above example the subinterface uses vlanid 1 since this is the vlan id used by host3 to send and receive frames if you wanted host3 to sent and received untagged traffic the vlan encap command can be configured with either of these options  vlan encap singletagged vlanid optional  where optional captures all traffic when no specific vlanid has been defined  vlan encap untagged  where untagged captures traffic with no tags or vlantag 0 step 2 after creating the access subinterfaces create the vxlaninterfaces this allows mcvrfs of the same bd to be connected throughout the ip fabric 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 42 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming the sr linux models vxlan as tunnels and vxlaninterfaces exist within them the network instance and main property is the vni or vxlan network identifier sr linux vxlan model characteristics include  the tunnelinterface for vxlan is configured as vxlann where the value of n is 0255  multiple tunnelinterfaces can be configured the tunnelinterface can host multiple vxlan interfaces  vxlaninterfaces are configured under tunnelinterfaces with an associated number in the range 04294967295 minimally the vxlaninterface must have an index type and ingress vni  a vxlaninterface can only be associated with one networkinstance and in the r213 a networkinstance can have only one vxlaninterface  the vxlaninterface type can be routed or bridged when used for evpnvxlan layer2 in macvrfs the type must be bridged  the ingress vni must be configured the vni is used to find the macvrf where the inner mac lookup is performed the egress vni is not configured and is determined by the imported evpn routes sr linux requires that the egress vni discovered matches the configured ingress vni so that two leaf routers attached to the same bd can exchange packets example vxlan1 vxlaninterface configuration  factory  candidate shared default  tunnelinterface   adut3 info tunnelinterface vxlan1  vxlaninterface 1  type bridged ingress  vni 1    outer vlan tagging is supported one vlan tag only assuming that the egress subinterface in the default networkinstance uses vlantagging no inner vlan tags can be pushed or popped on vxlaninterfaces but vlan tags that are not strippedoff at the ingress bridged subinterfaces are transparently carried over the vxlan tunnels the following applies for mtu and fragmentation for vxlan interfaces  no specific mtu checks are performed in networkinstances with vxlan  the default networkinstance interface mtu should be made large enough to allow room for the vxlan overhead  the dont fragment df flag is always set in the vxlan outer ip header  reassembly is not supported for vxlan packets step 3 configure the networkinstance type macvrf and associate it with the bridged interfaces and vxlaninterface to a bgpevpn enabled macvrf requires the association of at least one bridged subinterface and one bridged vxlaninterface 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 43 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming example macvrf configuration and bridged interface association  factory  candidate shared default  networkinstance macvrf1  adut3 info type macvrf adminstate enable interface ethernet121   vxlaninterface vxlan11   step 4 enable evpn in the macvrf by configuring the bgpvpn and the bgpevpn protocol containers  bgpvpn  provides the configuration of the bgpinstances where the routedistinguisher and the importexport routetargets used for the evpn routes exist import and export policies can be used instead of explicit routetargets in the current release only one bgpinstance per networkinstance is supported  bgpevpn  hosts all the commands required to enable evpn in the networkinstance at a minimum a reference to bgpinstance 1 is configured along with the reference to the vxlan interface where evpn is enabled and the evi the evi or evpn instance identifier is a two byte value that is mandatory and is used for  the autoderivation of the routedistinguisher rd if a manual rd is not configured the rd is autoderived as systemipevi where the systemip is the ip address configured in the system00 subinterface  the autoderivation of the routetarget rt if a manual rt is not configured the rt is autoderived as autonomoussystemevi the autonomoussystem is configured in the default networkinstance  the value used to represent the macvrf in the df election algorithm see multihoming configuration for evpn broadcast domains example configure bgpvpn and bgpevpn protocol containers  factory  candidate shared default  networkinstance macvrf1  adut3 info type macvrf adminstate enable interface ethernet121   vxlaninterface vxlan11   protocols  bgpevpn  bgpinstance 1  adminstate enable vxlaninterface vxlan11 evi 1 ecmp 2   bgpvpn  bgpinstance 1  routetarget  exportrt target12341 importrt target12341 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 44 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming     each leaf routers is configured with a different autonomoussystem number therefore evi based autoderived rts cannot be used or the three leaf routers would not produce the same import and export routetargets for the macvrfs of the same bd therefore rts are configured manually step 5 review the changes if correct commit the changes example adut2 commit stay  candidate shared default   523 checking the evpnvxlan operation in macvrfs after all leaf routers attached to the same bd are configured check the state of the macvrf and connectivity to leaf2 and leaf3 5231 checking vxlaninterface configuration procedure use the show tunnelinterface vxlaninterface and show networkinstance vxlaninterface commands to check that the vxlaninterface is properly configured and associated with the networkinstance if the networkinstance vxlaninterface is operdown a reason is shown the egress sourceip shown in the output should match the ipv4 address configured in the subinterface system00 example check vxlaninterface configuration  factory  candidate shared default   adut3 show tunnelinterface vxlan1 vxlaninterface 1 brief  show report for vxlantunnels    tunnel interface  vxlan interface  type  ingress vni  egress sourceip    vxlan1  vxlan11  bridged  1  333332    summary 1 tunnelinterfaces 1 vxlan interfaces 5 vxlandestinations 2 unicast 1 es 2 multicast 0 ip  adut3 show networkinstance macvrf1 vxlaninterface vxlan11  show report for network instance macvrf1 vxlan interface table   networkinstance macvrf1 vxlaninterface  vxlan11 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 45 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming type  bridged oper state  up operdownreason none  5232 checking macvrf bgpvpn and bgpevpn parameters procedure use the show networkinstance protocols bgpvpn and show networkinstance protocols bgp evpn commands to check that the macvrf bgpvpn and bgpevpn parameters are properly configured a manual or autoderived rdrt must exist or the bgpevpn bgpinstance will be operdown example check macvrf bgpvpn and bgpevpn parameters adut3 show networkinstance macvrf1 protocols bgpvpn bgpinstance 1  net instance  macvrf1 bgp instance 1  routedistinguisher 33331 autoderivedfromevi exportroutetarget target12341 manual importroutetarget target12341 manual    factory  candidate shared default   adut3 show networkinstance macvrf1 protocols bgpevpn bgpinstance 1  net instance  macvrf1 bgp instance 1 is enabled and none  vxlaninterface  vxlan11 evi  1 ecmp  2 defaultadmintag  0 operdownreason  na evpn routes next hop  none macip routes  none imet routes  none originatingip none   factory  candidate shared default   5233 checking vxlan tunnels procedure use the show tunnel vxlantunnel command to check for the creation of vxlan tunnels to the remote vteps after receiving evpn routes from the remote leaf routers with vxlan encapsulation the vxlanmgr creates vteps from the evpn routes nexthops each vtep gets an index allocated by the fibmgr per source and destination tunnel ip addresses if the nexthop is resolved in the default network instance the state of the two remote vteps is shown with their own indexes evpn routes are received with next hops 2222 and 4444 respectively 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 46 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming example check vxlan tunnels  factory  candidate shared default   adut3 show tunnel vxlantunnel all  show report for vxlantunnels    vtep address  index  last change    2222  278779228830  20210215t110723000z   4444  278779228829  20210215t181528000z   2 vxlan tunnels 2 active 0 inactive  5234 checking tunneltable entries procedure use the show networkinstance tunneltable all command to display all tunneltable entries when a vtep is created in the vxlantunnel table and a nonzero index is allocated a tunneltable entry is created in the tunneltable of the default networkinstance if the next hop is not resolved to a route in the default networkinstance routetable the index in the vxlan tunnel table shows as 0 for the vtep and no tunneltable is created if the tunnel prefix in the tunneltable is resolved but the system runs out of hardware index resources the tunnel shows in the tunneltable but is not programmed a nonprogrammedreason is displayed example check tunneltable entries  factory  candidate shared default   adut3 show networkinstance default tunneltable all  show report for network instance default tunnel table    ipv4 prefix  owner  type  index  metric  preference  fibprog  last update    222232  vxlanmgr  vxlan  4  0  0  y  20210301t104138590z  444432  vxlanmgr  vxlan  5  0  0  y  20210301t104508633z   2 vxlan tunnels 2 active 0 inactive   show report for network instance default tunnel table  5235 checking statistics about this task when the three leaf routers exchange packets over the vxlan leaf3 displays statistics for all individual vteps statistics include 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 47 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming  globallevel ingressegress packets and octets global inout octets and packets are aggregations of the individual statistics per vtep indiscardedpackets are vxlan packets discarded as a result of a nonexistent local vni packets from a source vtep are not discovered in the control plan and packets are not aggregations of individual per vtep dropped packets  per vtep packets and octets with inout discarded packets procedure use the info from state tunnel vxlantunnel command to check the vtep statistics to clear statistics use the following command tools tunnel vxlantunnel vtep 2222 statistics clear example check statistics  factory  candidate shared default   adut3 info from state tunnel vxlantunnel tunnel  vxlantunnel  vtep 2222  index 278779228830 lastchange 8 hours ago statistics  inoctets 0 inpackets 0 indiscardedpackets 0 outoctets 0 outpackets 0 outdiscardedpackets 0   vtep 4444  index 278779228829 lastchange an hour ago statistics  inoctets 555720 inpackets 5052 indiscardedpackets 0 outoctets 0 outpackets 0 outdiscardedpackets 0   statistics  inoctets 555720 inpackets 5052 indiscardedpackets 0 outoctets 0 outpackets 0    5236 checking for received imet routes and multicast destination creation about this task imet routes are used for autodiscovery and the creation of the default flood list for vxlan in the macvrf when leaf3 receives and imports the imet routes from leaf2 and leaf4 it creates a vxlan default flood list bum frames received on a bridged subinterface are ingressreplicated to the vteps on the list 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 48 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming procedure use the show and info from state commands shown in the following example to check that the imet routes for the bd from leaf2 and leaf4 have been received and they have created multicast destinations in the macvrf note that the vni is received in the pmsi tunnel attribute and not in the routes network layer reachability information nlri example check for received imet routes and multicast destination creation  factory  candidate shared default   adut3 show networkinstance default protocols bgp routes evpn routetype 3 detail  show report for the evpn routes to network  networkinstance default  route distinguisher 22221 tagid  0 originating router  2222 neighbor  2222 received paths  1 path 1 bestvalidused vni  1 route source  neighbor 2222 last modified 9h11m44s ago route preference no med localpref is 100 atomic aggr  false bgp nexthop  2222 as path  i communities  target12341 bgptunnelencapvxlan rr attributes  no originatorid clusterlist is  aggregation  none unknown attr  none invalid reason  none tie break reason none  route distinguisher 44441 tagid  0 originating router  4444 neighbor  4444 received paths  1 path 1 bestvalidused vni  1 route source  neighbor 4444 last modified 9h11m44s ago route preference no med localpref is 100 atomic aggr  false bgp nexthop  4444 as path  i communities  target12341 bgptunnelencapvxlan rr attributes  no originatorid clusterlist is  aggregation  none unknown attr  none invalid reason  none tie break reason none   factory  candidate shared default    factory  candidate shared default   adut3 info from state networkinstance default bgprib evpn ribinout ribinpost imet routes  originatingrouter  ethernettagid  neighbor  networkinstance default  bgprib  evpn  ribinout  ribinpost  imetroutes 22221 originatingrouter 2222 ethernet tagid 0 neighbor 2222  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 49 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming attrid 193 lastmodified 20210215t110721500z usedroute true validroute true bestroute true staleroute false pendingdelete false tiebreakreason none invalidreason  rejectedroute false asloop false nexthopunresolved false clusterloop false   imetroutes 44441 originatingrouter 4444 ethernettagid 0 neighbor 4444  attrid 197 lastmodified 20210215t110721500z usedroute true validroute true bestroute true staleroute false pendingdelete false tiebreakreason none invalidreason  rejectedroute false asloop false nexthopunresolved false clusterloop false         factory  candidate shared default   adut3 info from state networkinstance default bgprib attrsets attrset ribin index 193197 networkinstance default  bgprib  attrsets  attrset ribin index 193  origin igp atomicaggregate false nexthop 2222 med 0 localpref 100 aggregator   pmsitunnel  tunneltype ingressreplication vni 1 tunnelendpoint 2222  communities  extcommunity  target12341 bgptunnelencapvxlan   unknownattributes   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 50 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming  attrset ribin index 197  origin igp atomicaggregate false nexthop 4444 med 0 localpref 100 aggregator   pmsitunnel  tunneltype ingressreplication vni 1 tunnelendpoint 4444  communities  extcommunity  target12341 bgptunnelencapvxlan   unknownattributes       5237 checking for multicastdestinations about this task if the imet routes from leaf2 and leaf4 are imported for macvrf1 the corresponding multicast vxlan destinations are added procedure use the show tunnelinterface vxlaninterface bridgetable multicastdestinations command to check the multicast vxlan destinations are added example check for multicastdestinations  factory  candidate shared default   adut3 show tunnelinterface vxlan1 vxlaninterface 1 bridgetable multicastdestinations destination   show report for vxlaninterface vxlan11 multicast destinations floodinglist    vtep address  egress vni  destinationindex  multicastforwarding    2222  1  278779228840  bum   4444  1  278779228838  bum    summary 2 multicastdestinations   factory  candidate shared default   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 51 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming 5238 checking mactable and macip routes procedure when traffic is exchanged between host3 and host12 the macs are learned on the access bridged subinterfaces and advertised in macip routes the macip routes are imported and the macs programmed in the mactable use the show networkinstance bridgetable mactable all and show networkinstance protocols bgp routes evpn routetype summary commands to check the macip routes and the programmed macs example check mactable and macip routes  factory  candidate shared default   adut3 show networkinstance macvrf1 bridgetable mactable all  mactable of network instance macvrf1    address  destination  dest index  type  active  aging  last update    00000000  vxlaninterfacevxlan11  2787792288  evpn  true  na  20210216t1054   0001  esi01242424242424  46     54000z    000001        00000000  vxlaninterfacevxlan11  2787792288  evpn  true  na  20210216t1054   0002  vtep2222 vni1  40     54000z   00000000  ethernet121  12 learnt true  300  20210216t1054   0003       54000z   00000000  vxlaninterfacevxlan11  2787792288  evpn  true  na  20210216t1054   0004  vtep4444 vni1  38     54000z   total irb macs  0 total 0 active total static macs  0 total 0 active total duplicate macs  0 total 0 active total learnt macs  1 total 1 active total evpn macs  3 total 3 active total irb anycast macs  0 total 0 active total macs  4 total 4 active   factory  candidate shared default   adut3 show networkinstance default protocols bgp routes evpn routetype 2 summary  show report for the bgp route table of networkinstance default  status codes uused valid best xstale origin codes iigp eegp incomplete  bgp router id 3333 as 3333 local as 3333  type 2 macip advertisement routes  status routedis tag  macaddress  ip  neighbor next vni esi  mac    tinguisher id   address   hop    mob    u  22221  0  00000000  0000  2222  2222  1  000000000000        0002      00000000    u  44441  0  00000000  0000  4444  4444  1  012424242424        0001      24000001    u  44441  0  00000000  0000  4444  4444  1  000000000000       0004      0000000 0     3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 52 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming 3 macip advertisement routes 3 used 3 valid   factory  candidate shared default   5239 checking unicast destinations about this task the reception of macip routes also creates unicast destinations in the vxlaninterface in some cases the unicast destinations are ethernet segment es destinations if the macip routes are advertised from an es see multihoming configuration for evpn broadcast domains for details procedure use the show tunnelinterface vxlaninterface bridgetable unicastdestinations command to display the unicast destinations example check unicast destinations  factory  candidate shared default   adut3 show tunnelinterface vxlan1 vxlaninterface 1 bridgetable unicastdestinations destination   show report for vxlaninterface vxlan11 unicast destinations  destinations    vtep address  egress vni  destinationindex  number macs activefailed    2222  1  278779228840  110   4444  1  278779228838  110    ethernet segment destinations    esi  destinationindex  vteps  number macs activefailed    01242424242424000001   2222 4444  000    summary 3 unicastdestinations 2 nones 1 es 2 mac addresses 2 active 0 nonactive   factory  candidate shared default   524 checking mac mobility mac protection and mac loop protection in evpnvxlan bds mac mobility and mac protection are implemented following rfc7432 mac loop protection follows draftietfbessrfc7432bis 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 53 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming 5241 checking mac mobility about this task mac mobility is an event that triggers the fast move and relearn of a mac in a different leaf router mobility is common in dcs with some workloads moving between racks in the same dc evpn provides tools for fast mobility because macip routes are advertised with a sequence number that indicates the latest location of a mac this sequence number is used by the leaf routers to program the mac with the correct vxlan destination procedure to check mac mobility use the show networkinstance bridgetable mactable command example mac mobility 1 of 2 using figure 6 example of evpnvxlan broadcast domain as reference if host2 moves from leaf2 to leaf3 and you review the programming of the mac in leaf4 mac 000000000002 is learned against vxlan destination vtep2222 vni1  factory  candidate shared default  networkinstance macvrf1 bridgetable  adut4 show networkinstance macvrf1 bridgetable mactable all  mactable of network i    address  destination  dest index  type  active  aging  last update    000000000001 lag11  11  learnt true  300 20210216t11        3214000z   000000000002 vxlaninterfacevxlan11  2787793311  evpn  true  na 20210216t11   vtep2222 vni1  82     3215000z   000000000003 vxlaninterfacevxlan11  2787793311  evpn  true  na 20210216t11   vtep3333 vni1  84     3215000z   000000000004 ethernet1131  13  learnt true  300 20210216t11        3214000z   00cafecafe04 ethernet1131  13  static true  na 20210216t11        1026000z   total irb macs  0 total 0 active total static macs  1 total 1 active total duplicate macs  0 total 0 active total learnt macs  2 total 2 active total evpn macs  2 total 2 active total evpn static macs  0 total 0 active total irb anycast macs  0 total 0 active total macs  5 total 5 active  example mac mobility 2 of 2 after the mobility event leaf4 receives the mac with a higher sequence number this makes leaf4 reprogram the mac against leaf3 as shown below 20210216t0333535052530800 dut4 local6debu srbgpmgr bgp49595178402506d vr default 1 peer 1 3333 update peer 1 3333  received bgp update withdrawn length  0 total path attr length  96 flag 0x90 type 14 len 44 multiprotocol reachable nlri address family evpn 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 54 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming nexthop len 4 nexthop 3333 type evpnmac len 33 rd 33331 esi esi0 tag 0 mac len 48 mac 000000000002 ip len 0 ip null label1 1 flag 0x40 type 1 len 1 origin 0 flag 0x40 type 2 len 0 as path flag 0x80 type 4 len 4 med 0 flag 0x40 type 5 len 4 local preference 100 flag 0xc0 type 16 len 24 extended community target12341 bgptunnelencapvxlan macmobilityseq1  factory  candidate shared default   adut4 show networkinstance macvrf1 bridgetable mactable all   mactable of network instance macvrf1     address  destination  dest index  type  active  aging last update    000000000001 lag11  11  learnt true  180 20210216t11         3214000z   000000000002 vxlaninterfacevxlan11  2787793311  evpn  true  na 20210216t11    vtep3333 vni1  84     3354000z   000000000003 vxlaninterfacevxlan11  2787793311  evpn  true  na 20210216t11    vtep3333 vni1  84     3215000z   000000000004 ethernet1131  13  learnt true  180 20210216t11         3214000z   00cafecafe04 ethernet1131  13  static true  na 20210216t11         1026000z   total irb macs  0 total 0 active total static macs  1 total 1 active total duplicate macs  0 total 0 active total learnt macs  2 total 2 active total evpn macs  3 total 3 active total evpn static macs  0 total 0 active total irb anycast macs  0 total 0 active total macs  5 total 5 active    factory  candidate shared default   5242 checking mac protection about this task mac protection refers to the property of a mac that does not move between leaf routers it is always learned against a bridged subinterface you can configure this mac as static but be aware of the following  when a mac is programmed as static the same mac cannot be learned in another subinterace or via evpn if frames arriving on an interface are different than the ones associated with the static mac they are discarded  the mac is now advertised as static in evpn and installed as evpnstatic in the leaf routers attached to the same bd if programmed evpnstatic macs are also protected therefore frames arriving on a local subinterface are discarded if their source mac matches an evpnstatic mac 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 55 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming procedure to program a mac as static use the networkinstance bridgetable staticmac command example mac protection 1 of 2 using figure 6 example of evpnvxlan broadcast domain as reference the following example shows mac 00cafecafe04 configured as static in leaf4  factory  candidate shared default  networkinstance macvrf1 bridgetable  adut4 info staticmac  mac 00cafecafe04  destination ethernet1131    factory  candidate shared default  networkinstance macvrf1 bridgetable  adut4 commit stay all changes have been committed starting new transaction  factory  candidate shared default  networkinstance macvrf1 bridgetable  adut4  factory  candidate shared default  networkinstance macvrf1 bridgetable  adut4 show networkinstance macvrf1 bridgetable mactable all  mactable of network instance macvrf1    address  destination  dest index  type  active  aging  last update    00000000  lag11  11  learnt true  180  20210216t1108  0001       10000z   00000000  vxlaninterfacevxlan11  2787793311  evpn  true  na  20210216t1108  0002  vtep2222 vni1  82     11000z   00000000  vxlaninterfacevxlan11  2787793311  evpn  true  na  20210216t1108  0003  vtep3333 vni1  84     11000z   00000000  ethernet1131  13  learnt true  180  20210216t1108  0004       10000z   00cafeca  ethernet1131  13  static true  na  20210216t1110  fe04       26000z   total irb macs  0 total 0 active total static macs  1 total 1 active total duplicate macs  0 total 0 active total learnt macs  2 total 2 active total evpn macs  2 total 2 active total evpn static macs  0 total 0 active total irb anycast macs  0 total 0 active total macs  5 total 5 active   factory  candidate shared default  networkinstance macvrf1 bridgetable  example mac protection 2 of 2 on the remote leaf routers the mac is received as evpnstatic and programmed this way for example leaf4 receives the route and programs it as follows 20210216t0310274026530800 dut3 local6debu srbgpmgr bgp46284789270039d vr default 1 peer 1 4444 update peer 1 4444  received bgp update withdrawn length  0 total path attr length  96 flag 0x90 type 14 len 44 multiprotocol reachable nlri address family evpn nexthop len 4 nexthop 4444 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 56 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming type evpnmac len 33 rd 44441 esi esi0 tag 0 mac len 48 mac 00cafecafe04 ip len 0 ip null label1 1 flag 0x40 type 1 len 1 origin 0 flag 0x40 type 2 len 0 as path flag 0x80 type 4 len 4 med 0 flag 0x40 type 5 len 4 local preference 100 flag 0xc0 type 16 len 24 extended community target12341 bgptunnelencapvxlan macmobilityseq0static  factory  candidate shared default   adut3 show networkinstance macvrf1 bridgetable mactable all   mactable of network instance macvrf1     address  destination  dest index  type  active aging last update    00cafeca  vxlaninterfacevxlan11  2787792288  evpnstatic true  na  20210216t11   fe04  vtep4444 vni1  38     1027000z   total irb macs  0 total 0 active total static macs  0 total 0 active total duplicate macs  0 total 0 active total learnt macs  0 total 0 active total evpn macs  0 total 0 active total evpn static macs  1 total 1 active total irb anycast macs  0 total 0 active total macs  1 total 1 active   factory  candidate shared default  note that the static macs state depends on the state of the subinterface which they are configured against if the subinterface goes operdown the static mac and evpn route are removed static blackhole macs where the configured destination is blackhole also behave as static macs and are advertised as evpnstatic 5243 mac loop protection mac loop protection in evpn bds is based on the sr linux mac duplication feature this feature detects mac duplication for macs moving  among bridge subinterfaces of the same macvrf  between bridge subinterfaces and evpn in the same macvrf it does not detect mac duplication for macs moving from one vtep to a different vtep in the same mac vrf in addition when a mac is declared as a duplicate  if the blackhole configuration option is added to the interface incoming frames on bridged sub interfaces are discarded if their mac sa or da match the blackhole mac frames encapsulated in vxlan packets are discarded if their inner source mac or destination mac match the blackhole mac in the mactable  the duplicate mac can be overwritten by a higher priority type for example static or evpnstatic or flushed by a tools command blackhole macs that result out of duplicate macs are advertised as regular macs nonstatic 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 57 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming 53 multihoming configuration for evpn broadcast domains sr linux supports allactive multihoming for multihomed peers connected using vxlan as per rfc8365 using figure 6 example of evpnvxlan broadcast domain as a reference leaf2 and leaf3 are multihomed to server1 using allactive multihoming the representation of the multihomed device in the evpn control plane is referred to as an ethernet segment es it is considered allactive and not active active because sr linux supports up to four leaf routers multihomed to the same ce or server with all links being active not just two the allactive multihoming function relies on three different procedures to handle multihoming in the es  designated forwarder df election  splithorizon also known as localbias  aliasing the df is the leaf that forwards bum traffic received from the vxlan into the es to the server only one df can exist per es at a time and it is elected based on the exchange of es routes evpn routes type 4 and the subsequent df election algorithm all leaf routers df and nondf forward knownunicast traffic to the multihomed server the splithorizon or local bias is the procedure that avoids looped packets on the server if server1 hashes the bum traffic to the nondf leaf for example leaf2 without any splithorizon technique the flooded bum packets move to the df leaf4 and back to server1 splithorizon prevents these flooded packets from forwarding back to server1 when the data plane is vxlan the splithorizon mechanism is based on a localbias forwarding mode as defined in rfc8365 this implies that  bum traffic from a local subinterface is always forwarded to the es irrespective of the pe being df for example if host2 sends a broadcast frame it is sent to the es lag11 even though leaf is nondf for es1  bum traffic received over vxlan is never be forwarded to the es if the source vtep matches a leaf that is attached to the same es for example bum traffic from host2 that is forwarded via vxlan to leaf4 is not forwarded to lag11 only to ethernet1131 aliasing is the procedure that allows ecmp loadbalancing from remote leaf routers leaf3 to all leaf routers attached to the same es even though the mac is only advertised by one of the leaf routers in the es for example in figure 6 example of evpnvxlan broadcast domain flows from 000000000001 can only be hashed to leaf2 leaf2 is the only router in the es advertising the mac however because leaf2 and leaf4 advertise the association to the same ethernet segment identifier esi and the macip route for 000000000001 is tagged with esi1 leaf3 can alias the unicast traffic to both leaf routers note that a leaf advertises its association to an es via ad per es routes and its association to an es for a specified macvrf via ad per evi routes both are evpn routes type 1 531 allactive multihoming configurations configuration of allactive multihoming involves four major steps  configuring the serverce with a single lag that connects it to the leaf routers  configuring an es es1 on the leaf routers leaf2 and leaf4 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 58 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming  associating the es interface with the macvrf  optional configuring the ecmp with a value greater than 1 in all the leaf routers attached to the same bd for aliasing this step is only required if multihoming is used in an evpnvxlan bd distributed among multiple leaf routers 5311 ethernet segment configuration details with sr linux ess are control plane entities that reside in the system networkinstance the system networkinstance contains a bgpvpn instance similar to the one in macvrfs this instance hosts the bgp information used by evpn for multihoming routes and the es configuration and state the following example provides es configuration details  factory  candidate shared default   system networkinstance protocols evpn ethernetsegments  adut4 tree detail ethernetsegments evpnmgr  timers evpnmgr   boottimer evpnmgr   activationtimer evpnmgr  bgpinstance id evpnmgr  ethernetsegment name evpnmgr  adminstate evpnmgr  esi evpnmgr  interface evpnmgr  multihomingmode evpnmgr  dfelection evpnmgr   timers evpnmgr    activationtimer evpnmgr the es model uses a bgpvpn instance where the routedistinguisher and exportimport routetargets are taken by bgp and used for the es routes only one instance is allowed and all ess live under this bgp instance the default routedistinguisher for the instance is automatically derived from systemip0 and used in es routes the default importexport routetarget is automatically derived from the esi bytes 1 to 6 from the second highest order byte up to the seventh byte this routetarget is of type esiimport routetarget as per rfc7432 and is used in es routes to ensure they are imported on leaf routers attached to the es ess have an adminstate this is disabled by default it must be toggled to change any of the parameters affecting the evpn control plane the following timers can be configures for ess general boot per es boot and activation  the boottimer is configured globally for all ess this allows the system to synchronize with the rest of the network at reboot and before the es is brought up and its route is advertised  before a boottimer expires the es subinterfaces are operup and the ad routes advertised in all active mode they forward unicast traffic bum is not forwarded until the es subinterfaces become df when the boottimer expires the es route is advertised and the df election takes place  the boottimer can be configured with a value of 06000 seconds because it is linked to the evpnmgr application the boottimer kicks in when the evpnmgr restarts it is recommended that you configure a timer that is long enough for the node to establish its bgp sessions and underlay connectivity before it expires use some transient bum duplicationand es routes are exchanged  the es activation timer allows collecting es routes for the same es from other leaf routers before promoting a node subinterface as df this prevents multiple transient df leaf routers on the same es 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 59 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming and bum duplication to the serverce the es activation timer defaults to 3 seconds but can be set to 0 if fast convergence is needed although this may cause some transient bum duplication the es requires a manual 10byte esi configuration reserved esi values such as esi0 or maxesi 0xffff are not allowed esi values with 000000000000 in bytes 16 are not allowed this prevents the autoderivation of esiimport routetargets as all 0s sr linux supports the default df election algorithm as per rfc8584 no configuration is required  the algorithm also known as type default or type 0 is a modulobased operation that uses the number of leafs in the es and the configured evi values in the contained macvrfs  the default alg orders the candidate list from lowest to highest ip address where the ip address is taken from the originatingip of the es routes and picks up an ordinal of the list based on the outcome of the modulo operation  if the macvrf instances in the es have consecutive evi values load balancing of the df function occurs for example if macvrf1 has a value of evi1 macvrf2 is evi2 both have subinterfaces in lag1 that belong to es1 one of the macvrfs is df and the other is nondf for es1 the es association to an interface must be configured the interface type can be ethernet or lag if lacp is used on the ce as shown in figure 6 example of evpnvxlan broadcast domain only a lag can be associated 532 configuring leaf2 and leaf4 as multihomed nodes to server1 about this task leaf2 and leaf4 behave as a single system to server1 therefore they must be configured with the same lacp parameters for the lag on server1 to come up the adminkey systemidmac and system priority must match on both leaf routers so that the lag comes up procedure step 1 in candidate mode configure the lag that connects to server1 the lag can be lacp enabled or static in this example lacp is used example lag configuration lag1 on leaf4  factory  candidate shared default   adut4 interface ethernet14  factory  candidate shared default  interface ethernet14  adut4 info description es1 ethernet  aggregateid lag1   factory  candidate shared default  interface ethernet14  adut4 interface lag1  factory  candidate shared default  interface lag1  adut4 info adminstate enable vlantagging true subinterface 1  type bridged vlan  encap  singletagged  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 60 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming vlanid 1     lag  lagtype lacp memberspeed 100g lacp  interval fast lacpmode active adminkey 24 systemidmac 000000000024 systempriority 24   example lag configuration lag1 on leaf2  factory  candidate shared default  interface ethernet111  adut2 info description es1 ethernet  aggregateid lag1   factory  candidate shared default  interface ethernet111  adut2 interface lag1  factory  candidate shared default  interface lag1  adut2 info adminstate enable vlantagging true subinterface 1  type bridged vlan  encap  singletagged  vlanid 1     lag  lagtype lacp memberspeed 100g lacp  interval fast lacpmode active adminkey 24 systemidmac 000000000024 systempriority 24   step 2 configure ethernet segment es1 on leaf2 and leaf4 see ethernet segment configuration details for an indepth overview of es functionality and configuration 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 61 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming example es configuration es1 on leaf2  factory  candidate shared default  interface lag1  adut2 system networkinstance  factory  candidate shared default  system networkinstance  adut2 info protocols  evpn  ethernetsegments  bgpinstance 1  ethernetsegment es1  adminstate enable esi 01242424242424000001 interface lag1 multihomingmode allactive     bgpvpn  bgpinstance 1     the esi and mode must match on both leaf routers the following is the minimum configuration for es1 to function across the two leaf routers example es configuration es1 on leaf4  factory  candidate shared default  interface lag1  adut4 system networkinstance  factory  candidate shared default  system networkinstance  adut4 info protocols  evpn  ethernetsegments  bgpinstance 1  ethernetsegment es1  adminstate enable esi 01242424242424000001 interface lag1 multihomingmode allactive     bgpvpn  bgpinstance 1     step 3 configure the association of the es interface with the macvrf in this example interface lag11 is added to the macvrf the association is based on the configuration under the es and no further configuration is needed at the macvrf level 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 62 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming example es interface association with the macvrf adut2 networkinstance macvrf1  factory  candidate shared default  networkinstance macvrf1  adut2 info type macvrf adminstate enable interface ethernet1121   interface lag11   vxlaninterface vxlan11   protocols  bgpevpn  bgpinstance 1  adminstate enable vxlaninterface vxlan11 evi 1   bgpvpn  bgpinstance 1  routetarget  exportrt target12341 importrt target12341     adut4 networkinstance macvrf1  factory  candidate shared default  networkinstance macvrf1  adut4 info type macvrf adminstate enable interface ethernet1131   interface lag11   vxlaninterface vxlan11   protocols  bgpevpn  bgpinstance 1  adminstate enable vxlaninterface vxlan11 evi 1   bgpvpn  bgpinstance 1  routetarget  exportrt target12341 importrt target12341     bridgetable  staticmac  mac 00cafecafe04  destination ethernet1131 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 63 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming    step 4 configure the ecmp with a value greater than 1 in all the leaf routers attached to the same bd to allow for aliasing note this step is only required if multihoming is used in an evpnvxlan bd distributed among multiple leaf routers if the multihoming es is used locally as a layer2 mlag multichassis link aggregation group technique this step can be skipped in the following example leaf3 is configured with ecmp 2 example configure ecmp  factory  candidate shared default  networkinstance macvrf1  adut3 info detail flat  grep ecmp set  networkinstance macvrf1 protocols bgpevpn bgpinstance 1 ecmp 2 step 5 review the configuration and commit the changes example  candidate shared default   adut2 commit stay 5321 use of multihoming as allactive mlag for nonevpn layer2 bds an example of ess in a nonevpn layer2 bd is shown in the following diagram in this scenario evpn only runs locally between the leaf routers of the two pairs but not globally in the network the two leaf tiers leaf45 and leaf23 are connected via layer2 subinterfaces and not vxlan each leaf is configured with two ess leaf4 is configured with es6 for multihoming to server6 and es45 for multihoming to the leaf23 tier the configuration of the es previously described also apply to these topologies with the exception that each es would use a different name esi and lag interface as noted in the multihoming configuration procedure configuring the ecmp with a value greater than 1 in all the leaf routers attached to the same bd is not required if the multihoming es is used locally as a layer2 mlag 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 64 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming figure 7 use of es for layer2 mlag scenarios 533 checking the multihoming operation after the multihomed leaf routers and the remote leaf are configured the es operation must be checked 5331 checking the es status procedure use the show system networkinstance ethernetsegments command to check the status of the es on leaf2 and leaf4 the output from this command must show the same df for the same macvrf on both leaf routers and the same candidate list for the es on both leaf routers the detail form of this command also provides information about timers and the df election example check the es status  leaf4  factory  candidate shared default   adut4 show system networkinstance ethernetsegments es1  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 65 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming es1 is up allactive esi  01242424242424000001 alg  default peers 2222 interface lag1 networkinstances macvrf1 candidates  2222 4444 df interface  lag11  summary 1 ethernet segments up 0 ethernet segments down   factory  candidate shared default   adut4 show system networkinstance ethernetsegments es1 detail  ethernet segment  name  es1 4444 df admin state  enable oper state  up esi  01242424242424000001 multihoming  allactive oper multihoming  allactive interface  lag1 es activation timer  none df election  default oper df election  default last change  20210215t110701412z  macvrf actv timer rem df es1 0 yes  df candidates  networkinstance es peers macvrf1 2222 macvrf1 4444 df   factory  candidate shared default    leaf2  factory  candidate shared default   adut2 show system networkinstance ethernetsegments es1  es1 is up allactive esi  01242424242424000001 alg  default peers 4444 show system networkinstance ethernetsegments es1 networkinstances macvrf1 candidates  2222 4444 df interface  lag11  summary 1 ethernet segments up 0 ethernet segments down   factory  candidate shared default   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 66 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming 5332 checking es and evi routes procedure use the show networkinstance protocols bgp routes evpn routetype summary command to check the exchange of es routes used for df election and es discovery and ad per esevi routes used to indicate the association of leaf services to es note that leaf2 should have a type 4 route for the es originating from leaf4 there should also be one ad per evi and one ad per es route from leaf4 for macvrf1 ad routes are advertised for each macvrf that are part of the es example check es and evi routes  received es routes or routes type 4 on leaf2  factory  candidate shared default   adut2 show networkinstance default protocols bgp routes evpn routetype 4 summary  show report for the bgp route table of networkinstance default  status codes uused valid best xstale origin codes iigp eegp incomplete  bgp router id 2222 as 2222 local as 2222  type 4 ethernet segment routes   status  route  esi  originating  neighbor nexthop    distinguisher   router      u  44440  012424242424 4444  4444  4444     24000001       1 ethernet segment routes 1 used 1 valid   factory  candidate shared default   adut2  received ad routes or routes type 1 on leaf2 the ad per es route uses ethtag maxet all ffs   factory  candidate shared default   adut2 show networkinstance default protocols bgp routes evpn routetype 1 summary show report for the bgp route table of networkinstance default  status codes uused valid best xstale origin codes iigp eegp incomplete  bgp router id 2222 as 2222 local as 2222   type 1 ethernet autodiscovery routes   status  route  esi  tagid  neighbornexthop  vni    distinguisher         u  44441  0124242424  0  4444  4444       2424000001       u  44441  0124242424  4294967295  4444  4444       2424000001      3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 67 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming  2 ethernet autodiscovery routes 2 used 2 valid   factory  candidate shared default    factory  candidate shared default   adut2 show networkinstance default protocols bgp routes evpn routetype 1 detail  show report for the evpn routes to network  networkinstance default  route distinguisher 44441 tagid  0 esi  01242424242424000001 neighbor  4444 received paths  1 path 1 bestvalidused esi  01242424242424000001 route source  neighbor 4444 last modified 4h38m27s ago route preference no med localpref is 100 atomic aggr  false bgp nexthop  4444 as path  i communities  target12341 bgptunnelencapvxlan rr attributes  no originatorid clusterlist is  aggregation  none unknown attr  none invalid reason  none tie break reason none  route distinguisher 44441 tagid  4294967295 esi  01242424242424000001 neighbor  4444 received paths  1 path 1 bestvalidused esi  01242424242424000001 route source  neighbor 4444 last modified 4h38m27s ago route preference no med localpref is 100 atomic aggr  false bgp nexthop  4444 as path  i communities  target12341 esilabel0allactive rr attributes  no originatorid clusterlist is  aggregation  none unknown attr  none invalid reason  none tie break reason none   factory  candidate shared default   5333 checking the macip route about this task macip routes advertised for macs learned on the es subinterfaces are advertised with the esi of es1 the rib state for the macip routes can be used to check this procedure use the show networkinstance protocols bgp routes evpn routetype summary command to check the macip route for mac 000000000001 on leaf3 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 68 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming example check the macip route  factory  candidate shared default   adut3 show networkinstance default protocols bgp routes evpn routetype 2 summary  show report for the bgp route table of networkinstance default  status codes uused valid best xstale origin codes iigp eegp incomplete  bgp router id 3333 as 3333 local as 3  type 2 macip advertisement routes   status routedis  tag macaddress ip  neighbor nexthopvni esi  mac   tinguisher  id  address      mob    u 22221  0 00000000 0000  2222  2222  1  0000000000        0002      000000000 0   u 44441  0 00000000 0000  4444  4444  1  0124242424        0001      2424000001    u 44441  0 00000000 0000  4444  4444  1  0000000000        000 4      0000000000    u 44441  0 00cafeca 0000  4444  4444  1  0000000000 seq0      fe04      0000000000 static    4 macip advertisement routes 4 used 4 valid   factory  candidate shared default   5334 checking the es destination about this task when ad routes are received from leaf2 and leaf4 and the macip route is tagged with the esi leaf3 creates an es destination resolved to as many vteps as leafs advertising the ad routes up to a maximum of the ecmp setting on leaf3 procedure use the show tunnelinterface vxlaninterface bridgetable unicastdestinations command to check the es destination for es1 created on leaf3 example check the es destination  factory  candidate shared default   adut3 show tunnelinterface vxlan1 vxlaninterface 1 bridgetable unicastdestinations destination   show report for vxlaninterface vxlan11 unicast destinations  destinations    vtep address  egress vni  destinationindex  number macs activefailed    2222  1  278779228840  110   4444  1  278779228838  220    3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 69 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming ethernet segment destinations    esi  destinationindex  vteps  number macs activefailed    01242424242424000001   2222 4444  000    summary 3 unicastdestinations 2 nones 1 es 3 mac addresses 3 active 0 nonactive   factory  candidate shared default   5335 checking mac programming procedure use the show networkinstance bridgetable mactable mac command to show how leaf3 programs the macs received for the es as associated with an es destination example check mac programming  factory  candidate shared default   adut3 show networkinstance macvrf1 bridgetable mactable mac 000000000001  mactable of network instance macvrf1  mac  000000000001 destination  vxlaninterfacevxlan11 esi01242424242424000001 dest index  278779228850 type  evpn programming status  success aging  na last update  20210216t155109000z duplicate detect time  na hold down time remaining na   factory  candidate shared default   5336 checking subinterface es association leaf2 about this task on the nondf in this example leaf2 the macvrf interface included in es1 lag11 shows the multicastforwarding flag as none this means that the interface does not forward bum traffic to the ce server when it is received on the vxlan procedure use the info from state command for the subinterface itself to show the association with es1 and the df state example check subinterface es association leaf2  factory  candidate shared default   adut2 info from state networkinstance macvrf1 interface lag11 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 70 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming networkinstance macvrf1  interface lag11  operstate up opermaclearning up index 12 multicastforwarding none    factory  candidate shared default    factory  candidate shared default   adut2 info from state interface lag1 subinterface 1 ethernetsegmentassociation interface lag1  subinterface 1  ethernetsegmentassociation  ethernetsegment es1 esmanaged true designatedforwarder false   5337 checking subinterface es association leaf4 about this task on the df in this example leaf4 the macvrf interface in es1 lag11 shows the multicast forwarding flag as bum procedure use the info from state command for the subinterface itself to show the association with es1 and the df state example check subinterface es association leaf4  factory  candidate shared default   adut4 info from state networkinstance macvrf1 interface lag11 networkinstance macvrf1  interface lag11  operstate up opermaclearning up index 11 multicastforwarding bum    factory  candidate shared default    factory  candidate shared default   adut4 info from state interface lag1 subinterface 1 ethernetsegmentassociation interface lag1  subinterface 1  ethernetsegmentassociation  ethernetsegment es1 esmanaged true designatedforwarder true    3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 71 advanced solutions guide release 2410 evpnvxlan for layer2 and multihoming 5338 evpn related logs the evpnmgr application has logs that are triggered when the df state changes on an es as shown in the following example example evpn related logs rootdut2 srlinux 20210215t0259418885050800 dut2 local6noti srevpnmgr evpn1905190500086n bgpevpn attachment circuit on ethernet segment es1 on network instance macvrf1 and bgp instance 1 is now a nondesignated forwarder 20210215t0259448592950800 dut2 local6noti srevpnmgr evpn1905190500087n bgpevpn attachment circuit on ethernet segment es1 on network instance macvrf1 and bgp instance 1 is now a designated forwarder 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 72 advanced solutions guide release 2410 evpnvxlan for layer 3 6 evpnvxlan for layer 3 the evpn layer 3 configuration model builds on the model for evpn routes described in evpnvxlan for layer2 and multihoming understanding the concepts in the evpnvxlan layer2 chapter is required to understand this chapter this chapter addresses connectivity between subnets across multiple broadcast domains bds of the same tenant as defined in the evpn interfaceless ifl model draftietfbessevpnprefixadvertisement it is based on the advertisement and processing of ip prefixes using evpn type 5 routes this chapter defines how ces or servers can be multihomed to multiple leaf nodes in an evpn ifl network it also describes other evpn l3 topics such as  irb subinterface extensions for evpnvxlan layer 3  unicast routing pece  layer 3 host mobility 61 overview figure 8 evpn ipvrf domain in a multitenant dc shows four leaf routers attached to the same tenant or ipvrf domain servers are connected to different subnets and therefore different bds the leaf routers provide intersubnet forwarding by using the evpn ifl model as defined in draftietfbessevpn prefixadvertisement the sr linux implementation is fully standard and thirdparty routers such as leaf4 can be connected to the same ipvrf domain as sr linux routers 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 73 advanced solutions guide release 2410 evpnvxlan for layer 3 figure 8 evpn ipvrf domain in a multitenant dc the procedures in this chapter define the configuration and operation for  the evpn ifl model for evpnvxlan layer 3 and the evpn ip prefix routes  multihoming in an evpnvxlan layer 3 solution  host route mobility aspects  pece unicast routing on evpnvxlan layer 3 networks  evpnvxlan layer 3 feature parity for ipv6 prefixes 62 configuration of evpnvxlan ipvrf domains the following figure shows the configuration of an evpnvxlan ipvrf10 distributed in three leaf routers with different subnets and multihoming for server1 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 74 advanced solutions guide release 2410 evpnvxlan for layer 3 figure 9 example of evpnvxlan ipvrf domain 621 preconfiguring the underlay network before configuring the overlay bd the underlay connectivity must be configured this chapter uses the same underlay configuration defined for evpnvxlan layer2 and multihoming see configuring the underlay network and review this section to understand the underlay configuration before proceeding 622 configuring the leaf3 ipvrf domain about this task after leaf3 is preconfigured as defined in configuring the underlay network use the following steps to enable evpnvxlan on leaf3 as shown in figure 9 example of evpnvxlan ipvrf domain leaf3 is attached to ipvrf10 and host3 is connected to bd3 bd3 is mapped to subnet 10311024 and its irb subinterface is the defaultgateway to all hosts in bd3 procedure step 1 in candidate mode create the interfaces and bridged subinterfaces that connect leaf3 bd3 to host3 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 75 advanced solutions guide release 2410 evpnvxlan for layer 3 in this example  ethernet12 connects host3 to leaf3 although this interface could be defined untagged this example configures the interface as tagged vlantagging true  a subinterface with index 3 is created under the interface and must be configured as type bridged bridged subinterfaces can be associated with macvrf instances as described in evpnvxlan for layer2 and multihoming  the subinterface uses vlanid optional which captures any traffic that is not specified in other subinterfaces of the same interface note the irb subinterface expects no vlan tags so that traffic forwarded from host3 can be routed if host3 sends frames tagged with a vlanid the frames would be classified in the bd3 context but the subinterface does not strip off the vlan tag and frames are not routed example  factory  candidate shared default  interface ethernet12   info adminstate enable vlantagging true subinterface 3  type bridged adminstate enable vlan  encap  singletagged  vlanid optional     step 2 after creating the access subinterfaces create the vxlaninterfaces this allows macvrfs of the same bd to be connected throughout the ip fabric in this example no other leaf router is attached to bd3 so no vxlaninterface is needed in bd3 the configuration of the vxlaninterface is only shown for completeness see evpnvxlan for layer2 and multihoming for details on vxlaninterfaces and their characteristics example vxlan1 vxlaninterface 3 configuration  factory  candidate shared default  tunnelinterface vxlan1   info vxlaninterface 3  type bridged ingress  vni 3   step 3 ipvrf instances in the leaf routers are also connected by vxlan tunnels therefore vxlan interfaces of type routed must be created in this example tunnelinterface vxlan2 vxlaninterface 10 is configured while the configuration of the routed vxlaninterface is similar to the bridged vxlaninterface this type ensures a routed 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 76 advanced solutions guide release 2410 evpnvxlan for layer 3 vxlaninterface only attaches to an ipvrf and a bridged vxlaninterface only attaches to a mac vrf example vxlan tunnel configuration  factory  candidate shared default  tunnelinterface vxlan2   info vxlaninterface 10  type routed ingress  vni 10   step 4 configure the irb interface and subinterface that links bd3 and ipvrf10 together to allow packets fromto subnet 10311024 to route tofrom remote subnets in the local or remote leaf routers of the same tenant note that because bd3 is not present in another leaf the irb subinterface is not configured as an anycastgw subinterface however an operator may want to configure all irb subinterfaces as anycastgw in case the bd is extended later see configuring the ipvrf domain on leaf2 and leaf4 for anycastgw configuration details example irb configuration  factory  candidate shared default  interface irb0   info subinterface 3  ipv4  adminstate enable address 1031125424     step 5 configure the networkinstance type macvrf and associate it with the bridged irb interfaces and the vxlaninterface in the example that follows bd3 is connected to host3 and to the irb subinterface that is also attached to ipvrf10 although the b is not needed in this example the bgpevpn and vxlan configuration is shown for completeness for details about bgpvpn bgpevpn and vxlaninterface configuration see evpnvxlan for layer2 and multihoming example macvrf configuration and bridged interface association  factory  candidate shared default  networkinstance bd3   info type macvrf interface ethernet123   interface irb03   vxlaninterface vxlan13   protocols  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 77 advanced solutions guide release 2410 evpnvxlan for layer 3 bgpevpn  bgpinstance 1  adminstate enable vxlaninterface vxlan13 evi 3 ecmp 2   bgpvpn  bgpinstance 1  routetarget  exportrt target645003 importrt target645003     step 6 configure ipvrf10 with bgpevpn enabled using the evpn ifl model in this example ipvrf is configured with the irb03 interface for connectivity to bd3 and vxlan210 this allows the extension of ipvrf10 to remote leaf routers a loopback interface is configured in the ipvrf to test connectivity among ipvrfs of the same tenant when configured all local routes learned on ipvrf10 routetable are advertised in ip prefix routes or ipv6 prefix routes for local ipv6 routes example enable evpn ifl model on ipvrf10  factory  candidate shared default  networkinstance ipvrf   info networkinstance ipvrf10  type ipvrf interface irb03   interface lo102   vxlaninterface vxlan210   protocols  bgpevpn  bgpinstance 1  vxlaninterface vxlan210 evi 10 ecmp 2   bgpvpn  bgpinstance 1  routetarget  exportrt target6450010 importrt target6450010      the bgpvpn instance is configured as described in chapter evpnvxlan for layer2 and multi homing with a networkinstance of type ipvrf likewise the bgpevpn container enables evpn in the ipvrf and associates it to the routed vxlaninterface the rd and rt can be autoderived 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 78 advanced solutions guide release 2410 evpnvxlan for layer 3 from the evi just like they can in macvrfs explicitly configured rdrts can override the auto configured ones import and export policies are supported step 7 review the changes if correct commit the changes example  commit stay  candidate shared default   623 configuring the ipvrf domain on leaf2 and leaf4 about this task leaf2 and leaf4 are configured in the same way as leaf3 but with the addition of multihoming anycastgw interfaces and related configurations use the following procedure to enable evpnvxlan layer 3 on leaf2 and leaf4 considerations for configuring the irb subinterfaces step 4 are provided in irb subinterface considerations if needed procedure step 1 in candidate mode create the interfaces and bridged subinterfaces including lag to connect host2 host4 server1 and ce3 in this example ethernet segment es1 is associated with lag1 and is multihomed to server1 lag lacp is enabled on lag1 but can be disabled and the adminkey systemid mac and systempriority match on both leaf2 and leaf4 example interfaces and bridged subinterfaces configuration leaf2  interfaces in leaf2  factory  candidate shared default  interface    info interface ethernet111  description es1 ethernet  aggregateid lag1   interface ethernet112  description tohost2 adminstate enable vlantagging true subinterface 24  type bridged vlan  encap  singletagged  vlanid optional      interface ethernet122  description toce3 vlantagging true subinterface 2  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 79 advanced solutions guide release 2410 evpnvxlan for layer 3 type bridged adminstate enable vlan  encap  singletagged  vlanid 2      interface lag1  adminstate enable vlantagging true subinterface 24  type bridged vlan  encap  singletagged  vlanid 24     lag  lagtype lacp memberspeed 100g lacp  interval fast lacpmode active adminkey 24 systemidmac 000000000024 systempriority 24    example interfaces and bridged subinterfaces configuration leaf4  interfaces in leaf4  factory  candidate shared default  interface    info interface ethernet14  description es1 ethernet  aggregateid lag1   interface ethernet113  description tohost4 adminstate enable vlantagging true subinterface 4  type bridged adminstate enable vlan  encap  singletagged  vlanid optional    3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 80 advanced solutions guide release 2410 evpnvxlan for layer 3   interface lag1  adminstate enable vlantagging true subinterface 24  type bridged vlan  encap  singletagged  vlanid 24     lag  lagtype lacp memberspeed 100g lacp  interval fast lacpmode active adminkey 24 systemidmac 000000000024 systempriority 24    step 2 create the allactive ethernet segment es1 that is attached to leaf2 and leaf4 details about the es configuration and operation can be found in evpnvxlan for layer2 and multihoming note that the following example only shows the ethernet segment configuration the bgpvpnbgpinstance 1 must also be configured as described in evpnvxlan for layer2 and multihoming example es configuration  es1 on leaf2  factory  candidate shared default  system networkinstance protocols evpn ethernetsegments   info bgpinstance 1  ethernetsegment es1  adminstate enable esi 01242424242424000001 interface lag1 multihomingmode allactive    es1 on leaf4  factory  candidate shared default  system networkinstance protocols evpn ethernetsegments  adut4 info bgpinstance 1  ethernetsegment es1  adminstate enable esi 01242424242424000001 interface lag1 multihomingmode allactive   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 81 advanced solutions guide release 2410 evpnvxlan for layer 3 step 3 after the access bridged subinterfaces are created create the vxlaninterfaces to facilitate connectivity between networkinstances across the ip fabric the macvrf networkinstances require both vxlaninterfaces of type bridged and ipvrfs of type routed in the following example all the vxlaninterfaces for all networkinstances on leaf2 and leaf4 nodes are configured as follows example vxlaninterface configuration  vxlaninterfaces on leaf2  factory  candidate shared default  tunnelinterface    info tunnelinterface vxlan1  vxlaninterface 2  type bridged ingress  vni 2   vxlaninterface 24  type bridged ingress  vni 24    tunnelinterface vxlan2  vxlaninterface 10  type routed ingress  vni 10     vxlaninterfaces on leaf4  factory  candidate shared default  tunnelinterface    info tunnelinterface vxlan1  vxlaninterface 4  type bridged ingress  vni 4   vxlaninterface 24  type bridged ingress  vni 24    tunnelinterface vxlan2  vxlaninterface 10  type routed ingress  vni 10    3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 82 advanced solutions guide release 2410 evpnvxlan for layer 3 step 4 configure the irb subinterfaces that link the macvrf and ipvrf networkinstances for inter subnetforwarding see irb subinterface considerations for details on configuring irb subinterfaces example irb subinterface configuration  irb interfaces in leaf2  factory  candidate shared default  interface irb   info interface irb0  subinterface 2  ipv4  adminstate enable address 2011224   arp  learnunsolicited true    anycastgw    subinterface 24  ipv4  adminstate enable address 10111224   address 1011125424  anycastgw true primary  address 1021125424   arp  learnunsolicited true debug  messages  hostroute  populate dynamic    evpn  advertise dynamic      anycastgw      irb interfaces in leaf4  factory  candidate shared default  interface irb   info interface irb0  subinterface 4  ipv4  adminstate enable address 10411424   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 83 advanced solutions guide release 2410 evpnvxlan for layer 3 address 1041125424  anycastgw true primary  arp  learnunsolicited true debug  messages    anycastgw    subinterface 24  ipv4  adminstate enable address 10111424   address 1011125424  anycastgw true primary  arp  learnunsolicited true debug  messages  hostroute  populate dynamic    evpn  advertise dynamic      anycastgw    step 5 configure the networkinstances of type macvrf and associate the bridged subinterfaces irb subinterfaces and vxlaninterfaces then enable bgpevpn example network instance configuration and association  macvrfs in leaf2  factory  candidate shared default  networkinstance bd   info networkinstance bd2  type macvrf interface ethernet1222   interface irb02   vxlaninterface vxlan12   protocols  bgpevpn  bgpinstance 1  adminstate enable 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 84 advanced solutions guide release 2410 evpnvxlan for layer 3 vxlaninterface vxlan12 evi 2 ecmp 2   bgpvpn  bgpinstance 1  routetarget  exportrt target645002 importrt target645002      networkinstance bd24  type macvrf interface ethernet11224   interface irb024   interface lag124   vxlaninterface vxlan124   protocols  bgpevpn  bgpinstance 1  adminstate enable vxlaninterface vxlan124 evi 24 ecmp 2   bgpvpn  bgpinstance 1  routetarget  exportrt target6450024 importrt target6450024       macvrfs in leaf4  factory  candidate shared default  networkinstance bd   info networkinstance bd24  type macvrf interface irb024   interface lag124   vxlaninterface vxlan124   protocols  bgpevpn  bgpinstance 1  adminstate enable vxlaninterface vxlan124 evi 24 ecmp 2   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 85 advanced solutions guide release 2410 evpnvxlan for layer 3 bgpvpn  bgpinstance 1  routetarget  exportrt target6450024 importrt target6450024      networkinstance bd4  type macvrf interface ethernet1134   interface irb04   vxlaninterface vxlan14   protocols  bgpevpn  bgpinstance 1  adminstate enable vxlaninterface vxlan14 evi 4 ecmp 2   bgpvpn  bgpinstance 1  routetarget  exportrt target645004 importrt target645004      step 6 configure ipvrf10 with bgpevpn enabled with the evpn ifl model the ipvrf is configured with the irb subinterfaces previously created for bd2 bd4 and bd24 the ipvrf instances are connected vxlan tunnels so routed vxlaninterfaces need to be associated with ipvrf10 a loopback interface is configured in the ipvrf to test connectivity among ipvrfs of the same tenant in the following example leaf2s ipvrf is configured with a bgp pece neighbor to ce3 example ipvrf10 configuration  ipvrf10 in leaf2  factory  candidate shared default  networkinstance ipvrf   info networkinstance ipvrf10  type ipvrf interface irb02   interface irb024   interface lo102   vxlaninterface vxlan210   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 86 advanced solutions guide release 2410 evpnvxlan for layer 3 protocols  bgpevpn  bgpinstance 1  vxlaninterface vxlan210 evi 10 ecmp 2   bgp  adminstate enable afisafi ipv4unicast  adminstate enable  autonomoussystem 645002 routerid 2222 group ebgppece  adminstate enable exportpolicy exportall importpolicy importall afisafi ipv4unicast  adminstate enable   neighbor 20113  peeras 645003 peergroup ebgppece localas asnumber 645002   transport  localaddress 20112    bgpvpn  bgpinstance 1  routetarget  exportrt target6450010 importrt target6450010       ipvrf10 in leaf4  factory  candidate shared default  networkinstance ipvrf   info networkinstance ipvrf10  type ipvrf interface irb04   interface irb024   interface lo102   vxlaninterface vxlan210   protocols  bgpevpn  bgpinstance 1  vxlaninterface vxlan210 evi 10 ecmp 2   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 87 advanced solutions guide release 2410 evpnvxlan for layer 3 bgpvpn  bgpinstance 1  routetarget  exportrt target6450010 importrt target6450010      step 7 review the changes and if correct commit the changes example adut2 commit stay  candidate shared default   6231 irb subinterface considerations the following are considerations for configuring irb subinterfaces performed in step 4 irb subinterfaces on bds that are distributed to multiple leaf nodes must be configured with at least one anycastgw ip address and an anycastgw mac address when the anycastgw container is configured the anycastgw mac address is autoderived as 00005e000101 in all the leaf nodes the mac address can also be explicitly configured if needed in addition  the same anycastgw ip and mac address must be configured on all irbs of the same bd  all the hosts attached to the same bd use the same defaultgateway that is the anycastgw ip irrespective of the leaf they are connected to for example irb0 subinterfaces 24 are configured with the same anycastgw ip on leaf2 and leaf4 10111254 in the configuration example  default gateway redundancy in dcs is realized using anycastgws and not vrrp anycastgws avoid upstream tromboning for hosts that are multihomed to multiple leaf nodes or for singlehomed hosts that move to other leaf nodes of the same bd irb subinterfaces on bds that are distributed may also be configured with nonanycastgw ip addresses this is only done when separate ips are needed to check connectivity per leaf for example when leaf2 is configured with nonanycastgw ips 101112 and 10211254 and leaf4 is configured with 104114 and anycastgw ips exist in multiple nodes the anycastgw ips should not be used in icmp tools to check the availability of a leaf nonanycastgw ips should be used instead irb subinterfaces on distributed bds should be configured with the following commands as shown for subinterface 24 in leaf2 and leaf4 in the configuration example  arp learnunsolicited true  triggers the learning of arp entries out of any arp packet arriving at the irb subinterface regardless of whether there was an arprequest issued from the irb  arp hostroute populate dynamic  creates host routes arpnd in the ipvrf routetable from learned dynamic arp entries in the irb the arpnd host routes are then advertised to the remote leaf nodes this assists the routing of downstream traffic to a specified host without hairpinning traffic via another leaf connected to the same bd of the host but not connected to the host directly  arp evpn advertise dynamic  advertises evpn macip routes that include the mac and the ip of the dynamic arp entries the advertisement of these routes synchronizes the arp caches in all the irb subinterfaces of the same bd 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 88 advanced solutions guide release 2410 evpnvxlan for layer 3 irb subinterfaces on bds that are not distributed that is bds attached to only one leaf node do not need to be configured with the following  arp hostroutepopulate dynamic as downstream routing is always direct to the connected leaf  arp evpn advertise dynamic as arp entries do not need to be synchronized with any other node examples of nondistributed bds are bd2 bd4 and bd3 as shown in figure 9 example of evpnvxlan ipvrf domain their corresponding irb subinterfaces do not create hostroutes or advertise evpn mac ip routes for the arp entries 624 configuring evpn ifl interoperability to evpn iff unnumbered model about this task while evpn ifl for vxlan is supported by most dc vendors nuage wbx or vscvrs use the evpn iff unnumbered model by default the sr linux evpn ifl interfaceless model does not interoperate with the evpn iff interfacefull model however it is possible to configure the sr linux evpn ifl model to interoperate with the evpn iff model for more information about evpn ifl vs evpn iff models see the sr linux evpnvxlan user guide and draftietfbessevpnprefixadvertisement procedure to configure interoperability in ipvrf10 configure the advertisegatewaymac command as shown in the following example example evpn iff interoperability in ipvrf10 configuration  factory  candidate shared default  networkinstance ipvrf10   protocols bgpevpn bgpinstance 1 routes routetable macip advertisegatewaymac value  usage advertisegatewaymac truefalse if set to true in an ipvrf where bgpevpn is enabled a macip route containing the gatewaymac is advertised this gatewaymac matches the mac advertised along with the evpn ifl routes type 5 for the ipvrf networkinstance this advertisement is needed so that the evpn ifl interfaceless model in the ipvrf can interoperate with a remote system working in evpn iff interfaceful unnumbered mode positional arguments value truefalse default false when set to true the node advertises a macip route using all of the following  gatewaymac for ipvrf10 that is the systemmac  rdrt nexthop and vni of ipvrf10  null ip address esi or ethernet tag id example macip route advertisement in the following example the macip route advertised is from leaf3 the mac address matches the systemmac advertised in any local rt5s  factory  candidate shared default  networkinstance ipvrf10  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 89 advanced solutions guide release 2410 evpnvxlan for layer 3  protocols bgpevpn bgpinstance 1 routes routetable macip advertisegatewaymac true  factory  candidate shared default  networkinstance ipvrf10   commit stay all changes have been committed starting new transaction 20210415t0118246881850700 dut3 local6debu srbgpmgr bgp494251351393922d vr default 1 peer 1 1111 update peer 1 1111  send bgp update withdrawn length  0 total path attr length  81 flag 0x90 type 14 len 44 multiprotocol reachable nlri address family evpnandidate shared default root 8 thu 0118am nexthop len 4 nexthop 3333 type evpnmac len 33 rd 333310 esi esi0 tag 0 mac len 48 mac 000103ff0000 ip len 0 ip null label1 10 flag 0x40 type 1 len 1 origin 0 flag 0x40 type 2 len 0 as path flag 0x40 type 5 len 4 local preference 100 flag 0xc0 type 16 len 16 extended community target6450010 bgptunnelencapvxlan for ipv6 nuage wbx devices support two evpn l3 ipv6 modes iff unnumbered and iff numbered the sr linux interoperability mode enabled by the advertisegatewaymac command only works with devices that use evpn iff unnumbered this is because evpn ifl and evpn iff unnumbered models both use the same format in the ip prefix route and differ only in the additional macip route for the gatewaymac evpn ifl and evpn iff numbered models have different ip prefix route formats and cannot interoperate 625 checking the evpn ifl model in ipvrfs when configured the state of the ipvrf10 on the three leaf nodes and basic connectivity should be checked when the leaf nodes attached to ipvrf10 exchange at least one evpn ipprefix route on all leaf nodes of the tenant the bgpmgr requests the fibmgr to create a vxlan tunnel to each nexthop of the received evpn routes type 5 rt5s this assumes the tunnel had not already been created when a vxlan tunnel to the remote vtep exists the bgpmgr requests the nexthop resolution to the fibmgr and if it resolves the rt5 is installed in the ipvrf routetable using leaf3 as a reference you can check that rt5s are received from the two remote leaf nodes and then verify that vxlan tunnels exist to their vteps and the rt5s are installed in the routetable loopbacks are configured on each ipvrf10 instance to verify reachability 6251 checking ipvrf10 state and connectivity procedure use the show networkinstance protocols bgp routes evpn routetype prefix command to check rt5s for the loopbacks 22222222 and 44444444 advertised by the remote leaf nodes you can check that the routes contain the expected ipvrf10 vni routetarget and the macnh which is used as the inner destination mac when sending vxlan packets to the prefix 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 90 advanced solutions guide release 2410 evpnvxlan for layer 3 example check ipvrf10 state and connectivity  factory  candidate shared default    show networkinstance default protocols bgp routes evpn routetype 5 prefix 2222222232 detail  show report for the evpn routes in networkinstance default  route distinguisher 222210 tagid  0 ipprefixlen  32 ipprefix  2222222232 neighbor  2222 gateway ip  0000 received paths  1 path 1 bestvalidused esi  00000000000000000000 vni  10 route source  neighbor 2222 last modified 46m16s ago route preference no med localpref is 100 atomic aggr  false bgp nexthop  2222 as path  i communities  target6450010 macnh000102ff0000 bgptunnelencapvxlan rr attributes  no originatorid clusterlist is  aggregation  none unknown attr  none invalid reason  none tie break reason none   factory  candidate shared default    show networkinstance default protocols bgp routes evpn routetype 5 prefix 4444444432 summary  show report for the bgp route table of networkinstance default  status codes uused valid best xstale origin codes iigp eegp incomplete  bgp router id 3333 as 3333 local as 3333  type 5 ip prefix routes   status  route  tag  ipaddress  neighbor  nexthop  vni  gateway    distinguisher  id         u  444410  0  4444444432  4444  4444  10  0000    1 ip prefix routes 1 used 1 valid   factory  candidate shared default   6252 checking for vxlan tunnel creation procedure when the routes are correct the vxlan tunnels are created use the show networkinstance tunnel table all command to verify that the vxlan tunnels are created 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 91 advanced solutions guide release 2410 evpnvxlan for layer 3 example check for vxlan tunnel creation  factory  candidate shared default    show networkinstance default tunneltable all  show report for network instance default tunnel table    ipv4 prefix  owner  type  index  metric  preference fibprog  last update    222232  vxlanmgr  vxlan  7  0  0  y  20210413t104309483z   444432  vxlanmgr  vxlan  6  0  0  y  20210413t104309144z    2 vxlan tunnels 2 active 0 inactive   show report for network instance default tunnel table    factory  candidate shared default   6253 checking for remote vteps and associated destinations procedure use the show tunnel vxlantunnel vtep command to show the remote vteps and the associated destinations a destination is the combination of the vtep and vni that is created when the evpn routes are received and the vxlan tunnel is created ip destinations are created from rt5s example check for remote vteps and associated destinations  show tunnel vxlantunnel vtep 2222  show report for vxlantunnels vtep  vtep address 2222 index  202418627561 last change  20210413t114709000z  destinations    tunnel interface  vxlan interface  egress vni  type    vxlan1  1  1  multicastdestination   vxlan2  10  10  ipdestination    1 bridged destinations 1 multicast 0 unicast 0 es 1 routed destinations   factory  candidate shared default    show tunnel vxlantunnel vtep 4444  show report for vxlantunnels vtep  vtep address 4444 index  202418627553 last change  20210414t154023000z 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 92 advanced solutions guide release 2410 evpnvxlan for layer 3  destinations    tunnel interface  vxlan interface  egress vni  type    vxlan1  1  1  multicastdestination   vxlan1  1  1  unicastdestination   vxlan2  10  10  ipdestination    2 bridged destinations 1 multicast 1 unicast 0 es 1 routed destinations   factory  candidate shared default   6254 checking ipvrf10 route table procedure use the show routetable ipv4unicast summary command to check the ipvrf10 route table to ensure all the remote subnets and hosts are received and installed all interface and local routes are automatically advertised in rt5s because ecmp2 is configured in the ipvrf10 there are two ecmp paths for the 10111024 subnet which is attached to both leaf2 and leaf4 example check ipvrf10 route table  factory  candidate shared default  networkinstance ipvrf10   show routetable ipv4unicast summary  ipv4 unicast route table of network instance ipvrf10    prefix  id  active  route type  metric  pref  nexthop type  nexthop          interface    3131313132  0  true  bgpevpn  0  170  2222 indirect  none   2011024  0  true  bgpevpn  0  170  2222 indirect  none   2011332  0  true  bgpevpn  0  170  2222 indirect  none   2222222232  0  true  bgpevpn  0  170  2222 indirect  none   3333333332  0  true  host  0  0  none extract  none   4444444432  0  true  bgpevpn  0  170  4444 indirect  none   10111024  0  true  bgpevpn  0  170  2222 indirect  none         4444 indirect  none   10111132  0  true  bgpevpn  0  170  2222 indirect  none   10211024  0  true  bgpevpn  0  170  2222 indirect  none   10311024  0  true  local  0  0  103113 direct  irb03   10311132  0  true  arpnd  0  1  103111 direct  irb03   10311332  0  true  host  0  0  none extract  none   1031125432  0  true  host  0  0  none extract  none   1031125532  0  true  host  0  0  none broadcast  none   10411024  0  true  bgpevpn  0  170  4444 indirect  none    15 ipv4 routes total 15 ipv4 prefixes with active routes 1 ipv4 prefixes with active ecmp routes   factory  candidate shared default  networkinstance ipvrf10  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 93 advanced solutions guide release 2410 evpnvxlan for layer 3 6255 checking routetable state for a rt5 procedure use the info from state routetable command to check the routetable state for a rt5 this can be useful to understand how the rt5 is resolved to a vxlan tunnel and what vxlan vni inner source and destination macs are be used when sending vxlan packets to that route the following uses ecmp route 10111024 on leaf3 the routes nexthop group has two separate nexthops pointing at the remote leaf2 and leaf4 vteps example check routetable state for a rt5  factory  candidate shared default  networkinstance ipvrf10   info from state routetable ipv4unicast route 10111024 id 0 routetable  ipv4unicast  route 10111024 id 0  routetype bgpevpn routeowner bgpevpnmgr metric 0 preference 170 active true lastappupdate a day ago nexthopgroup 202418627581 resilienthash false fibprogramming  status success      factory  candidate shared default  networkinstance ipvrf10   info from state routetable nexthopgroup 202418627581 nexthop  routetable  nexthopgroup 202418627581  nexthop 0  nexthop 202418627569 resolved true  nexthop 1  nexthop 202418627565 resolved true     factory  candidate shared default  networkinstance ipvrf10   info from state routetable nexthop 202418627569 routetable  nexthop 202418627569  type indirect ipaddress 2222 resolvingtunnel  ipprefix 222232 tunneltype vxlan tunnelowner vxlanmgr  vxlan  vni 10 sourcemac 000103ff0000 destinationmac 000102ff0000  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 94 advanced solutions guide release 2410 evpnvxlan for layer 3   6256 monitoring pings procedure use the tools system trafficmonitor command to monitor pings between the local leaf3 loopback and leaf2s loopback 22222222 the inner source and destination macs that are associated to the rt5s nexthop that are used in the actual packets note that the sourcemac is the chassis mac advertised in the macnh of the local rt5s example monitor pings  factory  candidate shared default  networkinstance ipvrf10   a ping is sent from leaf3 to 22222222 the loopback on leaf2s ipvrf10  networkinstance ipvrf10  factory  candidate shared default  networkinstance ipvrf10   ping 22222222 using network instance ipvrf10 ping 22222222 22222222 5684 bytes of data 64 bytes from 22222222 icmpseq1 ttl64 time488 ms 64 bytes from 22222222 icmpseq2 ttl64 time476 ms c  22222222 ping statistics  2 packets transmitted 2 received 0 packet loss time 1000ms rtt minavgmaxmdev  4767482748880092 ms  the monitor command catches the inner packet sent on vxlan  factory  candidate shared default  networkinstance ipvrf10   tools system trafficmonitor destinationaddress 33333333 protocol icmp running as user root and group root this could be dangerous capturing on monit 1 0000000000 ethernet11 000102ff0000 000103ff0000 22222222 33333333 icmp 146 echo ping reply id0x580c seq1256 ttl64  the source mac is the local chassis mac  factory  candidate shared default    info from state platform chassis macaddress platform  chassis  macaddress 000103ff0000    that source mac is also advertised in the rt5s macnh  factory  candidate shared default    info from state networkinstance default bgprib evpn ribinout riboutpost ipprefixroutes 333310 ethernettagid 0 ipprefixlength 32 ipprefix 3333333332 neighbor 2222 networkinstance default  bgprib  evpn  ribinout  riboutpost  ipprefixroutes 333310 ethernettagid 0 ipprefixlength 32 ipprefix 3333333332 neighbor 2222  esi 00000000000000000000 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 95 advanced solutions guide release 2410 evpnvxlan for layer 3 gatewayip 0000 vni 10 attrid 132 nexthop 3333        factory  candidate shared default    info from state networkinstance default bgprib attrsets attrset ribout index 132 networkinstance default  bgprib  attrsets  attrset ribout index 132  origin igp atomicaggregate false nexthop 3333 med 0 localpref 100 aggregator   pmsitunnel   communities  extcommunity  target6450010 macnh000103ff0000 bgptunnelencapvxlan   unknownattributes       the received evpn ifl ip prefix routes are only installed in the ipvrf10 routetable if    the import routetarget matches the rt5 routetarget the rt5s vni matches the vni of the vxlaninterface in the ipvrf10 the rt5s gatewayip is zero additional guidelines  importing an rt5 into multiple ipvrf networkinstances is not supported due to the vni restriction an ipvrf can only use a single vni for ingress and egress vxlan packets this is a td3 limitation  the route nexthop cannot be changed in ipvrf networkinstances it is always the systemip in this release  the ipvrf bgpevpn bgp instance can be operdown for the same reasons as the bgpevpn bgp instance can be down in macvrfs see evpnvxlan for layer2 and multihoming for details  vxlan statistics are also accounted for when evpnifl is used  no mtu checks are done for vxlan in evpnifl if the routed packet plus the vxlan overhead exceeds the underlay interface mtu of the egress interface in the default networkinstance the packet is still encapsulated and sent to the remote leaf no statistics increment or drops occur 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 96 advanced solutions guide release 2410 evpnvxlan for layer 3  outer ttl for vxlan packets is always initialized to 255 and not copied or propagated from or to the inner ip packet 626 checking pece routing on an ipvrf with evpnifl in an evpnvxlan layer 3 network pece routing refers to the unicast routing between a ce connected to a bd in a leaf node and the irb subinterface of the ipvrf connected to the same bd static or bgp routing is supported in sr linux bfd can also be used between the irb and the ce 6261 checking pcce routing on ipvrf procedure figure 9 example of evpnvxlan ipvrf domain depicts a pece bgp session between ce3 and ip vrf10 in leaf2 use the following configuration in ipvrf10 to enable a pece bgp session to ce3 example check pece routing on ipvrf  ipvrf10 in leaf2  factory  candidate shared default  networkinstance ipvrf   info networkinstance ipvrf10  type ipvrf interface irb02   interface irb024   interface lo102   vxlaninterface vxlan210   protocols  bgpevpn  bgpinstance 1  vxlaninterface vxlan210 evi 10 ecmp 2   bgp  adminstate enable afisafi ipv4unicast  adminstate enable  autonomoussystem 645002 routerid 2222 group ebgppece  adminstate enable exportpolicy exportall importpolicy importall afisafi ipv4unicast  adminstate enable   neighbor 20113  peeras 645003 peergroup ebgppece localas asnumber 645002  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 97 advanced solutions guide release 2410 evpnvxlan for layer 3  transport  localaddress 20112    bgpvpn  bgpinstance 1  routetarget  exportrt target6450010 importrt target6450010       factory  candidate shared default  networkinstance ipvrf10   show protocols bgp neighbor 20113  bgp neighbor summary for networkinstance ipvrf10 flags s static d dynamic l discovered by lldp b bfd enabled  disabled  slow     netinst  peer  group  flags  peeras  state  uptime  afi  rxactive          safi  tx    ipvrf10  20113  ebgppece  s  645003  established 1d21h  ipv4  2111         46m56s  unicast     1 configured neighbors 1 configured sessions are established0 disabled peers 0 dynamic peers 6262 pece ebgp session import and export policies by default all local routes to the ipvrf routetable are automatically advertised in evpnifl routes this includes static routes local routes igp routes arpnd host routes and so on consider the following for routes coming from or going to a pece ebgp session  evpnifl to pece ebgp an export policy must be configured so that evpn ifl routes can be re advertised to a ce on the pece bgp session  pece ebgp to evpnifl either an import policy to accept the routes or ebgpdefaultpolicy import rejectall false must be configured so that the bgp routes are readvertised to evpnifl for example the following two policies are configured to import and export all routes example pece ebgp session import and export policies  factory  candidate shared default  networkinstance ipvrf10   info routingpolicy policy importall routingpolicy  policy importall  statement 1  action  accept      3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 98 advanced solutions guide release 2410 evpnvxlan for layer 3   factory  candidate shared default  networkinstance ipvrf10   info routingpolicy policy exportall routingpolicy  policy exportall  statement 1  action  accept       6263 additional pece considerations bgp pece sessions can only be established with primary ip addresses therefore in an irb with both an anycastgwip and a nonanycastgwip the bgp session can be setup against the nonanycastgwip only if it is configured as primary a bgp session is not established if the configured bgp localaddress for that session is a nonprimary address adding a secondary address on an interface where the primary address has established a bgp session is supported example bgp pece sessions and primary ip addresses in the following the local ip address is primary but not an anycastgw ip  factory  candidate shared default  networkinstance ipvrf10   info from state interface irb0 subinterface 2 interface irb0  subinterface 2  adminstate enable ipmtu 1500 name irb02 ifindex 1082130435 operstate up lastchange a day ago ipv4  allowdirectedbroadcast false address 2011224  anycastgw false origin static primary status preferred  arp  duplicateaddressdetection true timeout 14400 learnunsolicited true debug  messages  neighbor 20113  linklayeraddress 000103ff000b origin dynamic expirationtime an hour from now  hostroute  populate dynamic   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 99 advanced solutions guide release 2410 evpnvxlan for layer 3  evpn     anycastgw  virtualrouterid 1 anycastgwmac 00005e000101 anycastgwmacorigin vridautoderived  62631 changing the route preference procedure in sr linux the route selection across bgp families evpnifl vs pece ipv4v6 occurs based on the routetable preference for example if the same prefix 3131313132 is received on the ip vrf10s routetable via bgp pece ipv4 family and via evpnifl the route with the lowest routetable preference wins by default the preference for both evpnifl and bgp pece is set to 170 therefore for the pece route to be selected use the protocols bgp preference ebgp command to change the preference for the pece routes to a value lower than 170 as shown in the following example example changing the route preference  factory  candidate shared default  networkinstance ipvrf10   diff protocols  bgp  preference   ebgp 160     factory  candidate shared default  networkinstance ipvrf10   commit stay all changes have been committed starting new transaction  factory  candidate shared default  networkinstance ipvrf10   show routetable ipv4unicast prefix 3131313132 detail  ipv4 unicast route table of network instance ipvrf10  destination  3131313132 id  0 route type  bgp metric  0 preference  160 active  true last change  20210415t090553745z resilient hash false  next hops 1 entries 20113 indirect resolved by 2011332 arpnd via 20113 direct via irb02  destination  3131313132 id  1 route type  bgpevpn metric  0 preference  170 active  false 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 100 advanced solutions guide release 2410 evpnvxlan for layer 3 last change  20210415t085850600z resilient hash false  next hops 1 entries 3333 indirect resolved by none none   factory  candidate shared default  networkinstance ipvrf10  in the current release there is no ecmp across different owners for instance across evpnifl and pece bgp only within the same routing owner 627 checking multihoming in an evpnvxlan layer 3 network an evpnvxlan layer 3 network needs to provide a multihoming solution where upstream and downstream traffic is always routed efficiently without hairpinning as shown in figure 10 example of evpnvxlan layer 3 multihoming leaf2 and leaf4 are allactive multihomed to server1 the use of irb anycastgw ip and mac addresses along with the synchronization of macs and arps on the multihomed leaf nodes provides efficient routing figure 10 example of evpnvxlan layer 3 multihoming 6271 consistency check for anycastgw ips the configuration of the anycastgw must be consistent in the irb subinterfaces of leaf2 and leaf4 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 101 advanced solutions guide release 2410 evpnvxlan for layer 3 62711 checking anycastgw ip address consistency procedure use the info from state command for the subinterface to check the consistency of the anycastgw configuration example check configuration consistency  leaf2 irb024 subinterface  factory  candidate shared default    info from state interface irb0 subinterface 24 interface irb0  subinterface 24  adminstate enable ipmtu 1500 name irb024 ifindex 1082130457 operstate up lastchange 2 days ago ipv4  allowdirectedbroadcast false address 1011125424  anycastgw true origin static primary status preferred  anycastgw  virtualrouterid 1 anycastgwmac 00005e000101 anycastgwmacorigin vridautoderived   leaf4 irb024 subinterface  factory  candidate shared default    info from state interface irb0 subinterface 24 interface irb0  subinterface 24  adminstate enable ipmtu 1500 name irb024 ifindex 1082130457 operstate up lastchange 2 days ago ipv4  allowdirectedbroadcast false address 1011125424  anycastgw true origin static primary status preferred  anycastgw  virtualrouterid 1 anycastgwmac 00005e000101 anycastgwmacorigin vridautoderived  the anycastgwmac address is automatically derived by default as 00005e0001vrid per draft ietfbessevpnintersubnetforwarding it can also be manually configured either way the anycast gw ip and mac must match in the two leaf nodes 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 102 advanced solutions guide release 2410 evpnvxlan for layer 3 62712 checking anycastgw ip address resolution about this task in the next example host12 is configured with defaultgw 10111254 the anycastgw ip address of bd24 when host12 arps for the defaultgw ip the arp request can be hashed to either leaf regardless which leaf gets the arp request the arp reply contains the anycastgw mac unicast traffic from host12 can now be hashed to either leaf for example leaf2 in figure 10 example of evpnvxlan layer 3 multihoming and the receiving leaf node always routes the traffic directly to leaf3 without sending it to the peer leaf first leaf4 in the example using no anycastgw ips or mac addresses causes hairpinning and uses unnecessary spine bandwidth procedure use the arp and ping commands to show the resolution of the anycastgw ip from host12 and upstream routed traffic example anycastgw ip address resolution host12 arp n i veth2 host12 host12 host12 ping 33333333 ping 33333333 33333333 5684 bytes of data 025815782587 000064010101  broadcast ethertype arp 0x0806 length 42 request whohas 10111254 tell 101111 length 28 025815787404 00005e000101  000064010101 ethertype arp 0x0806 length 60 reply 10111254 isat 00005e000101 length 46 025815787436 000064010101  00005e000101 ethertype ipv4 0x0800 length 98 101111  33333333 icmp echo request id 3140 seq 1 length 64 025815791393 00005e000101  000064010101 ethertype ipv4 0x0800 length 98 33333333  101111 icmp echo reply id 3140 seq 1 length 64 64 bytes from 33333333 icmpseq1 ttl63 time896 ms  33333333 ping statistics  9 packets transmitted 9 received 0 packet loss time 8008ms rtt minavgmaxmdev  2362379289621907 ms host12 arp n i veth2 address hwtype hwaddress flags mask iface 10111254 ether 00005e000101 c veth2 62713 checking synchronization in both multihome leaf nodes about this task as shown in figure 10 example of evpnvxlan layer 3 multihoming downstream routed traffic from leaf3 to host12 is routed directly by leaf2 or leaf4 without hairpinning regardless of who gets the packets this occurs because host12s arp and the mac entries are synchronized in both multi homed leaf nodes leaf2 learns 101111000064010101 host12 ip and mac as dynamic and advertises both in macip routes that are imported by leaf4 leaf4 installs the host12 arp and mac entries as evpn however the mac points at the local es lag interface and forwarding is direct to host12 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 103 advanced solutions guide release 2410 evpnvxlan for layer 3 procedure to verify the synchronization in both multihome leaf nodes show the arp entries for the irb subinterface and show the mac table report for the networkinstance example synchronization in both multihome leaf nodes  factory  candidate shared default    show arpnd arpentries interface irb0 subinterface 24   interface  subinterf  neighbor  origin  link layer address  expiry    ace        irb0  24  101111  dynamic  000064010101  3 hours from now  irb0  24  101114  evpn  000104ff0041     total entries  2 0 static 2 dynamic   factory  candidate shared default    show networkinstance bd24 bridgetable mactable all  mactable of network instance bd24    address  destination  dest  type activeaging last update     index        00005e00  irb  0  irbint true  na  20210413t104214000z   0101    erface        anycast     00006401  lag124  20  learnt  true  285  20210415t101311000z   0101         00006601  ethernet11224  17  learnt  true  285  20210415t101311000z   0101         000102ff  irb  0  irbint true  na  20210413t104214000z   0041    erface      000104ff  vxlaninterface  202418 evpn  true  na  20210413t104254000z   0041  vxlan124         vtep4444 vni24  653897 static      total irb macs  1 total 1 active total static macs  0 total 0 active total duplicate macs  0 total 0 active total learnt macs  2 total 2 active total evpn macs  0 total 0 active total evpn static macs  1 total 1 active total irb anycast macs  1 total 1 active total macs  5 total 5 active   factory  candidate shared default    arp and mac entries for leaf4  factory  candidate shared default    show arpnd arpentries interface irb0 subinterface 24   interface  subinterf  neighbor  origin  link layer address  expiry   ace        irb0  24  101111  evpn  000064010101    irb0  24  101112  evpn  000102ff0041    3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 104 advanced solutions guide release 2410 evpnvxlan for layer 3  total entries  2 0 static 2 dynamic   factory  candidate shared default    show networkinstance bd24 bridgetable mactable all  mactable of network instance bd24    address  destination dest  type activeaging last update    index        00005e000101  irb  0 irbint  true  na 20210413t1042    erface    38000z     anycast      000064010101  lag124  18 evpn  true  na 20210415t1004        12000z   000066010101 vxlaninterfacevxlan124 202418evpn  true  na 20210415t1013  vtep2222 vni24 654989    12000z   000102ff0041 vxlaninterfacevxlan124 202418evpn  true  na 20210413t1042  vtep2222 vni24 654989static    54000z   000104ff0041 irb 0 irbint  true  na 20210413t1042    erface    38000z   total irb macs  1 total 1 active total static macs  0 total 0 active total duplicate macs  0 total 0 active total learnt macs  0 total 0 active total evpn macs  2 total 2 active total evpn static macs  1 total 1 active total irb anycast macs  1 total 1 active total macs  5 total 5 active   factory  candidate shared default   6272 nonanycastgw ip addresses in addition to using anycastgw ips for the routed traffic the multihomed leaf nodes also have non anycastgw ips that can be used for icmp the examples that follow check the availability of each individual leaf irb leaf2 and leaf4 62721 checking leaf2 irb availability procedure use the show interfaces command to check the leaf2 irb availability leaf2 has a nonanycastgw ip of 101112 example check leaf2 irb availability  factory  candidate shared default  networkinstance ipvrf10   show interfaces irb024  net instance  ipvrf10 interface  irb024 oper state  up ip mtu  1500 prefix origin status 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 105 advanced solutions guide release 2410 evpnvxlan for layer 3  10111224 static preferred 1011125424 static preferred primary anycast 1021125424 static preferred 2001db82425464 static preferred primary anycast fe802005efffe0010164 linklayer preferred anycast fe802012fffeff4164 linklayer preferred   factory  candidate shared default  networkinstance ipvrf10  62722 checking leaf4 irb availability procedure use the show interfaces command to check the leaf4 irb availability leaf4 has a nonanycastgw ip of 101114 in the same irb example check leaf4 irb availability  factory  candidate shared default  networkinstance ipvrf10   show interfaces irb024  net instance  ipvrf10 interface  irb024 oper state  up ip mtu  1500 prefix origin status  10111424 static preferred 1011125424 static preferred primary anycast fe802005efffe0010164 linklayer preferred anycast fe802014fffeff4164 linklayer preferred   factory  candidate shared default  networkinstance ipvrf10  62723 checking nonanycastgw ips reachability procedure use the arp and ping commands to check the nonanycastgw ips reachability both nonanycastgw ips are reachable from host12 arp requests to nonanycastgw ips reply with the chassis mac of the leaf and not with the anycastgw mac of the irb this allows using the non anycastgw ips for troubleshooting purposes when there are anycastgw ips on the same irbs the example output from host12 demonstrates this example nonanycastgw ips reachability from host host12 arp n i veth2 address hwtype hwaddress flags mask iface 10111254 ether 00005e000101 c veth2 host12 ping 101112 ping 101112 101112 5684 bytes of data 032541291765 000064010101  broadcast ethertype arp 0x0806 length 42 request whohas 101112 tell 101111 length 28 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 106 advanced solutions guide release 2410 evpnvxlan for layer 3 032541295105 000102ff0041  000064010101 ethertype arp 0x0806 length 60 reply 101112 isat 000102ff0041 length 46 032541295130 000064010101  000102ff0041 ethertype ipv4 0x0800 length 98101111  101112 icmp echo request id 3307 seq 1 length 64 032541299204 000102ff0041  000064010101 ethertype ipv4 0x0800 length 98 101112  101111 icmp echo reply id 3307 seq 1 length 64 64 bytes from 101112 icmpseq1 ttl64 time759 ms  101112 ping statistics  4 packets transmitted 4 received 0 packet loss time 3003ms rtt minavgmaxmdev  2073368475962269 ms host12 arp n i veth2 address hwtype hwaddress flags mask iface 10111254 ether 00005e000101 c veth2 101112 ether 000102ff0041 c veth2 host12 ping 101114 ping 101114 101114 5684 bytes of data 032552696934 000064010101  broadcast ethertype arp 0x0806 length 42 request whohas 101114 tell 101111 length 28 032552700615 000104ff0041  000064010101 ethertype arp 0x0806 length 60 reply 101114 isat 000104ff0041 length 46 032552700649 000064010101  000104ff0041 ethertype ipv4 0x0800 length 98 101111  101114 icmp echo request id 3318 seq 1 length 64 032552703463 000104ff0041  000064010101 ethertype ipv4 0x0800 length 98 101114  101111 icmp echo reply id 3318 seq 1 length 64 64 bytes from 101114 icmpseq1 ttl64 time664 ms  101114 ping statistics  3 packets transmitted 3 received 0 packet loss time 2003ms rtt minavgmaxmdev  2200382166482006 ms host12 arp n i veth2 address hwtype hwaddress flags mask iface 101114 ether 000104ff0041 c veth2 10111254 ether 00005e000101 c veth2 101112 ether 000102ff0041 c veth2 6273 additional anycast gateway considerations the following guidelines also apply for using anycastgw in sr linux in a bgpevpnenabled macvrf with an irb subinterface the following applies whether the ips are configured as primary anycastgw or neither of these  all ipv4 and ipv6 addresses associated with the irb subinterface are advertised in separate macip routes  the anycastgwmac and its corresponding anycastgw ip address are advertised in a macip route  any other existing nonanycastgw ip is advertised along with the interface mac hwmac in a macip route 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 107 advanced solutions guide release 2410 evpnvxlan for layer 3 for example if irb024 is configured in leaf2 with anycastgw ipmac1011125424 005e00000101 and 10111224 is also configured as nonanycastgw ip two macip routes are advertised in the context of bd24 macip route 10111254 005e00000101 and macip route 101112 hwmac1 for ipv6 local link addresses llds are also advertised in addition to global addresses when the irb subinterface is admin disabled the irb mac addresses are removed from the mactable and withdrawn from evpn arp requests and neighbor solicitation messages for the irb subinterface ip addresses from the hosts connected to the broadcast domain are only processed when coming from local subinterfaces these messages cannot be processed when received over vxlan so each of the leaf routers attached to the same bd need to have their anycast irb subinterface operationally up to process the requests for the local hosts 62731 checking protection flags per mac address about this task the irb mac addresses are protected in the mactable if they are not anycastgwmacs protection means that received frames are dropped if their mac sa match a protected mac the mactable state shows the protection flag per mac procedure use the info from state networkinstance bridgetable mactable to check the protection flags per mac address example mactable state  factory  candidate shared default    info from state networkinstance bd24 bridgetable mactable mac  networkinstance bd24  bridgetable  mactable  mac 00005e000101  destinationtype irbinterface destinationindex 0 type irbinterfaceanycast lastupdate 2 days ago destination irb isprotected false  mac 000102ff0041  destinationtype irbinterface destinationindex 0 type irbinterface lastupdate 2 days ago destination irb isprotected true  mac 000104ff0041  destinationtype vxlan destinationindex 202418653897 type evpnstatic lastupdate 2 days ago destination vxlaninterfacevxlan124 vtep4444 vni24 isprotected true   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 108 advanced solutions guide release 2410 evpnvxlan for layer 3   63 testing and checking layer 3 host mobility in evpnvxlan layer 3 networks multiple leaf nodes are attached to the same bd hosts of the same subnet can be connected to any of those leaf nodes they can also move between leaf nodes of the same bd in either case the upstream and downstream traffic must be efficient and avoid hairpinning this is shown in the following figure where leaf2 and leaf4 configurations are modified no es and host12 was originally connected to leaf2 upstream traffic from host12 to host3 must be routed by leaf2 to leaf3 directly if host12 later moves to leaf4 upstream traffic to host3 must be routed by leaf4 to leaf3 directly this is accomplished using anycastgw ips and macs on the irb interfaces when host12 is attached to leaf2 downstream traffic from host3 must be sent from leaf3 to leaf2 directly if host12 later moves to leaf4 the routers need to update their tables quickly so that leaf3 routes the traffic to leaf4 directly and no bandwidth is wasted on the spines because of unnecessary hairpinning this is achieved by learning host12s ip address in the routetable of the connected leaf as a 32 route and advertising that host route in an evpn ifl route upon a mobility event to leaf4 leaf2 withdraws the host route as fast as possible and leaf4 then advertises the host12 host route in an evpn ifl route figure 11 example of l3 host mobility 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 109 advanced solutions guide release 2410 evpnvxlan for layer 3 631 configuring efficient host routing about this task in the initial configuration host12 is connected to leaf2 for leaf3 to route traffic to host12 directly to leaf2 leaf2 needs to learn host12s ip and advertise its host route in an evpnifl route procedure to configure efficient host routing set the following parameter definitions as shown in the example  learnunsolicited true  triggers the node to snoopprocess all solicited and unsolicited arp messages received on subinterfaces no vxlan and learns the corresponding arpnd entries as dynamic by default the command is false and only solicited entries are learned which does not guarantee host mobility when enabled dynamic arpnd entries are learned from the following messages received on the sub interfaces if the ips fall into the local subnets  arp and neighbor solicitation requests  gratuitous arp requests and unsolicited neighbor advertisements  hostroute populate dynamic triggers the creation of arpnd host routes in the ipvrf10 routetable out of dynamic arp entries these are disabled by default the arpnd host routes are not installed in the fib they are only used in the control plane and advertised to the evpnifl network to attract traffic from leaf3 the arpnd host routes can be exported in any routing protocol such as evpn ifl routes bgp ipv4ipv6 routes ospf and isis they are supported in networkinstances ipvrf and default  evpn advertise dynamic  triggers the advertisement of evpn macip routes for the dynamic learned arp entries and allows the synchronization of the arp entries in all irb subinterfaces of the same bd this is only supported on irb subinterfaces the macip routes that are advertised for arpnd entries contain the s bit set if the corresponding mac entry in the mactable is static note that an equivalent command can be used for nd entries example efficient host routing model  subinterface 24  factory  candidate shared default  interface irb0 subinterface 24   info ipv4  adminstate enable address 10111224   address 1011125424  anycastgw true primary  arp  learnunsolicited true debug  messages  hostroute  populate dynamic    3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 110 advanced solutions guide release 2410 evpnvxlan for layer 3 evpn  advertise dynamic      anycastgw   the next examples show how an arp request from host12 to a random ip in the subnet is enough for the irb024 to learn the dynamic arp it can then create a host route that is advertised as an evpn ifl route and imported by leaf3 example leaf2  host12 unsolicited arp request  factory  candidate shared default    show arpnd arpentries interface irb0 subinterface 24   interface  subinterface  neighbor  origin link layer address expiry   irb0  24 101114  evpn  000104ff0041     total entries  1 0 static 1 dynamic  example debug messages  arp request received 20210415t0458056518610700 dut2 local6info srarpndmgr arpnd1773177319334i received arp request on interface irb024 10247  22 from datapath source mac  000064010101 source ip  101111 target mac  000000000000 target ip  10111200 example triggered learning of rt5 and rt2 advertisements 20210415t0458060199550700 dut2 local6debu srbgpmgr bgp493351762128215d vr default 1 peer 1 3333 update peer 1 3333  send bgp update withdrawn length  0 total path attr length  85 flag 0x90 type 14 len 48 multiprotocol reachable nlri address family evpn nexthop len 4 nexthop 2222 type evpnipprefix len 34 rd 222210 tag 0 ipprefix 10111132 gwip 0000 label 10 flag 0x40 type 1 len 1 origin 0 flag 0x40 type 2 len 0 as path flag 0x80 type 4 len 4 med 0 flag 0x40 type 5 len 4 local preference 100 flag 0xc0 type 16 len 24 extended community target6450010 macnh000102ff0000 bgptunnelencapvxlan 20210415t0458060200030700 dut2 local6debu srbgpmgr bgp493351762128216d vr default 1 peer 1 3333 update peer 1 3333  send bgp update withdrawn length  0 total path attr length  97 flag 0x90 type 14 len 45 multiprotocol reachable nlri address family evpn nexthop len 4 nexthop 2222 type evpnmac len 37 rd 222224 esi esi0 tag 0 mac len 48 mac 000064010101 ip len 4 ip 101111 label1 24 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 111 advanced solutions guide release 2410 evpnvxlan for layer 3 flag 0x40 type 1 len 1 origin 0 flag 0x40 type 2 len 0 as path flag 0x40 type 5 len 4 local preference 100 flag 0xc0 type 16 len 16 extended community target6450024 bgptunnelencapvxlan  factory  candidate shared default    show arpnd arpentries interface irb0 subinterface 24  interface sub  neighbor  origin  link layer  expiry   interface    address     irb0  24 101111  dynamic  000064010101  3 hours from now   irb0  24 101114  evpn  000104ff0041     total entries  2 0 static 2 dynamic   factory  candidate shared default    factory  candidate shared default  networkinstance ipvrf10   show routetable ipv4unicast prefix 10111132 detail  ipv4 unicast route table of network instance ipvrf10  destination  10111132 id  0 route type  arpnd metric  0 preference  1 active  true last change  20210415t115805653z resilient hash false  next hops 1 entries 101111 direct via irb024   factory  candidate shared default  networkinstance ipvrf10  example leaf3 imports routes as bgpevpn host route  factory  candidate shared default  networkinstance ipvrf10   show routetable ipv4unicast summary  ipv4 unicast route table of network instance ipvrf10    prefix  id active  route  metric pref nexthop  nexthop      type    type interface    2011024  0  true  bgpevpn  0  170  2222 indirect  none   2011332  0  true  bgpevpn  0  170  2222 indirect  none   2222222232  0  true  bgpevpn  0  170  2222 indirect  none   3131313132  0  true  host  0  0  none extract  none   3131313132  1  false  bgpevpn  0  170  2222 indirect  none   3333333332  0  true  host  0  0  none extract  none   4444444432  0  true  bgpevpn  0  170  4444 indirect  none   10111024  0  true  bgpevpn  0  170  2222 indirect  none         4444 indirect  none   10111132  0  true  bgpevpn  0  170  2222 indirect  none   10211024  0  true  bgpevpn  0  170  2222 indirect  none   10311024  0  true  local  0  0  103113 direct  irb03   10311132  0  true  arpnd  0  1  103111 direct  irb03   10311332  0  true  host  0  0  none extract  none  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 112 advanced solutions guide release 2410 evpnvxlan for layer 3  1031125432  0  true  host  0  0  none extract  none   1031125532  0  true  host  0  0  none broadcast  none   10411024  0  true  bgpevpn  0  170  4444 indirect  none    16 ipv4 routes total 15 ipv4 prefixes with active routes 1 ipv4 prefixes with active ecmp routes   factory  candidate shared default  networkinstance ipvrf10  632 mobility event  efficient host routing when host12 is attached to leaf2 the arp entry must be maintained even if host12 does not send any traffic if the entry is removed or ages out the associated arpnd host route in ipvrf10 is removed and the evpnifl route withdrawn this can cause hairpinning for traffic routed from leaf3 to maintain the host12 arp entry and other dynamic arpnd entries the system supports timerbased arpnd refreshes arprequest for the host ip timerbased refreshes are triggered 30 seconds before the arp ageout timer expires and irrespective of the arrival of packets requiring resolution for the entry note that in sr os the arpproactiverefresh command is needed so that entries are always refreshed irrespective of the arrival of packets that hit the entry in sr linux this is the default behavior so there is no command to enable the timerbased refreshes when host12 moves from leaf2 to leaf4 leaf4 must advertise the host route for 10111132 in evpnifl as fast as possible and leaf2 withdraws its evpnifl route for it the process used by leaf2 and leaf4 to update their arproutetables when host12 moves between them is called evpn layer 3 host mobility sr linux provides this support per section 4 of draftietfbessevpninter subnetforwarding evpn layer 3 host mobility supports the three cases specified in the draft  host12 moves to leaf4 and generates a garp  host12 moves to leaf4 and generates traffic but not arp  host12 moves to leaf4 and remains silent to support fast mobility sr linux supports triggered refreshes triggered refreshes arprequests on events and not based on timer expiration are issued from irb024 leaf nodes for the existing dynamic arp entry 101111000064010101 the following events apply  an evpn macip route for 101111 000064010101 is received  an evpn route for 000064010101 no ip is received  000064010101 ages out in the mactable or the entry in the mac table is cleared manually as shown in figure 11 example of l3 host mobility when host12 moves to leaf4 and if it issues a garp or ethernet traffic the advertised routes immediately updates the arproute tables on both leaf nodes leaf3 then changes its nexthop for host12 from leaf2 to leaf4 example silent move  host2 initially attached to leaf2  factory  candidate shared default    show arpnd arpentries interface irb0 subinterface 24 ipv4address 101111  interface sub  neighbor  origin  link layer  expiry   interface    address   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 113 advanced solutions guide release 2410 evpnvxlan for layer 3   irb0  24  101111  dynamic  000064010101  3 hours from now   total entries  1 0 static 1 dynamic   factory  candidate shared default    show networkinstance bd24 bridgetable mactable mac 000064010101  mactable of network instance bd24  mac  000064010101 destination  lag124 dest index  20 type  learnt programming status  success aging  2680 last update  20210415t143245000z duplicate detect time  na hold down time remaining na   factory  candidate shared default   example silent move  initial leaf4  factory  candidate shared default    show arpnd arpentries interface irb0 subinterface 24 ipv4address 101111  interface sub  neighbor  origin  link layer  expiry   interface    address     irb0  24  101111  evpn  000064010101     total entries  1 0 static 1 dynamic   factory  candidate shared default    show networkinstance bd24 bridgetable mactable mac 000064010101  mactable of network instance bd24  mac  000064010101 destination  vxlaninterfacevxlan124 vtep2222 vni24 dest index  202418654989 type  evpn programming status  success aging  na last update  20210415t141500000z duplicate detect time  na hold down time remaining na   factory  candidate shared default   example silent move  watch command output for leaf3 every 20s show routetable ipv4unicast prefix 10111132 detail executions 903 thu 074140am  ipv4 unicast route table of network instance ipvrf10  destination  10111132 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 114 advanced solutions guide release 2410 evpnvxlan for layer 3 id  0 route type  bgpevpn metric  0 preference  170 active  true last change  20210415t141500450z resilient hash false  next hops 1 entries 2222 indirect resolved by none none  example silent move  move host12 to leaf2 in this example host12 is moved to leaf4 to simulate a silent move immediately after flushing mac 000064010101 in leaf2 the macip routes are withdrawn and leaf2 issues three triggered refreshes  factory  candidate shared default    20210415t0743164228160700 dut2 local6info srarpndmgr arpnd1773177320438 i sending arp request on interface irb024 10247  22 source mac  00005e000101 source ip  10111254 target mac  000000000000 target ip  101111 ethernet sa 00005e000101 ethernet da ffffffffffff 20210415t0743164228160700 dut2 local6info srarpndmgr arpnd1773177320438i sending arp request on interface irb024 10247  22 source mac  00005e000101 source ip  10111254 target mac  000000000000 target ip  101111 ethernet sa 00005e000101 ethernet da ffffffffffff 20210415t0743164228160700 dut2 local6info srarpndmgr arpnd1773177320438i sending arp request on interface irb024 10247  22 source mac  00005e000101 source ip  10111254 target mac  000000000000 target ip  101111 ethernet sa 00005e000101 ethernet da ffffffffffff flag 0x90 type 15 len 77 multiprotocol unreachable nlri address family evpn type evpnmac len 37 rd 222224 esi esi0 tag 0 mac len 48 mac 000064010101 ip len 4 ip 101111 label1 0 type evpnmac len 33 rd 222224 esi esi0 tag 0 mac len 48 mac 000064010101 ip len 0 ip null label1 0 example silent move  leaf2 updates when the refreshes arrive at host12 in leaf4 the arp reply is consumed by leaf4 since the mac destination address matches the anycastgw mac address leaf4 then advertises the mac ip routes and ip prefix route for host12 type evpnipprefix len 34 rd 444410 tag 0 ipprefix 10111132 gwip 0000 label 10 flag 0x40 type 1 len 1 origin 0 flag 0x40 type 2 len 0 as path flag 0x80 type 4 len 4 med 0 flag 0x40 type 5 len 4 local preference 100 flag 0xc0 type 16 len 24 extended community target6450010 macnh000104ff0000 bgptunnelencapvxlan 20210415t0743187635510700 dut2 local6debu srbgpmgr bgp493351762169872d vr default 1 peer 1 4444 update peer 1 4444  received bgp update withdrawn length  0 total path attr length  97 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 115 advanced solutions guide release 2410 evpnvxlan for layer 3 flag 0x90 type 14 len 45 multiprotocol reachable nlri address family evpn nexthop len 4 nexthop 4444 type evpnmac len 37 rd 444424 esi esi0 tag 0 mac len 48 mac 000064010101 ip len 4 ip 101111 label1 24 type evpnmac len 33 rd 444424 esi esi0 tag 0 mac len 48 mac 000064010101 ip len 0 ip null label1 24 flag 0x40 type 1 len 1 origin 0 flag 0x40 type 2 len 0 as path flag 0x40 type 5 len 4 local preference 100 flag 0xc0 type 16 len 16 extended community target6450024 bgptunnelencapvxlan type evpnipprefix len 34 rd 444410 tag 0 ipprefix 10111132 gwip 0000 label 10 flag 0x40 type 1 len 1 origin 0 flag 0x40 type 2 len 0 as path flag 0x80 type 4 len 4 med 0 flag 0x40 type 5 len 4 local preference 100 flag 0xc0 type 16 len 24 extended community target6450010 macnh000104ff0000 bgptunnelencapvxlan 20210415t0743187669230700 dut2 local6info srarpndmgr arpnd1773177320450i the arp entry for 101111 has been updated after the move leaf2 and leaf4 tables are updated and leaf3 points at leaf4 as the next hop for the host12 route example silent move  leaf2 tables  factory  candidate shared default    show arpnd arpentries interface irb0 subinterface 24 ipv4address 101111  interface sub  neighbor  origin  link layer  expiry   interface    address     irb0  24  101111  evpn  000064010101     total entries  1 0 static 1 dynamic   factory  candidate shared default    show networkinstance bd24 bridgetable mactable mac 000064010101  mactable of network instance bd24  mac  000064010101 destination  vxlaninterfacevxlan124 vtep4444 vni24 dest index  202418653897 type  evpn programming status  success aging  na last update  20210415t144318000z duplicate detect time  na hold down time remaining na   factory  candidate shared default   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 116 advanced solutions guide release 2410 evpnvxlan for layer 3 example silent move  leaf4 tables  factory  candidate shared default    show arpnd arpentries interface irb0 subinterface 24 ipv4address 101111  interface sub  neighbor  origin  link layer  expiry   interface    address     irb0  24  101111  dynamic  000064010101 3 hrs from now    total entries  1 0 static 1 dynamic   factory  candidate shared default    factory  candidate shared default    show networkinstance bd24 bridgetable mactable mac 000064010101  mactable of network instance bd24  mac  000064010101 destination  lag124 dest index  18 type  learnt programming status  success aging  2875 last update  20210415t144318000z duplicate detect time  na hold down time remaining na   factory  candidate shared default   example silent move  watch command output for leaf3 every 20s show routetable ipv4unicast prefix 10111132 detail executions 976 thu 074430am  ipv4 unicast route table of network instance ipvrf10  destination  10111132 id  0 route type  bgpevpn metric  0 preference  170 active  true last change  20210415t144319767z resilient hash false  next hops 1 entries 4444 indirect resolved by none none  64 evpnvxlan layer 3 feature parity for ipv6 prefixes all the features discussed in this chapter are supported for ipv6 prefixes and hosts evpn ifl works for prefix ipv6 routes without enabling a separate bgp family evpn supports ipv4 and ipv6 routes in 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 117 advanced solutions guide release 2410 evpnvxlan for layer 3 addition all irb subinterfaces must be configured with the ipv6 container using the same commands used earlier in this chapter but performed under neighbordiscovery 641 configuring ipv6 container procedure see the following example to configure the ipv6 container example ipv6 container configuration  factory  candidate shared default  interface irb0 subinterface 24   info ipv4  adminstate enable address 10111224   address 1011125424  anycastgw true primary  address 1021125424   arp  learnunsolicited true debug  messages  hostroute  populate dynamic    evpn  advertise dynamic      ipv6  adminstate enable address 2001db82425464  anycastgw true  neighbordiscovery  learnunsolicited both hostroute  populate dynamic    evpn  advertise dynamic     anycastgw   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 118 advanced solutions guide release 2410 evpnvxlan for layer 3 642 additional feature parity considerations the anycastgw container is common for ipv4 and ipv6 therefore the anycastgw mac is the same for both families only one anycastgw mac is programmed in the interface and ipv4 and ipv6 packets use this anycastgwmac as mac sa when sourcing packets to the bd lla and global addresses are advertised in evpn the command neighbordiscovery learnunsolicited both includes global and link local addresses the following example shows that when anycastgw is enabled an anycastgw lla is automatically generated the anycastgw ipv6 link local address is based off the anycastgwmac when the anycastgw and the ipv6 containers are present the logic to compute this new anycastgw ipv6 link local address is the same as is used for computing the regular ipv6 lla except the anycastgwmac is used instead of the interface mac this new ipv6 lla appears in the list of ipv6 addresses associated with the subinterface but with the attribute anycastgw true multicast ns messages use the anycastgw lla and anycastgw mac unicast ns use the global ipv6 and hwaddress example lla generation  factory  candidate shared default  interface irb0 subinterface 24 ipv6   info from state address 2001db82425464  anycastgw true origin static primary status preferred  address fe802005efffe0010164  anycastgw true origin linklayer status preferred  address fe802012fffeff4164  origin linklayer status preferred  neighbordiscovery  duplicateaddressdetection true reachabletime 30 staletime 14400 learnunsolicited both neighbor fe802014fffeff41  linklayeraddress 000104ff0041 origin evpn  hostroute  populate dynamic    evpn  advertise dynamic  admintag 0    routeradvertisement  routerrole  currenthoplimit 64 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 119 advanced solutions guide release 2410 evpnvxlan for layer 3 managedconfigurationflag false otherconfigurationflag false maxadvertisementinterval 600 minadvertisementinterval 200 reachabletime 0 retransmittime 0 routerlifetime 1800   3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 120 advanced solutions guide release 2410 security hardening using cpm filters 7 security hardening using cpm filters protecting the control and management plane of each routing switch in the data center fabric access leaf border leaf spine from unauthorized or outofprofile sources of traffic is important without control plane protection policies routers are vulnerable to attacks on the data center infrastructure and performance degradation can occur because of misconfiguration the sr linux supports a special access control list acl type called a cpmfilter for control plane protection there are separate control processing module cpm filters for ipv4 traffic and for ipv6 traffic the entries of each cpmfilter are installed on each line card and in the control cpm software there are different types of cpmfilter actions that can be applied and all actions are not relevant at all locations acl configuration for control plane protection defines each action and how to configure it 71 acl configuration for control plane protection acls support the following actions  accept  allows the packet through to the next processing function  drop  discards the packet without internet control message protocol icmp generation  log  extracts information about each matching packet and sends it to the log application  distributedpolicer  sends the packet to a policer instance implemented in the forwarding asic of the ingress line card this policer sends the packet to the cpm only if the policer token bucket does not go into the exceedviolate state the rate of a distributedpolicer is defined in units of kbs and the bucket depth is defined in units of bytes  systemcpupolicer  sends the packet to a policer instance implemented by cpm software when the packet reaches the cpm from any line card as source this policer admits the packet to its owner application only if the policer token bucket does not go into the exceedviolate state the rate of a systemcpupolicer is defined in units of packetspersecond and the bucket depth is defined in units of packets 711 cpm filter rules cpm filter rules that apply a systemcpupolicer or distributedpolicer action do not directly specify the policer parameters instead the rules refer to a generically defined policer under the acl configuration tree this allows different cpm filter entries even across multiple acls to use the same policer if needed optionally each policer can be configured as entryspecific this means that a different policer instance is used by each referring filter entry even if they are part of the same acl cpm filter acl actions are applied to the following traffic flows   ipv4 and ipv6 traffic flows originating by external systems arriving on any line card port accepted by the interface acls applied to the ingress subinterface if any system acls applied globally and determined to be locally terminating by lookup of the ip destination address ipv4 and ipv6 traffic flows originating by external systems arriving on the outofband oob management port and accepted by the interface acls applied to ingress traffic on the oob port 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 121 advanced solutions guide release 2410 security hardening using cpm filters subinterface and system acls applied globally if the cpmfilter policy has distributedpolicer actions these are ignored for inbound traffic on the oob management port the startup configuration of a new sr linux router includes a default ipv4 cpmfilter policy and a default ipv6 cpmfilter policy these default policies block packets associated with any protocol that is not supported by the sr linux operating system however they do not limit the sending sources or enforce any rate limits aside from icmpv4icmpv6 traffic which is subject to an aggregate rate limit of 1000 pps the default policies should be modified to add these additional restrictions and to allow protocols associated with netops development kit ndk applications if applicable 712 restricting source subnets for incoming traffic using cpm filter procedure use the acl cpmfilter command to define how to restrict the source subnets for incoming ssh traffic associated with remotely originated tcp connections to a specified ip address example ipv4 address of 19202024  candidate shared default    acl cpmfilter ipv4filter  candidate shared default  acl cpmfilter ipv4filter   entry 100 match  candidate shared default  acl cpmfilter ipv4filter entry 100 match   sourceip address 192020 mask 2552552550   candidate shared default  acl cpmfilter ipv4filter entry 100 match   protocol tcp destinationport value ssh   candidate shared default  acl cpmfilter ipv4filter entry 100 match   exit   candidate shared default  acl cpmfilter ipv4filter entry 100   action drop   candidate shared default  acl cpmfilter ipv4filter entry 100   exit all  candidate shared default    info acl cpmfilter ipv4filter entry 100 acl  cpmfilter  ipv4filter  entry 100  description restrict the source subets 19202024 for incoming ssh traffic action  drop    match  protocol tcp sourceip  address 192020 mask 2552552550  destinationport  value ssh       3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 122 advanced solutions guide release 2410 security hardening using cpm filters example ipv6 address of 2001db8320048  candidate shared default    acl cpmfilter ipv6filter entry 140  candidate shared default  acl cpmfilter ipv6filter entry 140  match nextheader tcp destinationport value ssh operator eq  candidate shared default  acl cpmfilter ipv6filter entry 140  match sourceip address 2001db81 mask fffffffffffffff8ffffffffffffffff  candidate shared default  acl cpmfilter ipv6filter entry 140  action drop  candidate shared default  acl cpmfilter ipv6filter entry 140  exit all  candidate shared default    info acl cpmfilter ipv6filter entry 140 acl  cpmfilter  ipv6filter  entry 140  description restrict the source subets 2001db83248 for incoming ssh traffic action  drop    match  nextheader tcp sourceip  address 2001db81 mask fffffffffffffff8ffffffffffffffff  destinationport  operator eq value ssh       3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 123 advanced solutions guide release 2410 configuring ipvpn services 8 configuring ipvpn services ipvpn services use a combination of mpbgp and mpls to distribute ipv4v6 routing information and provide layer 3 vpn services each ipvpn consists of a set of customer end points connected to one or more pe routers each associated pe router maintains a separate ip forwarding table for each ipvpn instance additionally the pe routers exchange the routing information configured or learned from all customer sites via mp bgp peering each route exchanged via the mpbgp protocol includes a route distinguisher rd which identifies the ipvpn association and handles any potential ip address overlap multiprotocol bgp mpbgp is used to exchange the routes of a particular vpn among the pe routers that are attached to that vpn this route exchange is done in a way that ensures that routes from different vpns remain distinct and separate even if two vpns have an overlapping address space when bgp distributes a vpn route it also distributes an mpls label for that route to identify the advertising ipvpn instance before a customer data packet travels across the service providers backbone it is encapsulated with the mpls label that corresponds in the customers ipvpn to the route that best matches the packets destination address the mpls packet is further encapsulated with one or more mpls labels corresponding to the resolving mpls path to deliver the packet to the intended egress pe router the following figure displays an ipvpn network diagram example 3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 124 advanced solutions guide release 2410 configuring ipvpn services figure 12 ip virtual private network example ipvpn configuration the following is an example of an ipvpn configuration   candidate shared default   asrl1 info interface ethernet12 interface ethernet12  adminstate enable subinterface 1  type routed adminstate enable ipv4  address 103030124      asrl1 info networkinstance base networkinstance base  type default protocols  bgp  adminstate enable autonomoussystem 65550 routerid 1010101 afisafi l3vpnipv4unicast  adminstate enable  group basegroup  3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 125 advanced solutions guide release 2410 configuring ipvpn services  neighbor 1010102  peergroup basegroup       candidate shared default   asrl1 info networkinstance ipvrfred networkinstance ipvrfred  type ipvrf interface ethernet12  interfaceref  interface ethernet12 subinterface 1   protocols  bgpipvpn  bgpinstance 1  adminstate enable ecmp 8 mpls  nexthopresolution  allowedtunneltypes  ldp srisis      bgp  adminstate enable autonomoussystem 65551 routerid 1010101 afisafi ipv4unicast  adminstate enable  group ipvrfredpeers  adminstate enable afisafi ipv4unicast    neighbor 1010103  peergroup ipvrfredpeers    bgpvpn  bgpinstance 1  routedistinguisher  routetarget     3he 20952 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 126 customer document and product support customer documentation customer documentation welcome page technical support product support portal documentation feedback customer documentation feedback nokia service router linux configuration basics release 226 3he 18781 aaaa tqzza issue 01 june 2022  2022 nokia use subject to terms available at wwwnokiacomterms nokia is committed to diversity and inclusion we are continuously reviewing our customer documentation and consulting with standards bodies to ensure that terminology is inclusive and aligned with the industry our future customer documentation will be updated accordingly this document includes nokia proprietary and confidential information which may not be distributed or disclosed to any third parties without the prior written consent of nokia this document is intended for use by nokias customers youyour in connection with a product purchased or licensed from any company within nokia group of companies use this document as agreed you agree to notify nokia of any errors you may find in this document however should you elect to use this document for any purposes for which it is not intended you understand and warrant that any determinations you may make or actions you may take will be based upon your independent judgment and analysis of the content of this document nokia reserves the right to make changes to this document without notice at all times the controlling version is the one available on nokias site no part of this document may be modified no warranty of any kind either express or implied including but not limited to any warranty of availability accuracy reliability title non infringement merchantability or fitness for a particular purpose is made in relation to the content of this document in no event will nokia be liable for any damages including but not limited to special direct indirect incidental or consequential or any losses such as but not limited to loss of profit revenue business interruption business opportunity or data that may arise from the use of this document or the information in it even in the case of errors in or omissions from this document or its content copyright and trademark nokia is a registered trademark of nokia corporation other product names mentioned in this document may be trademarks of their respective owners the registered trademark linux is used pursuant to a sublicense from the linux foundation the exclusive licensee of linus torvalds owner of the mark on a worldwide basis  2022 nokia configuration basics release 226 table of contents table of contents 1 about this guide12 11 precautionary and information messages 12 12 conventions12 2 whats new14 3 system management15 31 configuring a hostname15 32 configuring a domain name 15 33 configuring dns settings 16 34 configuring the management networkinstance 16 35 access types 17 351 enabling an ssh server17 3511 configure ssh keybased authentication 18 352 configuring ftp19 36 configuring banners20 37 synchronizing the system clock 20 38 configuring snmp 21 39 ip ecmp load balancing21 391 configuring ip ecmp load balancing22 4 configuration management24 41 default configuration 24 42 configuration datastores 24 43 configuration modes 24 431 configuration candidates 25 432 setting the configuration mode 25 44 committing a configuration in candidate mode 26 441 confirming a commit operation 27 442 validating a commit operation 28 443 updating the baseline datastore 28 45 deleting a configuration 29 46 annotating the configuration 29 47 discarding a configuration in candidate mode 30 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 3 spacer text configuration basics release 226 table of contents 48 displaying configuration details 30 49 displaying the configuration state33 410 saving a configuration to a file34 411 loading a configuration35 412 executing configuration statements from a file35 413 configuration checkpoints36 4131 generating a checkpoint 36 4132 loading a checkpoint 37 4133 reverting to a previous checkpoint37 4134 clearing a checkpoint38 4135 configuring maximum number of checkpoints 38 4136 displaying checkpoint information 38 414 rescue configuration 39 4141 saving a rescue configuration39 4142 clearing a rescue configuration 40 415 configuration upgrades40 4151 upgrading configuration files 40 5 securing access 42 51 user types 42 511 linux users 42 512 local users 42 513 remote users 42 52 aaa functions42 521 authentication 43 522 authorization 43 523 accounting 43 53 aaa server group configuration44 531 configuring an aaa server group 44 54 authentication for local users 45 541 configuring authentication for local users 45 55 authorization using rolebased access control 46 551 role configuration46 5511 configuring a role47 552 assigning roles to users 48 553 authorization using a tacacs server 49 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 4 spacer text configuration basics release 226 table of contents 5531 configuring tacacs authorization 49 554 service authorization for local users 51 5541 configuring service authorization52 56 accounting configuration53 561 configuring accounting 54 57 displaying user session information 54 58 disconnecting user sessions 54 59 configuring idletimeout for user sessions 55 6 management servers56 61 gnmi server56 611 configuring a gnmi server 56 62 jsonrpc server57 621 configuring a jsonrpc server 57 63 tls profiles 58 631 configuring a tls profile 58 632 generating a selfsigned certificate59 633 generating a certificate signing request 60 7 logging61 71 input sources for log messages 61 72 filters for log messages 63 73 output destinations for log messages 64 74 defining filters 64 75 logging destination configuration 65 751 specifying a log file destination 65 752 specifying a buffer destination 67 753 specifying the console as destination67 754 specifying a remote server destination68 76 specifying a linux syslog facility for sr linux subsystem messages68 8 interfaces 69 81 linux interface naming conventions 70 82 basic interface configuration70 83 subinterfaces70 831 routed and bridged subinterfaces 71 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 5 spacer text configuration basics release 226 table of contents 832 subinterface naming conventions 71 833 basic subinterface configuration71 834 subinterface vlan configuration 73 835 vlan tag tpid configuration 74 8351 configuring the vlan tag tpid for an interface 75 8352 displaying the vlan tag tpid 75 836 bridged subinterface configuration 75 84 irb interfaces76 841 irb interface configuration 77 85 displaying interface statistics77 851 clearing interface statistics 82 86 displaying subinterface statistics 82 861 clearing subinterface statistics84 87 displaying interface status84 88 lag 90 881 minlink threshold90 882 lacp90 8821 lacp fallback90 883 lag configuration 90 8831 configuring the minlink threshold 91 8832 configuring lacp and lacp fallback 92 8833 configuring forwarding viability for lag member links 93 884 displaying lag interface statistics93 8841 clearing lag interface statistics94 89 breakout ports 7220 ixrd3 only 94 891 configuring breakout mode for an interface 96 810 dhcp relay 97 8101 dhcp relay for ipv498 81011 configuring dhcp relay for ipv4103 81012 using the giaddr as the source address for dhcp discoverrequest packets 104 81013 trusted and untrusted dhcp requests105 8102 dhcp relay for ipv6105 81021 configuring dhcp relay for ipv6107 8103 qos for dhcp relay109 8104 dhcp relay operational down reasons 109 8105 displaying dhcp relay statistics 109 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 6 spacer text configuration basics release 226 table of contents 81051 clearing dhcp relay statistics110 811 dhcp server 110 8111 configuring the dhcp server 111 812 ipv6 router advertisements 113 8121 configuring ipv6 router advertisements 113 813 ipv6 router advertisement guard ra guard114 8131 configuring ipv6 ra guard policies 115 8132 applying ipv6 ra guard policies to subinterfaces 115 814 interface port speed configuration 116 8141 configuring interface port speed 117 8142 configuring link autonegotiation 7220 ixrd1 only118 815 interface holdtimers 118 8151 configuring interface hold timers 119 816 reloaddelay timer 120 8161 configuring the reloaddelay timer for an interface121 9 networkinstances 123 91 basic networkinstance configuration 123 92 path mtu discovery 124 93 static routes 124 931 configuring static routes125 932 configuring failure detection for static routes126 94 aggregate routes126 941 configuring aggregate routes 127 95 route preferences127 96 displaying networkinstance status128 97 macvrf networkinstance 129 971 mac selection129 972 mac duplication detection and actions 130 9721 mac duplication detection 130 9722 mac duplication actions 130 9723 mac duplication process restarts 130 9724 configurable holddowntime 131 973 bridge table configuration131 9731 deleting entries from the bridge table 131 974 macvrf network instance configuration132 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 7 spacer text configuration basics release 226 table of contents 10 ospf 133 101 ospf global configuration133 1011 configuring basic ospf parameters134 1012 configuring the router id135 1013 configuring an area136 1014 configuring a stub area136 1015 configuring a notsostubby area 137 1016 configuring an interface 137 11 bgp 139 111 bgp global configuration 139 1111 configuring an asn 139 1112 configuring the router id 140 112 configuring a bgp peer group 140 113 configuring bgp neighbors 140 114 ebgp multihop 141 1141 configuring ebgp multihop 142 115 as path options143 1151 configuring allowownas143 1152 configuring replacepeeras 143 1153 configuring removeprivateas144 116 route reflection 145 1161 configuring route reflection146 117 graceful restart146 1171 configuring graceful restart 147 118 bgp unnumbered peering 147 1181 configuring bgp unnumbered peering 150 119 bgp configuration management 151 1191 modifying an asn151 1192 deleting a neighbor 151 1193 deleting a group 151 1194 resetting bgp peer connections 151 1110 protocol authentication152 11101 configuring protocol authentication 152 1111 bgp shortcuts 153 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 8 spacer text configuration basics release 226 table of contents 11111 configuring bgp shortcuts over segment routing 155 12 isis 157 121 basic isis configuration 159 1211 enabling an isis instance159 1212 configuring the router level 159 1213 configuring the network entity title160 1214 configuring global parameters 160 1215 configuring interface parameters 161 122 displaying isis information 162 123 clearing isis information166 13 bfd167 131 configuring bfd for a subinterface 167 132 configuring bfd under the bgp protocol 168 133 configuring bfd under ospf 169 134 configuring bfd under isis169 135 viewing the bfd state 170 136 microbfd 170 1361 configuring microbfd for a lag interface 171 1362 viewing the microbfd state171 14 routing policies173 141 creating a routing policy173 1411 specifying match conditions 173 14111 specifying a list as a match condition 174 1412 specifying actions175 1413 specifying a default action 176 142 applying a routing policy 176 1421 applying a default policy to ebgp sessions 177 1422 replacing an as path 178 15 access control lists 179 151 acl actions179 1511 supported acl actions for 7250 ixr systems 180 1512 supported acl actions for 7220 ixrd systems181 1513 supported acl actions for 7220 ixrh systems182 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 9 spacer text configuration basics release 226 table of contents 152 acl match conditions183 153 interface filters184 1531 creating an ipv4 acl 185 1532 creating an ipv6 acl 186 1533 attaching an acl to a subinterface 187 1534 attaching an acl to the management interface 187 1535 detaching an acl from an interface188 1536 detaching an acl from the management interface189 1537 modifying acls190 1538 resequencing acl entries191 154 packet capture filters 192 155 control plane module cpm filters 193 156 system filters194 1561 creating a system filter 194 157 configuring logging for acls195 1571 enabling syslog for the acl subsystem 195 15711 syslog entry examples 195 1572 logging acl resource usage196 1573 logging tcam resource usage 196 158 collecting and displaying acl statistics197 1581 collecting acl statistics 197 1582 displaying acl statistics 198 1583 displaying acl resource usage199 1584 clearing acl statistics 200 1585 displaying acl statistics using show commands 201 16 sr linux applications204 161 installing an application 204 162 starting an application 205 163 terminating an application 205 164 reloading application configuration 206 165 clearing application statistics 206 166 restricted operations for applications 207 167 configuring an application 208 168 removing an application from the system 212 169 partioning and isolating application resources 213 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 10 spacer text configuration basics release 226 table of contents 1691 cgroup profiles 213 16911 default cgroup profile213 16912 customerdefined cgroup profile215 1692 configuring a cgroup 216 16921 cgroup configuration example 216 1693 kernel lowmemory killer 218 16931 sr linux process kill strategy 218 1694 application manager extensions for cgroups 220 1695 debugging cgroups221 16951 sr linux cgroup debugging commands221 16952 linuxprovided cgroup debugging commands 225 17 mirroring 227 171 mirror sources 227 172 mirror destinations227 173 configuring mirroring229 1731 configuring mirroring sources 229 1732 configuring mirroring destinations230 174 displaying mirroring information 232 175 displaying mirroring statistics 232 18 uft profiles234 181 shared bank partitioning for sr linux systems 234 182 lpm table partitioning 235 183 default uft allocations for sr linux systems235 184 configuring a uft profile 236 185 displaying uft profile information 236 19 maintenance mode 238 191 configuring a maintenance group 238 192 configuring a maintenance profile239 193 placing a maintenance group into maintenance mode 240 194 taking a maintenance group out of service 240 195 restoring the maintenance group to service241 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 11 spacer text configuration basics release 226 about this guide 1 about this guide this document describes basic configuration for the nokia service router linux sr linux examples of commonly used commands are provided this document is intended for network technicians administrators operators service providers and others who need to understand how the router is configured note this manual covers the current release and may also contain some content that will be released in later maintenance loads see the sr linux release notes for information on features supported in each load 11 precautionary and information messages the following are information symbols used in the documentation danger danger warns that the described activity or situation may result in serious personal injury or death an electric shock hazard could exist before you begin work on this equipment be aware of hazards involving electrical circuitry be familiar with networking environments and implement accident prevention procedures warning warning indicates that the described activity or situation may or will cause equipment damage serious performance problems or loss of data caution caution indicates that the described activity or situation may reduce your component or system performance note note provides additional operational information tip tip provides suggestions for use or best practices 12 conventions nokia sr linux documentation uses the following command conventions  bold type indicates a command that the user must enter  input and output examples are displayed in courier text  an open rightangle bracket indicates a progression of menu choices or simple command sequence often selected from a user interface example start  connect to  a vertical bar  indicates a mutually exclusive argument  square brackets   indicate optional elements 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 12 spacer text configuration basics release 226 about this guide  braces   indicate a required choice when braces are contained within square brackets they indicate a required choice within an optional element  italic type indicates a variable generic ip addresses are used in examples replace these with the appropriate ip addresses used in the system 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 13 spacer text configuration basics release 226 whats new 2 whats new topic location dhcpv6 option 79 configuring dhcp relay for ipv6 bgp dynamic peers on unnumbered interfaces available in 2263 bgp unnumbered peering acl actions for 7220 ixrd5 systems access control lists free static and free dynamic tcam usage per acl type available in 2263 displaying acl resource usage mirroring to underlay destination gre erspan  ipv6  td3 mirror sources 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 14 spacer text configuration basics release 226 system management 3 system management this chapter contains procedures for setting up basic system management functions on sr linux including the hostname domain name dns settings and management networkinstance it contains examples of configuring an ssh server and ftp server as well as ntp for the system clock and enabling an snmp server 31 configuring a hostname the sr linux device must have a hostname configured the default hostname is srlinux the hostname normally appears on all cli prompts on the device although you can override this with the environment prompt cli command the hostname should be a unique name on the network and can be a fully qualified domain name fqdn or an unqualified singlelabel name if the hostname is a singlelabel name for example srlinux the system may use its domain name if configured to infer its own fqdn example the following example shows the configuration for a hostname on the sr linux device  candidate shared default    info system name system  name  hostname 3nodesrlinuxa   32 configuring a domain name the sr linux device uses its hostname combined with a domain name to form its fully qualified domain name fqdn it is expected that the fqdn exists within the dns servers used by sr linux though this is not a requirement assuming the sr linux fqdn is in the dns server you can use the fqdn to reach the sr linux device without knowing its management address a domain name is not mandatory but if specified it is added to the dns search list by default example the following shows the configuration for a domain name on the sr linux device in this example the device fqdn is set to 3nodesrlinuxamvusanokiacom  candidate shared default    info system name system  name  hostname 3nodesrlinuxa 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 15 spacer text configuration basics release 226 system management domainname mvusanokiacom   33 configuring dns settings the sr linux device uses dns to resolve hostnames within the configuration or for operational commands such as ping you can specify up to three dns servers for the sr linux device to use with either ipv4 or ipv6 addressing you can also specify a search list of dns suffixes that the device can use to resolve singlelabel names for example for a search list of nokia1com and nokia2com a ping for host srlinux does a dns lookup for srlinuxnokia1com and if unsuccessful does a dns lookup for srlinuxnokia2com the sr linux device supports configuration of static dns entries static dns entries allow resolution of hostnames that may not be in the dns servers used by the sr linux device using a static dns entry you can map multiple addresses both ipv4 and ipv6 to one hostname the sr linux linuxmgr application adds the static dns entries to the etchosts file in the underlying linux os example in the following example the sr linux device is configured to use two dns servers to resolve hostnames a search list of dns suffixes for resolving singlelabel names and ipv4 and ipv6 static dns entries for a host dns requests are sourced from the mgmt networkinstance see configuring the management network instance  candidate shared default    info system dns system  dns  networkinstance mgmt serverlist  1111 2222  searchlist  nokia1com nokia2com  hostentry srlinuxnokiacom  ipv4address 3333 ipv6address 2001db81234561111    34 configuring the management networkinstance management of the sr linux device is primarily done via a management networkinstance the management networkinstance isolates management traffic from other networkinstances configured on the device 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 16 spacer text configuration basics release 226 system management the outofband mgmt0 interface is automatically added to the management networkinstance and management services run within the management networkinstance although the management networkinstance is primarily intended to handle management traffic you can configure it in the same way as any other networkinstance on the device including protocols policies and filters the management network instance is part of the default configuration but may be deleted if necessary addressing within the management networkinstance is available via dhcp and static ip addresses both ipv4 and ipv6 addresses are supported example  candidate shared default    info networkinstance mgmt networkinstance mgmt  type ipvrf adminstate enable description management network instance interface mgmt00   protocols  linux  exportroutes true exportneighbors true    35 access types access to the sr linux device is available via a number of apis and protocols the sr linux supports the following ways to access the device  ssh  secure shell a standard method for accessing network devices see enabling an ssh server  ftp  file transfer protocol a secure method for transferring files to and from network devices see configuring ftp  console  access to the sr linux cli via direct connection to a serial port on the device  gnmi  a grpcbased protocol for the modification and retrieval of configuration from a target device as well as the control and generation of telemetry streams from a target device to a data collection system see gnmi server  jsonrpc  ability to retrieve and set configuration and state using a jsonrpc api see json rpc server  snmp  simple network management protocol a commonly used network management protocol the sr linux device supports snmpv2 with a limited set of oids regardless of the method of access all sessions are authenticated if authentication is enabled whether the session is entered via the console ssh or an api access to the device is controlled via the aaamgr application see securing access 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 17 spacer text configuration basics release 226 system management 351 enabling an ssh server you can enable an ssh server for one or more network instances on the sr linux device so that users can log in to the cli using an ssh client the sr linux device implements ssh via openssh and configures etcsshsshdconfig in the underlying linux os only sshv2 is supported example in the following example an ssh server is enabled in the mgmt and default networkinstances specifying the ip addresses where the device listens for ssh connections  candidate shared default    info system sshserver system  sshserver  networkinstance mgmt  adminstate enable sourceaddress  1111 1112   networkinstance default  adminstate enable sourceaddress  2111 2112     3511 configure ssh keybased authentication the sr linux ssh server supports rsa publicprivate keybased authentication where an ssh client provides a signed message that has been encrypted by a private key if the ssh clients corresponding public key is configured on the sr linux the ssh server can authenticate the client when performing authentication for a user the sr linux first tries publickey authentication if this fails the sr linux tries password authentication to configure ssh keybased authentication you generate a publicprivate key pair then add the public key to the sr linux example the following is an example of using the sshkeygen utility in linux to generate an rsa key pair with a length of 2048 bits  sshkeygen t rsa b 2048 generating publicprivate rsa key pair enter file in which to save the key homeusersshidrsa enter passphrase empty for no passphrase enter same passphrase again your identification has been saved in homeusersshidrsa your public key has been saved in homeusersshidrsapub the key fingerprint is sha256rnvv8xrvk7phy2ojxa7rjksufqyvoj4puxl2pds7mi userlinux the keys randomart image is 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 18 spacer text configuration basics release 226 system management rsa 2048  oo oo  oob    o   fo     m   o    o    o o  e o     oo  sha256 example after generating the rsa key pair you can add the public key to the sr linux the location for the public key depends on the type of user for which ssh keybased authentication is being configured  for linux users see linux users you add the public key to the users homesshauthorized keys file  for users configured within the sr linux cli see local users you add the public key to the sr linux configuration file this can be done with a cli command for example the following cli command configures a public key and password for the sr linux user srlinux  candidate shared default    system aaa authentication user username srlinux sshkey  publickey  password password in the example the publickey has the format sshrsa key comment if multiple public keys are configured for a user they are tried in the order they were configured 352 configuring ftp you can enable an ftp server for one or more network instances on the sr linux device so that users can transfer files to and from the device the sr linux uses the vsftpd very secure ftp daemon application within the underlying linux os the authenticated users home directory returned by the aaamgr application is set as the users ftp root directory example in the following example the ftp server is enabled in the mgmt and default networkinstance specifying the ip addresses where the device listens for ftp connections  candidate shared default    info system ftpserver system  ftpserver  networkinstance mgmt  adminstate enable sourceaddress  1111   networkinstance default  adminstate enable sourceaddress  2121 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 19 spacer text configuration basics release 226 system management     36 configuring banners you can specify banner text that appears when a user connects to the sr linux device the following banners can be configured  login banner  displayed before a user has been authenticated by the system for example at the ssh login prompt  message of the day motd banner  displayed after the user has been authenticated by the system the banners appear regardless of the method used to connect to the sr linux so they are displayed to users connecting via ssh console and so on example in the following example login and motd banners are configured the login banner text appears at the prompt when a user attempts to log in to the system and the motd banner text appears after the user has been authenticated  candidate shared default    info system banner system  banner  loginbanner enter your srlinux login credentials motdbanner welcome to the srlinux cli your activity may be monitored   37 synchronizing the system clock network time protocol ntp is used to synchronize the system clock to a time reference you can configure ntp settings on the sr linux device using the cll and the sr linux linuxmgr application provisions the settings in the underlying linux os ntp does not account for time zones instead relying on the host to perform such computations time zones on the sr linux device are based on the iana tz database which is implemented by the underlying linux os you can specify the time zone of the sr linux device using the cli example the following configuration enables the system ntp client on the sr linux device and specifies an ntp server to use for clock synchronization the ntp client runs in the mgmt networkinstance the system time zone is set to americalosangeles  candidate shared default    info system ntp system  ntp  adminstate enable 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 20 spacer text configuration basics release 226 system management networkinstance mgmt server 45316075    clock  timezone americalosangeles   38 configuring snmp the sr linux device supports snmpv2 see the sr linux system management guide for descriptions of the supported snmp oids the mib file that covers these oids is packaged with each release example in the following example an snmp server is running within the mgmt and default networkinstances and the configuration specifies the ip addresses where the device listens for snmp client connections  candidate shared default    info system snmp system  snmp  community test1  permission r version v2c  networkinstance mgmt  adminstate enable sourceaddress  1111   networkinstance default  adminstate enable sourceaddress  3333     39 ip ecmp load balancing equalcost multipath protocol ecmp refers to the distribution of packets over two or more outgoing links that share the same routing cost static isis ospf and bgp routes to ipv4 and ipv6 destinations can be programmed into the datapath by their respective applications with multiple ip ecmp nexthops the sr linux loadbalances traffic over multiple equalcost links with a hashing algorithm that uses header fields from incoming packets to calculate which link to use when an ipv4 or ipv6 packet is received on a subinterface and it matches a route with a number of ip ecmp nexthops the nexthop that forwards the packet is selected based on a computation using this hashing algorithm the goal of the hash computation is to keep packets in the same flow on the same network path while distributing traffic proportionally 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 21 spacer text configuration basics release 226 system management across the ecmp nexthops so that each of the n ecmp nexthops carries approximately 1nth of the load the hash computation takes various key and packet header field values as inputs and returns a value that indicates the nexthop the key and field values that can be used by the hash computation depend on the platform packet type and configuration options as follows on 7250 ixr systems the following can be used in the hash computation  for ipv4 tcpudp nonfragmented packets userconfigured hashseed 065535 default 0 source ipv4 address destination ipv4 address ip protocol l4 source port l4 destination port the algorithm is asymmetric that is inverting source and destination pairs does not produce the same result  for ipv6 tcpudp nonfragmented packets userconfigured hashseed 065535 default 0 source ipv6 address destination ipv6 address ipv6 flow label even if it is 0 ip protocol ipv6 nextheader value in the last extension header l4 source port l4 destination port the algorithm is symmetric that is inverting source and destination pairs produces the same result  for all other packets userconfigured hashseed 065535 default 0 source ipv4 or ipv6 address destination ipv4 or ipv6 address on 7220 ixrd1 d2 d3 and 7220 ixrh2 and h3 systems the following can be used in the hash computation  for ipv4 tcpudp nonfragmented packets vlan id userconfigured hashseed 065535 default 0 source ipv4 address destination ipv4 address ip protocol l4 source port l4 destination port the algorithm is asymmetric  for ipv6 tcpudp nonfragmented packets vlan id userconfigured hashseed 065535 default 0 source ipv6 address destination ipv6 address ipv6 flow label even if it is 0 ip protocol ipv6 next header value in the last extension header l4 source port l4 destination port  for all other packets userconfigured hashseed 065535 default 0 source ipv4 or ipv6 address destination ipv4 or ipv6 address 391 configuring ip ecmp load balancing to configure ip ecmp load balancing you specify hashoptions that are used as input fields for the hash calculation which determines the nexthop for packets matching routes with multiple ecmp hops example the following example configures hash options for ip ecmp load balancing including a hash seed and packet header field values to be used in the hash computation   candidate shared default    info system loadbalancing system  loadbalancing  hashoptions  hashseed 128 ipv6flowlabel false    if no value is configured for the hashseed the default value is 0 if a hashoption is not specifically configured the default is true 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 22 spacer text configuration basics release 226 system management on 7250 ixr systems if sourceaddress is configured as a hash option the destinationaddress must also be configured as a hash option similarly if sourceport is configured as a hash option the destinationport must also be configured as a hash option 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 23 spacer text configuration basics release 226 configuration management 4 configuration management the chapter describes concepts behind managing the sr linux configuration including configuration datastores modes and how to commit changes to the running configuration 41 default configuration at startup the sr linux loads a json configuration file located at etcoptsrlinuxconfigjson if this startup configuration does not exist the system is started using a factory default configuration the factory default configuration brings device into management enables dhcpv6 on the management interface adds it to the management networkinstance enables an ssh server and creates various system logs and applies a default set of cpm filters you can optionally create a rescue configuration which is loaded if the startup configuration fails to load see rescue configuration if the startup configuration fails to load and no rescue configuration exists the system is started using the factory default configuration 42 configuration datastores configuration and state information reside in datastores on the sr linux device the following datastores are available  running  contains the currently active configuration  state  contains the running configuration plus dynamically added data such as operational state of interfaces or bgp peers added via autodiscovery as well as session states and routing tables  candidate  contains a userconfigurable version of the running datastore after it has been committed the candidate datastore becomes the running datastore  tools  contains executable commands that allow you to perform operations such as restarting the device and clearing interface statistics within the cli you can use the info command to display information from a datastore for example entering the info from state command or entering the info command in state mode displays configuration and statistics from the state datastore for the current context and entering the info from running command or the info command in running mode displays configuration from the running datastore for the current context 43 configuration modes the candidate datastore corresponds to a configuration mode within the sr linux cli in candidate mode you can modify sr linux configuration settings 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 24 spacer text configuration basics release 226 configuration management by default candidate mode operates in shared mode which allows multiple users to modify the candidate configuration concurrently when the configuration is committed in shared mode all of the users changes are applied you can optionally use candidate mode in exclusive mode which locks out all other users from making changes to the candidate configuration 431 configuration candidates when a user enters candidate mode the system creates two copies of the running datastore one is modifiable by the user and the other serves as a baseline the modifiable datastore and the baseline datastore are collectively known as a configuration candidate a configuration candidate can be either shared or private  shared  is the default configuration candidate for cli sessions multiple users can modify the shared candidate concurrently when the configuration is committed the changes from all of the users are applied  private  is the default configuration candidate when using jsonrpc or gnmi clients and can optionally be used in the cli with a private candidate each user modifies their own separate instance of the configuration candidate when a user commits their changes only the changes from that user are committed by default there is a single unnamed global configuration candidate you can optionally configure one or more named configuration candidates which function identically to the global configuration candidate both shared and private configuration candidates support named versions 432 setting the configuration mode after logging in to the cli you are initially placed in running mode table 1 commands to change configuration mode describes the commands to change between modes table 1 commands to change configuration mode to enter this mode type this command candidate shared enter candidate candidate mode for named shared candidate enter candidate name name candidate private enter candidate private candidate mode for named private candidate enter candidate private name name candidate exclusive enter candidate exclusive exclusive mode for named candidate enter candidate exclusive name name running enter running 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 25 spacer text configuration basics release 226 configuration management to enter this mode type this command state show example enter state enter show for example to change from running to candidate mode  running    enter candidate   candidate shared default   the asterisk  next to the mode name indicates that the candidate configuration has changes that have not yet been committed example to enter candidate mode for a named configuration candidate you specify the name of the configuration candidate for example  running    enter candidate name cand1  candidate shared cand1  44 committing a configuration in candidate mode about this task changes made during a configuration modification session do not take effect until a commit command is issued use the commit command in candidate mode only procedure step 1 enter candidate mode example  enter candidate step 2 enter configuration commands step 3 enter the commit command  to apply the changes and remain in candidate mode enter commit stay  to apply the changes exit candidate mode and enter running mode enter commit now  to apply the changes remain in candidate mode and save the changes to the startup configuration enter commit stay save  to apply a comment to a commit stay or save operation use the comment keyword and specify a comment 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 26 spacer text configuration basics release 226 configuration management example  enter candidate  candidate shared default    interface ethernet11 subinterface 1   candidate shared default  interface ethernet11 subinterface 1   commit stay all changes have been committed starting new transaction   candidate shared default  interface ethernet11 subinterface 1   save startup system saved current running configuration as initial startup configuration etc optsrlinuxconfigjson  candidate shared default  interface ethernet11 subinterface 1   in this example a user enters candidate mode and creates a subinterface for interface ethernet11 the asterisk  next to candidate shared default in the prompt indicates that the candidate configuration has changes that have not yet been committed after committing the changes with the commit stay command the new subinterface becomes part of the running configuration the plus sign  in the prompt indicates that the currently running configuration differs from the startup configuration the save startup command saves the running configuration to the startup configuration 441 confirming a commit operation you can optionally configure the sr linux to require explicit confirmation via a tools command for the configuration changes from a commit operation to become permanent if the new configuration is not confirmed after a timeout period the running datastore reverts to the previous version example after entering configuration commands in candidate mode use the following command to commit the configuration and start the confirmation timer  candidate shared default    commit confirmed the commit confirmed command applies the changes to the running datastore and activates them if the configuration is committed successfully the confirmation timer is started default 10 minutes if you do not confirm the commit operation before the timer expires the configuration reverts to the previous version example to confirm the commit operation and make the configuration changes permanent enter the following command before the confirmation timer expires  candidate shared default    tools system configuration confirmedaccept 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 27 spacer text configuration basics release 226 configuration management example to revert to the previous configuration without waiting for the confirmation timer to expire enter the following command  candidate shared default    tools system configuration confirmedreject 442 validating a commit operation you can optionally validate the configuration changes made during a commit operation before they are applied to the running datastore the sr linux management server checks the syntax of the changes in the candidate configuration and displays messages if validation errors are found example use the following command to perform a validation check for configuration changes note that this command only validates the changes it does not apply them to the running datastore  candidate shared default    commit validate if syntax errors are found in the configuration changes sr linux displays error messages if validation is successful no output is displayed 443 updating the baseline datastore a configuration candidate consists of a modifiable candidate datastore and a baseline datastore both of which are snapshots of the thencurrent running datastore when a user enters candidate mode during the lifetime of the configuration candidate the running datastore can be modified via commits initiated from other configuration sessions at that point the baseline in the configuration candidate is out ofdate updating the baseline datastore takes a new snapshot of the running configuration applies the changes in the candidate datastore and checks for configuration conflicts in the updated baseline datastore if conflicts are found the user is informed with a warning or error for each conflict a baseline datastore update is done automatically when the user commits the changes to the configuration or can be done manually with the baseline update command example in the following example the baseline datastore in a configuration candidate is out of date as indicated by the  in the prompt this indicates that another user has committed changes to the running datastore entering the baseline update command copies the current running datastore to the baseline datastore applies the changes in the candidate datastore then displays any conflicts in the updated baseline datastore if there are no conflicts no output is returned by the command  candidate shared default    baseline update  candidate shared default    3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 28 spacer text configuration basics release 226 configuration management 45 deleting a configuration use the delete command to delete configurations while in candidate mode example the following example displays the system banner configuration deletes the configured banner then displays the resulting system banner configuration  candidate shared default    info system banner system  banner  loginbanner welcome to srlinux    candidate shared default    delete system banner  candidate shared default    info system banner system  banner    46 annotating the configuration to aid in reading a configuration you can add comments or descriptive annotations the annotations are indicated by  in displayed output you can enter a comment either directly from the command line or by navigating to a cli context and entering the comment in annotate mode example the following example adds a comment to an acl configuration if there is already a comment in the configuration the new comment is appended to the existing comment  candidate shared default    acl ipv4filter iptcp  filter tcp traffic example to replace the existing comment use  instead of  in the command the following example adds the same comment to the acl by navigating to the context for the acl and entering the comment in annotate mode   candidate shared default    acl ipv4filter iptcp   candidate shared default  acl ipv4filter iptcp   annotate press metaenter or esc followed by enter to finish  filter tcp traffic 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 29 spacer text configuration basics release 226 configuration management you can enter multiple lines in annotate mode to exit annotate mode press esc then the enter key example in cli output the comment is displayed in the context it was entered for example  running    info acl acl  ipv4filter iptcp   filter tcp traffic entry 100  action  drop  log true    entry 110  action  accept  log true      to remove a comment enter annotate mode for the context and press esc then enter without entering any text 47 discarding a configuration in candidate mode you can discard previously applied configurations with the discard command use the discard command in candidate mode only  to discard the changes and remain in candidate mode with a new candidate session enter discard stay  to discard the changes exit candidate mode and enter running mode enter discard now example all changes have been committed starting new transaction  candidate shared default  interface ethernet11 subinterface 1   discard stay  candidate shared default  interface ethernet11 subinterface 1  48 displaying configuration details the info command displays configuration and state information entering the info command from the root context displays the entire configuration or the configuration for a specified context entering the command from within a context limits the display to the configuration under that context use this command in candidate or running mode 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 30 spacer text configuration basics release 226 configuration management example to display the entire configuration enter info from the root context  candidate shared default    info all the configuration is displayed  candidate   example to display the configuration for a specific context enter info and specify the context  candidate shared default    info system lldp system  lldp  adminstate enable hellotimer 600 managementaddress mgmt00  type  ipv4   interface mgmt0  adminstate disable     candidate   example from a context use the info command to display the configuration under that context  candidate shared default    system lldp  candidate  system lldp   info adminstate enable hellotimer 600 managementaddress mgmt00  type  ipv4   interface mgmt0  adminstate disable   candidate  system lldp  example use the as json option to display jsonformatted output  candidate  system lldp   info  as json  adminstate enable hellotimer 600 managementaddress  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 31 spacer text configuration basics release 226 configuration management  subinterface mgmt00 type  ipv4    interface   name mgmt0 adminstate disable    example use the detail option to display values for all parameters including those not specifically configured  candidate  system lldp   info detail adminstate enable hellotimer 600 holdmultiplier 4 managementaddress mgmt00  type  ipv4   interface mgmt0  adminstate disable  example use the flat option to display the output as a series of set statements omitting indentation for any sub contexts  candidate  system lldp   info flat set  system lldp adminstate enable set  system lldp hellotimer 600 set  system lldp managementaddress mgmt00 set  system lldp managementaddress mgmt00 type  ipv4  set  system lldp interface mgmt0 set  system lldp interface mgmt0 adminstate disable example use the depth option to display parameters with a specified number of subcontext levels  candidate  system lldp   info depth 0 adminstate enable hellotimer 600  candidate  system lldp   info depth 1 adminstate enable hellotimer 600 managementaddress mgmt00  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 32 spacer text configuration basics release 226 configuration management type  ipv4   interface mgmt0  adminstate disable  49 displaying the configuration state to display information from the state datastore enter the info from state command in candidate or running mode or the info command in state mode example to display state information for a specified context from candidate or running mode  candidate shared default    info from state routingpolicy policy bgpexportpolicy routingpolicy  policy bgpexportpolicy  statement 999  action  accept       example to display state information for a specified context from state mode  candidate shared default    enter state  state    info routingpolicy policy bgpexportpolicy routingpolicy  policy bgpexportpolicy  statement 999  action  accept        state   example you can change to a different mode for example from state mode to candidate mode and remain in the previous context for example  candidate shared default    enter state  state   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 33 spacer text configuration basics release 226 configuration management  routingpolicy policy bgpexportpolicy  state  routingpolicy policy bgpexportpolicy   info statement 999  action  accept      state  routingpolicy policy bgpexportpolicy   enter candidate  candidate shared default  routingpolicy policy bgpexportpolicy  410 saving a configuration to a file save the existing configuration to a file using the save command use this command in candidate or running mode example to save the running configuration to a file  running    save file runningconfigtxt text from running  running configuration has been stored in runningconfigtxt  running   example to save the running configuration in json format  running    save file runningconfigjson from running  running configuration has been stored in runningconfigjson  running   example to save the running configuration in json format  running    save file runningconfigjson from running  running configuration has been stored in runningconfigjson  running   example to save the running configuration to the initial startup configuration   running    save startup  running configuration has been stored in etcoptsrlinuxconfigjson  running   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 34 spacer text configuration basics release 226 configuration management the plus sign  in the prompt indicates that the running configuration differs from the startup configuration after you enter the save startup command the running configuration is synchronized with the startup configuration and the plus sign is removed from the prompt 411 loading a configuration use the load command to load a configuration the configuration can be from a checkpoint see configuration checkpoints a jsonformatted configuration file the startup configuration the factory default configuration a rescue configuration see rescue configuration or from manually entered or pasted jsonformatted input example to load a configuration from a checkpoint   candidate shared default    load checkpoint id 0 systemconfigurationcheckpointid0 loaded checkpoint etcoptsrlinuxcheckpointcheckpoint0json example to load a configuration from a file   candidate shared default    load file homeconfigtxt loading configuration from homeconfigtxt example to load a rescue json configuration from a checkpoint   candidate shared default    load rescue autocommit systemconfigurationcheckpointidrescue reverting to rescue configuration example to load a configuration from manually entered jsonformatted input   candidate shared default    system banner   candidate shared default  system banner   load json press metaenter or esc followed by enter to finish    loginbanner welcome to srlinux   you can enter or paste multiple lines at the  prompt in jsoninput mode to exit jsoninput mode press esc then the enter key 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 35 spacer text configuration basics release 226 configuration management 412 executing configuration statements from a file you can execute configuration statements from a source file consisting of set statements such as those generated by the info flat command see displaying configuration details the sr linux reads the file and executes each configuration statement linebyline you can optionally commit the configuration automatically after the file is read example the following example executes a configuration from a specified file  running    source configcfg sourcing commands from configcfg executed 20 lines in 16541 seconds from file configcfg use the autocommit option to commit the configuration after the commands in the source file are executed 413 configuration checkpoints you can roll back the configuration to a previous state known as a checkpoint you can load a saved checkpoint into the candidate configuration and revert the running configuration to a previously saved checkpoint a checkpoint is saved as a jsonformatted file containing the complete configuration for the system if a checkpoint file is larger than 1 mb it is compressed and saved in gzip format checkpoint files are saved in the etcoptsrlinuxcheckpoint directory they are named checkpointnumberjson for example checkpoint0json or checkpointnumberjsongz with the lowest number being the most recently saved checkpoint by default the 10 most recent checkpoints are saved you can configure the maximum number of checkpoint files that are kept by the system 4131 generating a checkpoint you can generate a checkpoint with a tools command or with the save checkpoint command you can optionally configure the system to generate a checkpoint automatically when a configuration is committed example the following example generates a checkpoint from the current configuration   candidate shared default    tools system configuration generatecheckpoint system generated checkpoint etcoptsrlinuxcheckpointcheckpoint 0json with name checkpoint20201020t231412703z and comment  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 36 spacer text configuration basics release 226 configuration management example you can optionally configure a name or comment for a checkpoint for example   candidate shared default    save checkpoint comment mycheckpoint system generated checkpoint etcoptsrlinuxcheckpointcheckpoint 0json with name checkpoint20201020t232325891z and comment mycheckpoint example the following example configures the system to generate a checkpoint automatically whenever a configuration is committed   candidate shared default    info system configuration system  configuration  autocheckpoint true    for automatically generated checkpoints the comment is set to automatic checkpoint after commit n where n is the id of the commit that triggered the checkpoint 4132 loading a checkpoint loading a checkpoint requires an interactive configuration session with a candidate session already active example the following example loads a checkpoint into the candidate configuration note that you must be in candidate mode to load a checkpoint   running    enter candidate   candidate shared default    tools system configuration checkpoint 0 load systemconfigurationcheckpointid0 loaded checkpoint etcoptsrlinuxcheckpointcheckpoint0json 4133 reverting to a previous checkpoint you can revert the running configuration to a previous checkpoint when used within a candidate session the revert operation loads the checkpoint removing any present changes then commits them and establishes a new candidate session example the following example reverts the running configuration to a previously saved checkpoint   running    enter candidate 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 37 spacer text configuration basics release 226 configuration management   candidate shared default    tools system configuration checkpoint 0 revert systemconfigurationcheckpointid0 reverting to checkpoint 0 name checkpoint20191014t184730282z comment dailycheckpoint  successfully reverted configuration 4134 clearing a checkpoint checkpoints can be cleared from the system either manually with a tools command or automatically when the number of saved checkpoints exceeds the configured maximum when the number of saved checkpoints exceeds the configured maximum the oldest checkpoint is removed and the number of each remaining checkpoint is incremented by 1 if you clear a checkpoint manually the other checkpoints are not renumbered example the following example clears a previously saved checkpoint  tools system configuration checkpoint 2 clear systemconfigurationcheckpointid2 cleared checkpoint etcoptsrlinuxcheckpointcheckpoint2json 4135 configuring maximum number of checkpoints by default the 10 most recent checkpoints are saved you can configure the maximum number of checkpoint files that are kept by the system example the following example configures the system to keep a maximum of 15 checkpoint files   candidate shared default    info system configuration system  configuration  maxcheckpoints 15    in this example if 15 checkpoint files are being kept adding a subsequent checkpoint file causes the oldest checkpoint file to be deleted and the index for the remaining checkpoint files to be incremented by 1 4136 displaying checkpoint information use the info from state command to display information about existing checkpoints example  info from state system configuration checkpoint 0 system  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 38 spacer text configuration basics release 226 configuration management configuration  checkpoint 0  name checkpoint20201020t232325891z comment cp002 created 20201020t232325894z version v2060 username srlinux size 28494    414 rescue configuration you can save a secondary rescue configuration to load in place of the default json configuration file the rescue configuration is a checkpoint file that is loaded automatically by the management server if the default configjson fails when the system starts if both the default configuration and rescue configuration files are missing or fail a configjson is regenerated and committed from the factory configjson that is compiled in the management server 4141 saving a rescue configuration you can save a rescue configuration to be loaded automatically if the default configjson fails when the system starts save the rescue configuration to a file with a tools command or using the save rescue command use these commands in running mode the system generates a rescueconfigjson file and saves it to the etcoptsrlinuxcheckpoint directory example the following tools command saves a rescue configuration  running    tools system configuration rescuesave system saved current running configuration as rescue configuration etcoptsrlinux checkpointrescueconfigjson example the following example also saves a rescue configuration  running    save rescue system saved current running configuration as rescue configuration etcoptsrlinux checkpointrescueconfigjson example you can confirm the rescue configuration is saved by viewing the checkpoint directory the following example lists the checkpoint directory  running   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 39 spacer text configuration basics release 226 configuration management  file ls etcoptsrlinuxcheckpoint checkpoint0json rescueconfigjson 4142 clearing a rescue configuration to remove an existing rescue configuration use the rescueclear command to clear the configuration from the etcoptsrlinuxcheckpoint directory use this command in running mode you can then save a new rescue configuration to replace the cleared configuration example the following tools command clears a previously saved rescue configuration  running    tools system configuration rescueclear system cleared rescue configuration etcoptsrlinuxcheckpointrescueconfigjson example you can confirm the rescue configuration is cleared by viewing the checkpoint directory the following example lists the checkpoint directory  running    file ls etcoptsrlinuxcheckpoint checkpoint0json 415 configuration upgrades when the sr linux is started following a software image upgrade it reads the configuration in the startup configjson file makes any necessary changes to ensure compatibility with the new software image and places the upgraded configuration into the running configuration this upgraded configuration is not saved automatically to save the contents of the running configuration use the following commands  save startup  saves the running configuration to the startup configuration file located at etcopt srlinuxconfigjson or configgz  save rescue  saves the running configuration to the rescue configuration file located at etcopt srlinuxcheckpointrescueconfigjson or rescueconfiggz  save checkpoint  saves the running configuration to a configuration checkpoint for example etc optsrlinuxcheckpointcheckpoint0json or checkpoint0gz  save file name from running  saves the running configuration to the specified file in json format 4151 upgrading configuration files in addition to saving the upgraded running configuration to startup rescue and checkpoint configurations you can use the following tools commands to upgrade existing configuration files so they are compatible with the current software version 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 40 spacer text configuration basics release 226 configuration management example to upgrade the startup configuration file  running    tools system configuration upgrade startup example to upgrade the rescue configuration file  running    tools system configuration upgrade rescue example to upgrade a configuration checkpoint file  running    tools system configuration upgrade checkpoint 0 example to upgrade a specific jsonformatted configuration file  running    tools system configuration upgrade file etcoptsrlinuxconfigsmyconfigjson 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 41 spacer text configuration basics release 226 securing access 5 securing access the sr linux is able to secure access to the device for users connecting via ssh or the console port as well as for applications and ftp access authentication can be performed for users configured within the underlying linux os and for administrative users configured within the sr linux itself depending on the user type users are authenticated locally on the device or through interaction with the sr linux aaamgr application and an authentication server group for example tacacs 51 user types the sr linux supports three user types linux users local users and remote users each user type is authenticated differently as described in the following sections 511 linux users linux users are those configured in the underlying linux os not in the sr linux cli information about linux users is stored in etcpasswd in the underlying linux os by default the sr linux has a single linux user username linuxadmin password nokiasrl1 who has access to sudo to root and can run the sr linux cli with admin permissions other linux users can be added with the useradd command in the underlying linux os linux users are authenticated via the underlying linux os not through the sr linux aaamgr application this means that linux users are not subject to authentication settings configured within the sr linux cli such as authentication by a tacacs server group 512 local users local users are users configured within the sr linux itself by default sr linux supports a single local user named admin other local users can be added as necessary local users are authenticated via a grpc interface to the aaamgr application see authentication for local users for an example configuration 513 remote users remote users are users that are not configured either in etcpasswd or within the sr linux configuration remote users are configured on a remote server which is queried when the user attempts to log in to the sr linux device 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 42 spacer text configuration basics release 226 securing access 52 aaa functions the sr linux performs authentication authorization and accounting aaa functions for each user type as described in the following sections 521 authentication for linux users the sr linux authenticates via the authentication mechanism built into the underlying linux os for local users including the sr linux admin user the sr linux uses its grpc interface to the aaamgr application for authentication authentication settings that apply to the local users including a local password and tacacs server group can be configured using the sr linux cli see authentication for local users for information about configuring local users for remote users authentication is performed using the aaamgr application in coordination with the remote system 522 authorization the sr linux implements authorization through rolebased access control where each authenticated user is assigned one or more predefined roles that specify the functions the user is allowed to perform on the system if no role is configured for a user then the user is assigned a role that allows access to cli plugins but no other functions authorization via role based access control is performed for all user types on all interfaces cli gnmi jsonrpc with the exception of the admin and linuxadmin users which are permitted write access to all commands in the command tree you can configure service authorization which can limit the interface types for which the functions in a role are authorized you can configure the sr linux to use information from a tacacs server to assign roles to an authenticated user in this case the privlvl value in the authorizationreply message received from the tacacs server maps to a role configured on the sr linux the user is assigned the role that corresponds to the privlvl value see authorization using rolebased access control for information about configuring roles for users 523 accounting the sr linux supports command accounting accounting records generated by the sr linux include the entire cli string that a user enters on the command line including any pipes or output redirects specified in the command you can configure the sr linux device to send accounting records to a destination specified in an accountingmethod list such as a tacacs server group or the local system for each user type the sr linux device generates accounting records as follows  for local users including the sr linux admin user command accounting records are sent to the destination specified in the accountingmethod list both for commands entered in the sr linux cli and for commands entered in the bash shell 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 43 spacer text configuration basics release 226 securing access  for linux users and remote users command accounting records are sent for commands entered in the sr linux cli including linux commands entered in the sr linux cli using the bash command although not for commands entered in the bash shell see configuring accounting for an example configuration 53 aaa server group configuration the sr linux supports the following server group types for aaa functions  local  uses local authentication including etcpasswd etcgroup and logging via syslog  tacacs  performs authentication authorization and accounting via interaction with servers in a tacacs server group users whose aaa functions are handled by the aaamgr application that is the sr linux admin user and local users can use one of these server groups for authentication and accounting the tacacs server group can have up to five servers when authenticating a user or writing an accounting record the sr linux tries each server in the group in a roundrobin fashion until a response is received if no response is received within a specified timeout period the sr linux tries the next server in the group if no response is received from any of the servers in the group the sr linux moves to the next specified authentication or accounting method if no other method is specified or the tacacs server group is the last method in the list then the authentication or accounting request is rejected 531 configuring an aaa server group the following example shows settings for a tacacs and a local server group to be used for aaa functions tacacs requests are sourced from the mgmt networkinstance the tacacs server group consists of three tacacs servers the timeout period specifies that the sr linux wait 30 seconds for a response from a server before trying the next server in the group for the server group of type local no external servers can be specified the local server group uses  etcpasswd and etcgroup for authentication and syslog for accounting the timeout period specifies that the sr linux wait a maximum of 60 seconds for an aaa function to complete example   candidate shared default    info system aaa system  aaa  servergroup tacacsall  type tacacs timeout 30 server 1221  networkinstance mgmt tacacs  secretkey aes3iz5vetdrv06gxkrgjfbqwbyma0t3itgq   server 1222  networkinstance mgmt 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 44 spacer text configuration basics release 226 securing access tacacs  secretkey aes3iz5vetdrv06gxkrgjfbqwbyma0t3itgq   server 1223  networkinstance mgmt tacacs  secretkey aes3iz5vetdrv06gxkrgjfbqwbyma0t3itgq   servergroup local  type local timeout 60     54 authentication for local users local users are those configured within the sr linux cli for a local user you can configure a password and specify one or more authentication methods including local authentication or a tacacs server group 541 configuring authentication for local users by default there is a single local user configured on the sr linux admin you can configure additional local users example the following example configures a password for the sr linux admin user   candidate shared default    system aaa authentication adminuser password newpass1234 example the following example creates a local user called sruser and configures a password   candidate shared default    system aaa authentication user srlinux password sr1l234 when the user configuration is displayed the password is hashed for example   candidate shared default    info system aaa system  aaa  authentication  user srlinux  password ar2kgsitqfju5gizz6xkxtxozogmbexo2ypg    3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 45 spacer text configuration basics release 226 securing access  example to change an existing users password use the same command that created the user and configure the new password for example   candidate shared default    system aaa authentication user srlinux password newpasswordl234 example the following example specifies authentication methods when a user attempts to log in the user is authenticated using local authentication first if local authentication fails the sr linux tries the servers in tacacs server group tacacsall if the user cannot be authenticated through either method the authentication attempt is rejected   candidate shared default    info system aaa system  aaa  authentication  authenticationmethod  local tacacsall     55 authorization using rolebased access control authorization is performed through rolebased access control users can be configured with a set of one or more roles that indicate the privileges for which they are authorized in the system a role consists of one or more rules which specify a schema path the role can have privileges for and a corresponding action which can be read write or deny after authentication a user is authorized to perform the specified action defined in the path for the role the user is assigned rolebased access control supports service authorization which allows you to limit the actions a user is authorized to perform to specific access types such as cli and gnmi 551 role configuration roles consist of a set of rules that define a schema pathreference and a corresponding action the path reference specifies system functions that are subject to authorization and the action specifies the privilege type for users assigned the role read write or deny the pathreference is specified relative to the root level for example the pathreference  indicates all cli functions at the root level and below the pathreference system indicates all cli functions at the system level and below and the pathreference system configuration indicates all cli functions at the system configuration level and below 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 46 spacer text configuration basics release 226 securing access if no role is assigned to a user at login the user has access to all cli plugins but no access to cli commands at any level this is equivalent to a rule with  as the pathreference and deny as the action up to 32 roles are supported each role can have a list of up to 256 paths the order of the pathreferences in a role does not matter the longest match is used when validating a command against a pathreference the syntax for the pathreference is sr linux cli format with  representing the root wildcards and ranges can be used with pathreferences in the same way they can in cli syntax each entry within the pathreference should use double quotes unless the command string is a single word with no spaces if the path itself includes quotes use backslash characters to indicate the quotes for example to specify the following in a pathreference a b and c d you can configure the following for the pathreference pathreference a b c d 5511 configuring a role to configure a role you define one or more rules that specify a path indicating the command string that is subject to authorization and a corresponding action such as read write or deny example the following is an example of creating a role named testrole that contains two rules one rule to limit access to networkinstance red and another rule to give write access to the rest of the tree a user assigned this role upon authentication is able to configure everything in the system except network instance red first define the role under the system aaa authorization context   candidate shared default    info system aaa system  aaa  authorization  role testrole      then specify the rules under the system configuration role context   candidate shared default    info system configuration system  configuration  role testrole  rule   action write  rule networkinstance red  action read    3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 47 spacer text configuration basics release 226 securing access  example the following example configures a role named aclapp that allows a user to view the state of the aclmgr application but no other information   candidate shared default    info system aaa system  aaa  authorization  role aclapp        candidate shared default    info system configuration system  configuration  role aclapp  rule system  action deny  rule system appmanagement application aclmgr state  action read     when a user that is assigned the aclapp role attempts to read information from the system state datastore only the state of the aclmgr application is displayed for example   candidate shared default    info from state system application aclmgr system  appmanagement  application aclmgr  state running    552 assigning roles to users a user can be assigned one or more roles the rules configured in the users roles specify the commands the user is authorized to issue up to 32 roles can be assigned to a user if a user has multiple roles assigned all of the rules configured in all of the roles apply to the user if multiple roles reference the same path the most specific rule is used for service authorization the system merges all roles that have the service cli gnmi and so on the user has logged in with and excludes any roles that omit the service 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 48 spacer text configuration basics release 226 securing access example in the following example the user srlinux is assigned the role testrole after the srlinux user is authenticated the user is authorized to use the system according to the rules configured in the role testrole using the example from configuring a role this would authorize the srlinux user to configure everything in the system except for the networkinstance red   candidate shared default    info system aaa system  aaa  authentication  user srlinux  role  testrole      553 authorization using a tacacs server you can configure the sr linux to use a tacacs server to provide authorization for rolebased access control when tacacs authorization is configured the actions an authenticated user can perform depend on the privlvl value configured for the user on a tacacs server if privlvlauthorization is not set to true the authenticated user is authorized as an admin user tacacs authorization for sr linux users works as follows 1 after a user is authenticated the sr linux sends the tacacs server an authorizationrequest message based on a shell exec session starting this authorizationrequest is sent immediately following user authentication but before the shell is started 2 the tacacs server returns an authorizationreply message that includes the privlvl value configured for the user for shell access 3 on the sr linux roles have been configured that map to a privlvl value 4 the sr linux allows the user to perform actions specified in roles with a privlvl value equal or lower to the privlvl value returned by the tacacs server 5531 configuring tacacs authorization to configure tacacs authorization for sr linux users you enable privlvl authorization for the tacacs  server group and configure roles that specify the privlvl mapping for each role subject to authorization using a tacacs server example the following configuration enables privlvl authorization for the tacacsall server group   candidate shared default    info system aaa servergroup tacacsall system  aaa  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 49 spacer text configuration basics release 226 securing access servergroup tacacsall  privlvlauthorization true    example the following configuration specifies two roles interface operstate and networkinstance operstate the interface operstate role grants read access for all interface operstates and the networkinstance operstate role grants read access for all networkinstance operstates   candidate shared default    info system configuration role  system  configuration  role interface operstate  rule interface  operstate  action read   role networkinstance operstate  rule networkinstance  operstate  action read    example the following configuration specifies the privlvl mapping for both roles in this example when a user is authenticated the sr linux sends an authorizationrequest based on a shell exec session starting the tacacs server returns an authorizationreply that specifies the privlvl value for the shell if the privlvl value returned by the tacacs server is 14 the user is assigned both roles that is read access to all interface operstates and all networkinstance operstates but no access to anything else in the system if the privlvl value returned by the tacacs server is 13 the user is assigned only the network instance operstate role and can read the operstate for networkinstances but has no access to anything else in the system   candidate shared default    info system aaa authorization system  aaa  authorization  role interface operstate  tacacs  privlvl 14   role networkinstance operstate  tacacs  privlvl 13     3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 50 spacer text configuration basics release 226 securing access  example the following example configures service authorization for a role that uses tacacs authorization see configuring service authorization in this example when a user is authenticated by a tacacs server in the server group tacacsall if the tacacs server returns privlvl 15 for the user then role1 is assigned to the user service authorization is configured for the role so that all services except gnmi are authorized for users assigned this role this means users assigned role1 are authorized for the functionality defined in the rules of role1 if they connect using the cli jsonrpc or ftp but are not authenticated if they connect using gnmi   candidate shared default    info system aaa authorization role role1 system  aaa  authorization  role role1  services  cli jsonrpc ftp  tacacs  privlvl 15      when a user is assigned multiple roles the user is authorized for all services specified in the roles they are assigned according to the rules defined in the roles for example if a user is assigned role1 which allows access to the system via cli and also assigned role2 which allows access via gnmi the user is authorized to use the cli to perform the functions defined in the rules of role1 and is authorized to use the gnmi interface for the functions defined in the rules of role2 554 service authorization for local users service authorization allows you to block or allow access to a user depending on the interface they use to connect to the device you can use service authorization to restrict access to a controller allowing it to speak through programmatic interfaces but without credentials that can be used by someone logged into the cli to configure service authorization you assign roles to local users that authorize them to issue commands using specified services such as the cli gnmi or jsonrpc interfaces for example you can define a role that grants read access to subinterface statistics and limits access to that information to the gnmi service when you assign that role to a user the user is allowed to read subinterface information via the gnmi interface only the following interface types can be configured for service authorization  cli  access to the system via cli 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 51 spacer text configuration basics release 226 securing access  gnmi  access to the system via gnmi  jsonrpc  access to the system via jsonrpc  ftp  access to the system via ftp  p4rt  access to the system via p4runtime rpcs after a user is authenticated the system checks whether the user is assigned a role that allows access via the interface they used to connect to the device for example if a user connects using gnmi the system checks whether the user is assigned any roles that authorize access via the gnmi interface if the user is assigned a role that authorizes access via gnmi the user receives access to the system via gnmi according to the rules defined in the set of roles that includes gnmi if the user connects via gnmi but is not assigned any role that authorizes access via gnmi the authorization attempt is rejected and the session is closed if a user is assigned multiple roles the user is authorized for all services specified in the roles they are assigned according to the rules defined in the roles for example consider a user assigned role r1 which allows access to the system via cli and also assigned role r2 which allows access via gnmi the user is authorized to use the cli to perform the functions defined in the rules of role r1 and is authorized to use the gnmi interface for the functions defined in the rules of role r2 by default a role has no services configured for authorization when you configure a role you must specify the services that apply to the role users assigned the role are authorized to perform the functions defined in the role using the specified services 5541 configuring service authorization to configure service authorization you create a role that defines rules permitting or denying access to system functionality assign the role to one or more users and specify the services over which users assigned the role are authorized to perform the rules defined in the role example the following example creates a role readoperstate that allows reading subinterface operstate but nothing else   candidate shared default    info system configuration role  system  configuration  role readoperstate  rule   action deny  rule interface  subinterface  operstate  action read     example the following example creates a user gnmiuser that is assigned the readoperstate role when authenticated   candidate shared default   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 52 spacer text configuration basics release 226 securing access  info system aaa authentication system  aaa  authentication  authenticationmethod  local  user gnmiuser  role  readoperstate      example the following example configures service authorization so that users assigned the readoperstate role such as gnmiuser can perform the functionality defined in the role only if they have connected to the system via gnmi if the user connects via a different service such as by logging into the cli the user is not authorized for the functionality defined in the role   candidate shared default    info system aaa authorization system  aaa  authorization  role readoperstate  services  gnmi      56 accounting configuration when accounting is enabled the sr linux device generates command accounting records as described in accounting the following is an example of accounting records generated by the sr linux device aug 7 223409 127001 bob ssh 1721701 start taskid2 timezoneutc serviceshell privlvl15 cmdtail f varlogtacplusacct aug 7 223409 127001 bob ssh 1721701 stop taskid2 timezoneutc serviceshell privlvl15 cmdtail f varlogtacplusacct aug 7 223414 127001 bob ssh 1721701 start taskid5 timezoneutc serviceshell privlvl15 cmdhelp aug 7 223414 127001 bob ssh 1721701 stop taskid5 timezoneutc serviceshell privlvl15 cmdhelp 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 53 spacer text configuration basics release 226 securing access 561 configuring accounting the following example configures accounting records to be sent to the tacacsall server group the sr linux generates an accounting record when a command is started and when it is stopped example   candidate shared default    info system aaa system  aaa  accounting  accountingmethod  tacacsall  event commands  record startstop     57 displaying user session information to display information about users currently logged in to the sr linux device use the show system aaa authentication session command example  show system aaa authentication session   id  user  service  authentication  privlvl  tty  remote  login time    name  name  method    host     4  bob  srlinuxcli  tacacs  15  pts1  2102  20211206t21240780z   11  user  srlinuxcli  local   pts4   20211207t04060693z   the asterisk  next to the username indicates the session from which the show system aaa authentication session was invoked 58 disconnecting user sessions to disconnect a user currently logged in to the sr linux device use the tools system disconnect sessionid sessionid command and specify the session id of the user to list the session ids of active users enter the show system aaa authentication session command example  show system aaa authentication session   id  user  service  authentication  privlvl  tty  remote  login time  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 54 spacer text configuration basics release 226 securing access   name  name  method    host     6  bob  srlinuxcli  tacacs  15  pts1  2102  20211206t21240780z   11  user  srlinuxcli  local   pts4   20211207t04060693z    tools system disconnect sessionid 6 terminating cli session 6 owned by user bob logged from pts1 systemaaaauthenticationsessionid6 disconnecting aaa cli sessions 6 59 configuring idletimeout for user sessions you can configure the idletimeout for user sessions which disconnects a user session after a specified period of inactivity by default user sessions are disconnected after 15 minutes of inactivity the idletimeout setting applies to sr linux users and remote users it does not apply to linux users or to jsonrpc or gnmi client sessions after a user session has been inactive for onehalf of the idletimeout period a notification is displayed indicating that the user will be logged out if the session remains idle for the remainder of the idletimeout period example the following example configures the idletimeout so that sr linux user sessions and remote user sessions are disconnected after 20 minutes of inactivity   candidate shared default    info system aaa system  aaa  authentication  idletimeout 20     3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 55 spacer text configuration basics release 226 management servers 6 management servers you can configure the following management servers on the sr linux  gnmi server  allows external gnmi clients to connect to the device and modify the configuration and collect state information  jsonrpc server  allows you to issue jsonformatted requests to the device to retrieve and set configuration and state you can configure transport layer security tls profiles which contain tls settings that can be provided to the gnmi and jsonrpc management servers 61 gnmi server the sr linux device can enable a gnmi server that allows external gnmi clients to connect to the device and modify the configuration and collect state information when the gnmi server is enabled the sr linux gnmimgr application functions as a target for gnmi clients the gnmimgr application validates gnmi clients and passes get set and subscribe rpcs to the sr linux mgmtsvr application via the grpc interface see the sr linux system management guide for details about the supported rpcs configuration changes made by gnmi clients are made within a private candidate configuration using a snapshot of the current running configuration as a baseline for the private candidate as with other types of candidate configurations the private candidate can operate in exclusive mode which locks out other users from concurrently modifying the private candidate configuration sessions between gnmi clients and the sr linux device must be encrypted using tls you can specify tls settings within a tls profile and apply the tls profile when configuring a gnmi server within a networkinstance when the gnmi server is enabled gnmi clients connect and authenticate to the sr linux device using the settings specified in the tls profile new connections between gnmi clients and the sr linux device are mutually authenticated by default the sr linux device validates the x509 certificate of the gnmi client and the other way around this behavior can be disabled in the tls profile the sr linux device after validating the x509 certificate of the gnmi client performs local authentication if the useauthentication parameter is set to true in this case the gnmi client is required to provide a username and password in the metadata of the get set and subscribe rpcs the supplied username and password are authenticated by the sr linux aaamgr application see the sr linux system management guide for examples of using the gnmicli gnmiget and gnmiset open source gnmi clients to configure and retrieve state information about the sr linux device 611 configuring a gnmi server the sr linux supports configuring a gnmi server under one or more networkinstances you can specify limits for the number of simultaneous active gnmi client sessions as well as the number of connection attempts per minute by gnmi clients 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 56 spacer text configuration basics release 226 management servers for the networkinstance where the gnmi server is running you can specify the ip address and port for gnmi client connections as well as the tls profile used for authenticating gnmi clients see tls profiles example the following example shows a configuration that enables a gnmi server on the sr linux device the gnmi server is configured so that gnmi clients can connect to the sr linux via the mgmt networkinstance on port 50052 connecting gnmi clients are authenticated using the settings specified in the tls profile tlsprofile1   candidate shared default    info system gnmiserver system  gnmiserver  adminstate enable timeout 7200 ratelimit 60 sessionlimit 20 networkinstance mgmt  adminstate enable useauthentication true port 50052 tlsprofile tlsprofile1 sourceaddress       62 jsonrpc server you can enable a jsonrpc server on the sr linux device which allows you to issue jsonformatted requests to the device to retrieve and set configuration and state you can use the jsonrpc api to run cli commands and standard get and set methods the sr linux device returns responses in json format configuration changes made using the jsonrpc api are made within a private candidate configuration using a snapshot of the current running configuration as a baseline for the private candidate as with other types of candidate configurations the private candidate can operate in exclusive mode which locks out other users from concurrently modifying the private candidate configuration when the jsonrpc server is enabled the application passes the requests to the sr linux mgmtsvr application via the grpc interfacethis jsonrpc api uses http and https for transport and users are authenticated with the aaamgr application https requests can be authenticated using tls using settings specified in a tls profile see tls profiles see the sr linux system management guide for examples of using the get method to retrieve state information from the sr linux the set method to modify the sr linux configuration and the cli method to enter sr linux cli commands 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 57 spacer text configuration basics release 226 management servers 621 configuring a jsonrpc server the sr linux supports configuring a jsonrpc server under one or more networkinstances you can specify limits for the number of simultaneous active http or https connections and the tcp port used for http or https connections if the tcp port is in use when the jsonrpc server attempts to bind to it the commit operation fails example the following example shows a configuration that enables a jsonrpc server within the mgmt network instance on the sr linux device the jsonrpc server is configured so that http requests are accepted on tcp port 4000 and https requests are accepted on tcp port 443 https requests are authenticated using the settings in the tls profile tlsprofile1   candidate shared default    info system jsonrpcserver system  jsonrpcserver  adminstate enable  networkinstance mgmt  http  adminstate enable useauthentication true sessionlimit 1 port 4000  https  adminstate enable useauthentication true sessionlimit 1 port 443 tlsprofile tlsprofile1 sourceaddress       63 tls profiles transport layer security tls is a protocol for enabling applications or devices to exchange information the sr linux supports configuring tls settings in tls profiles which can be provided to applications such as the gnmi server and the jsonrpc server so that clients connecting to the sr linux device via these applications are authenticated using the settings in the tls profile 631 configuring a tls profile a tls profile can specify whether authentication is performed for clients connecting to sr linux applications to which the profile is applied within a tls profile you can configure certificates keys and ciphers to use when negotiating tls connections with clients 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 58 spacer text configuration basics release 226 management servers example   candidate shared default    info system tls system  tls  serverprofile tlsprofile1  key aes4naar4zz5ska3pv773cuer0tapnhqrq certificate begin certificate request miieujccajocaqawdtelmakga1uebhmcvvmwggiima0gcsqgsib3dqebaquaa4icdwawggikaoicaqdxg7nz qw7ejhm6ubit7bi1gopgqtd2oqjtotfqexcfzgcbeefk903v7otnws0h11a1pzgnt9fpxv hymacvov4fzz99jrgz8wiwjmpxgwg3rndcwefc59cqfou9k8pbxlzvyckpvcjguk9wlzmhtdvyadxp7i5h nymldettpssucxazcwptzdxjtepa9dkq75lgcl jmivhx7eysbbrlkoselumbygavxjefnpjftvouape7cvdmprntha7op5fksoqzcotza0v1bcantblu7j8dl 1unsrk6mi9m5sz5mcqdw8cn223pt9acelcm27ly62rnecpazhnumpqg352mdlqz7sjmfwscb3eisj6yvni szk8wor7pd0oz3rsnygjjte3xf nwxndiofavf80nkhwbposyzfuwzigkbvsyeuqzmye4ehc5efezmwracitmsqzjsdqojza5y3ngak72ag9wqn 2lz3ahyvmlc3gn4d2p onh1ywl0desdemxukqamsf8eievcu1cbkbhab3blvop61c7isanhdw1k95cfpfnlt1howjlkaivi7gctgpw 2uury67lubal4rdpfnnkrlnjfkygjsclwsw0ur17notinflagx4k5axzp8fpvw3s0kyqr0s8uhajcsysrd7w aivohfoexuxyegqidaqaboaawdqyjkozihvcnaqelbqadggibafdyqd7ygmbm9e12i4y7nwuvorg5nwr6b5z acgncl3h8byerhsqjntahajyklg2pycodfq435b8nnfdsefbj9z8c6vs kixlffvggzvaglxr9vgs13srht0ae4lge2biuwje5szicgrr7moxcn ys2fh5qbuhyjhdp3uielinleuylou0aln0xxvrfjffeyofnkgetltg2ruevh7tuvgmld6jfhzwkm7hks eog4h22rmyq0eejcrjyuwtxzysohiiwbpgtddtoqi7j4cru0b5bibzkcfrxqdhzqivapi7u113i7qpq jic2fqnroxl2lvupuwcyehdnwhatbt oipepjfvg7zvngk3phvlph3g6a85oewfa8tbckct9ca8exwjcmbncebbnwl tl75hognftweqnxoggqnbleg8mmxdu9t5e lsdyedycj0ce2f8kfhe7rgw6xznyuts9c0casoi0kaexz9fm1jrrylaradyecvrymqeofgpio 2vjtmbu0rmtszkony5ijwsyljczgjc9jx9rteprqnym3bfbcg0yzw2blykfozsyzbuhr0nxpjy50v04an glj6cvvjpe8wutkuecrbwyuyeznbpy7m7au6sd1htmcl3sdtj2pzejt56wkcv9zjnoqybmrwatpjpu end certificate request authenticateclient true cipherlist  aes128sha256 descbc3sha camellia128sha     632 generating a selfsigned certificate from the sr linux cli you can create a selfsigned certificate and key by default sha256 with rsa encryption are used for the signature algorithm private keys are not encrypted using des3 and are 4096 bits in length example the following example generates a private key followed by the self signed certificate  tools system tls generateselfsigned email infonokiacom country us organization nokia systemtls begin private key miijraibadanbgkqhkig9w0baqefaasccs4wggkqageaaoicaqc3q7pncwjevlfn snip 1ecxrjvprvieduwyqvoiomfcawxjotjux6hgjiy0z9ktfwicex1ka4e3zxipec4p svzksoctqpqcik5pcsalhznoo6artpc4 end private key 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 59 spacer text configuration basics release 226 management servers begin certificate miietccauwgawibagijakzaurebpiv1ma0gcsqgsib3dqebcwuambqxejaqbgnv snip bttcaiqniikdj0niqezconesgxp3dkeovwqbh3es2qlsqbdvbyjz4ebodigaaz kdnk207h3hiklaaxmbaqewgiu2zkokkdd4qe6ophow6t end certificate this tools command example is equivalent to the following openssl command  openssl req x509 newkey rsa4096 days 365 633 generating a certificate signing request you can issue a cli command that returns a private key and certificate signing request csr this csr can be passed to a certificate authority the same one that the clientserver uses to validate certificates on either side for the certificate authority to sign the request the csr cannot be used asis example the following command returns the private key followed by the csr  tools system tls generatecsr email infonokiacom country us organization nokia systemtls begin private key miijraibadanbgkqhkig9w0baqefaasccs4wggkqageaaoicaqc3q7pncwjevlfn snip 1ecxrjvprvieduwyqvoiomfcawxjotjux6hgjiy0z9ktfwicex1ka4e3zxipec4p svzksoctqpqcik5pcsalhznoo6artpc4 end private key begin certificate request miic5tccac0caqawgz8xczajbgnvbaytalvtmrmweqydvqqidapdywxpzm9ybmlh vy3mje7rjtmwtg0ptfiuu4bfoazlhhrn1hl1mxue2m6xj8gvbpp2sn7svieucyl rvtsfmcc4vmjx3t0haewisd7dnekvq end certificate request this tools command example is equivalent to the following openssl command  openssl req newkey rsa4096 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 60 spacer text configuration basics release 226 logging 7 logging the sr linux device implements logging via the standard linux syslog libraries the sr linux device uses rsyslog in the underlying linux os to filter logs and pass them on to remote servers or other specified destinations the main configuration file for rsyslog is etcrsyslogconf the sr linux installs a minimal version of the etcrsyslogconf file and maintains an sr linuxspecific configuration file in the etc rsyslogd directory perapplication logging configuration files are also kept in the etcrsyslogd directory these files are named etcrsyslogdnnappconf you can modify the sr linux logging configuration using the cli northbound api or by editing the conf files manually the sr linux device overwrites any parts of the configuration that are owned by sr linux and this may supersede any configuration done manually the sr linux conf files in etcrsyslogd use standard rsyslog syntax for configuring filters and actions within rules the sr linux supports configuration of linux facilities and sr linux subsystems as sources for log messages to filter see the sr linux log events guide for properties and descriptions of the log messages that can be generated by sr linux subsystems basic logging configuration consists of specifying a source for input log messages filtering the log messages and specifying an output destination for the filtered log messages 71 input sources for log messages the sr linux supports using messages logged to linux syslog facilities and messages generated by sr linux subsystems as input sources for log messages table 2 linux syslog facilities describes the linux syslog facilities that can be used as input sources for log messages table 2 linux syslog facilities facility description auth securityauthorization messages that do not contain secret information authpriv securityauthorization messages that may contain secret information cron messages generated by cron daemon messages generated by system daemons without their own facility ftp kern local0 messages generated by an ftp daemon messages generated by the kernel local use 0 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 61 spacer text configuration basics release 226 logging facility description local1 local2 local3 local4 local5 local6 local7 lpr mail news syslog user uucp local use 1 local use 2 local use 3 local use 4 local use 5 local use 6 local use 7 messages generated by the line printer subsystem messages generated by a mail client or server messages generated by the network news subsystem messages generated internally by syslog messages generated by a user messages generated by the uucp unixtounix copy subsystem table 3 sr linux logging subsystem names lists the sr linux subsystems that produce messages that can serve as input sources for log messages by default sr linux subsystem messages are logged to linux syslog facility local6 table 3 sr linux logging subsystem names subsystem description aaa messages generated by the aaamgr application not including accounting messages accounting accounting messages generated by the aaamgr application acl app messages generated through an acl log action messages generated by the aaamgr application arpnd messages generated by the arpndmgr application bfd bgp messages generated by the bfdmgr application messages generated by the bgpmgr application chassis messages generated by the chassismgr application fib messages generated by the fibmgr application 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 62 spacer text configuration basics release 226 logging subsystem description gnmi json linux lldp mgmt mpls netinst policy sdk messages generated by the gnmiserver application messages generated by the jsonrpcserver application messages generated by the linuxmgr application messages generated by the lldpmgr application messages generated by the mgmtsvr application messages generated by the mplsmgr application messages generated by the netinstmgr application messages generated by the policymgr application messages generated by the sdkmgr application staticroute messages generated by the staticroutemgr application xdp messages generated by the xdpmgr application 72 filters for log messages you can configure filters to target specific messages or groups of log messages captured within the input message source a filter can specify the set of messages generated by a linux facility at a specified priority for example messages generated by the kernel that have a priority of warning or higher or mail facility messages that have a priority of critical filtering can be done for messages generated by a specific sr linux subsystem for example messages generated by the aaamgr application or messages generated by the chassismgr application sr linux subsystem messages go to a specified linux facility by default local6 and you can create filters for subsystemspecific messages from this facility table 4 logging priorities describes the logging priorities in order of severity table 4 logging priorities code priority name description 0 1 2 3 4 emergency system is unusable alert critical error action must be taken immediately critical conditions error conditions warning warning conditions 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 63 spacer text configuration basics release 226 logging code priority name description 5 6 7 notice normal but significant conditions informational informational messages debug debuglevel messages 73 output destinations for log messages you can set the action that the sr linux takes for input messages that meet the criteria specified in a filter this can include sending the messages to a destination such as a log file the console or a remote host for example you can configure the sr linux to send messages generated by the kernel that have priority warning to a file called varlogsrlinuxfilekernelwarning messages generated by an sr linux subsystem such as the bgpmgr or gnmiserver application can be sent to specified destinations actions for messages matching a filter can include the following  send the messages to a specified file in the varlogsrlinuxfile directory  send the messages to a buffer a buffer is similar to a file but uses memory as storage and is not persistent across system reboots messages sent to a buffer are stored in the varlogsrlinux buffer directory  send the messages to the console that is the linux device devconsole which may be assigned to a serial device in hardware  send the messages to one or more remote servers you can specify a networkinstance where rsyslogd is run and which serves as the source for the messages 74 defining filters filters target specific messages or groups of log messages within the input message source filter criteria for log messages can include the following  specific text within a message  prefix text at the beginning of a message  linux facility that generated the message  regular expression matching text within the message  syslog tag of the message example the following example shows a configuration that creates a filter that matches messages from the linux facility kern that have a priority of warning or higher see table 4 logging priorities for a list of logging priorities   candidate shared default    info system logging 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 64 spacer text configuration basics release 226 logging system  logging  filter f1  facility kern  priority  matchabove warning       example the following example creates a filter that matches messages from the linux facility local6 where sr linux subsystem messages are logged by default that have a priority of informational or higher and contain the text accounting this filter can be used to match messages from the sr linux accounting subsystem   candidate shared default    info system logging system  logging  filter f2  contains accounting  facility local6  priority  matchabove informational       75 logging destination configuration you can configure the sr linux to send logging information to the following destinations  a log file  memory buffer storage  the console devconsole  one or more remote servers 751 specifying a log file destination the sr linux can send log messages to a specified log file by default the log file resides in the var logsrlinuxfile directory you can specify the retention policy for the file including the maximum size default 10 mb as well as the number of files to keep in the rotation default 4 files 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 65 spacer text configuration basics release 226 logging example the following example uses messages from linux facility cron as input filters the messages for those that have critical priority and sends the filtered messages to the file varlogsrlinuxfilecron critical   candidate shared default    info system logging system  logging  file croncritical  facility cron  priority  matchexact  critical       example the following example sends messages matching criteria specified in filter f1 to the file varlog srlinuxfilef1match   candidate shared default    info system logging system  logging  file f1match  filter  f1     example the following example uses messages generated by the sr linux aaa subsystem that is messages generated by the aaamgr application but not including accounting messages as input the messages are filtered for those that have warning or informational priority and the filtered messages are sent to the file varlogsrlinuxfileaaawarninfo   candidate shared default    info system logging system  logging  file aaawarninfo  subsystem aaa  priority  matchexact  warning informational     3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 66 spacer text configuration basics release 226 logging   752 specifying a buffer destination the sr linux can send log messages to a buffer a buffer is similar to a file except that a buffer uses memory as storage and is not persistent across system reboots when the sr linux device boots it creates a nonswappable tmpfs virtual filesystem at varlog srlinuxbuffer this tmpfs filesystem has a fixed size of 512 mb which is reserved for buffer usage when a buffer is created through a commit transaction the sr linux verifies that there is enough buffer space available to contain all configured buffers based on their retention policies if sufficient space is not available the commit transaction fails example the following example sends messages matching criteria specified in filter f1 to the buffer varlog srlinuxbufferf1match a retention policy is specified so that when the buffer reaches 5000000 bytes messages are written to a new buffer after five buffers are filled the oldest one is overwritten   candidate shared default    info system logging system  logging  buffer f1match  rotate 5 size 5000000 filter  f1     753 specifying the console as destination you can specify the console as a destination for log messages the console refers to linux device dev console the console may be assigned to a serial device in hardware example the following example uses messages generated by the sr linux accounting subsystem as input filters the messages for those that have informational priority or higher and sends the filtered messages to  devconsole   candidate shared default    info system logging system  logging  console  subsystem accounting  priority  matchabove informational   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 67 spacer text configuration basics release 226 logging    754 specifying a remote server destination the sr linux can send log messages to one or more remote servers you can specify the network instance that the sr linux uses to contact the remote servers the rsyslogd process is run within the specified networkinstance example the following example uses messages generated by the sr linux bgp subsystem that is messages generated by the bgpmgr application as input filters the messages for those that have alert priority or higher and sends the filtered messages to a remote server the messages are sourced from the mgmt networkinstance   candidate shared default    info system logging system  logging  networkinstance mgmt remoteserver 1122  subsystem bgp  priority  matchabove alert       76 specifying a linux syslog facility for sr linux subsystem messages all of the messages generated by sr linux subsystems see table 3 sr linux logging subsystem names are logged to the same linux syslog facility this allows you to filter messages from all sr linux subsystems by capturing logs from this facility by default sr linux subsystem messages are logged to the linux syslog facility local6 you can optionally specify a different syslog facility see table 2 linux syslog facilities for the syslog facilities example the following example changes the linux syslog facility where messages generated by sr linux subsystems are logged from the default of local6 to local7   candidate shared default    info system logging system  logging  subsystemfacility local7   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 68 spacer text configuration basics release 226 interfaces 8 interfaces on the sr linux an interface is any physical or logical port through which packets can be sent to or received from other devices the sr linux supports the following interface types  loopback a loopback interface is a virtual interface that is always up providing a stable source or destination from which packets can always be originated or received the sr linux supports up to 256 loopback interfaces systemwide across all networkinstances loopback interfaces are named lon where n is 0 to 255  system the system interface is a type of loopback interface that has characteristics that do not apply to regular loopback interfaces  the system interface can be bound to the default networkinstance only  the system interface does not support multiple ipv4 addresses or multiple ipv6 addresses  the system interface cannot be administratively disabled once configured it is always up the sr linux supports a single system interface named system0 when the system interface is bound to the default networkinstance and an ipv4 address is configured for it the ipv4 address is the default local address for multihop bgp sessions to ipv4 neighbors established by the default network instance and it is the default ipv4 source address for ipv4 vxlan tunnels established by the default networkinstance the same functionality applies with respect to ipv6 addresses  ipv6 bgp neighbors  ipv6 vxlan tunnels  network network interfaces carry transit traffic as well as originate and terminate control plane traffic and in band management traffic the physical ports in line cards installed in the sr linux are network interfaces a typical line card has a number of frontpanel cages each accepting a pluggable transceiver each transceiver may support a single channel or multiple channels supporting one ethernet port or multiple ethernet ports depending on the transceiver type and its breakout options in the sr linux cli each network interface has a name that indicates its type and its location in the chassis the location is specified with a combination of slot number and port number using the following formats ethernetslotport for example interface ethernet21 refers to the line card in slot 2 of the sr linux chassis and port 1 on that line card  management management interfaces are used for outofband management traffic the sr linux supports a single management interface named mgmt0 the mgmt0 interface supports the same functionality and defaults as a network interface except for the following  packets sent and received on the mgmt0 interface are processed completely in software 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 69 spacer text configuration basics release 226 interfaces  the mgmt0 interface does not support multiple output queues so there is no output traffic differentiation based on forwarding class  the mgmt0 interface does not support pluggable optics it is a fixed 101001000baset copper port  integrated routing and bridging irb irb interfaces enable intersubnet forwarding network instances of type macvrf are associated with a network instance of type ipvrf via an irb interface irb interfaces are named irbn where n is 0 to 255 see irb interfaces on the sr linux each loopback network management and irb interface can be subdivided into one or more subinterfaces see subinterfaces 81 linux interface naming conventions every type of sr linux interface has an underlying interface in the linux os these interfaces have names that adhere to linux restrictions maximum 15 characters and no slashes the linux interface name formats are as follows  loopback interfaces lon where n is 0 to 255 for example lo0  network interfaces eslotportsubinterface for example e421  management interface mgmt0  system interface system0  lag interface lagn  irb interface irbn 82 basic interface configuration the following example shows a configuration for interface basic parameters including administratively enabling the interface specifying a description and setting the mtu the settings apply to any subinterfaces on the port unless overridden in the subinterface configuration   candidate shared default    info interface ethernet12 interface ethernet12 description sampleinterfaceconfig adminstate enable mtu 1500 83 subinterfaces on the sr linux each loopback network management and irb interface can be subdivided into one or more subinterfaces a subinterface is a logical channel within its parent interface traffic belonging to one subinterface can be distinguished from traffic belonging to other subinterfaces of the same port using encapsulation methods such as 8021q vlan tags 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 70 spacer text configuration basics release 226 interfaces while each port can be considered a shared resource of the router that is usable by all networkinstances a subinterface can only be associated with one networkinstance at a time to move a subinterface from one networkinstance to another you must disassociate it from the first networkinstance before associating it with the second networkinstance see networkinstances you can configure acl policies to filter ipv4 and ipv6 packets entering or leaving a subinterface see access control lists the sr linux supports policies for assigning traffic on a subinterface to forwarding classes or remarking traffic at egress before it leaves the router dscp classifier policies map incoming packets to the appropriate forwarding classes and dscp rewriterule policies mark outgoing packets with an appropriate dscp value based on the forwarding class 831 routed and bridged subinterfaces sr linux subinterfaces can be specified as type routed or bridged  routed subinterfaces can be assigned to a networkinstance of type mgmt default or ipvrf  bridged subinterfaces can be assigned to a networkinstance of type macvrf routed subinterfaces allow for configuration of ipv4 and ipv6 settings and bridged subinterfaces allow for configuration of bridge table and vlan ingressegress mapping 832 subinterface naming conventions the cli name of a subinterface is the name of its parent interface followed by a dot  and an index number that is unique within the scope of the parent interface for example the subinterface named ethernet210 is a subinterface of ethernet21 and it has index number 0  each loopback interface lon can only have one subinterface and the index number can be in the range 0 to 255  each network interface ethernetslotport where the vlantagging parameter is set to false can have one subinterface and the index number can be in the range 0 to 9999  each network interface where the vlantagging parameter is set to true can have up to 4096 subinterfaces up ro 1024 of type routed and 3072 of type bridged with each subinterface assigned a unique index number in the range 0 to 9999  the management and system interfaces mgmt0 and system0 can only have one subinterface with an index number of 0 the linux name of a subinterface adheres to linux restrictions maximum 15 characters and no slashes for example the subinterface named ethernet210 has the linux name e210 833 basic subinterface configuration for ipv4 packets to be sourced from a subinterface the ipv4 address family must be enabled on the subinterface and the subinterface must be configured with an ipv4 address and prefix length that indicates the other ipv4 hosts reachable on the same subnet a subinterface can have up to 64 ipv4 prefixes assigned to it one or more of these can be optionally configured as a primary candidate within the set of ipv4 prefixes configured as primary candidates the 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 71 spacer text configuration basics release 226 interfaces lowest ipv4 address that does not fail duplicate address detection is selected as the primary address for the subinterface the primary address is used by upper layer protocols that need to choose only one ipv4 address from which to source their messages as well as for information about this interface displayed with the info from state command if there is no suitable address in the set of ipv4 prefixes configured as primary candidates or if no ipv4 prefix is configured as primary a selection is made from the ipv4 prefixes not configured as primary candidates for ipv6 packets to be sourced from a subinterface the ipv6 address family must be enabled on the subinterface which must be configured with a global unicast ipv6 address and prefix length the address can be configured statically or obtained from a dhcp server a subinterface can have up to 16 global unicast ipv6 addresses and prefixes assigned to it one or more of these can be optionally configured as a primary candidate within the set of ipv6 prefixes configured as primary candidates the lowest ipv6 address that does not fail duplicate address detection is selected as the primary address for the subinterface the primary address is used by upper layer protocols that need to choose only one ipv6 address from which to source their messages as well as for information about this interface displayed with the info from state command if there is no suitable address in the set of ipv6 prefixes configured as primary candidates or if no ipv6 prefix is configured as primary a selection is made from the ipv6 prefixes not configured as primary candidates the following example shows basic parameters for a subinterface configuration including ipv4 and ipv6 addresses and prefix lengths the configuration for subinterface 1 administratively enables the subinterface specifies an acl policy for input ipv4 traffic and specifies a dscp classifier policy that assigns input ipv4 traffic to a queue based on the 6bit dscp value in the ip header the configuration for subinterface 2 administratively enables the subinterface and configures multiple ipv4 and ipv6 addresses and prefix lengths the primary ipv4 address for the subinterface is selected from among the set of ipv4 prefixes configured as primary candidates the selected ipv4 address is the numerically lowest address that does not fail duplicate address detection the global unicast ipv6 address for the subinterface is selected from the ipv6 prefix configured as primary the selected global unicast ipv6 address is the numerically lowest address that does not fail duplicate address detection   candidate shared default    info interface ethernet12 interface ethernet12 description sampleinterfaceconfig adminstate enable mtu 1500 subinterface 1  adminstate enable ipv4  dhcpclient true    ipv6  address 20011192168121126    acl  input  ipv4filter 101   qos  input  classifiers  ipv4dscp 1 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 72 spacer text configuration basics release 226 interfaces     subinterface 2  adminstate enable ipv4  address 19216812130  primary  address 19216812230  primary  address 19216812230    ipv6  address 20011192168122126  primary  address 20011192168123126     834 subinterface vlan configuration when the vlantagging parameter is set to true for a network interface the interface can accept ethertype 0x8100 frames with one or more vlan tags the interface can be configured with up to 4096 subinterfaces each with a separate index number the following example enables vlan tagging for an interface and configures two subinterfaces single tagged packets received on subinterface ethernet211 are encapsulated with vlan id 101   candidate shared default    info interface ethernet21 interface ethernet21 adminstate enable vlantagging true subinterface 1  adminstate enable ipv4  dhcpclient true     subinterface 2  adminstate enable ipv4  dhcpclient true    vlan  encap  singletagged  vlanid 101     3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 73 spacer text configuration basics release 226 interfaces 835 vlan tag tpid configuration the 8021q vlan tag protocol identifier tpid in the vlan tag of an ethernet frame indicates the protocol type of the vlan tag this feature allows you to configure the vlan tag tpid that is used to classify frames as dot1q on singletagged interfaces or to push at egress by default the value of the vlan tag tpid is 0x8100 you can configure the following tpid values for an interface  tpid0x8100 default value typically used to identify 8021q singletagged frames  tpid0x88a8 typical tpid value for 8021q provider bridging or qinq stags  tpid0x9100 alternate tpid value for qinq tags  tpid0x9200 alternate tpid value for qinq tags  tpidany wildcard that matches any of the generally used tpid values for single or multitagged vlans this value is equivalent to matching any of tpid0x8100 tpid0x88a8 tpid0x9100 or tpid 0x9200 at ingress at egress if a tag needs to be pushed and tpidany is configured the default tpid value is used note  this feature does not change the behavior of subinterfaces of type untagged or any nor does it change the behavior of interfaces configured with vlantagging false  on a dot1q interface if the configured tpid is for example tpid0x88a8 the service delimiting tags have tpid value 0x88a8 so frames received with that tpid may match a subinterface if they come with the appropriate vlan id frames with any other tpid value only match untagged interfaces or tagged interfaces with vlan id any or untagged  only one tpid value can be configured per interface  the tpid pushed at egress is one of the following  the configured tpid if sr linux is pushing a servicedelimiting tag and the configured tpid is different from tpidany  the default tpid of 0x8100 if sr linux is pushing a servicedelimiting tag and the configured tpid is tpid0x8100 or tpidany  this feature is supported on all interfaces that support vlan tagging that is all interfaces except for loopback system management and irb  for cpu injected packets the configured interface tpid is used in injected unicast and multicast frames in the context of the macvrf flood group so the configured tpid appears in cpmoutgoing ethernet frames  when the tpid is configured on a lag interface the configuration is propagated to all lag members  this feature is not supported on interfaces configured in breakout mode 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 74 spacer text configuration basics release 226 interfaces 8351 configuring the vlan tag tpid for an interface the following example configures the tpidany wildcard for an interface at ingress this configuration matches tpid0x8100 tpid0x88a8 tpid0x9100 or tpid0x9200 sr linux pushes the default tpid of 0x8100 to egress frames example  candidate shared default    info interface ethernet11 interface ethernet11  vlantagging true tpid tpidany subinterface 1  vlan  encap  singletagged  vlanid 101      8352 displaying the vlan tag tpid use the show interface detail command to display the vlan tag tpid for an interface example  candidate shared default    show interface ethernet112 detail  interface ethernet112  description  dut2 oper state  up down reason  na last change  47m6s ago 1 flaps since last clear speed  100g flow control  rx is disabled tx is disabled mtu  9232 vlan tagging  true vlan tpid  0x8100 queues  8 output queues supported 1 used since the last clear mac address  000102ff000c last stats clear 47m6s ago breakout mode  false 836 bridged subinterface configuration bridged subinterfaces are associated with a macvrf networkinstance on macvrf network instances traffic can be classified based on vlan tagging interfaces where vlan tagging is set to false or true can be used with macvrf network instances 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 75 spacer text configuration basics release 226 interfaces a default subinterface can be specified which captures untagged and nonexplicitly configured vlan tagged frames in tagged subinterfaces within a tagged interface a default subinterface vlanid value is set to any and an untagged subinterface can be configured this kind of configuration behaves as follows  the vlanid any subinterface captures untagged and nonexplicitly configured vlantagged frames  the untagged subinterface captures untagged and packets with tag0 as outermost tag when vlanid any and untagged subinterfaces are configured on the same tagged interface packets for unconfigured vlans go to the vlanid any subinterface and tag0untagged packets go to the untagged subinterface the vlanid value can be configured as a specific valid number or with the keyword any which means any frame that does not hit the vlanid configured in other subinterfaces of the same interface is classified in this subinterface in the following example the vlan encap untagged setting is enabled for subinterface 1 this setting allows untagged frames to be captured on tagged interfaces for subinterface 2 the vlan encap singletagged vlanid any setting allows nonconfigured vlan ids and untagged traffic to be classified to this subinterface with the vlan encap untagged setting on one subinterface and the vlan encap singletagged vlanid any setting on the other subinterface traffic enters the appropriate subinterface that is traffic for unconfigured vlans goes to subinterface 2 and tag0untagged traffic goes to subinterface 1  candidate shared default    info interface ethernet12 interface ethernet12 vlantagging true subinterface 1  type bridged vlan  encap  untagged   subinterface 2  type bridged vlan  encap  singletagged  vlanid any  84 irb interfaces integrated routing and bridging irb interfaces enable intersubnet forwarding network instances of type macvrf are associated with a network instance of type ipvrf via an irb interface on sr linux irb interfaces are named irbn where n is 0 to 255 up to 4095 subinterfaces can be defined under an irb interface an ipvrf network instance can have multiple irb subinterfaces while a macvrf network instance can refer to only one irb subinterface irb subinterfaces are type routed and cannot be configured as any other type 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 76 spacer text configuration basics release 226 interfaces irb subinterfaces operate in the same way as other routed subinterfaces including support for the following  ipv4 and ipv6 acls  dscp based qos input and output classifiers and rewrite rules  static routes and bgp ipv4 and ipv6 families  ip mtu with the same range of valid values as ethernet subinterfaces  all settings in the subinterfaceipv4 and subinterfaceipv6 containers for ipv6 the irb subinterface also gets an ipv6 link local address  bfd  subinterface statistics irb interfaces do not support sflow or vlan tagging 841 irb interface configuration the following example configures an irb interface the irb interface is operationally up when its admin state is enabled and its irb subinterfaces are operationally up when associated with macvrf and ipvrf network instances at least one ipv4 or ipv6 address must be configured for the irb subinterface to be operationally up  candidate shared default    info interface irb1 interface irb1  description irbinterface adminstate enable subinterface 1  adminstate enable ipv4  address 172161124      85 displaying interface statistics to display statistics for a specific interface use the info from state command in candidate or running mode or the info command in state mode example  candidate shared default    info from state interface ethernet11 interface ethernet11  adminstate enable mtu 9232 loopbackmode false ifindex 54 operstate down operdownreason lowerlayerdown lastchange 20200604t150635920z 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 77 spacer text configuration basics release 226 interfaces vlantagging false statistics  inoctets 0 inunicastpackets 0 inbroadcastpackets 0 inmulticastpackets 0 inerrorpackets 0 infcserrorpackets 0 outoctets 0 outunicastpackets 0 outbroadcastpackets 0 outmulticastpackets 0 outerrorpackets 0 carriertransitions 0  trafficrate  inbps 0 outbps 0  transceiver  adminstate enable txlaser true operstate up ddmevents false forwarderrorcorrection disabled formfactor qsfp28 ethernetpmd 100gbasesr4 connectortype mpo1x12 vendor avago  vendorpartnumber afbr89cddzal1  vendorrevision 01 serialnumber af1937gn050  datecode 190910  faultcondition false temperature  latestvalue 32  voltage  latestvalue 32809  channel 1  wavelength 85000 inputpower  latestvalue 3398  outputpower  latestvalue 026  laserbiascurrent  latestvalue 7494   channel 2  wavelength 85000 inputpower  latestvalue 4000  outputpower  latestvalue 005  laserbiascurrent  latestvalue 7494   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 78 spacer text configuration basics release 226 interfaces channel 3  wavelength 85000 inputpower  latestvalue 2328  outputpower  latestvalue 002  laserbiascurrent  latestvalue 7494   channel 4  wavelength 85000 inputpower  latestvalue 4000  outputpower  latestvalue 024  laserbiascurrent  latestvalue 7494    ethernet  portspeed 100g hwmacaddress 68ab09a271b0 flowcontrol  receive false  statistics  inmacpauseframes 0 inoversizeframes 0 injabberframes 0 infragmentframes 0 incrcerrorframes 0 outmacpauseframes 0 in64bframes 0 in65bto127bframes 0 in128bto255bframes 0 in256bto511bframes 0 in512bto1023bframes 0 in1024bto1518bframes 0 in1519borlongerframes 0 out64bframes 0 out65bto127bframes 0 out128bto255bframes 0 out256bto511bframes 0 out512bto1023bframes 0 out1024bto1518bframes 0 out1519borlongerframes 0   sflow  adminstate enable  qos  output  unicastqueue 0  queueparameters  peakratebps 101370000000 strictpriority true  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 79 spacer text configuration basics release 226 interfaces  unicastqueue 1  queueparameters  peakratebps 101370000000 strictpriority true   unicastqueue 2  queueparameters  peakratebps 101370000000 strictpriority true   unicastqueue 3  queueparameters  peakratebps 101370000000 strictpriority true   unicastqueue 4  queueparameters  peakratebps 101370000000 strictpriority true   unicastqueue 5  queueparameters  peakratebps 101370000000 strictpriority true   unicastqueue 6  queueparameters  peakratebps 101370000000 strictpriority true   unicastqueue 7  queueparameters  peakratebps 101370000000 strictpriority true     queuestatistics  unicastqueue 0  virtualoutputqueue 1   virtualoutputqueue 2   virtualoutputqueue 3   virtualoutputqueue 4    unicastqueue 1  virtualoutputqueue 1   virtualoutputqueue 2   virtualoutputqueue 3   virtualoutputqueue 4  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 80 spacer text configuration basics release 226 interfaces   unicastqueue 2  virtualoutputqueue 1   virtualoutputqueue 2   virtualoutputqueue 3   virtualoutputqueue 4    unicastqueue 3  virtualoutputqueue 1   virtualoutputqueue 2   virtualoutputqueue 3   virtualoutputqueue 4    unicastqueue 4  virtualoutputqueue 1   virtualoutputqueue 2   virtualoutputqueue 3   virtualoutputqueue 4    unicastqueue 5  virtualoutputqueue 1   virtualoutputqueue 2   virtualoutputqueue 3   virtualoutputqueue 4    unicastqueue 6  virtualoutputqueue 1   virtualoutputqueue 2   virtualoutputqueue 3   virtualoutputqueue 4    unicastqueue 7  virtualoutputqueue 1   virtualoutputqueue 2   virtualoutputqueue 3   virtualoutputqueue 4    multicastqueue 0   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 81 spacer text configuration basics release 226 interfaces multicastqueue 1   multicastqueue 2   multicastqueue 3   multicastqueue 4   multicastqueue 5   multicastqueue 6   multicastqueue 7     851 clearing interface statistics you can clear the statistics counters for a specified interface example  tools interface ethernet11 statistics clear interfacenameethernet11 interface ethernet11 statistics cleared example to clear queue statistics for an interface  tools interface ethernet11 statistics queuestatistics clear example to clear statistics for a specified queue on an interface  tools interface ethernet11 statistics queuestatistics multicastqueue 0 clear 86 displaying subinterface statistics to display statistics for a specific subinterface enter the context for the subinterface and use the info from state command example  candidate shared default    interface ethernet12  candidate shared default  interface ethernet12   subinterface 1  candidate shared default  interface ethernet12 subinterface 1   info from state adminstate enable ipmtu 1500 ifindex 32769 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 82 spacer text configuration basics release 226 interfaces operstate up lastchange 20190930t163929725z ipv4  allowdirectedbroadcast false address 19216812230  origin static  arp  timeout 14400 neighbor 192168121  linklayeraddress 000101ff0001 origin dynamic expirationtime 20190930t203930591z    ipv6  address 20011192168122126  origin static status preferred  address fe802013fffeff164  origin linklayer status preferred  neighbordiscovery  dupaddrdetect true reachabletime 30 staletime 14400 neighbor 20011192168121  linklayeraddress 000101ff0001 origin dynamic isrouter true currentstate reachable nextstatetime 20190930t172630018z  neighbor fe802011fffeff1  linklayeraddress 000101ff0001 origin dynamic isrouter true currentstate stale nextstatetime 20190930t204016078z    statistics  inpkts 564 inoctets 49394 inerrorpkts 0 indiscardedpkts 0 interminatedpkts 560 interminatedoctets 49054 inforwardedpkts 4 inforwardedoctets 340 outforwardedpkts 0 outforwardedoctets 0 outerrorpkts 0 outdiscardedpkts 0 outpkts 0 outoctets 0  acl   qos  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 83 spacer text configuration basics release 226 interfaces input  classifiers  ipv4dscp default ipv6dscp default mplstc default    861 clearing subinterface statistics you can clear the statistics counters for a specified subinterface example  tools interface ethernet11 subinterface 1 statistics clear interfacenameethernet11subinterfaceindex1 subinterface ethernet111 statistics cleared 87 displaying interface status use the show interface command to display the operational state of configured interfaces example to display the status of all configured interfaces that have operational state up and their subinterfaces that also have operational state up  running    show interface  ethernet110 is up speed 100g type 100gbasecr4 cal ethernet1101 is up encapsulation null ipv4 addr  192351031 static ipv6 addr  2001192351127 static preferred ipv6 addr  fe8022e09cfffe78e2ea64 linklayer preferred  ethernet121 is up speed 100g type 100gbasecr4 cal ethernet1211 is up encapsulation null ipv4 addr  19245125431 static ipv6 addr  2001192451fe127 static preferred ipv6 addr  fe8022e09cfffe78e2f564 linklayer preferred  ethernet122 is up speed 100g type 100gbasecr4 cal ethernet1221 is up encapsulation null ipv4 addr  19245325431 static ipv6 addr  2001192453fe127 static preferred ipv6 addr  fe8022e09cfffe78e2f664 linklayer preferred  ethernet13 is up speed 100g type 100gbasecr4 cal ethernet131 is up encapsulation null ipv4 addr  192571131 static ipv6 addr  20011925711127 static preferred 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 84 spacer text configuration basics release 226 interfaces ipv6 addr  fe8022e09cfffe78e2e364 linklayer preferred    summary 3 loopback interfaces configured 8 ethernet interfaces are up 1 management interfaces are up 12 subinterfaces are up  example to display summary information about interfaces that have operational state up or down  running    show interface brief   port  admin state  oper state  speed  type    ethernet11  enable  up  100g  100gbasesr4   ethernet12  enable  up   100gbasesr4   ethernet13  disable  down     ethernet14  disable  down     ethernet15  disable  down     ethernet16  disable  down     ethernet17  disable  down     example to display summary information about a specific interface  running    show interface ethernet11 brief   port  admin state  oper state  speed  type    ethernet11  enable  up  100g  100gbasesr4   example to display summary information about interfaces and subinterfaces that have operational state up or down  running    show interface all  ethernet11 is down reason portadmindisabled  ethernet110 is up speed 100g type 100gbasecr4 cal ethernet1101 is up encapsulation null ipv4 addr  192351031 static ipv6 addr  2001192351127 static preferred ipv6 addr  fe8022e09cfffe78e2ea64 linklayer preferred  ethernet111 is down reason portadmindisabled  ethernet112 is down reason portadmindisabled   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 85 spacer text configuration basics release 226 interfaces  summary 3 loopback interfaces configured 8 ethernet interfaces are up 1 management interfaces are up 12 subinterfaces are up  example to display summary information about a specific interface and its subinterfaces  running    show interface ethernet121  ethernet121 is up speed 100g type 100gbasecr4 cal ethernet1211 is up encapsulation null ipv4 addr  19245125431 static ipv6 addr  2001192451fe127 static preferred ipv6 addr  fe8022e09cfffe78e2f564 linklayer preferred  example to display details about a specific interface and its subinterfaces  running    show interface ethernet13 detail  interface ethernet13  description  rifadifa1 oper state  up down reason  na last change  23m14s ago no flaps since last clear speed  100g flow control  rx is disabled tx is not supported mtu  9232 vlan tagging  false queues  8 output queues supported 3 used since the last clear mac address  20e09c78e2e3 last stats clear never  queue parameter for ethernet13  queueid scheduling weight  traffic statistics for ethernet13  counter rx tx octets 14241 11724 unicast packets 0 0 broadcast packets 0 0 multicast packets 52 56 errored packets 0 0 fcs error packets 0 na mac pause frames 0 na oversize frames 0 na jabber frames 0 na fragment frames 0 na crc errors 0 na  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 86 spacer text configuration basics release 226 interfaces traffic rate statistics for ethernet13  units rx tx kbps rate  frame length statistics for ethernet13  frame lengthoctets rx tx 64 bytes 0 0 65127 bytes 5 8 128255 bytes 0 48 256511 bytes 47 0 5121023 bytes 0 0 10241518 bytes 0 0 1519 bytes 0 0  transceiver detail for ethernet13  status  transceiver is present and operational form factor  qsfp28 channels used  4 connector type  noseparableconnector vendor  mellanox vendor part  mcp1600c003 pmd type  100gbasecr4 cal fault condition false temperature  0 voltage  00000  transceiver channel detail for ethernet13  channel no rx power dbm tx power dbm laser bias current ma 1 4000 4000 0000 2 4000 4000 0000 3 4000 4000 0000 4 4000 4000 0000  subinterface ethernet131  oper state  up down reason  na last change  23m14s ago encapsulation  null ip mtu  9000 last stats clear never ipv4 addr  192571131 static ipv6 addr  20011925711127 static preferred ipv6 addr  fe8022e09cfffe78e2e364 linklayer preferred  arpnd summary for ethernet131  ipv4 arp entries  0 static 0 dynamic ipv6 nd entries  0 static 0 dynamic  qos policies applied to ethernet131  summary in out ipv4 dscp classifier default ipv6 dscp classifier default ipv4 dscp rewrite none ipv6 dscp rewrite none  traffic statistics for ethernet131  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 87 spacer text configuration basics release 226 interfaces statistics rx tx packets 52 8 octets 14241 828 errored packets 0 0 discarded packets 2 0 forwarded packets 0 0 forwarded octets 0 0 cpm packets 50 8 cpm octets 14033 828  example to display information about egress queues and virtual output queues voqs for a specific interface and its subinterfaces  show interface ethernet11 queuestatistics  interface ethernet11  description  none oper state  down down reason  lowerlayerdown last change  4d14h50m28s ago no flaps since last clear speed  100g flow control  rx is disabled tx is not supported loopback mode  false mtu  9232 vlan tagging  false queues  8 output queues supported 0 used since the last clear mac address  68ab09a271b0 last stats clear never  queue parameter for for ethernet11  queueid scheduling weight pir  pir kbps 0 sp  100 98994140625 1 sp  100 98994140625 2 sp  100 98994140625 3 sp  100 98994140625 4 sp  100 98994140625 5 sp  100 98994140625 6 sp  100 98994140625 7 sp  100 98994140625  queue statistics for interface ethernet11 queue 0 fc0 traffic  name fwdoctets fwdpkts dropoctets droppkts unicast egress queue 0 0 0 0 voq 1 0 0 0 0 voq 2 0 0 0 0 voq 3 0 0 0 0 voq 4 0 0 0 0 multicast egress queue 0 0 0 0  queue statistics for interface ethernet11 queue 1 fc1 traffic  name fwdoctets fwdpkts dropoctets droppkts unicast egress queue 0 0 0 0 voq 1 0 0 0 0 voq 2 0 0 0 0 voq 3 0 0 0 0 voq 4 0 0 0 0 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 88 spacer text configuration basics release 226 interfaces multicast egress queue 0 0 0 0  queue statistics for interface ethernet11 queue 2 fc2 traffic  name fwdoctets fwdpkts dropoctets droppkts unicast egress queue 0 0 0 0 voq 1 0 0 0 0 voq 2 0 0 0 0 voq 3 0 0 0 0 voq 4 0 0 0 0 multicast egress queue 0 0 0 0  queue statistics for interface ethernet11 queue 3 fc3 traffic  name fwdoctets fwdpkts dropoctets droppkts unicast egress queue 0 0 0 0 voq 1 0 0 0 0 voq 2 0 0 0 0 voq 3 0 0 0 0 voq 4 0 0 0 0 multicast egress queue 0 0 0 0  queue statistics for interface ethernet11 queue 4 fc4 traffic  name fwdoctets fwdpkts dropoctets droppkts unicast egress queue 0 0 0 0 voq 1 0 0 0 0 voq 2 0 0 0 0 voq 3 0 0 0 0 voq 4 0 0 0 0 multicast egress queue 0 0 0 0  queue statistics for interface ethernet11 queue 5 fc5 traffic  name fwdoctets fwdpkts dropoctets droppkts unicast egress queue 0 0 0 0 voq 1 0 0 0 0 voq 2 0 0 0 0 voq 3 0 0 0 0 voq 4 0 0 0 0 multicast egress queue 0 0 0 0  queue statistics for interface ethernet11 queue 6 fc6 traffic  name fwdoctets fwdpkts dropoctets droppkts unicast egress queue 0 0 0 0 voq 1 0 0 0 0 voq 2 0 0 0 0 voq 3 0 0 0 0 voq 4 0 0 0 0 multicast egress queue 0 0 0 0  queue statistics for interface ethernet11 queue 7 fc7 traffic  name fwdoctets fwdpkts dropoctets droppkts unicast egress queue 0 0 0 0 voq 1 0 0 0 0 voq 2 0 0 0 0 voq 3 0 0 0 0 voq 4 0 0 0 0 multicast egress queue 0 0 0 0  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 89 spacer text configuration basics release 226 interfaces 88 lag a link aggregation group lag based on the ieee 8021ax standard formerly 8023ad increases the bandwidth available between two network devices depending on the number of links installed a lag also provides redundancy if one or more links participating in the lag fail all physical links in a lag combine to form one logical interface packet sequencing is maintained for individual sessions the hashing algorithm deployed by sr linux is based on the type of traffic transported to ensure that all traffic in a flow remains in sequence while providing effective load sharing across the links in the lag lags can be either statically configured or formed dynamically with link aggregation control protocol lacp load sharing is executed in hardware which provides line rate forwarding for all port types a lag can consist of ports of the same speed as well as ports of mixed speed however the active links would be only those whose port speed matches the configured memberspeed parameter for the lag instance 881 minlink threshold sr linux supports configuring a minlink threshold for a lag which sets the minimum number of member links that must be active in order for the lag to be operationally up if the number of active links falls below this threshold the entire lag is brought operationally down if the minlink threshold is crossed the active member links are maintained including continuing to run lacp on links where it is configured but the lag is held out of forwarding state when the number of active links reaches or exceeds the minlink threshold the lag is brought back up operationally 882 lacp lacp defined by the ieee 8023ad standard specifies a method for two devices to establish and maintain lags when lacp is enabled sr linux can automatically associate lacpcompatible ports into a lag all nonfailing links in a lag are active and traffic is loadbalanced across the active links when lacp is enabled lacp changes are visible through traps and log messages logged against the lag 8821 lacp fallback lacp fallback allows one or more designated links of an lacp controlled lag to go into forwarding mode if lacp is not yet operational after a configured timeout period sr linux supports lacp fallback in static mode in static mode a single designated lag member goes into forwarding mode if lacp is not operational after the timeout period lacp fallback is configured by selecting the mode and fallback timeout seconds if the lag receives no pdus and the timeout period expires the configured fallback mode is enabled if any member link in the lag receives a pdu the fallback mode is immediately disabled 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 90 spacer text configuration basics release 226 interfaces 883 lag configuration to configure a lag you specify lag parameters within the context of a lag interface then associate ethernet interfaces with the lag interface the mac address of the lag should be a unique value taken from the chassis mac address pool member links in the lag can be associated statically or dynamically  static links are explicitly associated with the lag within the configuration of the lag instance  dynamic links are associated with the lag using lacp a lag instance can consist of static links only or dynamic links only if an ethernet interface is associated with a lag interface the following parameters must be the same for all associated ethernet ports  flowcontrol  portspeed  aggregateid the following example shows the configuration for a lag consisting of three member links   candidate shared default    info interface  interface ethernet11  adminstate enable ethernet  aggregateid lag1   interface ethernet12  adminstate enable ethernet  aggregateid lag1   interface ethernet13  adminstate enable ethernet  aggregateid lag1   interface lag1  subinterface 1  adminstate enable  lag  lagtype static minlinks 2   8831 configuring the minlink threshold the minlink threshold specifies the minimum number of member links that must be active in order for the lag to be operationally up if the number of active links falls below this threshold the entire lag is brought operationally down 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 91 spacer text configuration basics release 226 interfaces example the following example configures the minlink threshold for a lag to be 4 if the number of active links in the lag drops below 4 the lag is taken operationally down   candidate shared default    info interface lag1 interface lag1  lag  minlinks 4   after the lag has been taken operationally down because of crossing the minlink threshold if the number active links in the lag subsequently reaches 4 or higher the lag is brought operationally up the default for the minlink threshold is 0 disabled 8832 configuring lacp and lacp fallback when lacp is enabled sr linux can automatically associate lacpcompatible ports into a lag lacp should be configured in active mode only if lacp fallback is also configured example the following example configures lacp to run on an interface which can dynamically become a member of a lag   candidate shared default    info interface ethernet11 lag interface ethernet11  lag  lagtype lacp minlinks 1 memberspeed 100g lacpfallbackmode static lacpfallbacktimeout 4 lacp  interval fast lacpmode active    in this example the lacp interval is set to fast which causes lacp messages to be sent every second the slow option for lacp interval causes lacp messages to be sent every 30 seconds example the following example enables lacp fallback mode for a lag which allows a single designated lag member to go into forwarding mode if lacp is not operational after the timeout period   candidate shared default    info interface ethernet11 lag interface ethernet11  lag  lacpfallbackmode static lacpfallbacktimeout 60  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 92 spacer text configuration basics release 226 interfaces  the lacp fallback timeout range is 4 to 3600 seconds when the lacp interval is fast and 90 to 3600 seconds when lacp interval is slow example the following example enables lacp port priority when lacp fallback is triggered in static mode one of the memberlinks goes into a forwarding state that can be influenced using lacp port priority   candidate shared default    info interface ethernet11 ethernet interface ethernet11  ethernet  aggregateid lag1 lacpportpriority 1 portspeed 25g hwmacaddress 000102ff0001   8833 configuring forwarding viability for lag member links by default all interfaces configured in a lag are capable of forwarding traffic to the other end of the lag assuming all other lag and port attributes allow it port and lacp state you can optionally configure individual lag members to be nonviable for forwarding traffic to the other end of the lag link when a lag member is configured as nonviable for forwarding traffic the interface is not used for the transmission of traffic over the lag but is still able to process traffic it receives on the associated member link in addition layer 2 protocols such as lldp lacp and microbfd continue to be sent and processed over the nonforwardingviable lag member example the following example configures a lag member to be nonviable for forwarding traffic across a lag link the interface can still receive traffic on the lag link and participate in layer 2 functions but does not transmit packets to the other end of the lag  candidate shared default    info interface ethernet11 ethernet interface ethernet11  ethernet  aggregateid lag1 forwardingviable false   note if the forwardingviable command is explicitly configured for a lag member you must delete the forwardingviable command to remove the lag member from the lag instance 884 displaying lag interface statistics to display statistics for a lag interface use the info from state command in candidate or running mode or the info command in state mode 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 93 spacer text configuration basics release 226 interfaces example  info from state interface lag1 statistics interface lag1  statistics  inoctets 0 inunicastpackets 0 inbroadcastpackets 0 inmulticastpackets 0 inerrorpackets 0 infcserrorpackets 0 outoctets 7168 outunicastpackets 0 outbroadcastpackets 0 outmulticastpackets 56 outerrorpackets 0 lastclear 20200609t215840919z   8841 clearing lag interface statistics you can clear the statistics counters for a specified lag interface example  tools interface lag1 statistics clear interfacenamelag1 interface lag1 statistics cleared example to clear statistics for a lag interface and all member links  tools interface lag1 statistics clear includemembers interfacenamelag1 interface lag1 and all member interfaces statistics cleared 89 breakout ports 7220 ixrd3 only on 7220 ixrd3 systems the qsfp28 connector ports ports 13133 can operate in breakout mode each qsfp28 connector port operating in breakout mode can have four breakout ports configured each operating at 25g to enable breakout ports you enable breakout mode for an interface and configure breakout ports for the interface breakout ports are named using the following format ethernetslotportbreakoutport for example if interface ethernet 13 is enabled for breakout mode its breakout ports are named as follows  ethernet 131  ethernet 132 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 94 spacer text configuration basics release 226 interfaces  ethernet 133  ethernet 134 when an interface is operating in breakout mode it is considered a breakout connector and not an ethernet port some features that are configurable on an ethernet port do not apply to a breakout connector the following parameters cannot be configured on an interface operating as a breakout connector  mtu  loopbackmode  aggregateid  autonegotiate  duplexmode  flowcontrol receive  flowcontrol transmit  lacpportpriority  portspeed  standbysignaling  reloaddelay  holdtime  stormcontrol  vlantagging  subinterface  lag  qos  sflow  transceiver when the adminstate parameter for a breakout connector is set to disable it causes its breakout ports to be shut down in this case the output from the info from state command lists the operdownreason for the breakout ports as connectordown the portspeed setting is not configurable for a breakout port the speed of the breakout port is determined by the channelspeed setting for the breakout connector note the following when configuring the transceiver parameter for a breakout port  the txlaser setting affects only the individual breakout port if the installed transceiver supports perchannel disabling of the tx laser then configuring txlaser  false causes the state of the breakout port to be operdown if the installed transceiver does not support perchannel disabling of the tx laser then the state of the breakout port remains operup and info from state displays txlasertrue  if ddmevents  true is configured for any breakout port then the system generates warning logs for temperature and voltage of the overall transceiverconnector 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 95 spacer text configuration basics release 226 interfaces if ddmevents  false for any breakout port the system suppresses warning logs for inputpower outputpower and laserbiascurrent for that specific portlaser  the configured forwarderrorcorrection algorithm applies only to the individual breakout port 891 configuring breakout mode for an interface the following is an example of configuring an interface for breakoutmode and enabling breakout ports on the interface example  candidate shared default    info interface ethernet13 interface ethernet13  adminstate enable description breakout connector breakoutmode  numchannels 4 channelspeed 25g    interface ethernet131  adminstate enable description breakout port 1 subinterface 1  adminstate enable ipv4  address 19216812130      interface ethernet132  adminstate enable description breakout port 2 subinterface 1  adminstate enable ipv4  address 19216812230      interface ethernet133  adminstate enable description breakout port 3 subinterface 1  adminstate enable ipv4  address 19216812330      interface ethernet134  adminstate enable description breakout port 4 subinterface 1  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 96 spacer text configuration basics release 226 interfaces adminstate enable ipv4  address 19216812430      810 dhcp relay dhcp relay refers to the routers ability to act as an intermediary between dhcp clients requesting configuration parameters such as a network address and dhcp servers when the dhcp clients and dhcp servers are not attached to the same broadcast domain or do not share the same ipv6 link in the case of dhcpv6 sr linux supports dhcp relay for irb subinterfaces and layer 3 subinterfaces up to 8 dhcp or dhcpv6 servers are supported the dhcp relay maximum packet size including option 82 and vendorspecific options is capped at 1500 bytes to avoid fragmentation on the ethernet segment end attached to the dhcp server when dhcp relay is enabled for a subinterface and a dhcp client initiates a request for configuration parameters the router accepts the dhcp clients request and relays it to the remote dhcp server which sends back the configuration parameters the router relays the configuration parameters to the client the dhcp server network can be in the same ipvrf networkinstance of the layer 3 subinterfaces that require dhcp relay see figure 1 dhcp relay for irb and layer 3 subinterfaces or it can be in a different ipvrf networkinstance or the default network instance see figure 2 dhcp relay using different ipvrf or default networkinstance sr linux supports dhcp relay for ipv4 and ipv6 this guide refers to dhcp for ipv4 as dhcp and dhcp for ipv6 as dhcpv6 figure 1 dhcp relay for irb and layer 3 subinterfaces 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 97 spacer text configuration basics release 226 interfaces figure 2 dhcp relay using different ipvrf or default networkinstance 8101 dhcp relay for ipv4 when dhcp relay is enabled the router intercepts dhcp broadcast packets and unicasts them to a specified dhcp server for handling by default the source address for dhcp packets relayed to the server giaddr is the ip address of the ingress subinterface where the dhcp relay agent is enabled although a different giaddr can be specified if necessary sr linux supports dhcp option 82 the relay information option specified in rfc 3046 which allows the router to append information to dhcp requests relayed to the dhcp server identifying where the original dhcp request came from dhcp option 82 includes two suboptions circuitid and remoteid when configured to do so sr linux includes the following information in the circuitid and remoteid sub options of dhcp option 82  for circuitid the systemnamevrfinstancesubinterfaceidvlanid of the ingress subinterface where the relay agent is enabled that receives the dhcp discover message from the dhcp client  for remoteid the mac address of the dhcp client figure 3 dhcp message flow for ipv4 address allocation shows an example of the discovery offer request and acknowledgment dora message flow that occurs when dhcp relay assigns an address to a dhcp client 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 98 spacer text configuration basics release 226 interfaces figure 3 dhcp message flow for ipv4 address allocation the dora message flow shown in figure 3 dhcp message flow for ipv4 address allocation works as follows 1 the dhcp client sends a dhcp discover broadcast message with the following values  da  ffffffffffff broadcast  sa client mac  sip  0000  dip  255255255255  source udp port  68  destination udp port  67 the dhcp payload has the following values  broadcast flag  1 broadcast or 0 unicast  relay agent ip  0000  client mac  mac1  parameter request list option 55 which lists the required items from the dhcp server to be sent along with the ip address like subnet mask router gateway and others 2 the dhcp relay agent relays the dhcp discover message toward the dhcp server unicast if configured to do so information is added for the circuit id and remote id suboptions in dhcp option 82 the relayed packet is unicast toward the dhcp servers with the following values  sip  outgoing interface ip address by default if the sourceaddress is configured the relayed packet instead has sip  configured sourceaddress 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 99 spacer text configuration basics release 226 interfaces  udp source port  67  udp destination port  67 the dhcp payload has the following values  broadcast  1 broadcast or 0 unicast  relay agent ip giaddr  ip address of the ingress subinterface where the relay agent is enabled  client mac  mac1  relay agent information option 82 3 the dhcp server assigns an ip address to the dchp client based on information in the giaddr or in option 82 if configured to do so the dhcp server sends a dhcp offer message to the dhcp relay agent unicast the dhcp offer message includes the ip address assigned to the dhcp client based on information in the giaddr or in option 82 the dhcp offer packet is unicast with the following values  sip  dhcp ip address  dip  giaddr  udp source port  67  udp destination port  67 the dhcp payload has the following values  broadcast flag  1 broadcast or 0 unicast  your client ip  ip address assigned by dhcp server  agent ip  giaddr  client mac  mac1  dhcp identifier  dhcp server ip address  option 82 echoed back and based on dhcp server configuration  ip address lease time option 51  subnet mask option 1  router gateway option 3  others dns renewal time value rebinding time value and so on 4 the dhcp relay agent relays the dhcp offer message to the dhcp client either broadcast or unicast based on the broadcast flag sent by the client the dhcp offer message is relayed from the dhcp server toward the client with the following values  da  ffffffffffff broadcast or client macunicast  sip  subinterface ip address toward the client where dhcp relay agent is enabled  dip  255255255255 broadcast or your client ip address unicast  source udp port  67  destination udp port  68 the relay agent relays the dhcp offer toward the client without option 82 it strips off option 82 if echoed back from dhcp server the dhcp payload has the following values 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 100 spacer text configuration basics release 226 interfaces  broadcast flag  1 broadcast or 0 unicast  your client ip  ip address assigned by dhcp server  agent ip  giaddr  client mac  mac1  dhcp identifier  dhcp server ip address  option 82 echoed back and based on dhcp server configuration  ip address lease time option 51  subnet mask option 1  router gateway option 3  others dns renewal time value rebinding time value and so on 5 the dhcp client sends a dhcp request message broadcast with the following values  da  ffffffffffff broadcast  sa  client mac  sip  0000  dip  255255255255  source udp port  68  destination udp port  67 the dhcp payload has the following values  broadcast flag  1 broadcast or 0 unicast  relay agent ip  0000  client mac  mac1  dhcp server identifier  dhcp server ip address  requested ip option 50  parameter request list option 55 that lists the required items from the dhcp server to be sent along with the ip address like subnet mask router gateway and others 6 the dhcp relay agent relays the dhcp request message toward the dhcp server unicast the relayed packet is unicast toward the dhcp servers with the following values  sip  outgoing interface ip address by default if sourceaddress is configured then the relayed packet has sip  configured sourceaddress  udp source port  67  udp destination port  67 the dhcp payload has the following values  broadcast flag  1 broadcast or 0 unicast  relay agent ip  giaddr  client mac  mac1  dhcp identifier  dhcp server ip address  requested ip option 50 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 101 spacer text configuration basics release 226 interfaces  relay agent information option 82 if configured under dhcprelay  parameter request list option 55 that lists the required items from the dhcp server to be sent along with the ip address like subnet mask router gateway and others  vendor specific option if configured 7 the dhcp server sends a dhcp ack message to the dhcp relay agent unicast the dhcp ack packet is unicasted with the following values  sip  dhcp ip address  dip  giaddr  udp source port  67  udp destination port  67 the dhcp payload has the following values  broadcast flag either 1 broadcast or 0 unicast  your client ip  ip address assigned by dhcp server  agent ip  giaddr  client mac  mac1  dhcp identifier  dhcp server ip address  option 82 echoed back and based on dhcp server configuration  ip address lease time option 51  subnet mask option 1  router gateway option 3  others dns renewal time value rebinding time value and so on 8 based on the broadcast flag sent by client the dhcp offer is relayed from the dhcp servers toward the client with the following values  da  ffffffffffff broadcast or client macunicast  sip  subinterface ip address toward the client where the dhcp relay agent is enabled  dip  255255255255 broadcast or your client ip address unicast  source udp port  67  destination udp port  68 the relay agent relays the dhcp offer toward client without option 82 it strips off option 82 if echoed back from dhcp server the dhcp payload has the following values  broadcast flag can be either 1 broadcast or 0 unicast  your client ip  ip address assigned by dhcp server  agent ip  giaddr  client mac  mac1  dhcp server identifier option 54  dhcp server ip address  ip address lease time option 51 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 102 spacer text configuration basics release 226 interfaces  subnet mask option 1  router gateway option 3  others dns renewal time value rebinding time value and so on when renewing or releasing an address the dhcp client unicasts the dhcp request or release message to the dhcp server without involvement by the dhcp relay agent 81011 configuring dhcp relay for ipv4 to configure dhcp relay for a subinterface  configure the addresses of the dhcp servers  optionally configure the source address for dhcp messages sent to the servers  configure whether information is added to the suboptions for dhcp option 82 example the following example configures the dhcp relay agent on a subinterface the example configures the ip addresses of the remote dhcp servers and specifies the address to be used as the giaddr in packets sent to the servers the circuitid and remoteid options are configured which causes the dhcp relay agent to include the systemnamevrfinstancesubinterfaceidvlanid in the circuitid suboption and the dhcp client mac address in the remoteid suboption of dhcp option 82   candidate shared default    info interface ethernet12 interface ethernet12  subinterface 1  ipv4  address 114424   dhcprelay  option  circuitid remoteid  sourceaddress 1144 server  17216321 17216641 19216811    example if the dhcp server network is in a different ipvrf networkinstance from the layer 3 subinterfaces that require dhcp relay see figure 2 dhcp relay using different ipvrf or default networkinstance specify the networkinstance in the configuration for example   candidate shared default    info interface ethernet12 interface ethernet12  subinterface 1  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 103 spacer text configuration basics release 226 interfaces ipv4  address 114424   dhcprelay  networkinstance ipvrf2 option  circuitid remoteid  sourceaddress 1144 server  17216321 17216641 19216811    81012 using the giaddr as the source address for dhcp discoverrequest packets by default the sr linux uses the ip address of the outgoing interface as the source address for discover request packets sent to the dhcp server this is not the needed behavior for some configurations such as a firewall protecting the dhcp server that allows connections from a limited set of ip addresses you can use the usegiaddrassrcipaddr parameter to cause the sr linux to instead use the giaddr as the source address for discoverrequest packets sent to the dhcp server you can optionally configure the giaddr address using the giaddress parameter the configured giaddr address can be a local ip address under the interface where dhcp relay is enabled any loopback address within the same ipvrf if the dhcp server network is in this ipvrf networkinstance or a loopback address defined in a different ipvrfdefault networkinstance if the dhcp server network is in different ipvrfdefault networkinstance the following table shows the giaddr and source address combinations table 5 giaddr and source address combinations giaddress parameter usegiaddrassrcipaddr parameter giaddr in relayed packet source ip address in relayed packet not configured default false default primary ip address of interface ip address of outgoing interface configured false default configured giaddr ip address of outgoing interface configured true configured giaddr configured giaddr not configured default true primary ip address of interface primary ip address of interface because it is picked as the giaddr 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 104 spacer text configuration basics release 226 interfaces example in the following example the address specified with the giaddress parameter is used as the source address for discoverrequest packets sent to the dhcp server if the giaddress parameter is not configured then the default giaddr the primary ip address of the interface is used   candidate shared default    info interface ethernet12 interface ethernet12  subinterface 1  ipv4  address 172161124  primary  address 172162124   dhcprelay  adminstate enable giaddress 1721621 usegiaddrassrcipaddr true option  circuitid remoteid  server  1111 2222    81013 trusted and untrusted dhcp requests if the dhcp relay agent receives a dhcp request and the downstream node added option 82 information or set the giaddr to any value other than 0 the dhcp request is considered to be untrusted by default the router drops any untrusted dhcp request and discards the dhcp packets as described in rfc 3046 sr linux supports untrusted mode only the dhcp relay agent discards dhcp packets traveling from the client to server side under the following conditions  the dhcp packet includes option 82  the dhcp packet has a giaddr value that is not 0 the dhcp relay agent discards dhcp packets traveling from the server to client side under the following conditions  the circuitid or remoteid are not enabled on the relay interface but are present in the packet  the giaddr value in the dhcp packet does not match the giaddr value on the relay interface  there is no matching entry in the cache 8102 dhcp relay for ipv6 dhcp relay for ipv6 works similarly to ipv4 however in dhcpv6 the dhcp discover offer and ack messages are replaced by solicit messages sent by clients and advertise and reply messages sent by servers 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 105 spacer text configuration basics release 226 interfaces the dhcpv6 relay agent relays messages between clients and remote servers using relayforward clienttoserver and relayreply servertoclient message types dhcp option 82 is replaced in dhcpv6 by interfaceid option 18 and remote identifier option 37 appended by relay agents you can optionally configure the dhcpv6 relay agent to include the clients mac address in client link layer address option 79 this can be useful for dualstack clients where a client is using both dhcpv4 and dhcpv6 and the clients mac address is being used as an identifier for dhcpv4 figure 4 dhcpv6 message flow for ipv6 address allocation shows the dhcpv6 message flow figure 5 dhcpv6 renew message flow and figure 6 dhcpv6 release message flow show the renew and release flows figure 4 dhcpv6 message flow for ipv6 address allocation when assigning an address to a dhcp client dhcp relay for ipv6 works as follows 1 the dhcpv6 client uses its linklocal address as the source ipv6 address and ipv6 multicast address ff0212 and mac address 333300010002 as destination ipv6 addressmac address respectively for solicitrequest messages and with the following udp values  source udp port  546  destination udp port  547 2 the dhcpv6 relay agent uses a relayforw message to relay the solicit message toward the dhcpv6 server using the outbound ipv6 address of the dhcpv6 relay agent as the source ipv6 address and with the following udp values  source udp port  547  destination udp port  547 3 the dhcpv6 server replies to the relay agent an ip address to the dchp client based on information in the giaddr or in option 82 if configured to do so and with the following udp values 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 106 spacer text configuration basics release 226 interfaces  source udp port  547  destination udp port  547 4 the dhcpv6 server replies to the relay agent with destination ipv6 address equal to dhcpv6 relay fw source ipv6 address and the following udp values  source udp port  547  destination udp port  547 5 the dhcp relay agent relays the dhcp offer message to the dhcp client either broadcast or unicast based on the broadcast flag sent by the client figure 5 dhcpv6 renew message flow figure 6 dhcpv6 release message flow 81021 configuring dhcp relay for ipv6 to configure dhcp relay for a subinterface for ipv6  configure the addresses of the dhcpv6 servers  optionally configure the source ipv6 address for relayforward messages sent to the servers  optionally configure whether information is included in the interfaceid option 18 and remote identifier option 37 in relayforward messages 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 107 spacer text configuration basics release 226 interfaces  optionally configure whether the mac address of the dhcp client is included in the client linklayer address option 79 in the relayforward messages example the following example configures the dhcpv6 relay agent on a subinterface the example configures the ip addresses of the remote dhcpv6 servers and specifies the address to be used as the source ipv6 address in packets sent to the servers the interfaceid and remoteid options are configured which causes the dhcp relay agent to include the systemnamevrfinstancesubinterfaceidvlanid in interfaceid option 18 and the dhcpv6 client mac address in the remote identifier option 37 the clientlinklayeraddress option is configured which causes the dhcp relay agent to include the dhcpv6 client mac address in the client linklayer address option 79   candidate shared default    info interface ethernet12 interface ethernet12  description dut1dut41 subinterface 1  ipv6  address 2001db8101164  primary  address 2001db8202164   dhcprelay  adminstate enable sourceaddress 2001db81011 option  interfaceid remoteid clientlinklayeraddress  server  11 22     example if the dhcp server network is in a different ipvrf networkinstance from the layer 3 subinterfaces that require dhcp relay see figure 2 dhcp relay using different ipvrf or default networkinstance specify the networkinstance in the configuration for example   candidate shared default    info interface ethernet12 interface ethernet12  description dut1dut41 subinterface 1  ipv6  address 2001db8101164  primary  address 2001db8202164   dhcprelay  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 108 spacer text configuration basics release 226 interfaces networkinstance ipvrf2 adminstate enable sourceaddress 2001db81011 option  interfaceid remoteid clientlinklayeraddress  server  11 22     8103 qos for dhcp relay selfgenerated dhcpdhcpv6 packets are mapped into forwarding class 4 fc4 low drop probability level and dscp marking 34 af41 8104 dhcp relay operational down reasons the dhcp relay agent can enter an operationally down state in the following scenarios  the dhcp relay admin state is down  the subinterface under which dhcp relay is configured is operationally down  all dhcp servers configured within the network instance are unreachable  the configured giaddr for dhcp or sourceaddress for dhcpv6 does not match any of the configured ip addresses under the subinterface where dhcp relay is configured  the ip address is deleted under the subinterface 8105 displaying dhcp relay statistics to display dhcp relay statistics use the info from state command in candidate or running mode or the info command in state mode example ipv4  info from state interface ethernet116 subinterface 1 ipv4 dhcprelay statistics interface ethernet116  subinterface 1  ipv4  dhcprelay  statistics  clientpacketsreceived 2 clientpacketsrelayed 2 clientpacketsdiscarded 0 serverpacketsreceived 2 serverpacketsrelayed 2 serverpacketsdiscarded 0   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 109 spacer text configuration basics release 226 interfaces    example ipv6  info from state interface ethernet116 subinterface 1 ipv6 dhcprelay statistics interface ethernet116  subinterface 1  ipv6  dhcprelay  statistics  clientpacketsreceived 2 clientpacketsrelayed 2 clientpacketsdiscarded 0 serverpacketsreceived 2 serverpacketsrelayed 2 serverpacketsdiscarded 0      81051 clearing dhcp relay statistics you can clear the dhcp relay statistics counters for a specified subinterface example  tools interface ethernet12 subinterface 1 ipv4 dhcprelay statistics clear interfacenameethernet12subinterfaceindex1 subinterface ethernet121 statistics cleared 811 dhcp server for cases where a host requires ipam ip address management without an external dhcp server or where dhcp relay to underlay is not possible ipam information can be stored locally on the sr linux device which can assign an ip address and other dhcp options to the host using a local dhcp server sr linux supports static ip allocations on both dhcpv4 and dhcpv6 servers the sr linux dhcp server can be enabled under regular layer 3 or irb subinterfaces on layer 3 or irb subinterfaces the dhcp server can only be enabled under subinterfaces where dhcp relay is disabled when an incoming dhcp discover or solicit message is received from a host dhcp client and its mac address matches an entry in the sr linux dhcp server configuration the sr linux dhcp server starts the process of ip address assignment and sends other dhcp options if configured to do so for dhcpv4 in addition to ip address allocation the sr linux can send the following dhcp options to a host  router option 3  ipv4 address of the gateway for the dhcp client  ntpserver option 4  list of up to 4 ntp servers for the dhcp client to use  dnsserver option 6  list of up to 4 dns servers for the dhcp client to use 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 110 spacer text configuration basics release 226 interfaces  hostname option 12  the hostname for the dhcp client  domainname option 15  the domain name the client can use when resolving hostnames via dns  bootfilename option 66  url to a provisioning script for the dhcp client to use when booting  serverid  ip address the dhcp server must match within the networkinstance such as the subinterface primary address or loopback address for dhcpv6 in addition to ip address allocation the sr linux can send a list of up to 4 dns servers for the dhcp client to use option 23 notes  the sr linux dhcp server supports static ip address allocation only dynamic allocation is not supported  it is assumed there is no dhcp relay agent between the dhcp client and the sr linux dhcp server relayed frames are not supported  for ipv6 dhcp configuration uses mactoipv6 address binding the ipv6 address is assigned to the client based on the clients mac address not iaid the clients mac address is derived from the client identifier the recommended client identifier type is duid type duidllt or duidll 8111 configuring the dhcp server to configure the sr linux dhcp server you enable it on a subinterface and at the system dhcp server level configure dhcpv4 and dhcpv6 options and static ip allocations for the networkinstance where dhcp is required example the following example enables dhcpv4 and dhcpv6 servers for a subinterface   candidate shared default    info interface ethernet11 subinterface 1 interface ethernet11  subinterface 1  adminstate enable ipv4  address 192141427   dhcpserver  adminstate enable   ipv6  address 20011921414120   dhcpv6server  adminstate enable     3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 111 spacer text configuration basics release 226 interfaces example the following example configures dhcpv4 and dhcpv6 options which are supplied to dhcp clients on the default networkinstance   candidate shared default    info system dhcpserver system  dhcpserver  adminstate enable networkinstance default  dhcpv4  options  domainname lan router 19216811 dnsserver  192168153 192168154  ntpserver  192168150    dhcpv6  options  dnsserver  20011921414 20011921415       example the following example configures static ip allocation settings for an ipv4 host   candidate shared default    info detail system dhcpserver networkinstance default dhcpv4 system  dhcpserver  adminstate enable networkinstance default  dhcpv4  adminstate enable staticallocation  host 001dfee0e97c  ipaddress 1921681124 options  router 19216811 dnsserver  192168153        3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 112 spacer text configuration basics release 226 interfaces  example the following example configures static ip allocation settings for an ipv6 host   candidate shared default    info detail system dhcpserver networkinstance default dhcpv6 system  dhcpserver  adminstate enable networkinstance default  dhcpv6  adminstate enable staticallocation  host 9293473032ca  ipaddress 20011192168121126 options  dnsserver  20011921414         812 ipv6 router advertisements you can configure an ipv6 subinterface to originate router advertisement ra messages the following settings can be configured for the ra messages  current hop limit to advertise in the ra messages  ip mtu hosts can associate the ip mtu with the link on which the ra messages are received  managed configuration flag when enabled this setting indicates that hosts should use dhcpv6 to obtain ipv6 addresses  other configuration flag when enabled this setting indicates that hosts should use dhcpv6 to obtain other configuration information besides addresses  the maximum and minimum time between sending router advertisement messages to the allnodes multicast address  ipv6 prefix list hosts that support stateless address autoconfiguration slaac can use the ipv6 prefixes in the ra messages to generate ipv6 addresses  number of milliseconds advertised for the reachable time and the retransmit time in ra messages which hosts use for address resolution and the icmpv6 neighbor unreachability detection algorithm  number of seconds advertised as the router lifetime in ra messages this setting indicates amount of time the advertising router can be used as a default routergateway 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 113 spacer text configuration basics release 226 interfaces 8121 configuring ipv6 router advertisements the following example configures the sr linux to originate ra messages from an ipv6 subinterface the ra messages include an ipv6 prefix that slaacenabled clients can use to generate ipv6 addresses example   candidate shared default    info interface ethernet11 subinterface 1 ipv6 routeradvertisement interface ethernet11  subinterface 1  ipv6  routeradvertisement  routerrole  adminstate enable prefix 2001db80b64        813 ipv6 router advertisement guard ra guard ipv6 router advertisement guard ipv6 ra guard allows you to configure policies that filter out ipv6 ra messages that may be incorrectly or maliciously configured ipv6 ra messages entering a subinterface where an ipv6 ra guard policy is applied can be accepted or discarded based on match criteria specified in the policy ipv6 ra guard is supported on layer 2 and layer 3 subinterfaces which allows unwanted ra messages to be discarded as close to the network edge or server connection as possible the ipv6 ra guard feature can be configured on 7220 ixrd1 d2 and d3 systems only on irb interfaces an ipv6 ra guard policy can be applied to the layer 2 subinterface but not on the irb subinterface ingress acls are applied before ipv6 ra guard policies which may cause ra messages to be discarded before they can be evaluated by an ipv6 ra guard policy note ingress acls are applied before ipv6 ra guard policies which may cause ra messages to be discarded before they can be evaluated by an ipv6 ra guard policy the following can be used as match criteria in an ipv6 ra guard policy  advertised ipv6 prefix set  source ipv6 address list or prefix set  ra hopcount limit  router preference value  managed configuration flag mflag setting  other configuration flag oflag setting 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 114 spacer text configuration basics release 226 interfaces an ipv6 ra guard policy can have an action of accept or discard when an ipv6 ra guard policy is applied to a subinterface the default action for the subinterface is the opposite of the action specified in the policy if the policy action is accept then ipv6 ra packets that do not match the policy are discarded if the policy action is discard ipv6 ra packets that do not match the policy are accepted to configure ipv6 ra guard you specify match criteria and an action in an ipv6 ra guard policy then apply the policy to a subinterface if an ipv6 ra guard policy is not applied to a subinterface then ipv6 ra guard is disabled on that subinterface note depending on your configuration it may be more efficient to block ipv6 ra messages on a subinterface using an acl entry and action instead of configuring an ipv6 ra guard policy 8131 configuring ipv6 ra guard policies to configure an ipv6 ra guard policy you specify one or more match criteria and an action of either accept or discard example the following example configures and ipv6 ra guard policy with an advertised ipv6 prefix set and source ipv6 prefix set as match criteria and accept as the action to be considered a match all advertised prefixes in the ra message must match the ipv6 prefix set and the source address of the ra message must match the source ipv6 address prefix set   candidate shared default    info system raguardpolicy system  raguardpolicy rag1  action accept advertiseprefixset 2001db80b64 sourceprefixset 20011192168111126   example the following example configures an ipv6 ra guard policy with no match criteria and action of discard this policy blocks all ra messages on subinterfaces where it is applied   candidate shared default    info system raguardpolicy system  raguardpolicy discard all  action discard   8132 applying ipv6 ra guard policies to subinterfaces to activate ipv6 ra guard you apply an ipv6 ra guard policy to a subinterface 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 115 spacer text configuration basics release 226 interfaces example the following example applies an ipv6 ra guard policy to a subinterface this policy configured in the previous example causes all ipv6 ra messages received on the subinterface to be discarded   candidate shared default    info interface ethernet14 subinterface 2 raguard interface ethernet14  subinterface 2  raguard  policy discard all    if the subinterface has vlans configured you can specify a list of vlans to which the ipv6 ra guard policy applies if a vlan list is specified the ipv6 ra guard policy applies only to those vlans not to any others configured on the subinterface if vlan list is not specified the policy applies to all vlans on the subinterface example on a default bridged subinterface where the vlan encap singletagged vlanid any setting is configured a vlan list must be specified with the ipv6 ra guard policy for example   candidate shared default    info interface ethernet14 subinterface 2 interface ethernet14  subinterface 2  adminstate enable type bridged vlan  encap  singletagged  vlanid any     raguard  policy rag1 vlanlist 10      814 interface port speed configuration by default ports on sr linux devices operate at the speeds listed in table 6 default and supported port speeds for sr linux devices you can optionally configure ports to operate a different speed as long as that speed is supported for the port on all devices the mgmt ports operate at 1g on 7220 ixrd1 systems it is possible to configure autonegotiation for the port see configuring link autonegotiation 7220 ixrd1 only 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 116 spacer text configuration basics release 226 interfaces table 6 default and supported port speeds for sr linux devices sr linux device port range default port speed supported port speeds 7250 ixr imm ports 132 100g 40g 100g note ports 912 cannot operate at different port speeds some at 40g and others at 100g the required speed of ports 912 is based on the portspeed of the lowest numbered configured port in this block if any highernumbered port in the block is configured with a different port speed that port does not come up imm ports 3336 100g 40g 100g 400g 7220 ixrd1 ports 148 ports 4952 7220 ixrd2 ports 148 ports 4956 7220 ixrd3 ports 12 1g 10g 25g 100g 10g ethernet1334 100g ethernet1333n none 7220 ixrh2 ports 1128 7220 ixrh3 ports 12 ports 334 100g 10g 400g 10m 100m 1g 10g 1g 10g 25g note if one port in each consecutive group of 4 ports 14 58 and so on is 25g the other 3 ports must also be 25g if one port in each consecutive group of 4 ports is 1g or 10g the other 3 ports must also be 1g or 10g 40g 100g 10g 40g 100g 10g 25g 100g 10g 40g 100g 400g 8141 configuring interface port speed the following example configures the port speed for an interface example   candidate shared default    info from state interface ethernet11 interface ethernet11  ethernet  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 117 spacer text configuration basics release 226 interfaces portspeed 100g    8142 configuring link autonegotiation 7220 ixrd1 only for ports 148 on 7220 ixrd1 systems you can configure the interface to use autonegotiation for the speed duplex and flowcontrol settings table 7 port speed negotiation for rj45 ports 7220 ixr d1 systems lists how the autonegotiation setting interoperates with the portspeed configured for the interface table 7 port speed negotiation for rj45 ports 7220 ixrd1 systems auto negotiate parameter setting false false port speed parameter configured no yes true default no true default yes example port speed behavior bring up the port at the default speed of 1g bring up the port at the configured speed of 10m 100m or 1g if the other side is configured for the same speed otherwise the port state is operdown all speeds are advertised as supported and the actual speed is the highest common value between the two sides the configured port speed is the only speed advertised if the port at the other side of the link advertises this speed as well the link comes up otherwise it stays down the following example configures autonegotiation and port speed for a port on a 7220 ixrd1 system in this example a port speed is configured and the autonegotiation setting is enabled the sr linux advertises the configured port speed to the other end of the link if the other port also advertises this speed then the link is established otherwise the port state is operdown   candidate shared default    info from state interface ethernet11 interface ethernet11  ethernet  autonegotiate true portspeed 100m    3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 118 spacer text configuration basics release 226 interfaces 815 interface holdtimers you can configure holdtimers that keep an interface operationally enabled or disabled for a specified amount of time following an event that brings the interface up or shuts the interface down for example you can configure a holdtimer that keeps an interface operationally disabled for a period of time following a system reboot and you can configure a holdtimer that keeps an interface operationally enabled for a period of time after the interface goes down the main use for holdtimers is to reduce the number of link transitions and advertisewithdraw messages in networks where there are flapping optics you can configure a holdtime up timer and a holdtime down timer for an interface  holdtime up timer this timer specifies the amount of time an interface is kept operationally disabled following an event that would normally enable it such as entering the interface adminstate enable command or a system reboot the interface remains disabled from the time the event occurs until the holdtime up timer expires while the holdtime up timer is running the transceiver is enabled but the system does not consider the interface operationally up until the timer expires  holdtime down timer this timer specifies the amount of time an interface remains operationally enabled following an event that brings the interface down when triggered the holdtime down timer keeps the interface operationally enabled until the timer expires entering the interface adminstate disable command does not trigger the holdtime down timer nor does internal events such as fabric unavailability if you manually disable the interface while the holdtime down timer is running the interface is disabled immediately and the timer is aborted the holdtimers can be set to a value from 186400 seconds there is no default value if not configured no holdtime is considered when an interface changes state the holdtimers are available for ethernet interfaces only including those that are part of a lag you cannot configure a holdtimer for an interface in breakout mode the holdtimer does not affect the port led color which reflects the physical status of the port that is the port led is green when the holdtime up timer is running and solid amber when the holdtime down timer is running 8151 configuring interface hold timers to configure holdtimers for an interface you specify a time value from 186400 seconds for the holdtime up andor holdtime down timers example the following example configures a holdtime up and a holdtime down timer for an interface in this example when the interface is enabled it remains operationally disabled for 200 seconds until the holdtime up timer expires when the interface becomes disabled it remains operationally enabled for 100 seconds until the holdtime down timer expires  candidate shared default    info interface ethernet11 ethernet 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 119 spacer text configuration basics release 226 interfaces interface ethernet11  ethernet  holdtime  up 200 down 100    example when a holdtimer is in effect you can use the info from state command to display the amount of time remaining for example  running    info from state interface ethernet11 ethernet holdtime interface ethernet11  ethernet  holdtime  up 200 down 100 upexpires 85 seconds from now    in addition when the holdtime up timer is in effect the portoperdownreason for the interface is shown as interfaceholdtimeupactive 816 reloaddelay timer after the system boots the reloaddelay timer keeps an interface shut down with the laser off for a configured amount of time until connectivity with the rest of network is established when applied to an access multihomed interface typically an ethernet segment interface this delay can prevent blackholing traffic coming from the multihomed server or ce when a reloaddelay timer is configured the interface port is shut down and the laser is turned off from the time that the system determines the interface state following a reboot or reload of the xdp process until the number of seconds specified in the reloaddelay timer elapse the reloaddelay timer is only supported on ethernet interfaces that are not enabled with breakout mode for a multihomed lag interface the reloaddelay timer should be configured on all the interface members the reloaddelay timer can be from 186400 seconds there is no default value if not configured for an interface there is no reloaddelay timer only es interfaces should be configured with a nonzero reloaddelay timer singlehomed interfaces and network interfaces used to forward vxlan traffic should not have a reloaddelay timer configured the following example sets the reloaddelay timer for an interface to 20 seconds the timer starts following a system reboot or when the imm is reconnected and the system determines the interface state during the timer period the interface is deactivated and the port laser is inactive   candidate shared default    info interface ethernet11 interface ethernet11  adminstate enable ethernet  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 120 spacer text configuration basics release 226 interfaces reloaddelay 20   when the reloaddelay timer is running the portoperdownreason for the port is shown as interfacereloadtimeractive the reloaddelayexpires state indicates the amount of time remaining until the port becomes active for example  running    info from state interface ethernet11 interface ethernet11  description ethseg1 adminstate enable mtu 9232 loopbackmode false ifindex 671742 operstate down operdownreason interfacereloadtimeactive lastchange 51 seconds ago vlantagging true  ethernet  autonegotiate false lacpportpriority 32768 portspeed 100g hwmacaddress 000101ff0015 reloaddelay 20 reloaddelayexpires 18 seconds from now flowcontrol  receive false transmit false    8161 configuring the reloaddelay timer for an interface to configure the reloaddelay timer for an interface you specify a timer value from 186400 seconds the timer starts following a system reboot or when the imm is reconnected and the system determines the interface state during the timer period the interface is deactivated and the port laser is inactive you can display information about an active reloaddelay timer by entering the info from state command for the interface example the following example sets the reloaddelay timer for an interface to 20 seconds   candidate shared default    info interface ethernet11 interface ethernet11  ethernet  reloaddelay 20   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 121 spacer text configuration basics release 226 interfaces example when the reloaddelay timer is running the portoperdownreason for the port is shown as interfacereloadtimeractive the reloaddelayexpires state indicates the amount of time remaining until the port becomes active for example  running    info from state interface ethernet11 interface ethernet11  description ethseg1 adminstate enable mtu 9232 loopbackmode false ifindex 671742 operstate down operdownreason interfacereloadtimeactive lastchange 51 seconds ago vlantagging true  ethernet  autonegotiate false lacpportpriority 32768 portspeed 100g hwmacaddress 000101ff0015 reloaddelay 20 reloaddelayexpires 18 seconds from now flowcontrol  receive false transmit false    3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 122 spacer text configuration basics release 226 networkinstances 9 networkinstances on the sr linux device you can configure one or more virtual routing instances known as network instances each networkinstance has its own interfaces its own protocol instances its own route table and its own fib when a packet arrives on a subinterface associated with a networkinstance it is forwarded according to the fib of that networkinstance transit packets are normally forwarded out another subinterface of the networkinstance the sr linux supports three types of networkinstances default ipvrf and macvrf type default is the default networkinstance and only one of this type is supported type ipvrf is the regular networkinstance you can create multiple networkinstances of this type type macvrf functions as a broadcast domain and is associated with an ipvrf networkinstance via an integrated routing and bridging irb to support tunneling of layer 2 traffic across an ip network see macvrf networkinstance initially the sr linux has a default networkinstance and no ipvrf or macvrf networkinstances a management networkinstance which isolates management network traffic from other networkinstances configured on the device is created by default with the mgmt0 port automatically added to it see configuring the management networkinstance and interfaces 91 basic networkinstance configuration the following example creates networkinstance black and associates two network subinterfaces and one loopback subinterface with it the configuration administratively enables the networkinstance specifies a description and assigns it a router id the router id is optional and is used as a default router identifier for protocols running within the networkinstance the networkinstance is configured to export routes and neighbors to the linux routing table  candidate shared default    info networkinstance black networkinstance black  description sample network instance type ipvrf adminstate enable routerid 1111 interface ethernet111   interface ethernet121   interface lo01   protocols  linux  exportroutes true exportneighbors true  ipforwarding  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 123 spacer text configuration basics release 226 networkinstances receiveipv4check true   in the preceding example the receiveipv4check parameter is set to true if an ipv4 packet is received on a subinterface of this networkinstance and the ipv4 operational status of the subinterface is down then the packet is discarded when the receiveipv4check parameter is set to false ipv4 packets are received on all subinterfaces of this networkinstance that are up even if they do not have ipv4 addresses 92 path mtu discovery path mtu discovery is the technique for determining the mtu size on the network path between hosts on the sr linux path mtu discovery is enabled by default for all networkinstances and can be manually enabled or disabled per networkinstance if path mtu discovery is disabled the system drops the mtu for the session to the number of bytes specified by the minpathmtu parameter when an icmp fragmentationneeded message is received by default the minpathmtu setting is 552 bytes   candidate shared default    info networkinstance black networkinstance black  mtu  pathmtudiscovery true minpathmtu 552   93 static routes within a networkinstance you can configure static routes each static route is associated with an ipv4 prefix or an ipv6 prefix which represents the packet destinations matched by the static route each static route belongs to a specific networkinstance different networkinstances can have overlapping routes static or otherwise because each networkinstance installs its own routes into its own set of route tables and fibs each static route must be associated with a statically configured nexthop group which determines how matching packets are handled either perform a blackhole discard action or a forwarding action the next hop group can specify a list of one or more nexthops up to 128 each identified by an ipv4 or ipv6 address and a resolve flag if the resolve flag is set to false only a direct route can be used to resolve the ipv4 or ipv6 nexthop address if the resolve flag is set to true any route in the fib can be used to resolve the ipv4 or ipv6 nexthop address each static route has a specified metric and preference the metric is the igp cost to reach the destination the preference specifies the relative degree this static route is preferred compared to other static and nonstatic routes available for the same ip prefix in the same networkinstance a static route is installed in the fib for the networkinstance if the following conditions are met  the route has the lowest preference value among all routes static and nonstatic for the ip prefix  the route has the lowest metric value among all static routes for the ip prefix 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 124 spacer text configuration basics release 226 networkinstances if bgp is running in a networkinstance all static routes of that same networkinstance are automatically imported into the bgp local rib so that they can be redistributed as bgp routes subject to bgp export policies you can use bfd to monitor reachability between the router and the configured next hops for a static route making bfd sessions between the local router and the defined next hops a condition for an associated static route and next hops to be operationally active see configuring failure detection for static routes 931 configuring static routes to configure static routes you specify route prefixes to point to nexthop groups along with the metric and preference example the following example configures ipv4 and ipv6 static route prefixes to point to nexthop groups and specifies a preference and metric for each one   candidate shared default  networkinstance black   info staticroutes staticroutes  route 19216818024  adminstate enable metric 1 preference 5 nexthopgroup staticipv4grp  route 2001119216818064  adminstate enable metric 1 preference 6 nexthopgroup staticipv6grp   example the following example configures the nexthop groups for the static routes   candidate shared default  networkinstance black   info nexthopgroups nexthopgroups  group staticipv4grp  adminstate enable nexthop 1  ipaddress 17216022  nexthop 2  ipaddress 17216045 resolve true   group staticipv6grp  adminstate enable blackhole      3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 125 spacer text configuration basics release 226 networkinstances in the preceding example an ipv4 nexthop group is configured with two nexthops the resolve true setting allows any route in the fib to be used to resolve the ipv4 nexthop address provided the resolution depth is not more than 2 the ipv6 nexthop group is configured to perform a blackhole discard action for matching packets 932 configuring failure detection for static routes bfd can be used as a failure detection mechanism for monitoring the reachability of next hops for static routes when bfd is enabled for a static route it makes an active bfd session between the local router and the defined next hops required as a condition for a static route to be operationally active bfd is enabled for specific nexthop groups as a result bfd is enabled for any static route that refers to the nexthop group if multiple next hops are defined within the nexthop group a bfd session is established between the local address and each next hop in the nexthop group a static route is considered operationally up if at least one of the configured nexthop addresses can establish a bfd session if the bfd session fails the associated next hop is removed from the fib as an active next hop example the following example enables bfd for a static route nexthop   candidate shared default  networkinstance black   info nexthopgroups nexthopgroups  group staticipv4grp  adminstate enable nexthop 1  failuredetection  enablebfd  localaddress 12345      a bfd session is established between the address configured with the localaddress parameter and each nexthop address before that nexthop address is installed in the forwarding table all nexthop bfd sessions share the same timer settings which are taken from the bfd configuration for the subinterface where the address in localaddress parameter is configured see bfd 94 aggregate routes you can specify aggregate routes for a networkinstance each aggregate route is associated with an ipv4 prefix or an ipv6 prefix which represents the packet destinations matched by the aggregate route as with static routes each aggregate route belongs to a specific networkinstance though different network instances can have overlapping routes because each networkinstance installs its own routes into its own set of route tables and fibs an aggregate route can become active when it has one or more contributing routes a route contributes to an aggregate route if all of the following conditions are met 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 126 spacer text configuration basics release 226 networkinstances  the prefix length of the contributing route is greater than the prefix length of the aggregate route  the prefix bits of the contributing route match the prefix bits of the aggregate route up to the prefix length of the aggregate route  there is no other aggregate route that has a longer prefix length that meets the previous two conditions  the contributing route is actively used for forwarding and is not an aggregate route itself that is a route can only contribute to a single aggregate route and that aggregate route cannot recursively contribute to a lessspecific aggregate route aggregate routes have a fixed preference value of 130 if there is no route to the aggregate route prefix with a numerically lower preference value then the aggregate route when activated by a contributing route is installed into the fib with a blackhole nexthop it is not possible to install an aggregate route into the routetable or as a bgp route without also installing it in the fib the aggregate routes are commonly advertised by bgp or another routing protocol so that the individual contributing routes no longer need to be advertised this can speed up routing convergence and reduce rib and fib sizes throughout the network if bgp is running in a networkinstance all active aggregate routes of that networkinstance are automatically imported into the bgp local rib so they can be redistributed as bgp routes subject to bgp export policies 941 configuring aggregate routes the following example specifies an aggregate route the aggregator address setting identifies the aggregating router by default this is the configured router id of the bgp instance or 0 if bgp is not enabled example   candidate shared default  networkinstance black   info aggregateroutes aggregateroutes  route 172160024  aggregator  address 1111  summaryonly true generateicmp true   when the summaryonly parameter is set to true activation of an aggregate route automatically blocks the advertisement of all of its contributing routes by bgp the generateicmp true setting causes the router to generate icmp unreachable messages for the dropped packets 95 route preferences a route can be learned by the router from different protocols in which case the costs are not comparable when a route is learned from different protocols the preference value is used to decide which route is 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 127 spacer text configuration basics release 226 networkinstances installed in the forwarding table if several protocols calculate routes to the same destination the route with the lowest preference value is selected different protocols should not be configured with the same preference if protocols are configured with the same preference the tiebreaker is per the default preference table as defined in table 8 route preference defaults by route type if multiple routes are learned with an identical preference using the same protocol the lowest cost route is used table 8 route preference defaults by route type route type preference configurable direct attached static routes ospf internal isis level 1 internal isis level 2 internal ospf external isis level 1 external isis level 2 external bgp note 0 5 10 15 18 150 160 165 170 no yes yes1 yes yes yes yes yes yes 1 preference for ospf internal routes is configured with the preference command 96 displaying networkinstance status use the show networkinstance command to display status information about networkinstances configured on the device example to display information about all configured networkinstances including the router id description administrative and operational state  show   show networkinstance summary   name  type  admin  oper  router id  description     state  state      default  default  enable  up  5555  sample network instance   mgmt  ipvrf  enable  up   management network instance   red  ipvrf  enable  up 55555555  network instance for bgp tests   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 128 spacer text configuration basics release 226 networkinstances example to limit the display to a single networkinstance  show   show networkinstance default summary   name  type  admin  oper  router  description     state  state  id     default  default  enable  up  5555  sample network instance   example to display information about the interfaces attached to a networkinstance  show   show networkinstance default interfaces  net instance  default interface  ethernet111 oper state  up ip mtu  1500 prefix origin status  192351031 static 2001192351127 static preferred fe802015fffeff064 linklayer preferred  net instance  default interface  lo01 oper state  up prefix origin status  555532 static 20015555128 static preferred  the command displays the operational state ip mtu and assigned ipv4ipv6 prefix for each interface if the operational state for an interface is down the reason for the interface being down is shown 97 macvrf networkinstance the network instance type macvrf is associated with a networkinstance of type default or ipvrf via an integrated routing and bridging irb interface the macvrf networkinstance type functions as a broadcast domain each macvrf networkinstance builds a bridge table composed of mac addresses that can be learned via the data path on network instance interfaces or via static configuration you can configure the size of the bridge table for each mac vrf network instance as well as the aging for dynamically learned mac addresses and other parameters related to the bridge table the macvrf networkinstance type features a mac duplication mechanism that monitors mac address moves across networkinstance interfaces and across interfaces 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 129 spacer text configuration basics release 226 networkinstances 971 mac selection each macvrf networkinstance builds a bridge table to forward layer 2 frames based on a mac address lookup the sr linux selects the mac addresses to be sent for installation to the line card xdp based on the following priority 1 local application macs 2 local static macs 3 evpn static macs coming from a macip route with the static bit set 4 local duplicate macs 5 learned or evpnlearned macs 972 mac duplication detection and actions mac duplication is the mechanism used by sr linux for loop prevention mac duplication monitors mac addresses that move between subinterfaces it consists of detection actions and process restarts 9721 mac duplication detection detection of duplicate mac addresses is necessary when extending broadcast domains to multiple leaf nodes sr linux supports a mac duplication mechanism that monitors mac address moves across networkinstance interfaces a mac address is considered a duplicate when its number of detected moves is greater than a configured threshold within a configured time frame where the moves are observed upon exceeding the threshold the system holds on to the prior local destination of the mac and executes an action 9722 mac duplication actions the action taken upon detecting one or more mac addresses as duplicate on a subinterface can be configured for the macvrf network instance or for the subinterface the following are the configurable actions  operdown  when one or more duplicate mac addresses are detected on the subinterface the subinterface is brought operationally down  blackhole  upon detecting a duplicate mac on the subinterface the mac will be blackholed  stop learning  upon detecting a duplicate mac on the subinterface the mac address will not be relearned anymore on this or any subinterface this is the default action for a macvrf network instance  usenetworkinstanceaction  available for subinterfaces only use the action specified for the mac vrf network instance this is the default action for a subinterface 9723 mac duplication process restarts when at least one duplicate mac address is detected the duplicate mac addresses are visible in the state datastore and can be displayed with the info from state macduplication duplicateentries cli command 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 130 spacer text configuration basics release 226 networkinstances 9724 configurable holddowntime the info from state macduplication duplicateentries command also displays the holddowntime for each duplicate mac address when the holddowntime expires for all of the duplicate mac addresses for the subinterface the operdown or stoplearning action is cleared and the subinterface is brought operationally up or starts learning again the holddowntime is configurable from between 2 and 60 minutes you can optionally specify indefinite for the holddowntime which prevents the operdown or stoplearning action from being cleared after a duplicate mac address is detected in this case you can manually clear the operdown or stoplearning action by changing the macduplication configuration or using the tools networkinstance bridgetable macduplication command 973 bridge table configuration the bridge table its mac address limit and maximum number of entries can be configured on a per mac vrf or persubinterface basis when the size of the bridge table exceeds its maximum number of entries the mac addresses are removed in reverse order of the priority listed in mac selection you can also configure aging for dynamically learned mac addresses and other parameters related to the bridge table 9731 deleting entries from the bridge table the sr linux features commands to delete duplicate or learned mac entries from the bridge table for a macvrf or subinterface you can delete all mac entries mac entries with a blackhole destination or a specific mac entry example the following example clears mac entries in the bridge table for a macvrf network instance that have a blackhole destination  candidate shared default    tools networkinstance macvrf1 bridgetable macduplication deleteblackholemacs example the following example deletes a specified learned mac address from the bridge table for a macvrf network instance  candidate shared default    tools networkinstance macvrf1 bridgetable maclearning deletemac 000000000004 example the following example clears all duplicate mac entries in the bridge table for a subinterface  candidate shared default    tools interface ethernet111 bridgetable macduplication deleteallmacs 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 131 spacer text configuration basics release 226 networkinstances 974 macvrf network instance configuration the following example configures a macvrf network instance and settings for the bridge table the bridge table is set to a maximum of 500 entries learned mac addresses are aged out of the bridge table after 600 seconds mac duplication detection is configured so that a mac address is considered a duplicate when its number of detected moves across network instance interfaces is greater than 3 over a 5minute interval in this example the mac address is blackholed after the holddowntime of 3 minutes the mac address is flushed from the bridge table and the monitoring process for the mac address is restarted the example includes configuration for a static mac address in the bridge table the macvrf network instance is associated with a bridged interface and an irb interface  candidate shared default    info networkinstance macvrf1 networkinstance macvrf1  description sample macvrf network instance type macvrf adminstate enable interface ethernet111   interface irb11   bridgetable  maclimit  maclimit 500  maclearning  adminstate enable aging  adminstate enable agetime 600   macduplication  adminstate enable monitoringwindow 5 nummoves 3 holddowntime 3 action blackhole staticmac  address mac1      3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 132 spacer text configuration basics release 226 ospf 10 ospf open shortest path first ospf is a hierarchical link state protocol ospf is an interior gateway protocol igp used within large autonomous systems ass ospf routers exchange state cost and other relevant interface information with neighbors the information exchange enables all participating routers to establish a network topology map each router applies the dijkstra algorithm to calculate the shortest path to each destination in the network the resulting ospf forwarding table is submitted to the routing table manager to calculate the routing table when a router is started with ospf configured ospf along with the routingprotocol data structures is initialized and waits for indications from lowerlayer protocols that its interfaces are functional the hierarchical design of ospf allows a collection of networks to be grouped into a logical area an areas topology is concealed from the rest of the as which significantly reduces ospf protocol traffic with the correct network design and area route aggregation the size of the route table can be greatly reduced resulting in decreased ospf route calculation time and topological database size routers that belong to more than one area are called area border routers abrs an abr maintains a separate topological database for each area it is connected to every router that belongs to the same area has an identical topological database for that area key ospf areas are  backbone areas  the backbone distributes routing information between areas  stub areas  a designated area that does not allow external route advertisements routers in a stub area do not maintain external routes a single default route to an abr replaces all external routes  notsostubby areas nssas  nssas are similar to stub areas in that no external routes are imported into the area from other ospf areas external routes learned by ospf routers in the nssa area are advertised as type7 lsas within the nssa area and are translated by abrs into type5 external route advertisements for distribution into other areas of the ospf domain 101 ospf global configuration the minimal ospf parameters that should be configured to deploy ospf are  ospf version sr linux supports ospf version 2 and version 3 the ospf version number must be specified in the configuration if configuring ospfv3 you must also specify the address family to be used either ipv4 or ipv6  ospf instance id when configuring multiple instances an ospf instance id must be defined when configuring multiple instances or the instance being configured is not the base instance if an instance id is not configured the default instance ids are as follows  0 for ospfv2  0 for ospf v3 with address family ipv6 unicast  64 for ospf v3 with address family ipv4 unicast 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 133 spacer text configuration basics release 226 ospf  router id each router running ospf must be configured with a unique router id the router id is used by both ospf and bgp routing protocols in the routing table manager when you configure a new router id ospf is automatically disabled and reenabled to initialize the new router id  an area at least one ospf area must be created an interface must be assigned to each ospf area  interfaces an interface is the connection between a router and one of its attached networks an interface has state information associated with it which is obtained from the underlying lower level protocols and the routing protocol itself an interface to a network has associated with it a single ip address and mask unless the network is an unnumbered pointtopoint network an interface is sometimes also referred to as a link 1011 configuring basic ospf parameters to create a basic ospf configuration the minimal ospf parameters required are the following  ospf version number either v2 or v3 if configuring ospfv3 you must specify the address family either ipv4 or ipv6  a router id  one or more areas  interfaces example the following is an example of a basic ospfv2 configuration   candidate shared default  networkinstance default protocols   info ospf ospf  instance default  adminstate enable version ospfv2 routerid 1111 area 0001  interface ethernet111  interfacetype broadcast  interface ethernet121  interfacetype broadcast  interface ethernet1161  interfacetype broadcast  interface lo01  interfacetype broadcast     3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 134 spacer text configuration basics release 226 ospf example the following is an example of a basic ospfv3 configuration   candidate shared default  networkinstance default protocols   info ospf ospf  instance default  adminstate enable version ospfv3 addressfamily ipv6unicast routerid 1111 area 0001  interface ethernet111  interfacetype broadcast  interface ethernet121  interfacetype broadcast  interface ethernet1161  interfacetype broadcast  interface lo01  interfacetype broadcast     1012 configuring the router id the router id expressed like an ip address uniquely identifies the router within an as in ospf routing information is exchanged between ass groups of networks that share routing information it can be set to be the same as the loopback system interface address subscriber services also use this address as farend router identifiers when service distribution paths sdps are created the router id is used by both ospf and bgp routing protocols when you configure a new router id ospf is automatically disabled and reenabled to initialize the new router id the router id can be configured either at the networkinstance level or at the ospf protocol level if a router id is configured at the ospf protocol level ospf uses it instead of the router id configured at the networkinstance level example the following example configures a router id at the networkinstance level ospf uses this router id unless a different router id is configured at the ospf protocol level   candidate shared default    info networkinstance default networkinstance default  routerid 101010104   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 135 spacer text configuration basics release 226 ospf example the following example configures a router id for the ospf instance at the ospf protocol level   candidate shared default    info networkinstance default networkinstance default  protocols  ospf  instance default  version ospfv2 routerid 2222     1013 configuring an area an ospf area consists of routers configured with the same area id to include a router in a specific area the common area id must be assigned and an interface identified if your network consists of multiple areas you must also configure a backbone area 0000 on at least one router the backbone comprises the area border routers and other routers not included in other areas the backbone distributes routing information between areas the backbone is considered to be a participating area within the autonomous system to maintain backbone connectivity there must be at least one interface in the backbone area the minimal configuration must include an area id and an interface modifying other command parameters are optional example the following example configures an area at the ospf level   candidate shared default    info networkinstance default networkinstance default  protocols  ospf  instance default  version ospfv2 area 1111      1014 configuring a stub area you can configure stub areas to control external advertisement flooding and to minimize the size of the topological databases on an areas routers a stub area cannot also be configured as an nssa by default summary route advertisements are sent into stub areas 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 136 spacer text configuration basics release 226 ospf example the following example configures an ospf stub area   candidate shared default    info networkinstance default networkinstance default  protocols  ospf  instance default  version ospfv2 area 1111  stub       1015 configuring a notsostubby area you can explicitly configure an area to be a notsostubby area nssa nssas are similar to stub areas in that no external routes are imported into the area from other ospf areas an nssa has the capability to flood external routes it learns throughout its area and by an area border router to the entire ospf domain an area cannot be both a stub area and an nssa example the following is an ospf nssa configuration example   candidate shared default    info networkinstance default networkinstance default  protocols  ospf  instance default  version ospfv2 area 1111  nssa       1016 configuring an interface you can configure an interface to act as a connection between a router and one of its attached networks an interface includes state information that was obtained from underlying lower level protocols and from the routing protocol itself an interface to a network is associated with a single ip address and mask unless the network is an unnumbered pointtopoint network if the address is merely changed then the ospf configuration is preserved 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 137 spacer text configuration basics release 226 ospf example the following is an ospf interface configuration example   candidate shared default    info networkinstance default networkinstance default  protocols  ospf  instance default  version ospfv2 area 1111  interface ethernet12       3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 138 spacer text configuration basics release 226 bgp 11 bgp border gateway protocol bgp is an interas routing protocol an as autonomous system is a network or a group of routers logically organized and controlled by common network administration bgp enables routers to exchange network reachability information including information about other ass that traffic must traverse to reach other routers in other ass ass share routing information such as routes to each destination and information about the route or as path with other ass using bgp routing tables contain lists of known routers reachable addresses and associated path cost metrics for each router bgp uses the information and path attributes to compile a network topology to set up bgp routing participating routers must have bgp enabled and be assigned to an as and the neighbor peer relationships must be specified a router typically belongs to only one as this section describes the minimal configuration necessary to set up bgp on sr linux this includes the following  global bgp configuration including specifying the autonomous system number asn of the router as well as the router id  bgp peer group configuration which specifies settings that are applied to bgp neighbor routers in the peer group  bgp neighbor configuration which specifies the peer group to which each bgp neighbor belongs as well as settings specific to the neighbor including the as to which the router is peered for information about all other bgp settings see the sr linux online help as well as the sr linux advanced solutions guide and the sr linux data model reference 111 bgp global configuration global bgp configuration includes specifying the autonomous system number asn of the router and the router id 1111 configuring an asn an autonomous system number asn is a globally unique value that associates a router to a specific as each router participating in bgp must have an asn specified example the following example configures an asn for a router   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  autonomoussystem 65002  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 139 spacer text configuration basics release 226 bgp   1112 configuring the router id the router id expressed like an ip address uniquely identifies the router and indicates the origin of a packet for routing information exchanged between autonomous systems the router id is configured at the bgp level example the following example configures a router id   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  routerid 2222   112 configuring a bgp peer group a bgp peer group is a collection of related bgp neighbors the group name should be a descriptive name for the group all parameters configured for a peer group are inherited by each peer neighbor in the peer group but a group parameter can be overridden for specific neighbors in the configuration of that neighbor example the following example configures the administrative state and trace options for a bgp peer group these settings apply to all of the bgp neighbors that are members of this group unless specifically overridden in the neighbor configuration   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  group headquarters1  adminstate enable traceoptions  flag events   flag gracefulrestart      3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 140 spacer text configuration basics release 226 bgp 113 configuring bgp neighbors after you configure a bgp group name and assign options you can add neighbors within the same autonomous system to create internal bgp ibgp connections andor neighbors in different autonomous systems to create external bgp ebgp peers all parameters configured for the peer group to which the neighbor is assigned are applied to the neighbor but a group parameter can be overridden on a specific neighbor basis example the following example configures parameters for two bgp neighbors the peergroup parameter configures both nodes to use the settings specified for the headquarters1 group the group settings apply unless they are specifically overridden in the neighbor configuration   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  neighbor 192168111  peergroup headquarters1 description default networkinstance bgp neighbor to node a peeras 65001 localas 65002   multihop  adminstate enable maximumhops 3  failuredetection  enablebfd true fastfailover true   neighbor 192168132  peergroup headquarters1 description default networkinstance bgp neighbor to node c peeras 65003 localas 65002   failuredetection  enablebfd true fastfailover true      114 ebgp multihop external bgp ebgp multihop can be used to form adjacencies when ebgp neighbors are not directly connected to each other for example when a nonbgp router is between the ebgp neighbors bgp tcpip packets sent toward an ebgp neighbor by default have a ttl value of 1 if the bgp tcpip packets need to pass through more than one router to reach their destination the ttl decrements to 0 and the packets are dropped 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 141 spacer text configuration basics release 226 bgp to prevent this you can enable multihop for the ebgp neighbor and specify the maximum number of hops for bgp tcpip packets sent to the neighbor this allows the ebgp neighbor to be indirectly connected by up to the specified number of hops when multihop is not enabled the ip ttl for ebgp sessions is set to 1 and the ip ttl for ibgp sessions is set to 64 by enabling multihop and configuring the maximum number of hops to a neighbor it allows an ebgp session to have multiple hops and an ibgp session to have a single hop if required if multihop is enabled and the maximumhops parameter is configured for a bgp peer group the settings are applied to the members of the group if the multihop configuration for a neighbor is changed the session with the neighbor must be disconnected and reestablished for the change to take effect 1141 configuring ebgp multihop to configure ebgp multihop you enable it for the ebgp neighbor and specify a value for the maximum hops parameter additionally the nexthop to the neighbor must be configured so that the two systems can establish a bgp session example the following example enables multihop for an ebgp neighbor the maximumhops parameter is set to 2 which increases the ttl for bgp tcpip packets sent toward the ebgp neighbor allowing the neighbor to be indirectly connected by up to 2 hops   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  neighbor 192168111  multihop  adminstate enable maximumhops 2     example the following example configures a route to the nexthop toward the ebgp neighbor   candidate shared default    info networkinstance default staticroutes networkinstance default  staticroutes  route 19216811024  nexthopgroup staticipv4grp      candidate shared default    info networkinstance default nexthopgroups group staticipv4grp networkinstance default  nexthopgroups  group staticipv4grp  nexthop 1  ipaddress 1921682222  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 142 spacer text configuration basics release 226 bgp    115 as path options you can set the following options for handling the aspath in received bgp routes  allow own as  configures the router to process received routes when its own asn appears in the aspath  replace peer as  configures the router to replace the asn of the peer router in the aspath with its own asn  remove private as path numbers  configures the router to either delete private as numbers shortening the as path length or replace private as numbers with the local as number used toward the peer maintaining the as path length 1151 configuring allowownas normally when the asn of a router appears in the aspath of received routes it is considered a loop and the routes are discarded the allowownas option configures the router to process the received routes when its own asn appears in the aspath specifically it configures the maximum number of times the global asn of the router can appear in any received aspath before it is considered a loop and considered invalid default is 0 example the following example configures the router to process received routes where its own asn appears in the aspath a maximum of 1 time   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  autonomoussystem 65001 aspathoptions  allowownas 1     1152 configuring replacepeeras normally two sites having the same asn would not be able to reach each other directly because the receiving router would see its own asn in the aspath and consider it a loop to overcome this you can configure the router to replace the peer asn in the aspath with its own asn when the replacepeer as option is set to true the router replaces every occurrence of the peer as number that is present in the advertised aspath with the local asn used toward the peer 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 143 spacer text configuration basics release 226 bgp example the following example configures the router to replace the asn of the peer with its own asn   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  aspathoptions  replacepeeras true      1153 configuring removeprivateas you can configure how the router handles private as numbers either delete them shortening the as path length or replace private as numbers with the local as number used toward the peer which maintains the as path length you can configure the router to delete or replace private as numbers that appear before the first occurrence of a nonprivate asn in the sequence of most recent asns in the as path you can also configure the router to ignore private as numbers when they are the same as the peer asn example the following example configures the router to delete private as numbers 2byte and 4byte from the advertised as path toward all peers this shortens the as path   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  aspathoptions  removeprivateas  mode delete       example the following example configures the router to replace private as numbers with the local as number used toward the peer this keeps the as path the same length   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  aspathoptions  removeprivateas  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 144 spacer text configuration basics release 226 bgp mode replace      example the following example configures the router to replace only private as numbers that appear before the first occurrence of a nonprivate asn in the sequence of most recent asns in the as path   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  aspathoptions  removeprivateas  mode replace leadingonly true      example the following example configures the router to ignore private as numbers neither delete nor replace them when they are the same as the peer as number   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  aspathoptions  removeprivateas  mode replace ignorepeeras true      116 route reflection in a standard ibgp configuration all bgp speakers within an as must have full bgp mesh to ensure that all externally learned routes are redistributed through the entire as configuring route reflection provides an alternative to the full bgp mesh requirement instead of peering with all other ibgp routers in the network each ibgp router only peers with a router configured as a route reflector an as can be divided into multiple clusters with each cluster containing at least one route reflector which redistributes routes to the clients in the cluster the clients within the cluster do not need to maintain a full 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 145 spacer text configuration basics release 226 bgp peering mesh between each other they only require a peering to the route reflectors in their cluster the route reflectors must maintain a full peering mesh between all nonclients within the as 1161 configuring route reflection to configure a route reflector you assign it a cluster id and specify which neighbors are clients and which are nonclients clients receive reflected routes and nonclients are treated as a standard ibgp peer example the following example configures the router to be a route reflector for two clients srl1 and srl2 the router is assigned cluster id 0001   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  routereflector  clusterid 0001   neighbor srl1  routereflector  clusterid 0001 client true  neighbor srl2  routereflector  clusterid 0001 client true      117 graceful restart graceful restart allows a router whose control plane has temporarily stopped functioning because of a system failure or a software upgrade to return to service with minimal disruption to the network to do this the router relies on neighbor routers which have also been configured for graceful restart to maintain forwarding state while the router restarts these neighbor routers are known as helper routers the helper routers and the restarting router continue forwarding traffic using the previously learned routing information from the restarting router other routers in the network are not notified about the restarting router so network traffic is not disrupted when graceful restart is enabled on the sr linux and its neighbor the two routers exchange information about graceful restart capability including the address family identifier afi and subsequent address family identifier safi of the routes supported for graceful restart while the router restarts the helper router marks the routes from the restarting router as stale but continues to use them for traffic forwarding when the bgp session is reestablished the restarting router indicates to the helper router that it has restarted the helper router then sends the restarting router any 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 146 spacer text configuration basics release 226 bgp bgp rib updates followed by an endofrib eor marker indicating that the updates are complete the restarting router then makes its own updates and sends them to the helper router followed by an eor marker graceful restart is used in conjunction with the inservice software upgrade issu feature which can be used to upgrade 7220 ixrd2 and d3 systems while maintaining nonstop forwarding during the issu a warm reboot brings down the control and management planes while the nos reboots and graceful restart maintains the forwarding state in peers you can use a tools command to validate that the sr linux and its peers support warm reboot including graceful restart configuration see the sr linux software installation guide for more information 1171 configuring graceful restart the following example enables graceful restart for the bgp instance the sr linux operates as a helper router for neighbor routers when they are restarting assuming graceful restart is also enabled on the neighbors enabling graceful restart also indicates to the neighbors that they can serve as helper routers when the sr linux itself is restarting example when operating as a helper router the sr linux marks the routes from the restarting router as stale but continues to use them for forwarding for a period of time while the neighbor router restarts after this period expires the sr linux deletes the routes the staleroutestime parameter configures the amount of time in seconds the routes remain stale before they are deleted   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  gracefulrestart  adminstate enable staleroutestime 300     following a restart by default the system waits 600 seconds 10 minutes to receive eor markers from all helper routers for all address families that were up before the restart after this time elapses the system assumes convergence has occurred and sends its own eor markers to its peers you can configure the amount of time the system waits to receive eor markers to be from 0 to 3600 seconds for example the following configures the amount of time the system waits to receive eor markers to 270 seconds   candidate shared default    info system warmreboot system  warmreboot  bgpmaxwait 270   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 147 spacer text configuration basics release 226 bgp 118 bgp unnumbered peering in a typical largescale data center using bgp leaf and spine switches are interconnected in a clos topology and each device establishes a singlehop ebgp session with each of its physically connected peers the sessions come up as ebgp because of the asn allocation scheme it is common practice to assign a unique asn to every leaf switch tor in a cluster and a different unique asn to the set of spine switches to which those tors are connected the allocated asns are typically private asns in the range 4200000000 to 4294967294 although this is not always the case for this type of configuration bgp unnumbered peering can be a useful solution bgp unnumbered peering is the dynamic setup of one or more singlehop bgp sessions over a network segment that has no globallyunique ipv4 or ipv6 addresses each router connected to the network segment is assumed to have an ipv6enabled interface to the network and these interfaces have ipv6 linklocal addresses that are typically autogenerated by each router from the interface mac addresses how sessions are established using bgp unnumbered peering the set of bgp speakers configured for bgp unnumbered peering on a network segment discover each other by sending and receiving icmpv6 router advertisement ra messages consider an example of router a and router b which are both connected to an unnumbered interface and configured for bgp unnumbered dynamic session setup the bgp session between the two routers is established in the following sequence 1 router b sends an icmpv6 ra message on its interface b1 assuming the ra message is unsolicited the source ip address of this message is the linklocal address of interface b1 fe807efe90fffefc7ad8 and the destination ip address is the allnodes multicast address 2 asynchronously router a sends an icmpv6 ra message on its interface a1 the source ip address is the linklocal address of interface a1 fe807efe90fffefc7bd8 and the destination ip address is the allnodes multicast address 3 router a receives the ra message on interface a1 and the software process responsible for icmpv6 relays the information to bgp because in the bgp configuration a1 is a subinterface that is configured as a dynamic neighbor interface that is added to the bgp dynamicneighbors interface list 4 bgp checks if it already has a bgp session with fe807efe90fffefc7ad8   if bgp already has this session and it is up or bgp is in the process of establishing this session then the new information is a noop possibly router b started the same process moments before router a if bgp does not have a session with this linklocal address then a new tcp connection is initiated toward fe807efe90fffefc7ad8 5 when the tcp connection is established the bgp open message sent by router a encodes a local as and other capabilities that come from the configuration of the peergroup associated with interface a1 6 router a receives a bgp open message from router b and accepts that open message proceeding to move toward the bgp established state if the open message encodes an acceptable peer as number in one of the allowedpeeras ranges configured for interface a1 the address families supported by the session are based on the usual mpbgp negotiation 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 148 spacer text configuration basics release 226 bgp bgp dynamicneighbors interface list to enable dynamic peering you add subinterfaces to the bgp dynamicneighbors interface list in the sr linux configuration when a subinterface is added to the dynamicneighbors interface list  bgp automatically accepts incoming bgp connections to the ipv6 linklocal address of that subinterface subject to the configured maxsessions limit for the subinterface for the connection to be accepted the source address must be an ipv6 linklocal address that may or may not also be a defined neighbor address and the reported asn of the peer must match relevant configuration if the source address does not match a configured neighbor address the session is set up according to the peergroup associated with the subinterface not the peergroup associated with the dynamicneighbors accept matchprefix entry matching the source ipv6 linklocal address if a matching entry exists  bgp registers for ipv6 ra messages on the subinterface whenever the source of one of these ra messages matches an ipv6 linklocal address for which there is currently no established bgp session the system attempts to create a bgp session to that address as long as this does not exceed the configured maxsessions limit for the subinterface the session is set up according to the configured peergroup associated with the subinterface when a bgp session is established over a subinterface in the in the dynamicneighbors interface list  changes to the allowedpeeras ranges associated with the subinterface are a noop until the next time bgp attempts to establish the sessions  nonarrival of expected icmpv6 ra messages on the subinterface are a noop and do not trigger teardown of associated sessions  existing triggers for tearing down a session apply as normal for example holdtimer expiration bfd timeout clear bgp neighbor commands and so on  if the linklocal address of a dynamic peer is configured as a static neighbor address the dynamic session is immediately torn down and replaced by the static session when a subinterface is deleted from the dynamicneighbors interface list all dynamic sessions associated with that subinterface excluding sessions set up by static configuration of the neighbor are torn down immediately a bgp session that was previously established on an unnumbered interface and subsequently torn down can only be reestablished if the subinterface is configured in the dynamicneighbors interface list and a recent icmpv6 ra message is received configuration overrides for dynamic peers on unnumbered interfaces when a dynamic bgp session is initiated or accepted on an interface that is tied to a peergroup most of the parameters relevant to that session come from the configuration of that peergroup with the following exceptions  multihop maximumhops is always 1 for both ebgp and ibgp peers  transport localaddress is always the linklocal address of the specified interface  nexthopself is always true the neighbor is not presumed to have reachability to offlink destinations  transport passivemode is always false bgp always initiates a connection when informed by icmpv6 unless it already has a connection  ipv4unicast receiveipv6nexthops is always enabled 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 149 spacer text configuration basics release 226 bgp  ipv4unicast advertiseipv6nexthops and evpn advertiseipv6nexthops are always enabled  gracefulrestart adminstate is always disabled meaning dynamicpeers do not help during a warm reboot and there is no helper support for dynamic peers that restart peer as validation for dynamic peers on unnumbered interfaces when a bgp open message is received from an unnumbered dynamic neighbor the reported as number of the peer is checked to determine if it is acceptable to allow the peering to proceed for a dynamic session associated with a subinterface the peer as is acceptable only if it matches one of the allowedpeeras elements of the dynamicneighbors interface list entry for the subinterface and if the peer as is not equal to the local as implying an ibgp session in the current release ibgp is not supported for bgp unnumbered peering 1181 configuring bgp unnumbered peering to configure bgp unnumbered peering you add subinterfaces to the bgp dynamicneighbors interface list and specify the peer autonomous system numbers from which incoming tcp connections to the bgp wellknown port are accepted example the following example adds a subinterface to the bgp dynamicneighbors interface list  candidate shared default    info networkinstance default protocols bgp dynamicneighbors interface ethernet111 networkinstance default  protocols  bgp  dynamicneighbors  interface ethernet111  peergroup bgppeergroup0 allowedpeeras  4294967200       in this example subinterface ethernet111 is added to the bgp dynamicneighbors interface list this subinterface must be enabled for ipv6 and configured to accept and send ipv6 ra messages it does not require any ipv4 addresses or globalunicast ipv6 addresses incoming tcp connections to port 179 received on this subinterface that are sourced from an ipv6 link local address and destined for the ipv6 link local address of this subinterface are automatically accepted ipv6 ra messages received on this subinterface automatically trigger bgp session setup toward the sender of these messages if there is not already an established bgp session peer group bgppeergroup0 is associated with dynamic bgp neighbors on this subinterface parameters configured for this peergroup are used for establishing the dynamic bgp session with the exceptions described in configuration overrides for dynamic peers on unnumbered interfaces 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 150 spacer text configuration basics release 226 bgp asn 4294967200 is configured as an allowed peer as for dynamic bgp neighbors on this subinterface if the bgp open message from a peer on this subinterface contains a myas number that is not an allowed peer as then a notification is sent to the peer with the indication bad peer as 119 bgp configuration management managing the bgp configuration on sr linux can include the following tasks  modifying an as number  deleting a bgp neighbor from the configuration  deleting a bgp group  resetting bgp peer connections 1191 modifying an asn you can modify the asn on the router but the new asn does not take effect until the bgp instance is restarted either by administratively disablingenabling the bgp instance or by rebooting the system with the new configuration example   candidate shared default  networkinstance default   protocols bgp autonomoussystem 95002  protocols bgp adminstate disable  protocols bgp adminstate enable all established bgp sessions are taken down when the bgp instance is disabled 1192 deleting a neighbor use the delete command to delete a bgp neighbor from the configuration example   candidate shared default  networkinstance default   delete protocols bgp neighbor 192168111 1193 deleting a group use the delete command to delete the settings for a bgp peer group from the configuration example   candidate shared default  networkinstance default   delete protocols bgp group headquarters1 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 151 spacer text configuration basics release 226 bgp 1194 resetting bgp peer connections to refresh the connections between bgp neighbors you can issue a hard or soft reset a hardreset tears down the tcp connections and returns to idle state a softreset sends routerefresh messages to each peer the hard or soft reset can be issued to a specific peer to peers in a specific peergroup or to peers with a specific asn example the following command hardresets the connections to the bgp neighbors in a peer group that have a specified asn the hardreset applies both to configured peers and dynamic peers  tools networkinstance default protocols bgp group headquarters1 resetpeer peeras 95002 networkinstancenamedefaultprotocolsbgpgroupgroupnameheadquarters1 successfully executed the tools clear command example the following command softresets the connection to bgp neighbors that have a specified asn the soft reset applies both to configured peers and dynamic peers  tools networkinstance default protocols bgp softclear peeras 95002 networkinstancenamedefaultprotocolsbgp successfully executed the tools clear command 1110 protocol authentication on the sr linux authentication of routing control messages for bgp as well as other protocols such as ldp and isis is done using shared keys message authentication between two routers involves sharing knowledge of a secret key and a cryptographic algorithm such as md5 this secret key together with the message data are used to generate a message digest the message digest is added to each message transmitted by the sender and validated by the receiver with the expectation that only a sender in possession of the secret key and algorithm details could generate the same message digest computed by the receiver of the message to limit exposure in the event a key is compromised the secret key is changed at regular intervals using keys configured in a keychain a keychain defines a list of one or more keys each key is associated with a secret string an algorithm identifier and a start time when a protocol references a keychain for securing its messages with a set of peers it uses the active key in the keychain with the most recent start time to generate the message digest in its sent messages and it drops every received message that does not have an acceptable message digest 11101 configuring protocol authentication to configure protocol authentication you configure an authentication keychain at the system level and configure a protocol to use the keychain all protocol authentication is done using keychains if a protocol requires authentication with a single neighbor using a single key the key is configured within a keychain and the protocol references the keychain 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 152 spacer text configuration basics release 226 bgp example the following example configures a keychain consisting of two keys  candidate shared default    info system authentication system  authentication  keychain k1  tolerance 10  key 1  adminstate enable algorithm md5 authenticationkey zcvseljzjxwbz9bict starttime 20200526t102101z  key 2  adminstate enable algorithm md5 authenticationkey e7xdklyo2dom7v3ijv starttime 20200510t102101z    example the following example configures bgp to use the keys in the keychain above for protocol authentication  candidate shared default    info networkinstance default protocols bgp authentication networkinstance default  protocols  bgp  authentication  keychain k1      1111 bgp shortcuts with bgp shortcuts sr linux can include ldp lsps or segment routing srisis tunnels in the bgp algorithm calculations in this case tunnels operate as logical interfaces directly connected to remote nodes in the network because the bgp algorithm treats the tunnels in the same way as a physical interface being a potential output interface the algorithm can select a destination node together with an output tunnel to resolve the nexthop using the tunnel as a shortcut through the network to the destination note bgp shortcuts can only be used for nexthop resolution of ipv4unicast ribins with an ipv4 nexthop address bgp nexthop resolution describes the procedures that bgp uses to resolve the nexthop address of each bgp ribin that forms part of a bgp route the following table defines bgp ribin and bgp route in the context of bgp nexthop resolution 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 153 spacer text configuration basics release 226 bgp table 9 bgp ribin and bgp route bgp term definition bgp ribin one of the following  a received ipv4unicast bgp route with an ipv4 nexthop address  a received ipv4unicast bgp route with an ipv6 nexthop address allowed as a result of sending an extendednhencoding capability to the peer  a received ipv6unicast bgp route with an ipv6 nexthop address bgp route a route submitted by bgp to the fibmgr that resulted from the grouping of one or more bgp ribins multiple bgp ribins per route describes a multipath scenario with bgp shortcuts enabled nexthop resolution determines whether to use a local interface or a tunnel to resolve the bgp nexthop tunnel resolution mode as part of the configuration for bgp shortcuts you must define the tunnelresolution mode preferrequired disabled this mode determines the order of preference and fallback of using tunnels in the tunnel table to resolve the nexthop instead of using routes in the fib as described in the following sections nexthop resolution of ipv4unicast ribins with ipv4 nexthop the following table describes the nexthop resolution steps for ipv4unicast ribins with ipv4 nexthops depending on the specified tunnel resolution mode table 10 nexthop resolution for ipv4 unicast ribins with ipv4 nexthop address tunnel resolution mode nexthop resolution steps in bgp prefer 1 start with ttm lookup a find all the tunnels in ttm with an endpoint that matches the bgp nexthop address and that have one of the types listed in the allow list b if there is a single tunnel select that tunnel the ribin is resolved exit c if there are multiple tunnels select the tunnel with the numerically lowest ttm preference and if a further tiebreak is needed select the tunnel with the lowest ttm metric the ribin is resolved exit 2 if there are no tunnels fallback to fib lookup a find the longest match active route in the fib that matches the bgp nexthop address there are presently no restrictions on this route it can be an igp route a static blackhole route a default route or another bgp route b if there is a longest match route and it eventually resolves to a blackhole next hop interface or tunnel then the ribin is resolved exit c if there is no matching route the ribin is unresolved require perform ttm lookup only as described in 1 above 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 154 spacer text configuration basics release 226 bgp tunnel resolution mode nexthop resolution steps in bgp if there is no matching tunnel the ribin is unresolved disabled perform fib lookup only as described in 2 above nexthop resolution of ipv4unicast and ipv6unicast ribins with ipv6 nexthop if the nexthop address for the ipv4unicast ribin is an ipv6 address the nexthop is resolved by the longest prefix match ipv6 route in the fib this is the only option because there are no ipv6 tunnels in the ttm the same logic applies to bgp ribins with ipv6unicast nlri address family as they can only have an ipv6 nexthop address the nexthop resolution logic is the same as the fib lookup described in the preceding table 11111 configuring bgp shortcuts over segment routing about this task to configure bgp shortcuts procedure step 1 in the default networkinstance define the tunnelresolution mode for the bgp protocol this setting determines the order of preference and the fallback when using tunnels in the tunnel table instead of routes in the fib available options are as follows  require requires tunnel table lookup instead of fib lookup  prefer prefers tunnel table lookup over fib lookup  disabled default performs fib lookup only step 2 set the allowed tunnel types for nexthop resolution example configure ipv4 bgp shortcuts the following example shows the bgp nexthop resolution configuration to allow ipv4 srisis tunnels with the tunnel mode set to prefer   candidate shared default    info networkinstance default protocols bgp ipv4unicast nexthopresolution ipv4nexthops tunnelresolution networkinstance default  protocols  bgp  ipv4unicast  nexthopresolution  ipv4nexthops  tunnelresolution  mode prefer allowedtunneltypes  srisis   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 155 spacer text configuration basics release 226 bgp       example configure ipv6 bgp shortcuts the following example shows the bgp nexthop resolution configuration to allow ipv6 srisis tunnels with the tunnel mode set to prefer   candidate shared default    info networkinstance default protocols bgp ipv4unicast nexthopresolution ipv4nexthops tunnelresolution networkinstance default  protocols  bgp  ipv6unicast  nexthopresolution  ipv6nexthops  tunnelresolution  mode prefer allowedtunneltypes  srisis         3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 156 spacer text configuration basics release 226 isis 12 isis intermediate system to intermediate system isis is a linkstate igp that uses the shortest path first spf algorithm to determine routes routing decisions are made using the linkstate information isis evaluates topology changes and if necessary performs spf recalculations entities within isis include networks intermediate systems and end systems in isis a network is an autonomous system as or routing domain with end systems and intermediate systems a router is an intermediate system that sends receives and forwards protocol data units pdus end systems are network devices that send and receive pdus end system and intermediate system protocols allow routers and nodes to identify each other isis sends out linkstate updates periodically throughout the network so each router can maintain current network topology information isis supports large ass by using a twolevel hierarchy a large as can be administratively divided into smaller more manageable areas a system logically belongs to one area level 1 routing is performed within an area level 2 routing is performed between areas you can configure routers as level 1 level 2 or both level 1 and 2 on sr linux you can configure a single named isis instance per network instance the following summarizes sr linux support for isis  level 1 level 2 and level 12 is types  configurable network entity title net per isis instance  support for ipv4v6 routing  ecmp with up to 64 next hops per destination  isis export policies redistribution of other types of routes into isis  authentication of lsp csnp psnp and hello pdus using an authentication key or keychain specified as follows  per instance or per level for all pdu types  per interface or per interface and level for hello pdus  authentication keychains with a single key per named keychain  purge originator id tlv rfc 6232  options to ignore and suppress the attached bit  ability to set the overload bit immediately or after each subsequent restart of the isis manager application and leave it on for a configurable duration each time   control over the linkstate pdu lsp mtu size with range from 490 bytes to 9490 bytes configuration control over timers for lsp lifetime lsp refresh interval spf calculation triggers and lsp generation  hello padding strict loose and adaptive modes  graceful restart only acting as a helper of the restarting router  level 1 to level 2 route summary 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 157 spacer text configuration basics release 226 isis  bfd for fast failure detection  configurable hello timer with multiple per interface and level  wide metrics configurable per level  configurable route preference for each route type level 1internal level 1external level 2internal and level 2external  detailed statistics for interfaces adjacencies and levels the info detail command displays default values for an isis instance on sr linux as shown in the following example   candidate shared default  networkinstance default protocols isis   info detail instance i1  adminstate disable levelcapability l2 maxecmppaths 1 poitlv false attachedbit  ignore false suppress false  overload  advertiseinterlevel false advertiseexternal false immediate  setbit false maxmetric false  onboot  setbit false maxmetric false   timers  lsplifetime 1200 lsprefresh  interval 600 halflifetime true  spf  initialwait 1000 secondwait 1000 maxwait 10000  lspgeneration  initialwait 1000 secondwait 1000 maxwait 5000   transport  lspmtusize 1492  ipv4unicast  adminstate enable  ipv6unicast  adminstate enable multitopology false  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 158 spacer text configuration basics release 226 isis gracefulrestart  helpermode false  autocost   authentication  csnpauthentication false psnpauthentication false helloauthentication false  interlevelpropagationpolicies  level1tolevel2     121 basic isis configuration to configure isis perform the following tasks  enable an isis instance  if necessary modify the level capability on the global isis instance level  define area addresses  configure isis interfaces 1211 enabling an isis instance sr linux supports a single isis instance within a network instance the following example enables an is is instance within the default network instance example   candidate shared default  networkinstance default protocols   info isis isis  instance i1    1212 configuring the router level when isis is enabled the default levelcapability value is level 12 this means that the router operates with both level 1 and level 2 routing capabilities to change the default value in order for the router to operate as a level 1 router or a level 2 router you must explicitly modify the level value the levelcapability value can be configured on the global isis instance level and also on the interface level the levelcapability value determines which level values can be assigned on the router level or on an interfacebasis in order for the router to operate as a level 1 only router or as a level 2 only router you must explicitly specify the levelnumber value 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 159 spacer text configuration basics release 226 isis  specify level 1 to route only within an area  specify level 2 to route to destinations outside an area toward other eligible level 2 routers example the following example configures the level capability for an isis instance to level 2   candidate shared default  networkinstance default protocols   info isis isis  instance i1  levelcapability l2   1213 configuring the network entity title sr linux supports a configurable network entity title net per isis instance the net is 820 octets long and consists of 3 parts the area address 113 octets the system id 6 octets and the nselector 1 octet must be 00 the area address portion of the net defines the isis area to which the router belongs at least one area address should be configured on each router participating in isis the area address portion of the net identifies a point of connection to the network such as a router interface the routers in an area manage routing tables about destinations within the area the net value is used to identify the isis area to which the router belongs the net value is divided into three parts only the area id portion is configurable 1 area id  a variable length field between 1 and 13 bytes this includes the authority and format identifier afi as the most significant byte and the area id 2 system id  a 6byte system identifier this value is not configurable the system id is derived from the system or router id 3 selector id  a 1byte selector identifier that must contain zeros when configuring a net this value is not configurable the selector id is always 00 example the following example configures a net for an isis instance   candidate shared default  networkinstance default protocols   info isis isis  instance i1  net 49000119216800100200    3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 160 spacer text configuration basics release 226 isis 1214 configuring global parameters commands and parameters configured on the global isis instance level are inherited by the interface levels parameters specified in the interface and interfacelevel configurations take precedence over global configurations example the following example shows the command usage to configure globallevel isis the lsp pdu authentication setting references a keychain defined at the system level see protocol authentication   candidate shared default  networkinstance default protocols   info isis isis  instance i1  levelcapability l2 overload  onboot  timeout 90   authentication  lspauthentication  generate true checkreceived strict keychain isisglobal     1215 configuring interface parameters there are no interfaces associated with isis by default an interface belongs to all areas configured on a router interfaces cannot belong to separate areas there are no default interfaces applied to the router is is instance you must configure at least one isis interface in order for isis to work you can configure both the level 1 parameters and the level 2 parameters on an interface the level capability value determines which level values are used example the following example configures interface parameters for an isis instance   candidate shared default  networkinstance default protocols isis   info instance i1 instance i1  interface ethernet121  circuittype pointtopoint ipv4unicast  adminstate enable  level 1  authentication  helloauthentication  generate true checkreceived strict keychain hello  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 161 spacer text configuration basics release 226 isis    level 1    122 displaying isis information use the commands shown in this section to display the following information for an isis instance running in a specified network instance  interface information  adjacency information  isis link state database information example isis summary information to display summary information for an isis instance  show networkinstance greendefault protocols isis summary  network instance greendefault isis instance default is enable and up level capability  l1l2 export policy  none  systemid  005005005005 net   49000100500500500500  areaid   490001   ipv4 routing is enable ipv6 routing is enable using none max ecmp path  1  ldp synchronization is disabled  overload current status  not in overload  metric reference bandwidth na l1 metric style wide l2 metric style wide  graceful restart helper mode  disabled current status  not helping any neighbors  timers lsp lifetime  1200 lsp refresh  600 spf initial wait  1000 spf second wait  1000 spf max wait  10000 lsp generation initial wait  10 lsp generation second wait  1000 lsp generation max wait  5000  route preference 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 162 spacer text configuration basics release 226 isis l1 internal  15 l1 external  160 l2 internal  18 l2 external  165  l1l2 summary addresses not configured  instance statistics spf run  29 last spf  20220323t161616200z partial spf run  16 last partial spf  20220323t161617200z  pdu statistics   pduname  received  processed  dropped  sent    lsp  460  457  3  528   iih  308  281  27  497   csnp  52  51  1  116   psnp  30  30  0  3   example isis interface information to display interface information for an isis instance  show networkinstance greendefault protocols isis interface  network instance  greendefault instance  default   interface name  oper state  level  circuit id  circuit type  ipv4 metric l1l2  ipv6 metric l1l2   ethernet111  up  l1l2  2  pointtopoint  1010  1010  ethernet121  up  l1l2  2  broadcast  1010  1010  ethernet131  up  l1l2  3  broadcast  1010  1010  ethernet116  up  l1l2  4  broadcast  1010  1010  1        lo01  up  l1l2  5  broadcast  00  00  example isis interface detail information to display detail information for a specific isis interface  show networkinstance greendefault protocols isis interface ethernet111 detail  network instance  greendefault instance  default  interfacename  ethernet111 status  isis is admin enabled oper up circuit  id 1 is broadcast and not passive hello authentication generate  true hello authentication check received  strict hello padding  disable csnp interval  10 lsp pacing  100 ldp sync state  disabled ldp sync duration  3274  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 163 spacer text configuration basics release 226 isis level  1 status  enabled adjacencies  1 hello authentication generate  true hello authentication check received  strict priority  64 hello interval  9 hello multiplier  3 ipv4 metric  10 ipv6 metric  10  level  2 status  enabled adjacencies  1 hello authentication generate  true hello authentication check received  strict priority  64 hello interval  9 hello multiplier  3 ipv4 metric  10 ipv6 metric  10  example isis adjacency information to display isis adjacency information  show networkinstance default protocols isis adjacency  networkinstance  default isis instance  global  systemid adjlevel interface ipv4address state uptime remhold hostname1 l1 ethernet110 10001 up 0d 004643 19s hostname1 l2 ethernet110 10001 up 0d 004643 19s  adjacencies 2  example isis link state database information to display information for the isis link state database  show networkinstance greendefault protocols isis database  networkinstance  greendefault isis instance  default   level number  lsp id  sequence  checksum  lifetime  attributes    1  0010010010010000  0x33  0x1672  1167  l1 l2   1  0020020020020000  0x35  0xd562  1014  l1 l2   1  0030030030030000  0x38  0xf447  640  l1 l2   1  0030030030030100  0x2f  0x4db6  1005  l1 l2   1  0030030030030200  0x2e  0xd355  709  l1 l2   1  0040040040040000  0x39  0x6f2a  638  l1 l2   1  0040040040040100  0x2f  0xf0ef  822  l1 l2   1  0040040040040200  0x2f  0xa5f8  999  l1 l2   1  0050050050050000  0x38  0xfbbb  905  l1 l2   1  0050050050050100  0x31  0x3937  745  l1 l2   1  0050050050050200  0x2f  0xd19  657  l1 l2   1  0060060060060000  0x37  0xf287  967  l1 l2   1  0060060060060100  0x2f  0xadfb  753  l1 l2  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 164 spacer text configuration basics release 226 isis  1  0060060060060200  0x2f  0x5f95  819  l1 l2   1  0070070070070000  0x33  0x48dd  1058  l1 l2   1  0070070070070100  0x2f  0xadb2  1164  l1 l2   1  0070070070070200  0x2e  0xdf8e  852  l1 l2   2  0010010010010000  0x3e  0xb92f  1150  l1 l2   2  0010010010010001  0x3c  0x1875  818  l1 l2   2  0020020020020000  0x41  0x540f  1177  l1 l2   2  0020020020020001  0x3f  0x2db9  699  l1 l2   2  0030030030030000  0x3c  0x302f  1058  l1 l2   2  0030030030030001  0x3f  0x5150  668  l1 l2   2  0030030030030100  0x30  0xb518  915  l1 l2   2  0030030030030200  0x2f  0xe113  1035  l1 l2   2  0040040040040000  0x3e  0xa17b  657  l1 l2   2  0040040040040001  0x3e  0x260b  1018  l1 l2   2  0040040040040100  0x30  0x1511  1066  l1 l2   2  0040040040040200  0x2f  0x27a7  1035  l1 l2   2  0050050050050000  0x41  0x59d6  608  l1 l2   2  0050050050050001  0x44  0xf165  1110  l1 l2   2  0050050050050100  0x33  0x7709  584  l1 l2   2  0050050050050200  0x31  0xa74  657  l1 l2   2  0060060060060000  0x3d  0xd5ed  903  l1 l2   2  0060060060060001  0x44  0xdc97  666  l1 l2   2  0060060060060100  0x30  0x9024  1145  l1 l2   2  0060060060060200  0x30  0xbc66  1020  l1 l2   2  0070070070070000  0x3a  0x81fd  862  l1 l2   2  0070070070070001  0x3e  0xf82a  765  l1 l2   2  0070070070070100  0x30  0xbad5  658  l1 l2   2  0070070070070200  0x2f  0x1ecb  675  l1 l2   lsp count 41  to display information for a specific isis link state database  show networkinstance greendefault protocols isis database 1  networkinstance  greendefault isis instance  default   level number  lsp id  sequence  checksum  lifetime  attributes    1  0010010010010000  0x33  0x1672  1048  l1 l2   1  0020020020020000  0x35  0xd562  894  l1 l2   1  0030030030030000  0x39  0x7762  1179  l1 l2   1  0030030030030100  0x2f  0x4db6  886  l1 l2   1  0030030030030200  0x2f  0x4ace  1188  l1 l2   1  0040040040040000  0x3a  0xcd9f  1135  l1 l2   1  0040040040040100  0x2f  0xf0ef  703  l1 l2   1  0040040040040200  0x2f  0xa5f8  879  l1 l2   1  0050050050050000  0x38  0xfbbb  785  l1 l2   1  0050050050050100  0x31  0x3937  625  l1 l2   1  0050050050050200  0x30  0xb86e  1148  l1 l2   1  0060060060060000  0x37  0xf287  847  l1 l2   1  0060060060060100  0x2f  0xadfb  633  l1 l2   1  0060060060060200  0x2f  0x5f95  700  l1 l2   1  0070070070070000  0x33  0x48dd  938  l1 l2   1  0070070070070100  0x2f  0xadb2  1044  l1 l2   1  0070070070070200  0x2e  0xdf8e  733  l1 l2   lsp count 17  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 165 spacer text configuration basics release 226 isis 123 clearing isis information to clear information for an isis instance use the tools commands below example to clear statistics for an isis instance running in a specified network instance  tools networkinstance default protocols isis instance i1 statistics clear example to clear link state database information for a level  tools networkinstance default protocols isis instance i1 linkstatedatabase clear example to clear isis adjacency information for an interface  tools networkinstance default protocols isis instance i1 interface ethernet111 adjacencies clear 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 166 spacer text configuration basics release 226 bfd 13 bfd bidirectional forwarding detection bfd is a lightweight mechanism used to monitor the liveliness of a remote neighbor it is meant to be lightweight enough so that the ongoing sending and receiving mechanism can be implemented in the forwarding hardware because of this lightweight nature bfd can send and receive messages at a much higher rate than other control plane hello mechanisms this attribute allows connection failures to be detected faster than other hello mechanisms sr linux supports bfd asynchronous mode where bfd control packets are sent between two systems to activate and maintain bfd neighbor sessions between them bfd can be configured to monitor connectivity for the following  bgp peers see configuring bfd under the bgp protocol  nexthops for static routes see configuring failure detection for static routes  ospf adjacencies see configuring bfd under ospf  isis adjacencies see configuring bfd under isis sr linux supports one bfd session per portconnector or up to 1152 sessions for an 8slot chassis depending on the hardware configuration on sr linux systems that support link aggregation groups lags sr linux supports microbfd where bfd sessions are established for individual members of a lag if the bfd session for one of the links indicates a connection failure the link is taken out of service from the perspective of the lag see micro bfd this section describes the minimal configuration necessary to set up bfd on sr linux to create a bfd session you configure bfd on both systems or bfd peers when bfd has been enabled on the interfaces and at the global level for the appropriate routing protocols a bfd session is created bfd timers are negotiated and the bfd peers begin to send bfd control packets to each other at the negotiated interval 131 configuring bfd for a subinterface you can enable bfd with an associated subinterface and set values for intervals and criteria for declaring a session down timer values are in microseconds the detection interval for the bfd session is calculated by multiplying the value of the negotiated transmission interval by the value specified in this field example the following example configures bfd for a subinterface  candidate shared default    info bfd bfd  subinterface ethernet121  adminstate enable desiredminimumtransmitinterval 250000 requiredminimumreceive 250000 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 167 spacer text configuration basics release 226 bfd detectionmultiplier 3   132 configuring bfd under the bgp protocol bfd can be configured under the bgp protocol at the global group or neighbor level before it is enabled bfd must first be configured for a subinterface and timer values must be set see configuring bfd for a subinterface example the following example configures bfd under the bgp protocol at the global level  candidate shared default    info networkinstance default networkinstance default  protocols  bgp  failuredetection  enablebfd true      example the following example configures bfd for the links between peers within an associated bgp peer group  candidate shared default    info networkinstance default protocols bgp networkinstance default  protocols  bgp  group test  failuredetection  enablebfd true      example the following example configures bfd for the link between bgp neighbors  candidate shared default    info networkinstance default protocols bgp networkinstance default  protocols  bgp  neighbor 1923513  failuredetection  enablebfd true fastfailover true 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 168 spacer text configuration basics release 226 bfd      133 configuring bfd under ospf for ospf and ospfv2 bfd can be enabled at the interface level to monitor the connectivity between the router and its attached network example  candidate shared default    info networkinstance default protocols ospf networkinstance default  protocols  ospf  instance o1  area 1111  interface ethernet111  failuredetection  enablebfd true        134 configuring bfd under isis bfd can be configured at the interface level for isis you can optionally configure a bfdenabled tlv to be included for ipv4 or ipv6 on the isis interface example  candidate shared default    info networkinstance default protocols isis networkinstance default  protocols  isis  instance i1  ipv4unicast  adminstate enable  interface ethernet111  ipv4unicast  enablebfd true includebfdtlv true     3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 169 spacer text configuration basics release 226 bfd   135 viewing the bfd state use the info from state command to verify the bfd state for a networkinstance example  info from state bfd networkinstance default peer 30 bfd  networkinstance default  peer 30  operstate up localaddress 1923515 remoteaddress 1923513 remotediscriminator 25 subscribedprotocols bgpmgr sessionstate up remotesessionstate up laststatetransition 20200124t162255224z failuretransitions 0 localdiagnosticcode nodiagnostic remotediagnosticcode nodiagnostic remoteminimumreceiveinterval 1000000 remotecontrolplaneindependent false activetransmitinterval 250000 activereceiveinterval 250000 remotemultiplier 3 async  lastpackettransmitted 20200124t162319385z lastpacketreceived 20200124t162318906z transmittedpackets 32 receivedpackets 32 uptransitions 1     136 microbfd microbfd refers to running bfd over the individual links in a link aggregation group lag to monitor the bidirectional liveliness of the ethernet links that make up the lag a lag member cannot be made operational within the lag until the microbfd session is fully established if a microbfd session fails the corresponding ethernet link is taken out of service from the perspective of the lag microbfd is supported on ethernet lag interfaces with an ip interface microbfd sessions are associated with each individual link when enabled the state of the individual links depends on the micro bfd session state  microbfd sessions must be established between both endpoints of a link before the link can be operationally up 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 170 spacer text configuration basics release 226 bfd    if the microbfd session fails the associated ethernet link becomes operationally down from the perspective of the lag if lacp is not enabled for the lag if the ethernet port is up the system attempts to reestablish the microbfd session with the far end of the link if lacp not enabled for the lag if the ethernet port is up the system attempts to reestablish the microbfd session with the far end of the link when lacp reaches distributing state if a link is not active for forwarding from the perspective of a lag arp can still be performed across the link for example when a link is being brought up and its microbfd session is not yet established arp can still be performed for the mac address at the far end of the link even though the link is not yet part of the lag microbfd packets bypass ingress and egress subinterfaceinterface acls but received microbfd packets can be matched by cpm filters for filtering and logging microbfd is supported on all sr linux systems that also support lags 7250 ixr 7220 ixrd1 d2 and d3 7220 ixrh2 and h3 1361 configuring microbfd for a lag interface the following example configures microbfd for a lag interface the example configures ip addresses to be used as the source address for ip packets and a remote address for the far end of the bfd session the example configures the minimum interval in microseconds between transmission of bfd control packets as well as the minimum acceptable interval between received bfd control packets the detection multiplier setting specifies the number of packets that must be missed to declare the bfd session as down example   candidate shared default    info bfd microbfdsessions microbfdsessions  laginterface lag1  adminstate enable localaddress 1923525 remoteaddress 1923523 desiredminimumtransmitinterval 250000 requiredminimumreceive 250000 detectionmultiplier 3   1362 viewing the microbfd state use the info from state command to verify the microbfd state for members of a lag interface example  info from state microbfdsessions laginterface lag1 memberinterface ethernet 21 microbfdsessions laginterface lag1  adminstate up localaddress 1923515 remoteaddress 1923513 desiredminimumtransmitinterval 250000 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 171 spacer text configuration basics release 226 bfd requiredminimumreceive 250000 detectionmultiplier 3 memberinterface ethernet 21  sessionstate up remotesessionstate up laststatetransition 20200124t162255224z lastfailuretime 20200124t162255224z failuretransitions 0 localdiscriminator 25 remotediscriminator 25 localdiagnosticcode nodiagnostic remotediagnosticcode nodiagnostic remoteminimumreceiveinterval 1000000 remotecontrolplaneindependent false activetransmitinterval 250000 activereceiveinterval 250000 remotemultiplier 3 async  lastclear 20200123t162119385z lastpackettransmitted 20200124t162319385z lastpacketreceived 20200124t162318906z transmittedpackets 32 receivederroredpackets 3 receivedpackets 32 uptransitions 1     3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 172 spacer text configuration basics release 226 routing policies 14 routing policies the sr linux supports policybased routing policybased routing controls the size and content of the routing tables the routes that are advertised and the best route to take to reach a destination each routing policy has a sequence of rules called entries or statements and a default action each statement has numerical sequence identifier that determines its order relative to other statements in that policy when a route is analyzed by a policy it is evaluated by each statement in sequential order each policy statement has zero or more match conditions and a base action either accept or reject the statement may also have routemodifying actions a route matches a statement if it meets all of the specified match conditions the first statement that matches the route determines the actions that are applied to the route if the route is not matched by any statements the default action of the policy is applied if there is no default action then a protocol and contextspecific default action is applied all routes match a statement with no match conditions when a route fulfills the match conditions of a statement the base action of the statement is applied along with all of its routemodifying actions 141 creating a routing policy a routing policy consists of one or more statements that contain the following  match conditions such as protocol type as path length and address family against which routes are evaluated  actions such as accept or reject for routes that match the conditions in the statement each statement has a specified sequence number if a policy has multiple statements they are processed in sequencenumber order in addition you can specify a default action that applies to routes that do not match any statement in the policy 1411 specifying match conditions you can specify the following match conditions in a policy statement  match routes by their protocol type  bgp static direct host isis ospf and so on  match routes of any protocol by their address family  ipv4unicast ipv6unicast evpn  match routes of any protocol by their ipv4ipv6 prefix  match aggregate and bgp routes by their standard and large communities  match bgp routes by their as path length  match bgp routes by their as path encoding  match bgp routes by whether the evpn route has an ethernet segment identifier esi that matches a member of a specified esi set 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 173 spacer text configuration basics release 226 routing policies  match bgp routes by whether the evpn route has an ethernet tag id that matches a member of a specified ethernet tag set  match bgp routes by whether the evpn type2 route has a mac address that matches a member of a specified mac set  match bgp routes by whether the originating routers ip address in an evpn type3 or type4 route matches a specified ip address  match bgp routes by whether the evpn route is a specified route type ethernetad macip ethernet segment imet or ipprefix  match bgp routes by whether the bgp vpn route has a specified route distinguisher value  match isis routes by their association with either level1 l1 or level2 l2  match isis routes by their route type internal or external an ipv4 route is internal if the prefix was signaled in tlv 128 an ipv4 route is external if the prefix was signaled in tlv 130 the encoding of tlv 236 indicates whether an ipv6 route is internal or external  match isis routes by their tag value  match ospf routes by their area id  match ospf routes by their route type intraarea interarea type1ext type2ext type1nssa type2nssa summaryaggregate or nssaaggregate  match ospf routes by instance id  match routes based on evpn route type  match routes based on ip addresses and prefixes via prefixsets for route types 2 and 5  match routes based bgp encapsulation extended community if a statement has no match conditions defined all routes evaluated by the policy are considered to be matches example the following example specifies bgp protocol as a match condition in a policy statement  candidate shared default    info routingpolicy policy policy01 routingpolicy  policy policy01  statement 100  match  protocol bgp     14111 specifying a list as a match condition you can specify a list of items such as address prefixes autonomous systems bgp communities and ethernet tags as match criteria to do this you configure the list and include the list in a policy statement 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 174 spacer text configuration basics release 226 routing policies example the following example specifies a list of prefixes that can be used as a match condition in a policy statement  candidate shared default    info routingpolicy routingpolicy  prefixset western  prefix 10100132 masklengthrange exact   prefix 10100232 masklengthrange exact   prefix 10100332 masklengthrange exact   prefix 10100432 masklengthrange exact     1412 specifying actions the following are valid actions for routes that meet the match conditions in a statement  accept the route  reject the route  modify the as path of a bgp route by prepending additional as numbers  modify the as path of a bgp route by deleting the current as path and replacing it with a new as path a sequence of zero or more as numbers  add delete or replace standard and large communities attached to a bgp route  modify the localpref attribute of a bgp route by specifying a new value  modify the origin attribute of a bgp route by specifying a new value  set the nexthopself option for a bgp route  set the nexthopunchanged option for a bgp route  add delete or replace the route tag associated with an isis route  proceed to the next statement in the policy  proceed to the next policy example the following example specifies a policy with two statements if a route matches the first statement the action is to proceed to the next statement if the route matches the second statement the action is to accept  candidate shared default    info routingpolicy routingpolicy  policy policy02  statement 100  match  protocol bgp 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 175 spacer text configuration basics release 226 routing policies  action  nextentry   statement 101  match  prefixset western  action  accept     1413 specifying a default action you can optionally specify the policy action for routes that do not match the conditions defined in the policy the default action can be set to all available action states including accept reject nextentry and next policy   if a default action is defined and no matches occur with the entries in the policy the default action is used if no default action is specified the default behavior of the protocol controls whether the routes match for bgp the default import action is to accept all routes from bgp for internal routes the default export action is to advertise them to bgp peers for external routes the default export action is not to advertise them to bgp peers example the following example defines a policy where the default action for nonmatching routes is to reject them  candidate shared default    info routingpolicy routingpolicy  policy policy01  defaultaction  reject      142 applying a routing policy routing policies can be applied to routes received from other routers imported routes as well as routes advertised to other routers exported routes routing policies can be applied at the networkinstance level peergroup level and neighbor level 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 176 spacer text configuration basics release 226 routing policies example the following example specifies that bgp in the default networkinstance applies policy01 to imported routes  candidate shared default    info networkinstance default networkinstance default  protocols  bgp  importpolicy policy01   example the following example applies policy02 to bgp routes exported from the peers in peergroup headquarters1  candidate shared default    info networkinstance default networkinstance default  protocols  bgp  group headquarters1  exportpolicy policy02     example the following example applies policy02 to bgp routes exported from a specific bgp neighbor  candidate shared default    info networkinstance default networkinstance default  protocols  bgp  neighbor 192168111  exportpolicy policy02    1421 applying a default policy to ebgp sessions you can specify the action to take for routes exported to or imported from ebgp peers to which no configured policy applies this is set with the ebgpdefaultpolicy command and the exportrejectall and importrejectall parameters  the exportrejectall parameter when set to true causes all outbound routes that do not match a configured export policy to be rejected as if they had been rejected by a configured export policy the default is true 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 177 spacer text configuration basics release 226 routing policies  the importrejectall parameter when set to true causes all inbound routes that do not match a configured import policy to be rejected as if they had been rejected by a configured import policy the default is true example the following example allows a bgp neighbor to export a default route even though the route is not subject to any configured policy  candidate shared default    info networkinstance default networkinstance default  protocols  bgp  ebgpdefaultpolicy  exportrejectall false  neighbor 2001db8c11  senddefaultroute  ipv6unicast true     1422 replacing an as path you can configure a routing policy where the as path in matching routes is replaced by a list of as numbers specified in the policy for routes that match the policy the current as path is deleted and replaced with an asseq element containing the as numbers listed in the policy in their configured sequence if you configure an empty as list in the policy then the current as path in a matching route is deleted and it would then have a null aspath attribute example the following is an example of a routing policy whose action is to replace the as path in matching routes  candidate shared default    info routingpolicy routingpolicy  policy policy02  statement 100  match  protocol bgp  action  bgp  aspath  replace         3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 178 spacer text configuration basics release 226 access control lists 15 access control lists an access control list or acl is an ordered set of rules that are evaluated on a packetbypacket basis to determine whether access should be provided to a specific resource acls can be used to drop unauthorized or suspicious packets from entering or leaving a routing device via specified interfaces sr linux supports the following types of acls  interface filters an interface filter is an ipv4 or ipv6 acl that is applied to a routed or bridged subinterface to restrict traffic allowed to enter or exit the subinterface an interface acl can be applied to input or output traffic for one or more subinterfaces see interface filters for more information  packet capture filters a packet capture filter is an ipv4 or ipv6 acl used to extract packets to the control plane for inspection by packet capture tools when an ingress ip packet on any line card transits through the router and it matches a rule in a packet capture filter policy it is copied and extracted toward the cpm and delivered to a linux virtual ethernet interface so that it can be displayed by a packet capture utility or encapsulated and forwarded to a remote monitoring system see packet capture filters for more information  cpm filters a cpm filter is an ipv4 or ipv6 acl used for control plane protection there is one cpm filter for ipv4 traffic and another cpm filter for ipv6 traffic when an ingress ip packet is matched by a cpm filter rule and it is a terminating packet that is it must be extracted to the cpm then it is processed according to the matching cpm filter rule see control plane module cpm filters for more information  system filters 7220 ixrd1 d2 and d3 systems only a system filter acl is an ipv4 or ipv6 acl that is evaluated early in the ingress pipeline at a stage before tunnel termination occurs and before interface filters are run for vxlan traffic system filters can match and drop unauthorized vxlan tunnel packets before they are decapsulated based on information in the outer header see system filters for more information an acl is applied to a selected set of traffic contexts a traffic context could be all the ipv4 or ipv6 packets arriving or leaving on a specific subinterface or the outofband ip traffic arriving on a management interface or all the inband ipv4 or ipv6 packets that are locally terminating on the cpm of the router each acl rule or entry has a sequence id the acl evaluates packets starting with the entry with the lowest sequence id progressing to the entry with the highest sequence id evaluation stops at the first matching entry that is when the packet matches all of the conditions specified by the acl entry 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 179 spacer text configuration basics release 226 access control lists 151 acl actions when a packet matches an acl entry an action specified by the acl entry is applied to the packet an acl entry has a primary action and an optional secondary action the secondary action extends the primary action with additional packet handling operations for traffic transiting through the router acl entries support the following primary actions  accept  allow the packet through to the next processing function  accept and log  allow the packet through to the next processing function and send information about the accepted packet to the log application  drop  discard the packet without icmp generation  drop and log  discard the packet without icmp generation and send information about the dropped packet to the log application for traffic transiting through the router the following secondary action is supported  log  send information about the packet to the log application for traffic terminating on the cpm of the router the preceding primary and secondary actions are supported as well as the following secondary actions for acl entries where accept is the primary action  distributedpolicer  if the packet is extracted to the cpm feed the packet to a hardwarebased policer which determines if the packet should be queued by the line card toward the cpm or dropped because a bitpersecond rate is exceeded  systemcpupolicer  if the packet has been extracted to the cpm feed the packet to a softwarebased policer which determines if the packet should be delivered to the cpm application or dropped because a packetpersecond rate is exceeded if a packet matches an acl entry no further evaluation is done for the packet if the packet does not match any acl entry the default action is accept to drop traffic that does not match any acl entry you can optionally configure an entry with the highest sequence id in the acl to drop all traffic this causes traffic that does not match any of the lowersequence acl entries to be dropped the supported actions for each type of acl differ based on the hardware platform where the acl is configured the following tables indicate which actions are supported for each acl filter type for each hardware platform 1511 supported acl actions for 7250 ixr systems the following table lists the supported actions for each acl filter type on 7250 ixr systems table 11 supported actions for each acl filter type 7250 ixr acl filter type action interface filter input accept accept and log drop drop and log supported yes yes yes yes 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 180 spacer text configuration basics release 226 access control lists acl filter type action interface filter output accept accept and log drop drop and log cpm filter accept accept and log drop drop and log accept and distributedpolicer supported yes yes yes yes yes yes yes yes yes accept and distributedpolicer and log no log generated accept and systemcpupolicer yes accept and systemcpupolicer and log no log generated packet capture filter accept system filter copy accept drop drop and log yes yes no no no 1512 supported acl actions for 7220 ixrd systems the following table lists the supported actions for each acl filter type on 7220 ixrd1 d2 d3 and d5 systems table 12 supported actions for each acl filter type 7220 ixrd1 d2 d3 and d5 acl filter type action interface filter input accept accept and log drop drop and log supported yes no log generated yes yes using separate cpu queue 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 181 spacer text configuration basics release 226 access control lists acl filter type action interface filter output accept accept and log drop drop and log cpm filter accept accept and log drop drop and log supported yes no log generated yes no log generated yes no log generated yes yes using shared cpu queue accept and distributedpolicer yes1 accept and distributedpolicer and log no log generated1 2 accept and systemcpupolicer yes accept and systemcpupolicer and log no log generated packet capture filter accept system filter3 copy accept drop drop and log yes yes yes yes yes note    1 distributedpolicer not supported on 7220 ixrd5 2 log not supported on 7220 ixrd2 d3 and d5 3 system filter not supported on 7220 ixrd5 1513 supported acl actions for 7220 ixrh systems the following table lists the supported actions for each acl filter type on 7220 ixrh2 and h3 systems 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 182 spacer text configuration basics release 226 access control lists table 13 supported actions for each acl filter type 7220 ixrh2 and h3 acl filter type action interface filter input accept accept and log drop drop and log interface filter output accept accept and log drop drop and log cpm filter accept accept and log drop drop and log supported yes no log generated yes yes but logged packet is also processed by cpm filter yes no log generated yes no log generated yes no log generated yes yes accept and distributedpolicer no policing accept and distributedpolicer and log no policing and no log generated accept and systemcpupolicer yes accept and systemcpupolicer and log no log generated packet capture filter accept system filter copy accept drop drop and log yes yes no no no 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 183 spacer text configuration basics release 226 access control lists 152 acl match conditions ipv4 acls analyze ipv4 packets the following match criteria are supported by ipv4 acls   ipv4 destination prefix and prefixlength ipv4 destination address and addressmask  tcpudp destination port range     icmp typecode ip protocol number ipv4 source prefix and prefixlength ipv4 source address and addressmask  tcpudp source port range  tcp flags rst syn and ack  packet fragmentation whether the packet is a fragment  packet fragmentation whether the packet is a firstfragment fragmentoffset0 and more fragments1  ip dscp ipv6 acls analyze ipv6 packets the following match criteria are supported by ipv6 acls   ipv6 destination prefix and prefixlength ipv6 destination address and addressmask  tcpudp destination port range     icmpv6 typecode ipv6 nextheader value this is the value in the very first nextheader field in the fixed header ipv6 source prefix and prefixlength ipv6 source address and addressmask  tcpudp source port range  tcp flags rst syn and ack  ip dscp 153 interface filters an interface filter is an ipv4 or ipv6 acl that restricts traffic allowed to enter or exit a subinterface ipv4 and ipv6 acls can be applied to a subinterface to restrict traffic entering or exiting that subinterface as follows  input ipv4 acls  when an ipv4 filter is used as an input acl on a subinterface that carries ipv4 traffic the rules apply to native ipv4 packets ethertype 0x0800 that enter the subinterface and would normally terminate locally controlmanagement plane packets or transit through the router the rules also apply to mplsencapsulated ipv4 packets ethertype 0x8847 that are terminating or transit 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 184 spacer text configuration basics release 226 access control lists  input ipv6 acls  when an ipv6 filter is used as an input acl on a subinterface that carries ipv6 traffic the rules apply to native ipv6 packets ethertype 0x86dd that enter the subinterface and would normally terminate locally controlmanagement plane packets or transit through the router the rules also apply to mplsencapsulated ipv6 packets ethertype 0x8847 that are terminating or transit  output ipv4 acls  when an ipv4 filter is used as an output acl on a subinterface that carries ipv4 traffic the rules apply to native ipv4 packets ethertype 0x0800 that exit the subinterface including packets that originated locally controlmanagement plane packets and packets that transited through the router the rules do not apply to mplsencapsulated ipv4 packets ethertype 0x8847 exiting the subinterface  output ipv6 acls  when an ipv6 filter is used as an output acl on a subinterface that carries ipv6 traffic the rules apply to native ipv6 packets ethertype 0x86dd that exit the subinterface including packets that originated locally controlmanagement plane packets and packets that transited through the router the rules do not apply to mplsencapsulated ipv6 packets ethertype 0x8847 exiting the subinterface 1531 creating an ipv4 acl the following is an example ipv4 acl that has one entry example this example creates an ipv4 acl named iptcp within the iptcp acl an entry with sequence id 1000 is configured the action is specified as accept with logging set to true the filter matches packets with ip destination address 10013132 for tcp traffic if the source address 10015132 destination port 6789 and source port 6722 matches the filter the traffic stream is accepted   candidate shared default    info acl ipv4filter iptcp  entry 1000  description matchipaddresstcpprotocolports action  accept  log true   match  destinationaddress 10013132 protocol tcp sourceaddress 10015132 destinationport  value 6789  sourceport  value 6722     3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 185 spacer text configuration basics release 226 access control lists example the following is an example of an entry added to the iptcp acl that causes all traffic to be dropped because it has the highest sequence id traffic that matches any of the lowersequenced acl entries would have been accepted before being evaluated by this entry only traffic that did not match any of the other acl entries would be dropped by this entry   candidate shared default    info acl ipv4filter iptcp  entry 65535  action  drop  log true     note that the drop action with logging set to true is not supported on 7220 ixrd1 d2 d3 and d5 systems when it is attached as an egress filter 1532 creating an ipv6 acl the following is an example ipv6 acl that has one entry example this example creates an ipv6 acl named ipv6tcp within the ipv6tcp acl an entry with sequence id 100 is configured the action is specified as accept with logging set to true the filter matches packets with ipv6 destination address 200110131120 for tcp traffic if the source address 200110151120 destination port 6789 and source port 6722 matches the filter the traffic stream is accepted   candidate shared default    info acl ipv6filter ipv6tcp  entry 100  description matchdestaddresstcpsrcaddressdpsp action  accept  log true   match  destinationaddress 200110131120 nextheader tcp sourceaddress 200110151120 destinationport  value 6789  sourceport  value 6722     3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 186 spacer text configuration basics release 226 access control lists 1533 attaching an acl to a subinterface after an acl is configured you can attach it to a subinterface so that traffic entering or exiting the subinterface is subject to the rules defined in the acl example the following commands apply ipv4 and ipv6 acls to inbound traffic on a subinterface   candidate shared default    interface ethernet116   candidate shared default  interface ethernet116   subinterface 1   candidate shared default  interface ethernet116 subinterface 1   acl   candidate shared default  interface ethernet116 subinterface 1 acl   input ipv4filter iptcp   candidate shared default  interface ethernet116 subinterface 1 acl   input ipv6filter ipv6tcp example you can check the configuration of the interface to verify that the acl is successfully attached for example   candidate shared default    info interface ethernet116 interface ethernet116  description dut1dut2 subinterface 1  ipv4  address 10015224   arp  neighbor 100151  linklayeraddress 000064010505    ipv6  address 200110152120   neighbordiscovery  neighbor 200110151  linklayeraddress 000064010505    acl  input  ipv4filter iptcp ipv6filter ipv6tcp     3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 187 spacer text configuration basics release 226 access control lists 1534 attaching an acl to the management interface to modulate traffic for the management interface navigate to the subinterface of interface mgmt0 under the acl context attach the ipv4 or ipv6 acl for inputoutput traffic example   candidate shared default    interface mgmt0   candidate shared default  interface mgmt0   subinterface 0   candidate shared default  interface mgmt0 subinterface 0   acl   candidate shared default  interface mgmt0 subinterface 0 acl   input ipv4filter iptcp   candidate shared default  interface mgmt0 subinterface 0 acl   input ipv6filter ipv6tcp example to verify the configuration for the management interface acl   candidate shared default    info interface mgmt0 interface mgmt0  adminstate enable subinterface 0  adminstate enable ipv4  dhcpclient true  ipv6  dhcpclient true  acl  input  ipv4filter iptcp ipv6filter ipv6tcp     1535 detaching an acl from an interface to detach an acl from an interface enter the subinterface context and delete the acl from the configuration example the following commands detach an acl from a subinterface   candidate shared default    interface ethernet116   candidate shared default  interface ethernet116   subinterface 1   candidate shared default  interface ethernet116 subinterface 1   delete acl input ipv4filter 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 188 spacer text configuration basics release 226 access control lists   candidate shared default  interface ethernet116 subinterface 1  example use the info interface command to verify that the acl is no longer part of the subinterface configuration for example   candidate shared default    info interface ethernet116 interface ethernet116  description dut1dut2 subinterface 1  ipv4  address 10015224   arp  neighbor 100151  linklayeraddress 000064010505    ipv6  address 200110152120   neighbordiscovery  neighbor 200110151  linklayeraddress 000064010505    acl  input  ipv6filter ipv6tcp     1536 detaching an acl from the management interface the following example detaches an acl from the management interface example   candidate shared default    interface mgmt0   candidate shared default  interface mgmt0   subinterface 0   candidate shared default  interface mgmt0 subinterface 0   delete acl input ipv4filter example to verify that the acl was detached from the management interface   candidate shared default    info interface mgmt0 interface mgmt0  adminstate enable 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 189 spacer text configuration basics release 226 access control lists subinterface 0  adminstate enable ipv4  dhcpclient true  ipv6  dhcpclient true  acl  input  ipv6filter ipv6tcp     1537 modifying acls you can add entries to an acl delete entries from an acl and delete the entire acl from the configuration example to add an entry to an acl enter the context for the acl then add the entry for example the following commands add an entry to ipv4 acl iptcp   candidate shared default    acl ipv4filter iptcp  candidate shared default  acl ipv4filter iptcp   entry 65535  candidate shared default  acl ipv4filter iptcp entry 65535   action drop  candidate shared default  acl ipv4filter iptcp entry 65535 action drop   log true  candidate shared default  acl ipv4filter iptcp entry 65535 action drop  example to delete an entry in an acl use the delete command under the context for the acl and specify the sequence id of the entry to be deleted for example the following commands delete the entry in ipv4 acl iptcp with sequence id 65535  candidate shared default    acl ipv4filter iptcp  candidate shared default  acl ipv4filter iptcp   delete entry 65535 example to delete the entire acl use the delete command under the acl context for example the following commands delete the iptcp acl   candidate shared default    acl  candidate shared default  acl   delete ipv4filter iptcp 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 190 spacer text configuration basics release 226 access control lists 1538 resequencing acl entries to aid in managing complex acls that have many entries you can resequence the acl entries to set a sequence id number for the first entry and a constant increment for the sequence id for subsequent entries for example if you have an acl with three entries sequence ids 123 124 and 301 you can resequence the entries so that the initial entry has sequence id 100 and the other two entries have sequence id 110 and 120 example the following is an example of an acl with three entries  candidate shared default  acl   info ipv4filter iptcp ipv4filter iptcp  entry 123  action  drop  log true   match  destinationaddress 112124   entry 124  action  accept  log true   match  destinationaddress 113124   entry 301  action  drop    match  destinationaddress 114124   to resequence the entries in the acl so that the first entry has sequence id 100 and the next two entries are incremented by 10 enter the context for the acl issue the tools resequence command then specify the initial sequence id and the increment for the subsequent entries for example  candidate shared default    acl ipv4filter iptcp  candidate shared default  acl ipv4filter iptcp   tools resequence start 100 increment 10 after you enter the command the acl entries are renumbered for example  candidate shared default  acl  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 191 spacer text configuration basics release 226 access control lists  info ipv4filter iptcp ipv4filter iptcp  entry 100  action  drop  log true   match  destinationaddress 112124   entry 110  action  accept  log true   match  destinationaddress 113124   entry 120  action  drop    match  destinationaddress 114124   the resequence command is only available inside an acl configuration context and it only applies to the entries of the acl associated with that context 154 packet capture filters for troubleshooting purposes the sr linux supports acl policies called packet capture filters when an ingress ip packet on any line card transits through the router and it matches a rule in a capturefilter policy it is copied and extracted toward the cpm using the capturefilter extraction queue and delivered to a linux virtual ethernet interface so that it can be displayed by tcpdump or similar packet capture utility or encapsulated and forwarded to a remote monitoring system similarly when an ingress ip packet on any line card terminates locally and it matches a rule of a capture filter policy it is extracted toward the cpm using the normal protocolbased extraction queue and a header field indicates to the cpm to replicate it after running the cpmfilter rules toward the linux virtual ethernet interface there is one capturefilter for ipv4 traffic and another capturefilter for ipv6 traffic the default ipv4 capturefilter policy copies no ipv4 packets and the default ipv6 capturefilter copies no ipv6 packets the entries for each capturefilter are installed on every line card on the line card the entries are evaluated after the input subinterface acls and before the cpmfilter acls on the cpm the entries in the capturefilter policy are evaluated after the cpmfilter entries when a capturefilter acl is created its rules are evaluated against all transit and terminating ipv4 or ipv6 traffic that is arriving on any subinterface of the router regardless of where that traffic entered in terms of networkinstance subinterface linecard pipeline and so on note that capturefilter acl rules cannot 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 192 spacer text configuration basics release 226 access control lists override interface filter or systemfilter acl drop outcomes packets dropped by interface filter acls or a system filter acl cannot be mirrored to the control plane each capturefilter entry has a set of zero or more match conditions and one of two possible actions accept and copy the match conditions are the same as the other filter types the accept action passes the matching packet to the next stage of processing without creating a copy the copy action creates a copy of the matching packet extracts it toward the cpm and delivers it to the designated virtual ethernet interface 155 control plane module cpm filters for control plane protection sr linux supports acl policies called cpm filters there is one cpm filter for ipv4 traffic and another cpm filter for ipv6 traffic when an ingress ip packet is matched by a cpm filter rule and it is a terminating packet that is it must be extracted to the cpm then it is processed according to the matching cpm filter rule the entries for each cpm filter are installed on every line card they are evaluated after the input subinterface acls and after the capturefilter acls cpm filter rules have no effect on locally originating traffic or transit traffic and they have no interaction with output subinterface acls when a cpm filter acl is created its rules are evaluated against all ipv4 or ipv6 traffic that is locally terminating on the router regardless of where that traffic entered in terms of networkinstance subinterface linecard pipeline and so on on 7250 ixr systems for traffic terminating on the cpm of the router the following secondary actions are supported for acl entries where accept is the primary action  distributedpolicer  if the packet is extracted to the cpm feed the packet to a hardwarebased policer which determines if the packet should be queued by the line card toward the cpm or dropped because a bitpersecond rate is exceeded  systemcpupolicer  if the packet has been extracted to the cpm feed the packet to a softwarebased policer which determines if the packet should be delivered to the cpm application or dropped because a packetpersecond rate is exceeded on 7220 ixrd1 d2 d3 and d5 systems cpm filter acls support the following actions  accept  allow the packet through to the next processing function  accept and distributedpolicer  the packet is allowed through to the next processing function and rate limited by a policer instance implemented by the 7220 ixrd2 and d3  accept and systemcpupolicer  the packet is allowed through to the next processing function and rate limited by a policer instance implemented by xdpcpm  drop  discard the packet without icmp generation  drop and log  discard the packet without icmp generation and send information about the dropped packet to the log application the systemcpupolicer and distributedpolicer actions police terminating traffic to ensure that the rate does not exceed a safe limit the systemcpupolicer action applies an aggregate rate limit regardless of ingress line card while the distributedpolicer action applies a rate limit to the extracted traffic from each core 7250 ixr or complex 7220 ixr associated with the ingress port you can have both types of policer actions in the same cpm filter entry or only one of them 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 193 spacer text configuration basics release 226 access control lists cpm filter rules that apply a systemcpupolicer or distributedpolicer action do not directly specify the policer parameters they refer to a generically defined policer this allows different cpm filter entries even across multiple acls to use the same policer optionally each policer can be configured as entryspecific which means a different policer instance is used by each referring filter entry even if they are part of the same acl 156 system filters a system filter acl is an ipv4 or ipv6 acl that evaluates ingress traffic before all other acl rules if an ip packet is dropped by a system filter rule it is the final disposition of the packet neither a capturefilter copyaccept action nor an ingress interface acl accept action nor a cpmfilter accept action can override the drop action of a system filter at most one system filter can be defined for ipv4 traffic and at most one system filter can be defined for ipv6 traffic system filter acls are supported on 7220 ixrd1 d2 and d3 systems only they can be applied only at ingress not egress when a systemfilter acl is created its rules are automatically installed everywhere meaning they are evaluated against all transit and terminating ipv4 or ipv6 traffic arriving on any subinterface of the router regardless of where that traffic entered in terms of networkinstance subinterface pipeline and so on a system filter is the only type of filter that can match the outer header of tunneled packets for vxlan traffic this allows you to configure a system filter that matches and drops unauthorized vxlan tunnel packets before they are decapsulated the system filter matches the outer header of tunneled packets they do not filter the payload of vxlan tunnels 1561 creating a system filter the following is an example of a system filter acl that filters ipv4 traffic when the system filter is applied it evaluates all transit and terminating ipv4 arriving on any subinterface of the router the system filter acl evaluates the traffic before any other acl filters system filter acls can be configured on 7220 ixrd1 d2 and d3 systems only example   candidate shared default    info acl systemfilter acl systemfilter  ipv4filter  entry 44  action  drop  log true   match  sourceip  address 100151 mask 000255     3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 194 spacer text configuration basics release 226 access control lists  157 configuring logging for acls you can configure the sr linux to log information about packets that match an acl entry in the system log you can set thresholds for acl or tcam resource usage when utilization of a specified resource reaches the threshold in either the rising or falling direction it can trigger a log message 1571 enabling syslog for the acl subsystem if you set the log parameter to true for the accept or drop action in an acl entry information about packets that match the acl entry is recorded in the system log you can specify settings for the log file for the acl subsystem including the location of the log file maximum log file size and the number of log files to keep example for example the following configuration specifies that the log file for the acl subsystem be stored in the file dut1file located in the optsrlinuxbinlogssrbase directory the log file can be a maximum of 1 mb when the log file reaches this size it is renamed using dut1file as its base name the five most recent log files are kept  candidate shared default    system  candidate shared default  system   info logging file dut1file logging  file dut1file  directory optsrlinuxbinlogssrbase rotate 5 size 1m subsystem acl     ensure that write permission is set for the specified directory path 15711 syslog entry examples the following are examples of syslog entries for acls ipv4 accept acli type ingress ipv4 filter testing sequence id 100 action accept interface ethernet 1161 packet length 56 ip source 100151 destination 100131 protocol 6 tcp source port 6722 destination port 6789 flags syn 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 195 spacer text configuration basics release 226 access control lists ipv4 drop acli type ingress ipv4 filter test sequence id 65535 action drop interface ethernet 1161 packet length 44 ip source 100323 destination 100131 protocol 17 udp source port 6722 destination port 6789 ipv6 accept acli type ingress ipv6 filter tests sequence id 1000 action accept interface ethernet 1161 packet length 76 ip source 200110151 destination 200110131 protocol 6 tcp source port 6722 destination port 6789 flags syn 1572 logging acl resource usage you can set thresholds for acl resource usage when utilization of a specified acl resource such as input ipv4 filter instances reaches the threshold in either the rising or falling direction it can trigger a log message example the following example sets thresholds for resource usage by input ipv4 filter instances if the resource usage percentage falls below the fallingthresholdlog value a log message of priority notice is generated if the resource usage percentage falls below the risingthresholdlog value a log message of priority warning is generated   candidate shared default    info platform resourcemonitoring platform  resourcemonitoring  acl  resource inputipv4filterinstances  risingthresholdlog 90 fallingthresholdlog 90     1573 logging tcam resource usage you can set thresholds for ternary content addressable memory tcam resource usage when utilization of a specified tcam resource such as tcam used by ipv4 cpm filters reaches the threshold in either the rising or falling direction it can trigger a log message example the following example sets thresholds for tcam resource usage by ipv4 cpm filters if the resource usage percentage falls below the fallingthresholdlog value a log message of priority notice is generated if the resource usage percentage falls below the risingthresholdlog value a log message of priority warning is generated   candidate shared default    info platform resourcemonitoring platform  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 196 spacer text configuration basics release 226 access control lists resourcemonitoring  tcam  resource cpmcaptureipv4  risingthresholdlog 90 fallingthresholdlog 90     158 collecting and displaying acl statistics the sr linux can collect statistics for packets matching an acl and display statistics for the matched packets you can display the amount of system resources tcam used by each type of acl on each line card acl statistics can also be displayed using show commands 1581 collecting acl statistics you can configure an acl to collect statistics for packets matching the acl statistics can be collected for packets that match each acl entry as well as for matching inputoutput traffic per subinterface example the following example configures the acl to record the number of matching packets for each entry  candidate shared default  acl   ipv4filter iptcp  candidate shared default  acl ipv4filter iptcp   statisticsperentry true example by default if two or more subinterfaces on the same line card reference the same acl for filtering the same direction of traffic they use a shared instance of the same acl in hardware this means that per entry statistics including the number of matched packets and the time stamp of the last matching packet if enabled reflect the aggregate of the data gathered for the multiple subinterfaces to collect perentry persubinterface statistics instead of the aggregate of the subinterfaces where the acl is applied you can configure an acl to operate in subinterfacespecific mode if you change an acl from subinterfacespecific mode to shared mode or the other way around during the transition from one mode to the next traffic continues to be subject to the previous mode until the system resources tcam entries are programmed for the new mode the following example configures the acl to collect statistics for matching packets inbound and outbound on each subinterface  candidate shared default  acl   ipv4filter iptcp  candidate shared default  acl ipv4filter iptcp   subinterfacespecific inputandoutput you can configure the following values for the subinterfacespecific parameter 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 197 spacer text configuration basics release 226 access control lists  disabled the default  all subinterfaces on a single line card that reference the acl as an input acl use a shared filter instance and all subinterfaces on a single line card that reference the acl as an output acl use a shared filter instance  inputonly  all subinterfaces on a single line card that reference the acl as an output acl use a shared filter instance but each subinterface that references the acl as an input acl uses its own separate instance of the filter  outputonly  all subinterfaces on a single line card that reference the acl as an input acl use a shared filter instance but each subinterface that references the acl as an output acl uses its own separate instance of the filter  inputandoutput  each subinterface that references the acl as either an input acl or an output acl uses its own separate instance of the filter 1582 displaying acl statistics use the info from state command to display the matched packet statistics and the time of the last match for the interfaces to which the acl is attached example in the following example the acl is attached to two interfaces and statistics are collected for each subinterface  candidate shared default  acl ipv4filter iptcp   info from state subinterfacespecific inputandoutput statisticsperentry true entry 1000  description matchipaddresstcpprotocolports action  accept  log true   match  destinationaddress 10013132 protocol tcp sourceaddress 10015132 destinationport  value 6789  sourceport  value 6722   statistics  aggregate  inmatchedpackets 3000 inlastmatch 20190716t1053001563z outmatchedpackets 0  perinterface  subinterface ethernet1161  inmatchedpackets 3000 inlastmatch 20190716t1053001563z    3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 198 spacer text configuration basics release 226 access control lists  entry 65535  action  drop  log true   statistics  aggregate  inmatchedpackets 1000 inlastmatch 20190716t1053301563z  perinterface  subinterface ethernet1161  inmatchedpackets 1000 inlastmatch 20190716t1053301563z     if the match criteria changes for an acl entry the statistics counter does not reset to zero to reset the statistics counter for an acl entry to zero use the tools acl clear command as described in clearing acl statistics 1583 displaying acl resource usage use the info from state platform command to display the amount of system resources tcam used by each type of acl on each line card example the following example shows two different numbers for the remaining free tcam entry resources that are available for input ipv4 acls on the line card the freestatic value refers to the available number of resources assuming no additional tcam banks are dynamically assigned to the acl type the free dynamic value refers to the available number of resources assuming all unallocated tcam banks are dedicated to the specified acl type  candidate shared default    info from state platform linecard 1 forwardingcomplex 0 tcam resource ifinputipv4 platform  linecard 1  forwardingcomplex 0  tcam  resource ifinputipv4  freestatic 2046 freedynamic 18430 reserved 2 programmed 2      3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 199 spacer text configuration basics release 226 access control lists example the following example shows the amount of system resources allocated to input ipv4 acls on the line card and how much is used and free  candidate shared default    info from state platform linecard 1 forwardingcomplex 0 acl resource inputipv4filter instances platform  linecard 1  forwardingcomplex 0  acl  resource inputipv4filterinstances  used 1 free 254      1584 clearing acl statistics to reset acl statistics counters to zero use the tools acl clear command this command can clear statistics at the ipv4  ipv6  cpm filter level acl entry level or for an interface or subinterface to which the acl is attached example the following example clears statistics for an ipv4 filter  candidate shared default  acl   tools acl ipv4filter tcpip clear example after this command is executed the info from state output for the ipv4 filter includes a timestamp indicating when the statistics were cleared for example  candidate shared default  acl ipv4filter tcpip   info from state subinterfacespecific outputonly statisticsperentry true entry 1000  description matchipaddresstcpprotocolports action  accept  log true   match  destinationaddress 10013132 protocol tcp sourceaddress 10015132 destinationport  value 6789  sourceport  value 6722 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 200 spacer text configuration basics release 226 access control lists   statistics  lastclear 20191003t135351000z   example the following example clears statistics for a specific entry in the ipv4 filter  candidate shared default  acl   tools acl ipv4filter tcpip entry 1000 statistics clear example the following example clears statistics for a specified subinterface for a specified entry in the ipv4 filter  candidate shared default  acl   tools acl ipv4filter tcpip entry 1000 statistics perinterface subinterface 1 clear 1585 displaying acl statistics using show commands you can display acl statistics using relevant show commands example to display information about all active acls use the show acl summary command for example  show acl summary  ipv4 filter acls  filter  iptcp active on  1 subinterfaces input and 0 subinterfaces output entries  2  ipv6 filter acls  filter  ipv6tcp active on  1 subinterfaces input and 0 subinterfaces output entries  1  example you can display statistics for a specific acl including how many times each acl entry was matched on all subinterfaces to which the acl was applied for example  candidate shared default    show acl ipv4filter iptcp  filter  iptcp subifspecific inputandoutput entrystats  yes entries  2  subinterface input output 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 201 spacer text configuration basics release 226 access control lists ethernet1161 yes no  entry 1000 match  protocoltcp 1001513267226722100131326789 6789 action  accept input match packets  3000 input last match  18 seconds ago output match packets 0 output last match  never entry 65535 match  protocolundefined anyany action  drop input match packets  1000 input last match  6 minutes ago output match packets 0 output last match  never example to display perinterface statistics for packets matching each acl entry specify the interface name in addition to the acl name for example  candidate shared default    show acl ipv4filter iptcp interface ethernet116  filter  iptcp subifspecific inputandoutput entrystats  yes entries  2  subinterface input output ethernet1161 yes no  entry 1000 match  protocoltcp 1001513267226722100131326789 6789 action  accept input match packets  3000 input last match  5 minutes ago output match packets 0 output last match  never entry 65535 match  protocolundefined anyany action  drop input match packets  1000 input last match  10 minutes ago output match packets 0 output last match  never example to display statistics for packets matching a cpm filter specify the cpm filter type ipv4 or ipv6 for example  candidate shared default    show acl cpmfilter ipv4filter  filter  cpm ipv4filter entrystats no entries  1  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 202 spacer text configuration basics release 226 access control lists entry 1001 match  protocolundefined any112124 action  none matched packets 0  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 203 spacer text configuration basics release 226 sr linux applications 16 sr linux applications the sr linux is a suite of modular lightweight applications running like any others in a linux environment each sr linux application supports a different protocol or function such as bgp lldp aaa and so on these applications use grpc and apis to communicate with each other and external systems over tcp one sr linux application the application manager appmgr is itself responsible for monitoring the health of the process ids running each sr linux applications and restarting them if they fail the application manager reads in applicationspecific yaml configuration and yang models and starts each application or allows an application not to start if there no configuration exists for it there is an instance of the appmgr that handles applications running on the cpm and an instance of the appmgr on each imm that handles applications running on the line card in addition to the nokiaprovided sr linux applications the sr linux supports installation of userdefined applications which are managed and configured in the same way as the default sr linux applications userdefined sr linux applications can be loaded reloaded and unloaded from the system as necessary 161 installing an application about this task to install an application copy the application files into the appropriate sr linux directories then reload the application manager and start the application the example in this topic installs an application called fibagent the application consists of files named fibagentyml fibagentsh fibagentpy and fibagentyang the fibagentyml file is installed in the etcoptsrlinuxappmgr directory the yml file for a userdefined application must reside in this directory in order for the appmgr to read its yaml configuration the yml file defines the locations of the other application files the other application files can reside anywhere in the system other than in the optsrlinux directory or any tempfs file system in this example the fibagentsh and fibagentpy files are installed in the directory user agents and the fibagentyang file is installed in the directoryyang the locations for these files are defined in the fibagentyml file procedure step 1 copy the application files into the sr linux directories example  candidate    bash  cp fibagentyml etcoptsrlinuxappmgr  cp fibagentsh useragents  cp fibagentpy useragents  cp fibagentyang yang  exit step 2 from the sr linux cli reload the application manager 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 204 spacer text configuration basics release 226 sr linux applications example  candidate    tools system appmanagement application appmgr reload step 3 apply the changes to the configuration example  candidate    fibagent  candidate  fibagent   commit stay all changes have been committed starting new transaction  candidate  fibagent  step 4 verify that the application is running example  show system application fibagent   name  pid  state  version  last change    fibagent  227  running  v213061gd19567393  20210113t201645697z   162 starting an application to start an sr linux application instance use the start option in the tools system appmanagement command to terminate a running application instance and restart it use the restart option example to start an sr linux application instance  candidate    tools system appmanagement application mplsmgr start systemappmanagementapplicationnamemplsmgr application mplsmgr was started example to restart an sr linux application instance  candidate    tools system appmanagement application mplsmgr restart systemappmanagementapplicationnamemplsmgr application mplsmgr was killed with signal 9 systemappmanagementapplicationnamemplsmgr application mplsmgr was restarted 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 205 spacer text configuration basics release 226 sr linux applications 163 terminating an application you can use the stop quit or kill options in the tools system appmanagement command to terminate an sr linux application  stop gracefully terminates the application allowing it to clean up before exiting  quit terminates the application and generates a core dump the core dump files are saved in the  varlogsrlinuxcores directory  kill terminates the application immediately without allowing it to clean up before exiting example to terminate an application gracefully  candidate    tools system appmanagement application mplsmgr stop systemappmanagementapplicationnamemplsmgr application mplsmgr was killed with signal 15 example to terminate an application and generate a core dump  candidate    tools system appmanagement application mplsmgr quit systemappmanagementapplicationnamemplsmgr application mplsmgr was killed with signal 3 example to terminate an application immediately  candidate    tools system appmanagement application mplsmgr kill systemappmanagementapplicationnamemplsmgr application mplsmgr was killed with signal 9 164 reloading application configuration reloading the application manager causes it to process any changes in the installed applications yaml configuration and restart the applications applications that are no longer present in the system are stopped and their yang modules are removed from the management server applications removed from the system have their nodes or augmentations removed from the system schema example to reload the application configuration reload the appmgr application   running    tools system appmanagement application appmgr reload 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 206 spacer text configuration basics release 226 sr linux applications 165 clearing application statistics you can display statistics collected for an application with the info from state command to reset the statistics counters for the application use the statistics clear option in the tools system app management command example to reset the statistics counters for an application  running    tools system appmanagement application mplsmgr statistics clear 166 restricted operations for applications an application may have one or more operations that are restricted by default for example the linuxmgr application has stop quit and kill as restricted operations meaning that these options are not available when entering the tools system appmanagement command for the linuxmgr application table 14 restricted operations for sr linux applications lists the restricted operations for each sr linux application table 14 restricted operations for sr linux applications application restricted operations aaamgr aclmgr appmgr arpndmgr bfdmgr bgpmgr chassismgr devicemgr reload reload start stop restart quit kill reload reload reload stop quit kill reload reload dhcpclientmgr stop reload fibmgr gnmiserver idbserver reload reload start stop restart quit kill reload jsonrpcconfig reload linuxmgr stop quit kill 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 207 spacer text configuration basics release 226 sr linux applications application restricted operations lldpmgr logmgr mgmtserver mplsmgr netinstmgr oammgr plcymgr qosmgr sdkmgr staticroutemgr supportd xdpcpm xdplc reload reload start stop quit kill reload reload start stop quit kill reload reload reload reload reload reload reload stop quit kill reload reload restricted options are specified in the restrictedoperations setting in the yaml file for the application 167 configuring an application about this task to configure an sr linux application edit settings in the application yaml file then reload the application manager to activate the changes the example in this section shows how to configure an application to specify the action the sr linux device takes when the application fails if an sr linux application fails a specified number of times over a specified time period the sr linux device can reboot the system or attempt to restart the application after waiting a specified number of seconds for example if the aaamgr application crashes 5 times within a 500second window the sr linux device can be configured to wait 100 seconds then restart the aaamgr application the following actions can be taken if an sr linux application fails  reboot the system  wait a specified number of seconds then attempt to restart the failed application  move the failed application to error state without rebooting the system or attempting to restart the application 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 208 spacer text configuration basics release 226 sr linux applications if you stop or restart an application using the tools system appmanagement command in the sr linux cli it is not considered an application failure the failure action for the application if one is configured does not occur however if the failed application waits a specified period of time or forever to be restarted or has been moved into error state you can restart the application manually with the tools system appmanagement application restart cli command to configure the failure action for an application procedure step 1 check the status of the sr linux applications example  running    show system application   name  pid  state  version  last change    aaamgr  242  error  v223034ge0ee326f8  20220121t201510967z   aclmgr  193  running  v223034ge0ee326f8  20220121t201510967z   appmgr  118  running  v223034ge0ee326f8  20220121t201511161z   arpndmgr  104  running  v223034ge0ee326f8  20220121t201510967z   bfdmgr   waitingforconfig     bgpmgr  109  running  v223034ge0ee326f8  20220121t201513156z   chassismgr  115  running  v223034ge0ee326f8  20220121t201510967z   devmgr  150  running  v223034ge0ee326f8  20220121t201510001z   fibmgr  168  running  v223034ge0ee326f8  20220121t201510968z   gnmiserver  157  running  v223034ge0ee326f8  20220121t201513296z   idbserver  171  running  v223034ge0ee326f8  20220121t201510228z   igmpmgr   waitingforconfig     isismgr   waitingforconfig     jsonrpc  166  running   20220121t201513234z   labelmgr  139  running  v223034ge0ee326f8  20220121t201513186z   lagmgr  103  running  v223034ge0ee326f8  20220121t201510968z   ldpmgr   waitingforconfig     linuxmgr  116  running  v223034ge0ee326f8  20220121t201510968z   lldpmgr  149  running  v223034ge0ee326f8  20220121t201513206z   logmgr  127  running  v223034ge0ee326f8  20220121t201510968z   mgmtserver  149  running  v223034ge0ee326f8  20220121t201510968z   mirrormgr   waitingforconfig     mplsmgr   waitingforconfig     netinstmgr  160  running  v223034ge0ee326f8  20220121t201510968z   oammgr  160  running  v223034ge0ee326f8  20220121t201513231z   ospfmgr   waitingforconfig     p4rtserver  641  running  v223034ge0ee326f8  20220121t215647935z   plcymgr  177  running  v223034ge0ee326f8  20220121t201513242z   qosmgr  186  running  v223034ge0ee326f8  20220121t201513322z   sshdmgmt  192  running   20220121t201519710z   xdpcpm  197  running  v223034ge0ee326f8  20220121t201510968z   xdplc1  108  running   20220121t201510968z   step 2 use the info from state command to check the current failure action settings for the application to configure these settings are highlighted in the following example example  running    info from state system appmanagement application aaamgr system  appmanagement  application aaamgr  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 209 spacer text configuration basics release 226 sr linux applications pid 242 state error lastchange 20220121t201510967z author nokia failurethreshold 3 failurewindow 300 failureaction reboot path optsrlinuxbin launchcommand sraaamgr searchcommand sraaamgr version v223034ge0ee326f8 restrictedoperations  reload  statistics  restartcount 0  yang  modules  srlnokiaaaa srlnokiaaaatypes  sourcedirectories  optsrlinuxmodelsietf optsrlinuxmodelssrlnokiamodelscommon optsrlinuxmodelssrlnokiamodelsnetworkinstance optsrlinuxmodelssrlnokiamodelssystem      the following failure action settings can be configured for an application  failurethreshold number of times that the application must fail during the failure window period before the failureaction is taken the default is three times  failurewindow number of seconds over which the application must fail the failure threshold number of times before the failureaction is taken the default is 300 seconds  failureaction action to take if the application fails failurethreshold times over failure window seconds this can be one of the following  reboot reboot the system this is the default failureaction  waitseconds wait this number of seconds then attempt to restart the application  waitforever move the application to error state and do not reboot the system or attempt to restart the application step 3 edit the yaml configuration for the application the yaml configuration files for sr linux applications are located in the directory opt srlinuxappmgr on the sr linux device they are named srapplicationname configyml for example sraaamgrconfigyml step 4 in the yml file add or change the settings for the failurethreshold failurewindow and failureaction parameters 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 210 spacer text configuration basics release 226 sr linux applications example in the following example the failure action settings in the sraaamgrconfigyml file are configured so that if the aaamgr application fails 5 times over a 500second period the sr linux device waits 100 seconds then attempts to restart the aaamgr application aaamgrsetup path optsrlinuxbin launchcommand aaamgrsetenvsh runasuser root nevershow yes neverrestart yes startorder 1 aaamgr path optsrlinuxbin launchcommand sraaamgr searchcommand sraaamgr runasuser root restrictedoperations reload failurethreshold 5 failurewindow  500 failureaction wait100 yangmodules names  srlnokiaaaa  srlnokiaaaatypes sourcedirectories  optsrlinuxmodelsietf  optsrlinuxmodelssrlnokiamodelscommon  optsrlinuxmodelssrlnokiamodelssystem  optsrlinuxmodelssrlnokiamodelsnetworkinstance step 5 save and close the yml configuration file step 6 in the sr linux cli reload the application manager example  running    tools system appmanagement application appmgr reload this command reloads any application whose yml configuration file has changed it does not affect any service step 7 use the info from state command to verify that the changes to the failure action settings are now in effect example  running    info from state system appmanagement application aaamgr system  appmanagement  application aaamgr  pid 242 state running lastchange 20220121t201510967z author nokia failurethreshold 5 failurewindow 500 failureaction wait100 path optsrlinuxbin 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 211 spacer text configuration basics release 226 sr linux applications launchcommand sraaamgr searchcommand sraaamgr version v223034ge0ee326f8 restrictedoperations  reload  statistics  restartcount 0  yang  modules  srlnokiaaaa srlnokiaaaatypes  sourcedirectories  optsrlinuxmodelsietf optsrlinuxmodelssrlnokiamodelscommon optsrlinuxmodelssrlnokiamodelsnetworkinstance optsrlinuxmodelssrlnokiamodelssystem      168 removing an application from the system about this task to remove an application from the system remove the application files from the sr linux directories where they reside then reload the application manager when an application is removed from the system sr linux stops sending updates for the paths that the application would populate if the application is subsequently reloaded sr linux resumes sending updates for active cli sessions the schema is updated to remove the application if an active cli session exists in a context that is no longer present because of the application being removed the cli context is changed to the nexthighest valid context userdefined applications can be removed from the system but removing nokiaprovided sr linux applications is not supported in the following example the fibagent application consisting of files named fibagentyml fib agentsh fibagentpy and fibagentyang is removed from the system procedure step 1 remove the application files from the sr linux directories example  candidate    bash  rm etcoptsrlinuxappmgrfibagentyml  rm useragentsfibagentsh  rm useragentsfibagentpy  rm yangfibagentyang  exit 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 212 spacer text configuration basics release 226 sr linux applications step 2 from the sr linux cli reload the application manager example  candidate    tools system appmanagement application appmgr reload the application manager stops any application that is no longer present and removes the applications yang module from the management server 169 partioning and isolating application resources the sr linux protects system processes through the use of control groups cgroups which impose resource consumption limits on resourceintensive customer applications 1691 cgroup profiles cgroup profiles define how usage limits are applied on the sr linux cgroup profiles are supported for cpu and memory and are defined in cgroupprofilejson configuration files sr linux provides a default cgroup profile customers can configure additional cgroup profiles 16911 default cgroup profile the sr linuxprovided default cgroup profile is located in the optsrlinuxappmgrcgroup profilejson directory note editing the default cgroup profile is not recommended if the default cgroup profile fails to parse or be read by the appmgr the sr linux does not start the default cgroupprofilejson file definition is shown below  profiles   name workloadprimary path workloadsliceprimary controller  memory  max 08 swapmax 0 low 0  cpu  weight 10000 period 100000 quota 0  cpuset  cpus  mems   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 213 spacer text configuration basics release 226 sr linux applications    name workloaddatapath path workloadslicedatapath controller  memory  max 08 swapmax 0 low 0  cpu  weight 10000 period 100000 quota 0  cpuset  cpus all mems      name workloadsecondary path workloadslicesecondary controller  memory  max 05 swapmax 0 low 0  cpu  weight 10000 period 100000 quota 0  cpuset  cpus  mems      name userdefault path userslicedefault controller  memory  max 025 swapmax 0 low 0  cpu  weight 1000 period 100000 quota 0  cpuset  cpus  mems       3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 214 spacer text configuration basics release 226 sr linux applications table 15 default cgroup profile parameters describes the default cgroup profile parameters table 15 default cgroup profile parameters parameter description name the cgroup profile name type string path the cgroup directory path relative to a unified root path a typical unified root path is sysfscgroup or mntcgroupunified type string controller the memory controller configuration max this number denotes the percentage of total memory the actual memory value is calculated as max  totalmemory and is set in the memorymax interface file of the cgroup if the value is 0 this configuration is ignored the range is from 0 to 1 the default is 08 low this number denotes the percentage of total memory the actual memory value is calculated as max  totalmemory and is set in the memorylow interface file of the cgroup the range is from 0 to 1 the default is 08 cpu the cpu controller configuration weight this value is set in the cpuweight interface file of the cgroup the range is from 1 to 10 000 the default is 100 period this value specifies a period of time in microseconds for how regularly a cgroups access to cpu resources should be reallocatedthis value is set in the cpumax interface file of the cgroup the range is from 1000 to 1 000 000 the default is 100 000 quota this value specifies the total length of time in microseconds for which all tasks in a cgroup can run during one period as defined in the period parameter if quota is set to 0 it translates to max in the cpumax interface file the range is from 1000 to 1 000 000 the default is max cpuset cpu usage information for the cgroup cpus this value indicates the cpus used by the cgroup this can be  meaning use all cpus except for the isolated cpus this is the default the value all means include the isolated cpus for cgroup usage the value x yz where x y and z are cpu numbers means use a specific cpu or a range of cpus mems this value is used for scheduling multiple numa nonuniform memory access aware applications in the cgroup 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 215 spacer text configuration basics release 226 sr linux applications 16912 customerdefined cgroup profile customers can configure cgroup profiles in the etcoptsrlinuxappmgrcgroupprofilejson directory the appmgr creates this directory at boot up if it does not exist if a customerdefined cgroup profile fails to load the system continues to function and applications that are loaded into the customer cgroup are loaded using nokia defaults listed below  nokiawritten applications run in the workloadsliceprimary cgroup along with any processes that are started by linuxadmin including srcli  nonnokiawritten applications run in the workloadslicesecondary cgroup if a customer builds an application and launches it using the appmgr without specifying a cgroup the application runs in this cgroup  all interactive user applications run in the userslicedefault cgroup including srcli when not started by linuxadmin the admin user is treated as any other user in the system its processes fall into the userslicedefault cgroup 1692 configuring a cgroup customers can configure up to three cgroups in the etcoptsrlinuxappmgrcgroup profilejson directory customer applications are assigned to these groups any more than three configured cgroups are ignored the depth of cgroups is limited to two levels where for example workload is one level and primarysecondary are two levels any levels beyond this are also ignored if a cgroup with the same name is used in multiple customerdefined profiles the system ignores it and uses the cgroup defined in the default profile 16921 cgroup configuration example about this task the following example shows the configuration of two customerdefined cgroups one for a lightweight database that needs priority access to resources and one for storing the users of the database the steps and the outputs are described below the configuration above created two cgroup profiles one for the database slice and one for the frontend slice the profile for the database slice is configured to limit the database to 50 of system memory the profile for the frontend slice is configured to limit the web front end to 20 of system memory in addition both cgroup profiles are configured to limit cpu resources for their respective cgroup the database server cpu is weighted at 10000 the maximum cpu weight and the frontend server cpu is weighted at 5000 half the cpu weight of the database the weights are added together and each group is allocated its ratio of cpu as a proportion of the sum the periods are kept the same and no guaranteed cpu is granted procedure step 1 install the application including the yaml binary file and optional yang module in this example yaml defines two applications dtwdatabase and dtwfrontend these applications are placed into their own cgroups distributethewebslicedatabase and distributethewebslicefrontend 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 216 spacer text configuration basics release 226 sr linux applications the appmgr creates the cgroups the output below shows the installation of the database and a web front end dtwdatabase path optdistributethewebbin launchcommand rundb searchcommand rundb failurethreshold 100 failureaction wait60 cgroup distributethewebslicedatabase oomscoreadj 500 yangmodules names  database sourcedirectories  optdistributethewebyang dtwfrontend path optdistributethewebbin launchcommand runfrontend searchcommand runfrontend failurethreshold 100 failureaction wait60 cgroup distributethewebslicefrontend oomscoreadj 200 yangmodules names  frontend sourcedirectories  optdistributethewebyang step 2 configure the cgroup profiles in the etcoptsrlinuxappmgrcgroupprofilejson directory the output below shows the configuration  profiles   name distributethewebdatabase path distributethewebslicedatabase controller  memory  max 05 swapmax 0 low 0  cpu  weight 10000 period 100000 quota 0     name distributethewebfrontend path distributethewebslicefrontend controller  memory  max 02 swapmax 0 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 217 spacer text configuration basics release 226 sr linux applications low 0  cpu  weight 5000 period 100000 quota 0      1693 kernel lowmemory killer the kernel lowmemory killer driver monitors the memory state of a running system it reacts to high memory pressure by killing the least essential processes to keep the system performing at acceptable levels when the system is low in memory and cannot find free memory space the outofmemory function is called the outofmemory function makes memory available by killing one or more processes when an outofmemory oom failure occurs the outofmemory function is called and it obtains a score from the selectbadprocess function the process with the highest score is the one that is killed some of the criteria used to identify a bad process include the following  the kernel needs a minimum amount of memory for itself  try to reclaim a large amount of memory  do not kill a process that is using a small amount of memory  try to kill the minimum number of processes  algorithms that elevate the sacrifice priority on processes the user wants to kill in addition to this list the oom killer checks the outofmemory oom score the oom killer sets the oom score for each process and then multiplies that value by memory usage the processes with higher values have a high probability of being terminated by the oom killer 16931 sr linux process kill strategy the kernel calculates the oomscore using the formula 10  percentage of memory used by the process the maximum score is 10  100  1000 the oomscore of a process can be found in the proc directory procpidoomscore an oomscore of 1000 means the process is using all the memory an oomscore of 500 means it is using half the memory and an oomscore of 0 means it is using no memory the oom killer checks the oomscoreadj file in the procpidoomscoreadj directory to adjust its final calculated score the default value is 0 the oomscoreadj value can range from 1000 to 1000 a score of 1000 results in a process using 100 of the memory and in not being terminated by the oom killer however a score of 1000 causes the linux kernel to terminate the process even when it uses minimal memory a score of 100 results in a process using 10 of the memory before it is considered for termination as its score remains 0 until its unadjusted score reaches 100 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 218 spacer text configuration basics release 226 sr linux applications the oomscoreadj value for each process is defined in its corresponding yaml definition file the system groups the processes based on their score which the sr linux oom killer uses as the hierarchy for terminating a rogue process as follows  group1  998 for processes that should never be killed such as appmgr idbserver and all processes on the imm  group2  200 for processes that ideally should not be killed because doing so has a substantial impact on the system such as mgmtserver chassismgr and netinstmgr a score of 200 means the process gets to use 20 of the memory before their memory use starts being counted  group3  0 for process that should be killed if they are using too much memory such as bgp isis and ospf  group4  500 for processes that should be preferentially killed such as cli and oammgr table 16 oom adjust score per process lists the oom adjust score for each process table 16 oom adjust score per process process name oom adjust score aaamgr aclmgr appmgr sarpndmgr bfdmgr bgpmgr chassismgr devmgr dhcpclientmgr dhcprelaymgr ethswitchmgr evpnmgr fibmgr gnmiserver idbserver isismgr jsonrpc l2maclearnmgr 0 0 998 200 200 0 200 200 0 0 200 0 0 500 998 0 500 0 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 219 spacer text configuration basics release 226 sr linux applications process name oom adjust score l2macmgr l2staticmacmgr lagmgr linuxmgr lldpmgr logmgr mcidmgr mgmtserver mplsmgr netinstmgr oammgr ospfmgr plcymgr qosmgr sdkmgr sflowsamplemgr sshdmgmt staticroutemgr supportd timesrv vrrpmgr vxlanmgr xdpcpm 0 0 0 0 0 0 0 200 0 200 500 0 0 0 500 500 0 0 0 0 0 0 200 1694 application manager extensions for cgroups the cgroup feature provides two additional parameters in the appmgr yaml file the cgroup parameter and the oomscoreadj parameter the appmgr uses the cgroup parameter to launch an application within a specific cgroup a valid value for the cgroup parameter is the path of a cgroup as specified in the cgroup profile equivalent to  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 220 spacer text configuration basics release 226 sr linux applications profilesnamepath from the cgroupv2 root if this cgroup does not exist the appmgr launches the user application from the default cgroup profile path workloadslicesecondary the appmgr uses the oomscoreadj parameter to set the outofmemory adjust score for a process this score is fed into the sr linux oom killer valid oomscoreadj scores are any value in the range of 1000 to 1000 a process with a score of 1000 is least likely to be killed while a process with a score of 1000 is most likely to be killed at 1000 a process can use 100 of memory and still avoid being terminated by the oom killer however sr linux kills the process more frequently the cgroup parameter and the oomscoreadj parameter are shown in the output below bgpmgr path srlinuxbinaryinstallprefix launchcommand yamllaunchenvironment srbgpmgr searchcommand srbgpmgr oomscoreadj 0 waitforconfig yes author nokia restrictedoperations reload cgroup workloadsliceprimary yangmodules names  srlnokiabgp  srlnokiabgpvpn  srlnokiaribbgp  srlnokiasystemnetworkinstancebgpvpn tools  srlnokiatoolsbgp sourcedirectories  srlinuxfileinstallprefixmodelsietf  srlinuxfileinstallprefixmodelssrlnokiamodelscommon  srlinuxfileinstallprefixmodelssrlnokiamodelsinterfaces  srlinuxfileinstallprefixmodelssrlnokiamodelsnetwork instance  srlinuxfileinstallprefixmodelssrlnokiamodelsroutingpolicy  srlinuxfileinstallprefixmodelssrlnokiamodelssystem 1695 debugging cgroups cgroup debugging capability is available through  sr linux cli commands  linuxprovided cli commands 16951 sr linux cgroup debugging commands the sr linux provides cli commands to perform the following     check the usage of existing cgroups show information about the oom adjust score of applications managed by the appmgr show information about the cgroups that are associated with the applications that are managed by the appmgr list all of the applications associated with a specified cgroup 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 221 spacer text configuration basics release 226 sr linux applications 169511 checking existing cgroup usage the output below is an example of checking existing cgroup usage  running    info from state platform control a cgroup  platform  control a  cgroup mntcgroupunifieduserslicedefault  memorystatistics  current 0 currentswap 0 anon 0 kernelstack 0 slab 0 sock 0 anonthp 0 file 0 filewriteback 0 filedirty 0  cpuacctstatistics  user 0 system 0   cgroup mntcgroupunifiedworkloadsliceprimary  memorystatistics  current 1621110784 currentswap 0 anon 1327427584 kernelstack 2396160 slab 12939264 sock 151552 anonthp 855638016 file 250916864 filewriteback 0 filedirty 0  cpuacctstatistics  user 22082989551 system 11252275018   cgroup mntcgroupunifiedworkloadslicesecondary  memorystatistics  current 7827456 currentswap 0 anon 4501504 kernelstack 73728 slab 2453504 sock 8192 anonthp 0 file 0 filewriteback 0 filedirty 0  cpuacctstatistics  user 34323091 system 12342430   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 222 spacer text configuration basics release 226 sr linux applications   169512 showing current oom adjust scores the output below is an example of showing information about the current oom adjust scores for all applications that are managed by the appmgr  running    info from state system appmanagement application  oomscoreadj system  appmanagement  application aaamgr  oomscoreadj 0  application aclmgr  oomscoreadj 0  application appmgr  oomscoreadj 998  application arpndmgr  oomscoreadj 200     application vxlanmgr  oomscoreadj 0  application xdplc1  oomscoreadj 200    169513 showing cgroup information the output below is an example of showing information about cgroups that are associated with applications managed by the appmgr  running    info from state system appmanagement application  cgroup system  appmanagement  application aaamgr  cgroup mntcgroupunifiedworkloadsliceprimary  application aclmgr  cgroup mntcgroupunifiedworkloadsliceprimary  application arpndmgr  cgroup mntcgroupunifiedworkloadsliceprimary  application bgpmgr  cgroup mntcgroupunifiedworkloadsliceprimary   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 223 spacer text configuration basics release 226 sr linux applications   application sshdmgmt  cgroup mntcgroupunifiedworkloadslicesecondary  application supportd  cgroup mntcgroupunifiedworkloadsliceprimary  application vxlanmgr  cgroup mntcgroupunifiedworkloadsliceprimary  application xdplc1  cgroup mntcgroupunifiedworkloadsliceprimary    169514 listing all the applications associated with a specified cgroup use the tools system cgroup command pgrep cgroup cgroupname command to list all the applications associated with a specified group the output below shows an example  running    tools system cgroup command pgrep cgroup workloadsliceprimary   pid  process    3373  srappmgr   3385  srsupportd   3402  srdevicemgr   3460  sridbserver   3471  sraaamgr   3482  sraclmgr   3518  srarpndmgr   3542  srchassismgr   3560  srdhcpclientmgr   3574  srevpnmgr   3586  srfibmgr   3598  srl2maclearnmgr   3611  srl2macmgr   3621  srlagmgr   3631  srlinuxmgr   3641  srlogmgr   3651  srmcidmgr   3681  srmgmtserver   3702  srnetinstmgr   3724  sroammgr   3743  srsdkmgr   3753  srsflowsamplemgr   3772  srxdplc1   3874  sudo   3895  sudo   3902  sudo   3921  sudo   3930  srqosmgr   3953  srgnmiserver   3979  srjsonrpc   3990  srvxlanmgr   16740  srjsonwkr   16742  python3   17013  python3  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 224 spacer text configuration basics release 226 sr linux applications  18474  srjsonwkr   18478  python3   18671  python3   20671  srlldpmgr   21177  srbgpmgr   21190  srplcymgr   12753  srl2staticmacmgr   27353  rsyslogd   9777  python   16952 linuxprovided cgroup debugging commands the following linuxprovided cli commands are available for debugging cgroups   the systemdcgls command the systemdcgtop command the systemdcgls command dumps the cgroup hierarchy the output below shows an example of the systemdcgls command linuxadminsrlinux unified systemdcgls 1 usrlibsystemdsystemd switchedroot system deserialize 22 systemslice rngdservice  2725 sbinrngd f systemdudevdservice  868 usrlibsystemdsystemdudevd systemserialx2dgettyslice  serialgettyttys0service  1120 login  linuxadmin  8320 bash  9262 sendacct systemdcgls  9263 systemdcgls  9264 less srlinuxservice   3092 usrbinsudo optsrlinuxbinsrlinux   3120 runuser user srlinux group srlinux  optsrlinuxbinsrlinux   4019 binbash optsrlinuxbinsrlinux userenvswitched   4039 srappmgr   4051 srsupportd servermode   4068 srdevicemgr   4219 sridbserver   4229 srethswitch   4288 sraaamgr   4299 sraclmgr   4314 srarpndmgr   4324 srchassismgr   4337 srdhcpclientmgr   4365 srevpnmgr   4381 srfibmgr   4395 srl2maclearnmgr   4411 srl2macmgr   4423 srlagmgr   4445 srlinuxmgr   4494 srlogmgr   4510 ntpd c etcntpsconf g   4526 srmcidmgr   4574 srmgmtserver   4608 srnetinstmgr   4626 sroammgr 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 225 spacer text configuration basics release 226 sr linux applications   4640 srsdkmgr   4658 srsflowsamplemgr   4681 srxdpcpm   5197 usrbinsudo enu root usrbinsudo enu gnmirpc bash c srgnmi   5224 usrbinsudo enu root usrbinsudo enu jsonrpc bash c srjson   5243 usrbinsudo enu gnmirpc bash c srgnmiserver   5248 srqosmgr   5261 usrbinsudo enu jsonrpc bash c srjsonrpc   5290 srgnmiserver   5302 srjsonrpc   5693 usrsbinsshd f etcsshsshdconfigmgmt   6361 usrsbinrsyslogd i varrunsrlinuxrsyslogdpid  21936 srbfdmgr  22018 srbgpmgr  22132 srisismgr  22242 srlldpmgr  22321 srmplsmgr  22437 srospfmgr  22588 srplcymgr  22701 srstaticroutemgr  22796 srjsonwkr  22797 python3 m srlinuxmgmtjsonrpcjsonrpcservermain bind40  22953 ntpd c etcmntpconf g  23023 python3 m srlinuxmgmtjsonrpcjsonrpcservermain bind40  23736 srjsonwkr  23741 python3 m srlinuxmgmtjsonrpcjsonrpcservermain bind40  24009 python3 m srlinuxmgmtjsonrpcjsonrpcservermain bind40  27488 dnsmasq conffileetcdnsmasqconf polkitservice  2701 usrlibpolkit1polkitd nodebug ztpapiservice  1114 optsrlinuxztpvirtualenvbinpython m ztpztphttp systemdjournaldservice  840 usrlibsystemdsystemdjournald sshdservice  985 usrsbinsshd d crondservice  1133 usrsbincrond n srwatchdogservice  1155 srwd dbusservice  991 usrbindbusdaemon system addresssystemd nofork nopidfile systemdlogindservice 1062 usrlibsystemdsystemdlogind the systemdcgtop command dumps the current usage of each cgroup the output below shows an example of the systemdcgtop command path tasks cpu memory inputs outputs  186     systemslicecrondservice 1     systemslicedbusservice 1     systemslicepolkitservice 1     systemslicerngdservice 1     systemslicesrwatchdogservice 1     systemslicesrlinuxservice 53     systemslicesshdservice 1     systemslicialgettyttys0service 3     systemslicesystemdjournaldservice 1     systemslicesystemdlogindservice 1     systemslicesystemdudevdservice 1     systemsliceztpapiservice 1     3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 226 spacer text configuration basics release 226 mirroring 17 mirroring mirroring copies ipv4 and ipv6 packets seen on a specified source such as an interface port or subinterface vlan or matching an acl entry and sends the packets to a specific destination such as a locally attached traffic analyzer or a tunnel toward a remote destination by default the mirrored packets include ipv4ipv6 headers as well as ethernet headers traffic from multiple sources can be mirrored to a single destination although traffic from a specific source cannot be mirrored to multiple destinations 171 mirror sources the source for mirrored traffic can be an interface or subinterface or an acl filter  interfaces  subinterfaces a mirror source can be an interface including all subinterfaces within that interface the source can be a single interface for example interface ethernet11 or a lag for example interface lag1 either a lag member or lag port can be mirrored when a lag port is configured as a mirror source mirroring is enabled on all ports making up the lag the source can be a specific vlan that is a subinterface within an interface where vlan tagging is enabled for example interface ethernet111 or lag11 you can configure mirroring for traffic in a specific direction ingress only egress only or bidirectional traffic both ingress and egress  acl filters a mirror source can be an ipv4 or ipv6 acl filter applied under one or more subinterfaces traffic matching entries in the filter regardless of whether the action is accept or drop can be mirrored to the destination on 7220 ixrd2d2ld3d3l systems mirroring from acl filters is supported in the ingress direction only 172 mirror destinations traffic from the mirror source can be copied to a local destination local mirroring or encapsulated into a tunnel to a remote destination remote mirroring local mirroring in a local mirroring configuration both the mirror source and mirror destination reside on the same sr linux node as shown in figure 7 local mirroring in this configuration the local destination is a switched port analyzer span 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 227 spacer text configuration basics release 226 mirroring figure 7 local mirroring remote mirroring in a remote mirroring configuration the mirror source and mirror destination are on different nodes the mirror source resides on the sr linux node and the mirrored packets are encapsulated into a tunnel toward the mirror destination figure 8 remote mirroring shows a remote mirroring configuration in this configuration the remote destination is an encapsulated remote switched port analyzer erspan tunnel end points are defined within a specific networkinstance where the local tunnel endpoint ip address can be either a loopback subinterface address or any subinterface address within that network instance figure 8 remote mirroring mirroring to underlay erspangre in a mirroring to underlay erspangre configuration the mirrored packets including ipv4ipv6 header as well as ethernet header are tunneled using transparent ethernet bridging gre protocol type 0x6558 or l2ogre toward the remote destination figure 9 mirroring to underlay shows a mirroring to underlay configuration 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 228 spacer text configuration basics release 226 mirroring figure 9 mirroring to underlay 173 configuring mirroring to configure mirroring you configure a mirroringinstance which specifies the source and destination for the mirrored traffic multiple mirror sources can have a single destination although traffic from a specific source cannot be mirrored to multiple destinations only one mirror destination can be configured per mirroringinstance a mirror destination cannot be reused in multiple mirroring instances within a mirroringinstance if an interface is configured as mirror source a subinterface within that interface cannot be added as another mirror source if a lag is defined as mirror destination only the first 8 members of the lag carry mirrored traffic mirrored traffic is considered best effort be forwarding class 1731 configuring mirroring sources to configure mirroring you specify the source and destination for mirrored traffic within a mirroring instance the source in a mirroringinstance can be traffic on a specified interface subinterface or lag or can be packets matching an acl entry example interface source the following example shows a mirroringinstance configuration with an interface as the source for mirrored traffic   candidate shared default    info system mirroring system  mirroring  mirroringinstance 1  adminstate enable mirrorsource  interface ethernet15  direction ingressegress 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 229 spacer text configuration basics release 226 mirroring      example acl source the following example configures an acl with an entry that matches tcp packets and applies the acl to a subinterface a mirroringinstance is configured that uses packets matching the acl as the source for mirrored traffic   candidate shared default    info acl ipv4filter iptcp acl  ipv4filter iptcp  entry 1000  description matchtcpprotocol action  accept    match  protocol tcp       candidate shared default    info interface ethernet11 subinterface 1 acl interface ethernet11  subinterface 1  acl  input  ipv4filter iptcp       candidate shared default    info system mirroring system  mirroring  mirroringinstance 1  adminstate enable mirrorsource  acl iptcp  entry 1000      3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 230 spacer text configuration basics release 226 mirroring 1732 configuring mirroring destinations in a mirroringinstance you specify the destination for the mirrored traffic the mirroring destination can be a local destination residing on the same sr linux node as the mirroring source or a remote destination where the mirrored traffic is sent via a tunnel the tunneled traffic can be encapsulated using transparent ethernet bridging gre protocol type 0x6558 or l2ogre example local destination the following enables a subinterface to be a local mirror destination   candidate shared default    info from running interface ethernet14 subinterface 1 interface ethernet14  subinterface 1  type localmirrordest adminstate enable vlan  encap  singletagged  vlanid 1127    localmirrordestination  adminstate enable    the following configures a mirroringinstance where traffic from the mirror source is mirrored to the subinterface enabled as a local mirror destination   candidate shared default    info system mirroring system  mirroring  mirroringinstance 1  adminstate enable mirrorsource  interface ethernet21  direction ingressegress   mirrordestination  local ethernet141     example remote destination using underlay the following example configures a mirroringinstance that specifies the mirrored traffic be encapsulated into a tunnel within a networkinstance the mirrored traffic is encapsulated into a tunnel using l2ogre to the remote destination   candidate shared default    info system mirroring system  3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 231 spacer text configuration basics release 226 mirroring mirroring  mirroringinstance 1  adminstate enable mirrorsource  interface ethernet21  direction ingressegress   mirrordestination  remote  encap l2ogre networkinstance ipvrf1  tunnelendpoints  srcipv4 192168153 dstipv4 1921681153        174 displaying mirroring information use the info from state command to display mirroring configuration information example   candidate shared default    info from state system mirroring mirroringinstance 2 system  mirroring  mirroringinstance 2  adminstate enable operstate down operdownreason localmirrorsubifdown mirrorsource  interface lag1  direction ingressegress   mirrordestination  local lag251     175 displaying mirroring statistics you can use the info from state command to display the outgoing mirrored packetsoctets per interface example   candidate shared default   3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 232 spacer text configuration basics release 226 mirroring  info from state interface ethernet11 statistics  grep mirror outmirroroctets 0 outmirrorpackets 0 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 233 spacer text configuration basics release 226 uft profiles 18 uft profiles the processors in 7220 ixrd1 7220 ixrd2d3 and 7220ixr h2h3 systems use shared memory tables known as unified forwarding tables ufts with ufts the processor has a set of shared banks that can be partitioned to support the following types of forwarding table entries  learned mac addresses   ip host entries ip longestprefixmatch routes the default settings for the shared bank allocations can be changed by modifying the uft profile for the system 181 shared bank partitioning for sr linux systems the number of shared banks the size of each shared bank and the way they can be divided depend on the sr linux system as described in table 17 shared bank configuration for sr linux systems table 17 shared bank configuration for sr linux systems sr linux system shared bank configuration 7220 ixrd1 6 shared banks 16k singlewidesw or 8k doublewidedw entries per shared bank  1 sw entry can store 1 ipv4 host entry or 1 mac address  1 dw entry can store 1 ipv6 host entry  if a bank has any dw entry it is forced into dw mode if alpm is enabled it requires 4 shared banks each of the remaining banks can be allocated to either ip host entries or mac addresses 7220 ixrd2d3 8 shared banks 32k singlewide of 16k doublewide entries per shared bank  1 sw entry can store 1 ipv4 host entry or 1 mac address  1 dw entry can store 1 ipv6 host entry  if a bank has any dw entry it is forced into dw mode alpm can be enabled in 8bank highscale mode each of the remaining banks if there are any can be allocated to either ip host entries or mac addresses 7220 ixrh2h3 8 shared banks 8k entries per shared bank 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 234 spacer text configuration basics release 226 uft profiles sr linux system shared bank configuration alpm is enabled by default alpm uses all of the shared banks 182 lpm table partitioning ip fib scale depends significantly on the number of uft banks used for alpm but also depends on the partitioning of the hardware lpm table which is an alwayspresent tcam  sram table that stores ip lpm route entries when alpm is not active ip fib scale is entirely determined by the size and partitioning of this table when alpm is active the hardware lpm table is used as a firstsearch table into the alpm banks so it also plays an important role if the ipv6128bitlpmentries parameter is configured to be greater than zero the hardware lpm table is partitioned into two subblocks a singlewide subblock and a doublewide subblock  the singlewide subblock can store ipv4 routes each consuming half of a singlewide entry and ipv6 routes up to 64 prefix length each consuming a singlewide entry  the size of the doublewide subblock is controlled by the ipv6128bitlpmentries parameter and this subblock can store ipv6 routes up to 128 prefix length each consuming a doublewide entry it can also store ipv4 routes and ipv6 routes up to 64 prefix length inside the doublewide subblock ipv4 routes consume half of a singlewide entry and ipv6 routes up to 64 prefix length require a doublewide entry 183 default uft allocations for sr linux systems the default uft shared bank allocations and hardware lpm table parameters for each sr linux system are summarized in table 18 default uft allocations and hardware lpm table parameters table 18 default uft allocations and hardware lpm table parameters sr linux system default uft allocations and l3defip table parameters 7220 ixrd1 extra ip host shared banks 3 extra mac address shared banks 3 alpm disabled ipv6128bitlpmentries 1024 7220 ixrd2d3 extra ip host shared banks 4 extra mac address shared banks 4 alpm disabled ipv6128bitlpmentries 2048 7220 ixrh2h3 alpm enabled ipv6128bitlpmentries 512 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 235 spacer text configuration basics release 226 uft profiles 184 configuring a uft profile you can change the settings for the uft shared bank allocations and hardware lpm table parameters from the defaults listed in table 18 default uft allocations and hardware lpm table parameters by modifying the system uft profile to change the settings for the uft shared bank allocations and hardware lpm table parameters from the defaults modify the system uft profile as shown in the following example example this example configures a uft profile for a 7220 ixrd1 system the uft profile enables alpm and configures 32k extra ip host entries from the uft shared banks   candidate shared default    info platform resourcemanagement unifiedforwardingresources platform  resourcemanagement  unifiedforwardingresources  alpm enabled requestedextraiphostentries 32768 ipv6128bitlpmentries 1024    note uft profile configuration changes do not take effect immediately when the changes are committed they take effect the next time xdp is restarted 185 displaying uft profile information use the info from state command to display the uft profile including the extra number of host entries and mac address entries allocated from uft shared banks example   candidate shared default    info from state platform resourcemanagement unifiedforwardingresources platform  resourcemanagement  unifiedforwardingresources  xdprestartrequired true alpm enabled requestedextraiphostentries 32768 allocatedextraiphostentries 32768 allocatedextramacentries 0 ipv6128bitlpmentries 1024    in the example the xdprestartrequired leaf is shown as true if a change has been committed to one or more of the configurable values in the unifiedforwardingresources container but xdp 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 236 spacer text configuration basics release 226 uft profiles has not yet been restarted until xdp is restarted the operational values are still the values initialized at the last xdp restart 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 237 spacer text configuration basics release 226 maintenance mode 19 maintenance mode sr linux maintenance mode allows you to take a network element out of service so that maintenance actions can be performed for example to upgrade the software image on a router using sr linux maintenance mode you can do this with minimal impact on traffic sr linux maintenance mode works as follows 1 a maintenance group is configured that specifies the resources to be taken out of service see configuring a maintenance group 2 a maintenance profile is configured that specifies policy changes to apply when the group is in maintenance mode a maintenance profile is associated with each maintenance group see configuring a maintenance profile the usual intent of the policy changes is to depreference paths through the maintenance group so that traffic is diverted elsewhere 3 the maintenance group is placed into maintenance mode which applies the policies in the associated maintenance profile see placing a maintenance group into maintenance mode 4 the user monitors the traffic on the interfaces in the maintenance group when the traffic rate falls below a threshold the user shuts down the members of the maintenance group and performs the required service see taking a maintenance group out of service 5 after the service is completed the user takes the maintenance group out of maintenance mode which disables the policies in the associated maintenance profile and restores traffic on the original paths see restoring the maintenance group to service 191 configuring a maintenance group a maintenance group specifies a set of network resources to be taken out of service when maintenance mode is enabled for example a maintenance group can consist of one or more bgp neighbors or peer groups belonging to a one or more network instances specify a set of network resources in a maintenance group the network resources in the maintenance group are taken out of service when maintenance mode is enabled example the following example configures maintenance group mgroup1 consisting of the bgp neighbors in peer group headquarters1 which exists in the default network instance as well as bgp neighbors in peer group headquarters2 which exists in network instance black in the example maintenance group mgroup1 is associated with maintenance profile mprof1  candidate shared default    info system maintenance system  maintenance  group mgroup1  maintenanceprofile mprof1 maintenancemode  adminstate disable 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 238 spacer text configuration basics release 226 maintenance mode  members  bgp  networkinstance default  peergroup  headquarters1  networkinstance black  peergroup  headquarters2        192 configuring a maintenance profile a maintenance profile specifies policy changes that are applied to members of a maintenance group when maintenance mode is enabled for the group the following example configures a routing policy and a maintenance profile that references the routing policy example the following example defines the routing policy drainwithaspathprepend  candidate shared default    info routingpolicy policy drainwithaspathprepend routingpolicy  policy drainwithaspathprepend  defaultaction  accept  bgp  aspath  prepend  asnumber auto repeatn 3        the following example defines a maintenance profile that references the routing policy drainwithaspath prepend  candidate shared default    info system maintenance system  maintenance  profile mprof1  bgp  importpolicy drainwithaspathprepend 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 239 spacer text configuration basics release 226 maintenance mode exportpolicy drainwithaspathprepend     193 placing a maintenance group into maintenance mode when a maintenance group is placed into maintenance mode it applies the policies in the associated maintenance profile to the resources in the maintenance group to place a maintenance group into maintenance mode change the setting for maintenancemode in the group configuration to enable then commit the configuration example the following example enables maintenance mode for maintenance group mgroup1 and commits the configuration the policies configured in the maintenance profile associated with mgroup1 are applied to the resources configured in mgroup1  candidate shared default    info system maintenance group mgroup1 system  maintenance  group mgroup1  maintenancemode  adminstate enable       candidate shared default    commit stay all changes have been committed starting new transaction 194 taking a maintenance group out of service after enabling maintenance mode for a maintenance group monitor the traffic on the interfaces in the group when the traffic rate drops to an acceptable level shut down the members of the maintenance group and perform the required service monitor traffic for an interface using the info from state command to show interface traffic statistics when the traffic rate reaches a lowenough level administratively disable the interface example to monitor an interface  running    info from state interface ethernet12 statistics interface ethernet12  statistics  inoctets 46969 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 240 spacer text configuration basics release 226 maintenance mode inunicastpkts 492 inbroadcastpkts 0 inmulticastpkts 34 indiscards 0 inerrors 0 inunknownprotos 0 infcserrors 0 outoctets 46169 outunicastpkts 490 outbroadcastpkts 1 outmulticastpkts 25 outdiscards 0 outerrors 0 carriertransitions 1 to shut down the interface   candidate shared default    interface ethernet12 adminstate disable  commit stay all changes have been committed starting new transaction 195 restoring the maintenance group to service after performing the required maintenance operations restore the maintenance group to service to restore the maintenance group to service change the setting for the maintenancemode state in the group configuration to disable then commit the configuration example the following example takes maintenance group mgroup1 out of maintenance mode  candidate shared default    info system maintenance group mgroup1 system  maintenance  group mgroup1  maintenancemode  adminstate disable       candidate shared default    commit stay all changes have been committed starting new transaction 3he 18781 aaaa tqzza  2022 nokia use subject to terms available at wwwnokiacomterms 241 spacer text customer document and product support customer documentation customer documentation welcome page technical support product support portal documentation feedback customer documentation feedback nokia service router linux release 247 configuration basics guide 3he 20653 aaaa tqzza edition 01 july 2024  2024 nokia use subject to terms available at wwwnokiacomterms nokia is committed to diversity and inclusion we are continuously reviewing our customer documentation and consulting with standards bodies to ensure that terminology is inclusive and aligned with the industry our future customer documentation will be updated accordingly this document includes nokia proprietary and confidential information which may not be distributed or disclosed to any third parties without the prior written consent of nokia this document is intended for use by nokias customers youyour in connection with a product purchased or licensed from any company within nokia group of companies use this document as agreed you agree to notify nokia of any errors you may find in this document however should you elect to use this document for any purposes for which it is not intended you understand and warrant that any determinations you may make or actions you may take will be based upon your independent judgment and analysis of the content of this document nokia reserves the right to make changes to this document without notice at all times the controlling version is the one available on nokias site no part of this document may be modified no warranty of any kind either express or implied including but not limited to any warranty of availability accuracy reliability title non infringement merchantability or fitness for a particular purpose is made in relation to the content of this document in no event will nokia be liable for any damages including but not limited to special direct indirect incidental or consequential or any losses such as but not limited to loss of profit revenue business interruption business opportunity or data that may arise from the use of this document or the information in it even in the case of errors in or omissions from this document or its content copyright and trademark nokia is a registered trademark of nokia corporation other product names mentioned in this document may be trademarks of their respective owners the registered trademark linux is used pursuant to a sublicense from the linux foundation the exclusive licensee of linus torvalds owner of the mark on a worldwide basis  2024 nokia configuration basics guide release 247 table of contents table of contents 1 about this guide 9 11 precautionary and information messages9 12 conventions 9 2 whats new 11 3 system management12 31 configuring a hostname 12 32 configuring a domain name12 33 configuring dns settings13 331 configuring preferred source address for dns requests 14 34 configuring the management networkinstance 14 35 access types 15 351 enabling an ssh server 15 3511 configuring ssh keybased authentication 16 352 ssh host keys 17 3521 host key authentication and preservation 17 353 ssh certificates19 3531 configuring ca public key trustanchors19 3532 configuring ssh principals20 3533 configuring host certificate 21 3534 trusting ca public key22 3535 configuring revoked key list 22 3536 viewing an ssh certificate 23 354 configuring ftp 24 36 configuring banners 25 37 synchronizing the system clock25 38 configuring preferred source address for ntp requests26 39 configuring snmp27 310 ip ecmp load balancing 27 3101 configuring ip ecmp load balancing 28 311 powering down the system 28 312 configuring reboot options 29 3121 delay 29 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 3 configuration basics guide release 247 table of contents 3122 cancel 30 3123 force30 3124 message 30 3125 warm 33 313 nonstop forwarding 33 3131 triggering redundancy switchover 34 3132 forcing redundancy synchronization 35 314 vrrp 35 3141 configuring vrrp 35 4 configuration management 38 41 default configuration38 42 configuration datastores 38 43 configuration modes 39 431 configuration candidates39 432 setting the configuration mode 39 44 committing a configuration in candidate mode 40 441 confirming a commit operation41 442 validating a commit operation42 443 updating the baseline datastore 42 45 deleting a configuration 43 46 annotating the configuration 43 47 discarding a configuration in candidate mode45 48 displaying configuration details45 49 displaying the configuration state 47 410 saving a configuration to a file 49 411 loading a configuration 49 412 executing configuration statements from a file50 413 configuration checkpoints 50 4131 generating a checkpoint 51 4132 loading a checkpoint 51 4133 reverting to a previous checkpoint 52 4134 clearing a checkpoint 52 4135 configuring maximum number of checkpoints53 4136 displaying checkpoint information 53 414 rescue configuration53 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 4 configuration basics guide release 247 table of contents 4141 saving a rescue configuration 54 4142 clearing a rescue configuration 54 415 configuration upgrades 55 4151 upgrading configuration files 55 5 securing access 56 51 user types 56 511 linux users 56 512 local users 56 513 remote users 56 52 aaa functions 57 521 authentication 57 5211 superuser attribute for local users 57 5212 password security for local users57 5213 password hashing for local users58 522 authorization58 5221 superuser role attribute for local users 59 523 accounting 59 53 aaa server group configuration 60 531 configuring an aaa server group60 54 authentication for the linuxadmin user62 541 configuring the password for the linuxadmin user 62 55 authentication for local users63 551 configuring authentication for local users 63 552 configuring superuser attribute for local users64 553 configuring password security for local users 65 554 configuring hashmethod for local user passwords 67 555 clearing lockedout local users68 56 authorization using rolebased access control 69 561 role configuration 69 5611 configuring a role 70 5612 configuring superuser role for local users 71 562 assigning roles to users 72 563 authorization using a tacacs server73 5631 configuring tacacs authorization 74 564 authorization using a radius server 76 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 5 configuration basics guide release 247 table of contents 5641 configuring radius authorization 76 565 service authorization77 5651 configuring service authorization 78 566 cli plugin authorization for local users 79 5661 configuring cli plugin authorization 80 57 accounting configuration 81 571 configuring tacacs accounting81 572 configuring radius accounting82 58 displaying user session information 82 59 disconnecting user sessions83 510 configuring the idletimeout period for user sessions 84 6 management servers 85 61 grpc server 85 611 configuring a grpc server86 612 disconnecting clients from a grpc server87 613 displaying grpc client information 87 614 displaying the rpcs that clients are using 87 62 jsonrpc server 88 621 configuring a jsonrpc server 88 63 tls profiles 89 631 configuring a tls profile89 632 configuring a tls profile with tpm device identity 91 633 generating a selfsigned certificate 92 634 generating a certificate signing request 92 635 spiffe 93 6351 leveraging spiffe93 6352 configuring spiffeid for users94 6353 using spiffe for client authentication mtls94 7 logging 96 71 input sources for log messages96 72 filters for log messages98 73 output destinations for log messages 99 74 defining filters100 75 logging destination configuration 101 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 6 configuration basics guide release 247 table of contents 751 specifying a log file destination 101 752 specifying a buffer destination102 753 specifying the console as destination 103 754 specifying a remote server destination 103 76 specifying a linux syslog facility for sr linux subsystem messages 104 77 specifying fqdn for logging hostnames104 78 rsyslog templates for local buffer file or console output 105 79 rsyslog templates for forwarding messages to remote servers 106 8 networkinstances 108 81 basic networkinstance configuration108 82 path mtu discovery109 83 static routes109 831 configuring static routes 110 832 configuring failure detection for static routes 114 84 aggregate routes 114 841 configuring aggregate routes 115 85 route preferences 115 86 ip tunnel decapsulation groups116 861 configuring an ip tunnel decapsulation group117 87 displaying networkinstance status117 88 the macvrf networkinstance119 881 mac selection 119 882 mac duplication detection and actions 120 8821 mac duplication detection 120 8822 mac duplication actions 120 8823 mac duplication process restarts120 8824 configurable holddowntime 120 883 bridge table configuration 121 8831 deleting entries from the bridge table 121 884 the macvrf networkinstance type122 89 networkinstance route leaking123 891 networkinstance route leaking configuration example 124 810 configuring interface references 143 9 sr linux applications145 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 7 configuration basics guide release 247 table of contents 91 installing an application145 92 starting an application146 93 restarting applications 146 931 restarting an application 147 94 terminating an application 148 95 reloading application configuration 148 96 clearing application statistics149 97 restricted operations for applications149 98 configuring an application150 99 removing an application from the system154 910 partioning and isolating application resources 155 9101 cgroup profiles 155 91011 default cgroup profile155 91012 customerdefined cgroup profile 158 9102 configuring a cgroup158 91021 cgroup configuration example159 9103 kernel lowmemory killer160 91031 sr linux process kill strategy 161 9104 application manager extensions for cgroups163 9105 debugging cgroups 164 91051 sr linux cgroup debugging commands 164 91052 linuxprovided cgroup debugging commands167 10 datapath resource management170 101 lpm table partitioning 170 102 changing datapath resource management settings 171 103 displaying datapath resource management information172 11 maintenance mode173 111 configuring a maintenance group 173 112 configuring a maintenance profile 174 113 placing a maintenance group into maintenance mode 175 114 taking a maintenance group out of service 175 115 restoring the maintenance group to service 176 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 8 configuration basics guide release 247 about this guide 1 about this guide this document describes basic configuration for the nokia service router linux sr linux examples of commonly used commands are provided this document is intended for network technicians administrators operators service providers and others who need to understand how the router is configured note this manual covers the current release and may also contain some content that will be released in later maintenance loads see the sr linux release notes for information on features supported in each load configuration and command outputs shown in this guide are examples only actual displays may differ depending on supported functionality and user configuration 11 precautionary and information messages the following are information symbols used in the documentation danger danger warns that the described activity or situation may result in serious personal injury or death an electric shock hazard could exist before you begin work on this equipment be aware of hazards involving electrical circuitry be familiar with networking environments and implement accident prevention procedures warning warning indicates that the described activity or situation may or will cause equipment damage serious performance problems or loss of data caution caution indicates that the described activity or situation may reduce your component or system performance note note provides additional operational information tip tip provides suggestions for use or best practices 12 conventions nokia sr linux documentation uses the following command conventions  bold type indicates a command that the user must enter  input and output examples are displayed in courier text  an open rightangle bracket indicates a progression of menu choices or simple command sequence often selected from a user interface example start  connect to  a vertical bar  indicates a mutually exclusive argument 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 9 configuration basics guide release 247 about this guide  square brackets   indicate optional elements  braces   indicate a required choice when braces are contained within square brackets they indicate a required choice within an optional element  italic type indicates a variable generic ip addresses are used in examples replace these with the appropriate ip addresses used in the system 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 10 configuration basics guide release 247 whats new 2 whats new topic location source address for tacacs source address for radius configure tacacs and local server groups for aaa functions configure radius server group for aaa functions configuring a tls profile with tpm device identity configuring a tls profile with tpm device identity static nhgs for gre tunnel nexthops static routes new hashseed default for ip loadbalancing ip ecmp load balancing gre decapsulation subnets ip tunnel decapsulation groups virtual router redundancy protocol vrrp vrrp 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 11 configuration basics guide release 247 system management 3 system management this chapter contains procedures for setting up basic system management functions on sr linux including the hostname domain name dns settings and management networkinstance it contains examples of configuring an ssh server and ftp server as well as ntp for the system clock and enabling an snmp server 31 configuring a hostname procedure the sr linux device must have a hostname configured the default hostname is srlinux the hostname typically appears on all cli prompts on the device although you can override this with the environment prompt cli command the hostname must be a unique name on the network and it can be a fully qualified domain name fqdn or an unqualified singlelabel name if the hostname is a singlelabel name for example srlinux the system may use its domain name if configured to infer its own fqdn example the following example shows the configuration for a hostname on the sr linux device  candidate shared default    info system name system  name  hostname 3nodesrlinuxa   32 configuring a domain name procedure the sr linux device uses its hostname combined with a domain name to form its fqdn it is expected that the fqdn exists within the dns servers used by sr linux though this is not a requirement assuming the sr linux fqdn is in the dns server you can use the fqdn to reach the sr linux device without knowing its management address a domain name is not mandatory but if specified it is added to the dns search list by default example the following shows the configuration for a domain name on the sr linux device in this example the device fqdn is set to 3nodesrlinuxamvusanokiacom  candidate shared default    info system name 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 12 configuration basics guide release 247 system management system  name  hostname 3nodesrlinuxa domainname mvusanokiacom   33 configuring dns settings procedure the sr linux device uses dns to resolve hostnames within the configuration or for operational commands such as ping you can specify up to three dns servers for the sr linux device to use with either ipv4 or ipv6 addressing you can also specify a search list of dns suffixes that the device can use to resolve singlelabel names for example for a search list of nokia1com and nokia2com a ping for host srlinux performs a dns lookup for srlinuxnokia1com and if unsuccessful performs a dns lookup for srlinuxnokia2com the sr linux device supports configuration of static dns entries static dns entries allow resolution of hostnames that may not be in the dns servers used by the sr linux device using a static dns entry you can map multiple addresses both ipv4 and ipv6 to one hostname the sr linux linuxmgr application adds the static dns entries to the etchosts file in the underlying linux os example in the following example the sr linux device is configured to use two dns servers to resolve hostnames a search list of dns suffixes for resolving singlelabel names and ipv4 and ipv6 static dns entries for a host dns requests are sourced from the mgmt networkinstance see configuring the management networkinstance  candidate shared default    info system dns system  dns  networkinstance mgmt serverlist  192021 192022  searchlist  nokia1com nokia2com  hostentry srlinuxnokiacom  ipv4address 192023 ipv6address 2001db81234561111    3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 13 configuration basics guide release 247 system management 331 configuring preferred source address for dns requests procedure sr linux allows you to specify the preferred source address when acting as a dns client in a network instance with multiple possible source addresses the specified source ip address must belong to the network instance where dns is configured you can configure the preferred sourceaddress parameter as either an ipv4 or ipv6 address under systemdns example in this example dns requests are sent to the configured dns servers using the source address of 192168121  candidate shared default   info system dns system  dns  networkinstance mgmt sourceaddress 192168121 serverlist  192021 192022    34 configuring the management networkinstance procedure the sr linux device is primarily managed via a management networkinstance the management networkinstance isolates management traffic from other networkinstances configured on the device the outofband mgmt0 interface is automatically added to the management networkinstance and management services run within the management networkinstance although the management networkinstance is primarily intended to handle management traffic you can configure it in the same way as any other networkinstance on the device including protocols policies and filters the management networkinstance is part of the default configuration but may be deleted if necessary addressing within the management networkinstance is available via dhcp and static ip addresses both ipv4 and ipv6 addresses are supported example  candidate shared default    info networkinstance mgmt networkinstance mgmt  type ipvrf adminstate enable description management network instance interface mgmt00   protocols  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 14 configuration basics guide release 247 system management linux  exportroutes true exportneighbors true    35 access types access to the sr linux device is available via a number of apis and protocols the sr linux supports the following ways to access the device  secure shell ssh ssh is a standard method for accessing network devices see enabling an ssh server  file transfer protocol ftp the ftp is a secure method for transferring files to and from network devices see configuring ftp  console the console provides access to the sr linux cli via direct connection to a serial port on the device  grpc network management interface gnmi gnmi is a grpcbased protocol for the modification and retrieval of configuration from a target device as well as the control and generation of telemetry streams from a target device to a data collection system see grpc server  jsonrpc jsonrpc is a protocol with the ability to retrieve and set configuration and state using a jsonrpc api see jsonrpc server  simple network management protocol snmp snmp is a commonly used network management protocol the sr linux device supports snmpv2 with a limited set of oids regardless of the method of access all sessions are authenticated if authentication is enabled whether the session is entered via the console ssh or an api access to the device is controlled via the aaamgr application see securing access 351 enabling an ssh server procedure you can enable an ssh server for one or more network instances on the sr linux device so that users can log in to the cli using an ssh client the sr linux device implements ssh via openssh and configures etcsshsshdconfig in the underlying linux os only sshv2 is supported example in the following example an ssh server is enabled in the mgmt and default networkinstances specifying the ip addresses where the device listens for ssh connections  candidate shared default   3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 15 configuration basics guide release 247 system management  info system sshserver system  sshserver  networkinstance mgmt  adminstate enable sourceaddress  192021 192022   networkinstance default  adminstate enable sourceaddress  192023 192024     3511 configuring ssh keybased authentication procedure the sr linux ssh server supports rsa publicprivate key and ssh certificate authentication where an ssh client provides either a signed message that has been encrypted by a private key or a valid certificate that has been issued by a trusted authority if the ssh clients corresponding public key or certificate is configured on the sr linux the ssh server can authenticate the client using either rsa public key or ssh certificate method the sr linux attempts to authenticate a user using publickey authentication first then ssh certificates and finally password authentication if the previous methods fail to configure ssh keybased authentication you generate a publicprivate key pair then add the public key to the sr linux example the following is an example of using the sshkeygen utility in linux to generate an rsa key pair with a length of 2048 bits  sshkeygen t rsa b 2048 generating publicprivate rsa key pair enter file in which to save the key homeusersshidrsa enter passphrase empty for no passphrase enter same passphrase again your identification has been saved in homeusersshidrsa your public key has been saved in homeusersshidrsapub the key fingerprint is sha256rnvv8xrvk7phy2ojxa7rjksufqyvoj4puxl2pds7mi userlinux the keys randomart image is rsa 2048  oo oo  oob    o   fo     m   o    o    o o  e o   3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 16 configuration basics guide release 247 system management   oo  sha256 example after generating the rsa key pair you can add the public key to the sr linux the location for the public key depends on the type of user for which ssh keybased authentication is being configured  for linux users see linux users you add the public key to the users homessh authorizedkeys file  for users configured within the sr linux cli see local users you add the public key to the sr linux configuration file with a cli command for example the following cli command configures a public key and password for the sr linux user srlinux  candidate shared default    system aaa authentication user srlinux sshkey  publickey  password password in the example the publickey has the format sshrsa key comment if multiple public keys are configured for a user they are tried in the order they were configured 352 ssh host keys an ssh host key is generated when an ssh server is enabled for a network instance on an sr linux device this host key is the public key ssh clients store the public host keys of the servers to which they are connected a host key that is stored is referred to as a known host key the files etcsshknownhosts and sshknownhosts present in the users home directory contain the host public keys for all the known hosts in sr linux the serverside keys are stored in etcssh and the filenames begin with sshhost dsaecdsaed25519rsakey for information about host key authentication and preservation see host key authentication and preservation for information about ssh server host certificate configuration see configuring host certificate 3521 host key authentication and preservation when an ssh client connects to a server the server offers its host key as identification if this is the first time the user has connected to the server the client prompts the user to accept the host key after the user accepts the key the host key and the hostname used to connect to the server gets appended to the list of known hosts in subsequent connections to the same server the ssh client expects the server to return the same host key if the host key presented by the server on a subsequent connection is different from the one saved on the users local system the ssh client refuses to proceed with the connection and instead displays the following warning message   warning remote host identification has changed  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 17 configuration basics guide release 247 system management  it is possible that someone is doing something nasty someone could be eavesdropping on you right now maninthemiddle attack it is also possible that a host key has just been changed the fingerprint for the ed25519 key sent by the remote host is sha2564xnagtqydqylgjl0xhvavybcrrl2nz8vsrxtyfciye0 please contact your system administrator add correct host key in userstestusersshknownhosts to get rid of this message offending ed25519 key in userstestusersshknownhosts74 host key for 10001 has changed and you have requested strict checking host key verification failed the message suggests that the server may be pretending to be the intended server to intercept passwords or there could be a change in the host key without correct verification techniques a periodic change in an ssh host key is indistinguishable from a maninthemiddle mitm attack users may be tempted to accept frequent warning messages without verifying them which can increase the vulnerability to mitm attacks instead of reducing it to overcome this you can enable the preserve option for the ssh server host key this ensures the ssh server host keys in etcssh are preserved and restored after a system reboot or ssh server restart when the preserve option is not enabled the ssh server host key remains valid only until the node is restarted or the ssh server is stopped and restarted note this feature is nonbackward compatible in releases before 237 for information about enabling the preserve option to prevent ssh host key regeneration upon reboot see preserving ssh host key 35211 preserving ssh host key procedure to prevent ssh server host key regeneration upon reboot set the preserve option for ssh under system sshserver hostkey example the following example sets the preserve option for ssh   candidate shared default    info system sshserver hostkey system  sshserver  hostkey  preserve true     when preserve option is set to true the ssh server host keys in etcssh are saved and restored after a system reboot or ssh server restart  when preserve option is set to false the ssh server host keys in etcssh are removed and regenerated on each system reboot or ssh server restart  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 18 configuration basics guide release 247 system management 353 ssh certificates the sr linux ssh server supports rsa publicprivate key and ssh certificate authentication when using public key cryptography for authentication the public key from every client must be copied to every server that the client intends to log into this type of authentication method does not scale well and requires significant administrative effort to maintain as an alternative openssh supports the creation of simple ssh certificates and associated ca infrastructure using a public key from a certificate authority ca to authenticate client certificates removes the need to copy keys between multiple systems the ssh certificates are signed with a standard ssh public key using the sshkeygen utility the utility supports two types of certificates user and host certificates user certificates authenticate users to servers while the host certificates authenticate server hosts to users note if a user has both an rsa public key and an ssh certificate set up for authentication the ssh client tries the public key first and then the certificate the highlevel steps for enabling ssh certificate authentication are  create a ca key pair and configure the ca public key trustanchors on the ssh server see configuring ca public key trustanchors  create a user ssh certificate sign it with the ca private key and ssh principal and configure an ssh principal for each user see configuring ssh principals  create a host ssh certificate sign it with the ca private key and configure the ssh host certificate on the ssh server see configuring host certificate  set up ca public key as the certauthority for all client nodes see trusting ca public key  configure a revoked public user key list see configuring revoked key list 3531 configuring ca public key trustanchors procedure sr linux allows the configuration of ca public keys also known as trustanchors to verify ssh certificates the ssh certificates are used by the sshd service to authenticate clients users connecting via ssh the ca signing key pair ca public and private key is generated by running the sshkeygen command on a server designated as the ca machine example generate ca the following example generates ca signing key pair sshkeygen f ca generating publicprivate rsa key pair enter passphrase empty for no passphrase enter same passphrase again your identification has been saved in ca your public key has been saved in capub the key fingerprint is sha256gjgio2djv2tkbcucjc5skmn8cfjitoz4orf0hhae usernode 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 19 configuration basics guide release 247 system management the keys randomart image is rsa 3072  eoo  o     oooo o    o      s   o o o o   o      o   oo  sha256 example configure trustanchors the following example configures the trustanchors that verifies the ssh certificates the trustanchors configuration is a globalsetting and is applicable to all ssh servers  candidate shared default    info system sshserver trustanchors system  sshserver  trustanchors  sshrsa aaaab3nzac1yc2eaaaadaqabaaabgqcujqwgz360aq6y7pp3okjofkbqfvb pjr9g0jv2xyocbjidfh8czr9qaasffrihdfxeydnujt2htqhlekruq8okjarytr72plremzc7titgddqugnzdvnweefecbj xrj2lpiffwvzbofm7bnynhx4hehegyfkgz5rstxbmimw2xvwyfhrs5wkqxvkusxqlywjekdjlhrzbbdqdnr3alojtg ehoqcd6kg7ncmkdxspjie2tjha1khs7ecgff8tqgf43h4eimp0v1hjhsiqbgtzxk3we7tigdny8d2lqjblnspzh le4qodqwficozk9qkiodqawwmgcf3uxikzakh0zjvjic7etsbc9pgxm0jmxghvkakq37explkgxv2deq3ljhkcc8kqa guhqyxf7etw4sondxkfdrofunouygvldpwhihxrdzvboptu5oh9ik0adf2cequ7wcqamgubzwawkqzlnkb9jfncp alvdtgpxgegbmxel46r3e usernode    3532 configuring ssh principals procedure sr linux allows configuration of ssh principals for users a client machine generates a user certificate using the sshkeygen tool and signs it with the ca certificate and ssh principal value example the following is an example of a signed user certificate srluser1certpub with ssh principals  candidate shared default    sshkeygen l f srluser1certpub srluser1certpub type sshrsacertv01opensshcom user certificate public key rsacert sha256lbpqlkszi61xovfgch5sf3xrksq5my70tr3iai4 signing ca rsa sha256gjgio2djv2tkbcucjc5skmn8cfjitoz4orf0hhae using rsa sha2512 key id srluser1 serial 0 valid forever principals 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 20 configuration basics guide release 247 system management admin critical options none extensions permitx11forwarding permitagentforwarding permitportforwarding permitpty permituserrc when a user logs into the server over ssh the user certificate is checked against a list of configured principals the server authenticates the client over ssh only if the following conditions are met the clients certificate is verified the clients username matches and the clients certificate has a principal that is configured on the server a single user client certificate can match multiple principals and multiple principals can match a single user you can configure ssh principals under systemaaaauthenticationuser example the following example configures user srluser1 with role admin and sshprincipal allowing admin  candidate shared default    info system aaa authentication user srluser1 system  aaa  authentication  user srluser1  role  admin  sshprincipals  admin      3533 configuring host certificate procedure sr linux provides an option to configure the host certificates certificate under systemssh serverhostkey the host certificate refers to the host key signed with a ca private key for more information about ssh host keys see ssh host keys in sr linux the serverside keys are stored in etcssh and the filenames begin with sshhostdsaecdsaed25519rsakey the certificate configuration is a global setting and applicable to all ssh servers you must configure the host to present the certificate during user login example the following example configures host certificates with preserve option set to true this ensures the ssh server host keys in etcssh are preserved and restored after a system reboot or ssh server restart  candidate shared default   3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 21 configuration basics guide release 247 system management  info system sshserver hostkey system  sshserver  hostkey  certificate sshrsacertv01opensshcom aaaahhnzac1yc2ety2vydc12mdfab3blbn nzac5jb20aaaagz2nzyidarws9fn3p8ifd5iq40twp4evaqmaoswknamaaaadaqabaaabgqc7uc4ghviv 2cy9fgxuizgnjafugkt2jtae6fb7s885jboiqyp19ltghbqlrzqdckgtyjanj9wosjkdg5dyy9hgtpwi rbrzoy3onp7qsvweqds8hznop8odiwwrrhzdl9gvbttah2vy5qykhubamnw8xskqs6jip0nlcpfgvn x04fkzzqg8eofq5rnwvd570ypaxalkgr4xrdvbi7r65gvm3pcdfrbry9dl9jamc1svc6wcqqg17zoxo87ixb bxlqes3zcc44rnuq76em0ictx1k0wgemddjrevknq8yptmuipfyefjwoe3dpsodtfitgdafcjufltyrc wksznuufmlfhgqb1wriabpngrwu9ybtldenjnopxurapgykt6ddebsawuilcref6xsqzbqvpbao3ymkrairw8ds 8zdd6tzmiep8j00ad0jlzjez53wxaborzzilzobxoljublyw25gi3g3ageuh8xlwumfxuaflgx tnjramaaaaaaaaaaaaaaaiaaaary2xhyi1zc2hfdgvzdc1zcmwaaaavaaaaewnsywitc3nox3rlc3qtc3jsaaaaaaaaaad waaaaaaaaaaaaaaaaaaazcaaaahc3nolxjzyqaaaambaaeaaagbak6opadpfrrpdrl7umnegq ohrtaw9sov2dsnxbhi4igoj0ufwlov1bpqx8vegcmxf7j0278m3ye1cet6strdygqmcvk1hvakut4z nzu0hmyn1c4y1knu3ar594junesnysl58xc9kgguzse1if8fhgcqd4biuoznlfk3h9syixbbfxdjfhznaqpdx rszfcxjykqp2mufhmfsoom2vdqu4m2ase5bwpqqbuciwp1eymoj7zoofrwsgzsryd99y39cbjcfgtkysuckey kogc1nerfattoiym1jx3ytaluu2ynoet7ha52rbjyjot1cqih1brbyybxdreirp9qqfrklwmhzsroxsl0dezqmze adwrqsrfste8uqzdxz0rdeumgrwlwqpr6c4erlexsrpdhi6cpep91e59sei5ibusoncegddepo8e427k4f2irrp1zx5c7v bxacya4hnybyqpmu0pv0l80kkcw91maneyqygzcsxjqvcqaaazqaaaamcnnhlxnoytitnteyaaabgfvr2y3659xn7utll6i lfkcu76u8otwzl2pkpzrurbqfqc9bluqsmawfxmgazg5emmzqcafgelwzeiuqjmucslndyhyhsw6mmkadl2yifuffu zzix3ff2resfaptpkkbzrijclyxo9h9gqwbgjfa0f848gk3fcatwq6jm4f3q4j0lribqbulouvxvm3gzvwqhou9rphol0agwhu djtaq5oztv4xhfrckmkacesnex4wnn6k3jbfvlnnxdpdwalocsmvpqmzha8r6eqvu5b44ysvmlahsauyyhdbvjh6hhz koxgtlv3imonlbwnkicsu4licleh0pqhinsii8ftdvpexqwunqd93xqhauvxz9ia0gugkgmqixglbpfftaqqkzbbv0r s44npssvpoiyw6bjihzm4zfhk6l2eggj4pkx3tso10fhknaofizlws4geypl3yzfxmkkkwbctv7tlvyszavqqjrg svbh9fibefirhqq usernode preserve true    3534 trusting ca public key to prevent the warning about an unknown host the user client system must trust the ca public key that signed the host certificates this is done by adding the ca public key to the knownhosts file for example echo certauthority  cat capub  sshknownhosts where  capub references the public key of the signing ca   specify the server being connected to or a glob value examplecommydomaincom ca keys can be marked as trusted globally in the etcsshknownhosts file or peruser in the  sshknownhosts file 3535 configuring revoked key list procedure sr linux provides an option to configure revoke key revokedkeys list under systemsshserver a list of user public keys that must be invalidated is called a revoke list each line in the revoke list contains one public key if a users public key is listed in the revoke list the server rejects the connection when the user tries to connect using ssh 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 22 configuration basics guide release 247 system management example the following example configures the revoked key list  candidate shared default    info system sshserver revokedkeys system  sshserver  revokedkeys  sshrsa aaaab3nzac1yc2eaaaadaqabaaabgqdplz4nvdfagauca2mepytoyvwwhiyompsc wzvg8aj9ssj88pmjgb0re3fbyxek8bj1mjar7gnbuxot3nvcljcpo6ixxdouan8rmxpbpflslc6jwzq5iknoxdj9plunz cgloy2xiljgruosct02sonmjciaxzfkqmf9elnw9clqbw7hvcvwhpzj4ep814mmjbxzx9llgvj1suleajfuxotlchyscf3nbdh ymvfagngfrucebmg6n2vrzrlbtrqibao5fkoigeuntnv4fianlhlrqitidzxfnw7xx5yier30fnyf6u5y1ija5xjwhb9eos rjom7pbyhdc6xesuys7goji3lwqflz7twmlb5mxul4ab5snarlkyx14gyidpsvtoe8mfsy011pqmwmqjz8lm2euhn68unbod mmzgls9i11a1yodydv9gld3wwghxgq1vorgvp401s4hf26gaxrar2qblq7tjtq34fvz8o0ynplvcou usernode    3536 viewing an ssh certificate procedure you can view an ssh certificate using the following command  sshkeygen l f where  l lists the content of the certificate  f specifies the path to the signed certificate the ssh certificate formats and semantics are as per the specification defined in protocolcertkeys example viewing an user ssh certificate the following command displays the user ssh certificate user ssh certificate is used to authenticate users to servers  sshkeygen l f user1certpub user1certpub type sshrsacertv01opensshcom user certificate public key rsacert sha256lbpqlkszi61xovfgch5sf3xrksq5my70tr3iai4 signing ca rsa sha256gjgio2djv2tkbcucjc5skmn8cfjitoz4orf0hhae using rsa sha2512 key id user1 serial 0 valid forever principals admin critical options none extensions permitx11forwarding permitagentforwarding permitportforwarding permitpty permituserrc 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 23 configuration basics guide release 247 system management example viewing a host ssh certificate the following command displays the host ssh certificate host ssh certificate is used to authenticate server hosts to users  sshkeygen l f sshhostrsakeycertpub sshhostrsakeycertpub type sshrsacertv01opensshcom host certificate public key rsacert sha256ngxyhwgpt4bxeglv10jvzywed7dadjgs0ygbhzr7ko signing ca rsa sha256gjgio2djv2tkbcucjc5skmn8cfjitoz4orf0hhae using rsa sha2512 key id srl serial 0 valid forever principals srl srllocal critical options none extensions none 354 configuring ftp procedure you can enable an ftp server for one or more networkinstances on the sr linux device so that users can transfer files to and from the device the sr linux uses the vsftpd very secure ftp daemon application within the underlying linux os the authenticated users home directory returned by the aaamgr application is set as the users ftp root directory example in the following example the ftp server is enabled in the mgmt and default networkinstance specifying the ip addresses where the device listens for ftp connections  candidate shared default    info system ftpserver system  ftpserver  networkinstance mgmt  adminstate enable sourceaddress  192021   networkinstance default  adminstate enable sourceaddress  192024     3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 24 configuration basics guide release 247 system management 36 configuring banners procedure you can specify banner text that appears when a user connects to the sr linux device the following banners can be configured  login banner  displayed before a user has been authenticated by the system for example at the ssh login prompt  message of the day motd banner  displayed after the user has been authenticated by the system the banners appear regardless of the method used to connect to the sr linux so they are displayed to users connecting via ssh console and so on example in the following example login and motd banners are configured the login banner text appears at the prompt when a user attempts to log into the system and the motd banner text appears after the user has been authenticated  candidate shared default    info system banner system  banner  loginbanner enter your sr linux login credentials motdbanner welcome to the sr linux cli your activity may be monitored   37 synchronizing the system clock procedure network time protocol ntp is used to synchronize the system clock to a time reference you can configure ntp settings on the sr linux device using the cll and the sr linux linuxmgr application provisions the settings in the underlying linux os ntp does not account for time zones instead relying on the host to perform such computations time zones on the sr linux device are based on the iana tz database which is implemented by the underlying linux os you can specify the time zone of the sr linux device using the cli the ntp server used in the system ntp client configuration can be ip addressbased or hostnamebased example enabling an ntp client with an ip addressbased ntp server the following example enables the ntp client on the sr linux device and sets an ip addressbased ntp server for clock synchronization the ntp client runs in the mgmt networkinstance the system time zone is set to americalosangeles the example uses an ip address for the ntp server  candidate shared default    info system ntp system  ntp  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 25 configuration basics guide release 247 system management adminstate enable networkinstance mgmt server 45316075     example enabling an ntp client with a hostnamebased ntp server the following example enables the ntp client on the sr linux device and sets a hostnamebased ntp server for clock synchronization  candidate shared default    info system ntp system  ntp  adminstate enable networkinstance mgmt server srlinuxnokiacom     for the hostname support to work  dns configuration is mandatory for this to function correctly a missing configuration does not prevent configuration however the ntp session to that server can only become active when dns is functioning correctly  the networkinstance of the ntp server and dns must be the same 38 configuring preferred source address for ntp requests procedure sr linux allows you to specify the preferred source address when acting as an ntp client in a network instance with multiple possible source addresses the specified source ip address must belong to the network instance where ntp is configured you can configure the preferred sourceaddress parameter as either an ipv4 or ipv6 address under systemntp in this example ntp requests are sent to the configured ntp servers using the source address of 45316075 example in this example ntp requests are sent to the configured ntp servers using the source address of 45316075  candidate shared default    info system ntp system  ntp  networkinstance mgmt sourceaddress 45316075 server 12961528   server 216239350   3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 26 configuration basics guide release 247 system management   39 configuring snmp procedure to configure snmp enable an snmp server on one or more networkinstances the sr linux device supports snmpv2 the mib file that covers these oids is packaged with each release see the sr linux system management guide for the procedure for configuring an snmp server 310 ip ecmp load balancing equalcost multipath protocol ecmp refers to the distribution of packets over two or more outgoing links that share the same routing cost static isis ospf and bgp routes to ipv4 and ipv6 destinations can be programmed into the datapath by their respective applications with multiple ip ecmp next hops the sr linux device loadbalances traffic over multiple equalcost links with a hashing algorithm that uses header fields from incoming packets to calculate which link to use when an ipv4 or ipv6 packet is received on a subinterface and it matches a route with a number of ip ecmp next hops the next hop that forwards the packet is selected based on a computation using this hashing algorithm the goal of the hash computation is to keep packets in the same flow on the same network path while distributing traffic proportionally across the ecmp next hops so that each of the n ecmp next hops carries approximately 1nth of the load the hash computation takes various key and packet header field values as inputs and returns a value that indicates the next hop the key and field values that can be used by the hash computation depend on the platform packet type and configuration options as follows on 7250 ixr systems the following can be used in the hash computation  hashseed 0 to 65535 which can be systemgenerated the default or userspecified if the hash seed is systemgenerated sr linux generates a hashseed using the leastsignificant 16 bits of the base chassis mac address  for ipv4 tcpudp nonfragmented packets source ipv4 address destination ipv4 address ip protocol layer 4 source port layer 4 destination port the algorithm is asymmetric that is inverting source and destination pairs does not produce the same result  for ipv6 tcpudp nonfragmented packets source ipv6 address destination ipv6 address ipv6 flow label even if it is 0 ip protocol ipv6 nextheader value in the last extension header layer 4 source port layer 4 destination port the algorithm is symmetric that is inverting source and destination pairs produces the same result  for all other packets source ipv4 or ipv6 address destination ipv4 or ipv6 address on 7220 ixrd1 d2 d3 and 7220 ixrh2 and h3 systems the following can be used in the hash computation  hashseed 0 to 65535 which can be systemgenerated the default or userspecified if the hash seed is systemgenerated sr linux generates a hashseed using the leastsignificant 16 bits of the base chassis mac address 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 27 configuration basics guide release 247 system management  for ipv4 tcpudp nonfragmented packets vlan id source ipv4 address destination ipv4 address ip protocol layer 4 source port layer 4 destination port the algorithm is asymmetric  for ipv6 tcpudp nonfragmented packets vlan id source ipv6 address destination ipv6 address ipv6 flow label even if it is 0 ip protocol ipv6 nextheader value in the last extension header layer 4 source port layer 4 destination port  for all other packets source ipv4 or ipv6 address destination ipv4 or ipv6 address note to avoid polarization effects ensure that directly connected nodes have unique hashseeds you can do this by explicitly configuring the hashseeds or by checking the state value of system generated hashseeds 3101 configuring ip ecmp load balancing procedure to configure ip ecmp load balancing you specify hashoptions that are used as input fields for the hash calculation which determines the next hop for packets matching routes with multiple ecmp hops example the following example configures hash options for ip ecmp load balancing including a hashseed and packet header field values to be used in the hash computation   candidate shared default    info system loadbalancing system  loadbalancing  hashoptions  hashseed 128 ipv6flowlabel false    if no value is configured for the hashseed the default is for the system to generate a hashseed using the leastsignificant 16 bits of the base chassis mac address if a hashoption is not specifically configured either true or false the default for the hash option is true on 7250 ixr systems if sourceaddress is configured as a hash option the destinationaddress must also be configured as a hash option similarly if sourceport is configured as a hash option the destinationport must also be configured as a hash option 311 powering down the system about this task the sr linux device does not feature a power switch if you need to power down the device use the following procedure procedure step 1 enter the cli command to reboot the system 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 28 configuration basics guide release 247 system management example  tools platform chassis reboot step 2 when the grub menu appears remove the power cables from the psus 312 configuring reboot options you can perform a reboot using the command toolsplatformcomponentslot in cli the reboot command is supported for all platform components namely chassis control activestandby fabric and linecard slots this command triggers an immediate reboot     chassis tools platform chassis reboot control slot tools platform control slot reboot fabric slot tools platform fabric slot reboot linecard slot tools platform linecard slot reboot you can use the following options with the reboot command these options are platformspecific  delay   cancel force  message  warm 3121 delay you can use the delay option to set a wait time before rebooting the delay period required is configured in seconds during this period you can cancel any pending reboot operations note when a delayed reboot is pending for either a chassis or an active control component setting a wait time to delay the reboot of any other component linecard standby control or fabric slot is not supported  chassis tools platform chassis reboot delay value  tools platform chassis reboot delay 2 platform chassis will reboot in 2 seconds    control slot tools platform control slot reboot delay value fabric slot tools platform fabric slot reboot delay value linecard slot tools platform linecard slot reboot delay value 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 29 configuration basics guide release 247 system management when doing a warm redundancy cpm switchover any pending delayed reboot of active or standby control card is discarded the command toolsplatformredundancyswitchover is not impacted by any pending delayed reboots 3122 cancel you can use the cancel option to cancel any pending reboot on a platform component when there are no pending delayed reboots the reboot cancel command execution fails  chassis tools platform chassis reboot delay cancel  tools platform chassis reboot cancel the chassis reboot has been canceled platform chassis reboot has been canceled    control slot tools platform control slot reboot cancel fabric slot tools platform fabric slot reboot cancel linecard slot tools platform linecard slot reboot cancel note you cannot combine the cancel option with force or delay options 3123 force you can use the force option to trigger a force reboot of a platform component this option is supported only for the chassis and control slots the force option overrides all synchronization activities and any soft checks that prevent a reboot for example the unsaved configuration between running and startup are ignored caution forcing a reboot immediately after an image change may result in a standby module booting an older image   chassis tools platform chassis reboot force control slot tools platform control slot reboot force 3124 message you can use the message option to broadcast a userdefined message to other users before the reboot occurs the message option can be used with reboot types of immediate cancel or delay  chassis tools platform chassis reboot message value  tools platform chassis reboot message this is a message chassis is rebooting now this is a message   control slot tools platform control slot reboot message value fabric slot tools platform fabric slot reboot message value 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 30 configuration basics guide release 247 system management  linecard slot tools platform linecard slot reboot message value the following examples demonstrate different reboot scenarios with the message option  immediate reboot with the message option  tools platform chassis reboot message this is a message chassis is rebooting now this is a message a message indicating the initiation of an immediate reboot is broadcast to all users only if the immediate reboot command is executed with the message option  delayed reboot with the message option  tools platform control a reboot delay 100 message this is a message control slot a is rebooting in 100 seconds at 20230124t014520556z this is a message platformcontrolslota control slot a will reboot in 100 seconds a message indicating the reboot delay is broadcast to all users only if the reboot delay command is executed with the message option  when a pending delayed reboot is executed for an active control card or the chassis the userdefined message is broadcast and the prompt is also updated accordingly  tools platform control a reboot delay 3600 message control reboot message platformcontrolslota control slot a will reboot in 3600 seconds  active control reboot in 3599 seconds control reboot message running    tools platform chassis reboot delay 3600 message reboot message platform chassis will reboot in 3600 seconds  system reboot in 3599 seconds reboot message running    canceling a delayed reboot with the message option tools platform linecard 1 reboot cancel message this is a cancel message linecard slot 1 reboot has been canceled this is a cancel message platformlinecardslot1 linecard slot 1 reboot has been canceled the preceding command cancels all the pending delayed reboots and broadcasts the userdefined message a message indicating the reboot cancel is broadcast to all users only if the reboot cancel command is executed with the message option  when a delayed reboot time expires and the reboot is about to happen the following message is broadcast chassis chassis is rebooting now control control slot a or b is rebooting now linecard linecard slot x is rebooting now fabric fabric slot x is rebooting now 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 31 configuration basics guide release 247 system management note this message is broadcast irrespective of executing the reboot delay command with or without the message option  when a delayed reboot fails the following message is broadcast chassis chassis reboot failed reason for failure control control slot a or b reboot failed reason for failure linecard linecard slot x reboot failed reason for failure fabric fabric slot x reboot failed reason for failure note this message is broadcast irrespective of executing the reboot delay command with or without the message option  when a delayed reboot is pending for a component and a reboot delay or immediate is attempted for a chassis or active control the reboot gets rejected with the following message chassis disallowed delayed reboot is pending for linecard slot 1 active control slot a disallowed delayed reboot is pending for linecard slot 1 this example shows a reboot attempted on a linecard when control a is active note the error message lists only the first found component with a delayed reboot pending in this example if all linecards 1 to 4 are pending delayed reboots the error message highlights only the pending reboot for linecard1  when a delayed reboot is pending for a chassis or active control and a reboot delay or immediate is attempted for any other platform component the reboot gets rejected with the following error message this example shows a reboot attempted on a fabric slot when a reboot is pending for the active control module a fabric slot x disallowed delayed reboot is pending for control slot a this example shows a reboot attempted on a fabric slot when reboot is pending for chassis component fabric slot x disallowed delayed reboot is pending for chassis  while a delayed reboot is pending for a component and a reboot delay or immediate is attempted for the same platform component the reboot gets rejected with a message indicating that the pending delayed reboot must first be cancelled  when the wait time specified for the reboot delay exceeds the maximum delay limit the delayed reboot command gets executed and the following message is displayed  tools platform linecard 1 reboot delay 18446744073709551615 platformlinecardslot1 delay has been limited to 16772217903 seconds platformlinecardslot1 linecard slot 1 will reboot in 16772217903 seconds 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 32 configuration basics guide release 247 system management 3125 warm when you execute the reboot command with the warm option it validates the current configuration and prompts reboot confirmation on confirming the system reboots without impacting the datapath if a warm reboot is performed after a new image is configured the system upgrades to the new image before performing a warm reboot you must confirm if the current sr linux configuration and state supports warm reboot use the tools platform chassis reboot warm validate command  running   a tools platform chassis reboot warm validate platform warm reboot validate requested  success if the validation is successful proceed with the warm reboot if the validation is unsuccessful or if an attempt to perform a warm reboot fails you can force the warm reboot using the additional force option caution forcing a warm reboot may result in a service outage the force option overrides any warnings such as peers that are not configured or peers that do not support graceful restart  running   a tools platform chassis reboot warm force platform warm reboot force requested  success see the configuration state support section in the sr linux software installation guide for information about how to use warm reboot during an issu 313 nonstop forwarding nonstop forwarding or nsf is the sequence of processes required to effectively switch control of a running system between two supervisors or cpms activestandby without disrupting the data forwarding it allows the router to continue forwarding data with previously known routestate information while the control plane restarts and reconverges similar to system warm reboot nsf depends on graceful restart helpers but it is primarily used for unplanned outage for example control plane failover and cannot be used for upgrades during an nsf switchover no control plane or management plane functions are available including refreshing of neighbors and slow path functions like dhcp relay and responding to arpnd in sr linux nsf leverages application warm restart with the fundamental design to synchronize the idb server idbserver with the standby cpm supervisor and to allow applications to leave their state information in idb during the restart then recover it after the restart for more information see triggering redundancy switchover and forcing redundancy synchronization 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 33 configuration basics guide release 247 system management note currently the nsf feature is supported only for 7250 ixr6106e10e and 7250 ixrx platforms nsf features and limitations nsf is supported with the following feature set  supports acl ipv4 and ipv6  supports complete qos feature set including queue configuration classifiers ecn with counters cleared  supports ipv4ipv6 routing  supports bgp with ipv4ipv6unicast address families where all neighboring devices support graceful restart helper note peers who do not support graceful restart withdraw routes during outages impacting the data path for traffic destined for the system undergoing nsf however nsf must be attempted for any peers that support graceful restart helper  supports isis with ipv4ipv6unicast address families where all neighboring devices support graceful restart helper note peers who do not support graceful restart withdraw routes during outages impacting the data path for traffic destined for the system undergoing nsf however nsf must be attempted for any peers that support graceful restart helper  supports lag and lacp with both slow and fast timers  supports p4rt  supports gribi during nsf though management plane functions are unavailable gribi programmed routes are persisted  supports sflow on slow path  supports lldp note in case of session time out adjacency loss may occur 3131 triggering redundancy switchover procedure use the command tools platform redundancy switchover to trigger a redundancy switchover from active to the standby control module the switchover happens in conjunction with a cold restart example to trigger redundancy switchover  running    tools platform redundancy switchover 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 34 configuration basics guide release 247 system management the nsf implementation changes the default behavior of this command execution upon nsf implementation when a redundancy switch over is triggered the system always attempts to perform a nsf failover in conjunction with a warm restart note the command tools platform redundancy switchover is not impacted by any pending delayed reboots 3132 forcing redundancy synchronization procedure you can use the tools platform redundancy synchronize overlay system to synchronize the overlay file system or systemrequired data between the active and standby control modules the nsf implementation extends this behavior by including the synchronization of file system and idb server info between the modules example to synchronize use the following command  running    tools platform redundancy synchronize overlay system 314 vrrp virtual router redundancy protocol vrrp describes a method of implementing a redundant ip interface shared between two or more routers on a common lan segment allowing a group of routers to function as one virtual router when this ip interface is specified as a default gateway on hosts directly attached to a shared broadcast domain the routers sharing the ip interface prevent a single point of failure by limiting access to this gateway address the vrrp for ipv4 is defined in the ietf rfc 3768 virtual router redundancy protocol vrrp version 3 for both ipv4 and ipv6 is defined in rfc 5798 vrrp election process vrrp routers use vrrp advertisement messages to communicate these messages include a vrrp priority value the router with the highest configurable priority value becomes the active vrrp router and assumes control of the virtual ip address for the vrrp instance if multiple routers have the same value the router with the highest ip address becomes the active vrrp router if the active router fails to send advertisements within a certain time frame a new election occurs and the highest priority backup router becomes the active router 3141 configuring vrrp about this task to configure vrrp within an ip subinterface context you must configure a virtual router id using the vrrp group command to specify the ip address for the associated virtual router configure the virtualaddress parameter 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 35 configuration basics guide release 247 system management the following list outlines key optional parameters  priority  configures vrrp router priority to a specific value  advertiseinterval  configures vrrp message frequency  preempt  controls whether a new vrrp router with a preferred vrrp priority can assume the role of the active vrrp  authentication  configures authentication for vrrp messages the following example shows a sample vrrp v4 and v6 instance configuration example   candidate shared default  interface ethernet14   info adminstate enable vlantagging true ethernet  portspeed 40g  subinterface 1  adminstate enable ipv4  adminstate enable address 1011124  vrrp  vrrpgroup 1  adminstate enable priority 110 preempt true acceptmode true virtualaddress  1011100     address 1012124  vrrp  vrrpgroup 2  adminstate enable priority 110 preempt true acceptmode true virtualaddress  1012100     address 1013124  vrrp  vrrpgroup 3  adminstate enable priority 110 preempt true acceptmode true virtualaddress  1013100     3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 36 configuration basics guide release 247 system management  ipv6  address 2001db81011164  vrrp  vrrpgroup 1  adminstate enable priority 110 preempt true acceptmode true virtualaddress  2001db81011100      vlan  encap  singletagged  vlanid 1     3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 37 configuration basics guide release 247 configuration management 4 configuration management this chapter describes concepts for managing the sr linux configuration including configuration datastores modes and how to commit changes to the running configuration 41 default configuration at startup the sr linux loads a json configuration file located at etcoptsrlinuxconfigjson if this startup configuration does not exist the system is started using a factory default configuration the factory default configuration brings the device into management enables dhcpv6 on the management interface adds it to the management networkinstance enables an ssh server creates various system logs and applies a default set of cpm filters you can optionally create a rescue configuration which is loaded if the startup configuration fails to load see rescue configuration if the startup configuration fails to load and no rescue configuration exists the system is started using the factory default configuration 42 configuration datastores configuration and state information reside in datastores on the sr linux device the following datastores are available  running the running datastore contains the currently active configuration  state the state datastore contains the running configuration plus dynamically added data such as the operational state of interfaces or bgp peers added via autodiscovery as well as session states and routing tables  candidate the candidate datastore contains a userconfigurable version of the running datastore after it has been committed the candidate datastore becomes the running datastore  tools the tools datastore contains executable commands that allow you to perform operations such as restarting the device and clearing interface statistics in the cli you can use the info command to display information from a datastore for example entering the info from state command or entering the info command in state mode displays configuration and statistics from the state datastore for the current context and entering the info from running command or the info command in running mode displays the configuration from the running datastore for the current context 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 38 configuration basics guide release 247 configuration management 43 configuration modes the candidate datastore corresponds to a configuration mode within the sr linux cli in candidate mode you can modify the sr linux configuration settings by default candidate mode operates in shared mode which allows multiple users to modify the candidate configuration concurrently when the configuration is committed in shared mode all of the users changes are applied you can optionally use candidate mode in exclusive mode which locks out all other users from making changes to the candidate configuration 431 configuration candidates when a user enters candidate mode the system creates two copies of the running datastore one is modifiable by the user and the other serves as a baseline the modifiable datastore and the baseline datastore are collectively known as a configuration candidate a configuration candidate can be either shared or private  shared the shared configuration candidate is the default for cli sessions multiple users can modify the shared candidate concurrently when the configuration is committed the changes from all of the users are applied  private the private configuration candidate is the default when using jsonrpc or gnmi clients and can optionally be used in the cli with a private candidate each user modifies their own separate instance of the configuration candidate when a user commits their changes only the changes from that user are committed by default there is a single unnamed global configuration candidate you can optionally configure one or more named configuration candidates which function identically to the global configuration candidate both shared and private configuration candidates support named versions 432 setting the configuration mode procedure after logging in to the cli you are initially placed in running mode from running mode you can change to a configuration mode table 1 commands to change configuration mode describes the commands to change between modes table 1 commands to change configuration mode to enter this mode type this command candidate shared enter candidate candidate mode for named shared candidate enter candidate name name 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 39 configuration basics guide release 247 configuration management to enter this mode type this command candidate private enter candidate private candidate mode for named private candidate enter candidate private name name candidate exclusive enter candidate exclusive exclusive mode for named candidate enter candidate exclusive name name running state show enter running enter state enter show example change from running to candidate mode  running    enter candidate   candidate shared default   the asterisk  next to the mode name indicates that the candidate configuration has changes that have not yet been committed example enter candidate mode for a named configuration candidate  running    enter candidate name cand1  candidate shared cand1  44 committing a configuration in candidate mode about this task changes made during a configuration modification session do not take effect until a commit command is issued only use the commit command in candidate mode procedure step 1 enter candidate mode example  enter candidate step 2 enter configuration commands step 3 enter the commit command  to apply the changes and remain in candidate mode enter commit stay  to apply the changes exit candidate mode and enter running mode enter commit now 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 40 configuration basics guide release 247 configuration management  to apply the changes remain in candidate mode and save the changes to the startup configuration enter commit stay save  to apply a comment to a commit stay or save operation use the comment keyword and specify a comment example  enter candidate  candidate shared default    interface ethernet11 subinterface 1   candidate shared default  interface ethernet11 subinterface 1   commit stay all changes have been committed starting new transaction   candidate shared default  interface ethernet11 subinterface 1   save startup system saved current running configuration as initial startup configuration etc optsrlinuxconfigjson  candidate shared default  interface ethernet11 subinterface 1   in this example a user enters candidate mode and creates a subinterface for interface ethernet11 the asterisk  next to candidate shared default in the prompt indicates that the candidate configuration has changes that have not yet been committed after committing the changes with the commit stay command the new subinterface becomes part of the running configuration the plus sign  in the prompt indicates that the currently running configuration differs from the startup configuration the save startup command saves the running configuration to the startup configuration 441 confirming a commit operation procedure you can optionally configure the sr linux to require explicit confirmation via a tools command for the configuration changes from a commit operation to become permanent if the new configuration is not confirmed after a timeout period the running datastore reverts to the previous version example commit the configuration and start the confirmation timer after entering configuration commands in candidate mode use the following command to commit the configuration and start the confirmation timer  candidate shared default    commit confirmed the commit confirmed command applies the changes to the running datastore and activates them if the configuration is committed successfully the confirmation timer is started default 10 minutes if you do not confirm the commit operation before the timer expires the configuration reverts to the previous version 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 41 configuration basics guide release 247 configuration management example confirm the commit operation and make the configuration changes permanent to confirm the commit operation and make the configuration changes permanent enter the following command before the confirmation timer expires  candidate shared default    tools system configuration confirmedaccept example revert to the previous configuration to revert to the previous configuration without waiting for the confirmation timer to expire enter the following command  candidate shared default    tools system configuration confirmedreject 442 validating a commit operation procedure you can optionally validate the configuration changes made during a commit operation before they are applied to the running datastore the sr linux management server checks the syntax of the changes in the candidate configuration and displays messages if validation errors are found example use the following command to perform a validation check for configuration changes note this command only validates the changes it does not apply them to the running datastore  candidate shared default    commit validate if syntax errors are found in the configuration changes sr linux displays error messages if validation is successful no output is displayed 443 updating the baseline datastore procedure a configuration candidate consists of a modifiable candidate datastore and a baseline datastore both of which are snapshots of the thencurrent running datastore when a user enters candidate mode during the lifetime of the configuration candidate the running datastore can be modified via commits initiated from other configuration sessions at that point the baseline in the configuration candidate is out ofdate updating the baseline datastore takes a new snapshot of the running configuration applies the changes in the candidate datastore and checks for configuration conflicts in the updated baseline datastore if conflicts are found the user is informed with a warning or error for each conflict a baseline datastore is updated automatically when the user commits the changes to the configuration or can be updated manually with the baseline update command 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 42 configuration basics guide release 247 configuration management example in the following example the baseline datastore in a configuration candidate is out of date as indicated by the exclamation mark  in the prompt this indicates that another user has committed changes to the running datastore entering the baseline update command copies the current running datastore to the baseline datastore applies the changes in the candidate datastore then displays any conflicts in the updated baseline datastore if there are no conflicts no output is returned by the command  candidate shared default    baseline update  candidate shared default    45 deleting a configuration procedure use the delete command to delete configurations while in candidate mode example the following example displays the system banner configuration deletes the configured banner then displays the resulting system banner configuration  candidate shared default    info system banner system  banner  loginbanner welcome to sr linux    candidate shared default    delete system banner  candidate shared default    info system banner system  banner    46 annotating the configuration procedure to aid in reading a configuration you can add comments or descriptive annotations the annotations are indicated by three exclamation marks  in displayed output you can enter a comment either directly from the command line or by navigating to a cli context and entering the comment in annotate mode 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 43 configuration basics guide release 247 configuration management example add a comment to a configuration the following example adds a comment to an acl configuration if there is already a comment in the configuration the new comment is appended to the existing comment  candidate shared default    acl aclfilter iptcp type ipv4  filter tcp traffic example replace an existing comment to replace the existing comment use three exclamation marks  instead of two exclamation marks  in the command the following example adds the same comment to the acl by navigating to the context for the acl and entering the comment in annotate mode   candidate shared default    acl aclfilter iptcp type ipv4   candidate shared default  acl aclfilter iptcp type ipv4   annotate press metaenter or esc followed by enter to finish  filter tcp traffic you can enter multiple lines in annotate mode to exit annotate mode press esc then press enter example display a comment in context in cli output the comment is displayed in the context it was entered for example  running    info acl acl  aclfilter iptcp type ipv4   filter tcp traffic entry 1000  description match ip address tcp protocol ports match  ipv4  protocol tcp destinationip  prefix 1013132  sourceip  prefix 1015132   transport  destinationport  value 6789  sourceport  value 6722    action  log true accept      3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 44 configuration basics guide release 247 configuration management  to remove a comment enter annotate mode for the context and press esc then enter without entering any text 47 discarding a configuration in candidate mode procedure you can discard previously applied configurations with the discard command only use the discard command in candidate mode  to discard the changes and remain in candidate mode with a new candidate session enter discard stay  to discard the changes exit candidate mode and enter running mode enter discard now example all changes have been committed starting new transaction  candidate shared default  interface ethernet11 subinterface 1   discard stay  candidate shared default  interface ethernet11 subinterface 1  48 displaying configuration details procedure the info command displays configuration and state information entering the info command from the root context displays the entire configuration or the configuration for a specified context entering the command from within a context limits the display to the configuration under that context use this command in candidate or running mode example display the entire configuration to display the entire configuration enter info from the root context  candidate shared default    info all the configuration is displayed  candidate   example display the configuration for a specific context to display the configuration for a specific context enter info and specify the context  candidate shared default    info system lldp system  lldp  adminstate enable hellotimer 600 managementaddress mgmt00  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 45 configuration basics guide release 247 configuration management type  ipv4   interface mgmt0  adminstate disable     candidate   example display the configuration within a context from a context use the info command to display the configuration under that context  candidate shared default    system lldp  candidate  system lldp   info adminstate enable hellotimer 600 managementaddress mgmt00  type  ipv4   interface mgmt0  adminstate disable   candidate  system lldp  example display the configuration as jsonformatted output use the as json option to display jsonformatted output  candidate  system lldp   info  as json  adminstate enable hellotimer 600 managementaddress   subinterface mgmt00 type  ipv4    interface   name mgmt0 adminstate disable    example display values of all parameters in the configuration use the detail option to display values for all parameters including those not specifically configured  candidate  system lldp   info detail 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 46 configuration basics guide release 247 configuration management adminstate enable hellotimer 600 holdmultiplier 4 managementaddress mgmt00  type  ipv4   interface mgmt0  adminstate disable  example display the configuration as set statements use the flat option to display the output as a series of set statements omitting indentation for any subcontexts  candidate  system lldp   info flat set  system lldp adminstate enable set  system lldp hellotimer 600 set  system lldp managementaddress mgmt00 set  system lldp managementaddress mgmt00 type  ipv4  set  system lldp interface mgmt0 set  system lldp interface mgmt0 adminstate disable example display a specified number of subcontext levels use the depth option to display parameters with a specified number of subcontext levels  candidate  system lldp   info depth 0 adminstate enable hellotimer 600  candidate  system lldp   info depth 1 adminstate enable hellotimer 600 managementaddress mgmt00  type  ipv4   interface mgmt0  adminstate disable  49 displaying the configuration state procedure to display information from the state datastore enter the info from state command in candidate mode running mode or the info command in state mode 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 47 configuration basics guide release 247 configuration management example display state information for a specified context from candidate or running mode  candidate shared default    info from state routingpolicy policy bgpexportpolicy routingpolicy  policy bgpexportpolicy  statement 999  action  accept       example display state information for a specified context from state mode  candidate shared default    enter state  state    info routingpolicy policy bgpexportpolicy routingpolicy  policy bgpexportpolicy  statement 999  action  accept        state   example change to a different mode while remaining in the previous context you can change to a different mode for example from state mode to candidate mode and remain in the previous context for example  candidate shared default    enter state  state    routingpolicy policy bgpexportpolicy  state  routingpolicy policy bgpexportpolicy   info statement 999  action  accept      state  routingpolicy policy bgpexportpolicy   enter candidate  candidate shared default  routingpolicy policy bgpexportpolicy  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 48 configuration basics guide release 247 configuration management 410 saving a configuration to a file procedure save the existing configuration to a file using the save command use this command in candidate or running mode example save the running configuration to a file  running    save file runningconfigtxt text from running  running configuration has been stored in runningconfigtxt  running   example save the running configuration to a jsonformatted file  running    save file runningconfigjson from running  running configuration has been stored in runningconfigjson  running   example save the running configuration to the initial startup configuration   running    save startup  running configuration has been stored in etcoptsrlinuxconfigjson  running   the plus sign  in the prompt indicates that the running configuration differs from the startup configuration after you enter the save startup command the running configuration is synchronized with the startup configuration and the plus sign is removed from the prompt 411 loading a configuration procedure use the load command to load a configuration the configuration can be from a checkpoint see configuration checkpoints a jsonformatted configuration file the startup configuration the factory default configuration a rescue configuration see rescue configuration or from manually entered or pasted jsonformatted input example load a configuration from a checkpoint   candidate shared default    load checkpoint id 0 systemconfigurationcheckpointid0 loaded checkpoint etcoptsrlinuxcheckpointcheckpoint0json example load a configuration from a file   candidate shared default    load file homeconfigtxt 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 49 configuration basics guide release 247 configuration management loading configuration from homeconfigtxt example load a rescue json configuration from a checkpoint   candidate shared default    load rescue autocommit systemconfigurationcheckpointidrescue reverting to rescue configuration example load a configuration from manually entered jsonformatted input   candidate shared default    system banner   candidate shared default  system banner   load json press metaenter or esc followed by enter to finish    loginbanner welcome to sr linux   you can enter or paste multiple lines at the  prompt in jsoninput mode to exit jsoninput mode press esc then press enter 412 executing configuration statements from a file procedure you can execute configuration statements from a source file consisting of set statements such as those generated by the info flat command see displaying configuration details sr linux reads the file and executes each configuration statement linebyline you can optionally commit the configuration automatically after the file is read example the following example executes a configuration from a specified file  running    source configcfg sourcing commands from configcfg executed 20 lines in 16541 seconds from file configcfg use the autocommit option to commit the configuration after the commands in the source file are executed 413 configuration checkpoints you can roll back the configuration to a previous state known as a checkpoint you can load a saved checkpoint into the candidate configuration and revert the running configuration to a previously saved checkpoint a checkpoint is saved as a jsonformatted file containing the complete configuration for the system if a checkpoint file is larger than 1 mb it is compressed and saved in gzip format checkpoint files are saved 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 50 configuration basics guide release 247 configuration management in the etcoptsrlinuxcheckpoint directory they are named checkpointnumberjson for example checkpoint0json or checkpointnumberjsongz with the lowest number being the most recently saved checkpoint by default the 10 most recent checkpoints are saved you can configure the maximum number of checkpoint files that are kept by the system 4131 generating a checkpoint procedure you can generate a checkpoint with a tools command or with the save checkpoint command you can optionally configure the system to generate a checkpoint automatically when a configuration is committed example generate a checkpoint from the current configuration   candidate shared default    tools system configuration generatecheckpoint system generated checkpoint etcoptsrlinuxcheckpointcheckpoint 0json with name checkpoint20201020t231412703z and comment  you can optionally configure a name or comment for a checkpoint for example   candidate shared default    save checkpoint comment mycheckpoint system generated checkpoint etcoptsrlinuxcheckpointcheckpoint 0json with name checkpoint20201020t232325891z and comment mycheckpoint example generate a checkpoint automatically the following example configures the system to generate a checkpoint automatically whenever a configuration is committed   candidate shared default    info system configuration system  configuration  autocheckpoint true    for automatically generated checkpoints the comment is set to automatic checkpoint after commit n where n is the id of the commit that triggered the checkpoint 4132 loading a checkpoint procedure to load a checkpoint enter candidate mode and specify the checkpoint to load 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 51 configuration basics guide release 247 configuration management example the following example loads a checkpoint into the candidate configuration note you must be in candidate mode to load a checkpoint   running    enter candidate   candidate shared default    tools system configuration checkpoint 0 load systemconfigurationcheckpointid0 loaded checkpoint etcoptsrlinuxcheckpointcheckpoint0json 4133 reverting to a previous checkpoint procedure you can revert the running configuration to a previous checkpoint when used within a candidate session the revert operation loads the checkpoint removing any present changes then commits them and establishes a new candidate session example the following example reverts the running configuration to a previously saved checkpoint   running    enter candidate   candidate shared default    tools system configuration checkpoint 0 revert systemconfigurationcheckpointid0 reverting to checkpoint 0 name checkpoint20191014t184730282z comment dailycheckpoint  successfully reverted configuration 4134 clearing a checkpoint procedure you can clear checkpoints from the system manually with a tools command in addition checkpoints can be cleared automatically when the number of saved checkpoints exceeds the configured maximum when the number of saved checkpoints exceeds the configured maximum the oldest checkpoint is removed and the number of each remaining checkpoint is incremented by 1 if you clear a checkpoint manually the other checkpoints are not renumbered example the following example clears a previously saved checkpoint   candidate shared default    tools system configuration checkpoint 2 clear systemconfigurationcheckpointid2 cleared checkpoint etcoptsrlinuxcheckpointcheckpoint2json 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 52 configuration basics guide release 247 configuration management 4135 configuring maximum number of checkpoints procedure by default the 10 most recent checkpoints are saved you can configure the maximum number of checkpoint files that are kept by the system example the following example configures the system to keep a maximum of 15 checkpoint files   candidate shared default    info system configuration system  configuration  maxcheckpoints 15    in this example if 15 checkpoint files are being kept adding a subsequent checkpoint file causes the oldest checkpoint file to be deleted and the index for the remaining checkpoint files to be incremented by 1 4136 displaying checkpoint information procedure use the info from state command to display information about existing checkpoints example  info from state system configuration checkpoint 0 system  configuration  checkpoint 0  name checkpoint20201020t232325891z comment cp002 created 20201020t232325894z version v2060 username srlinux size 28494    414 rescue configuration you can save a secondary rescue configuration to load in place of the default json configuration file the rescue configuration is a checkpoint file that is loaded automatically by the management server if the default configjson file fails when the system starts if both the default configuration and rescue configuration files are missing or fail a configjson file is regenerated and committed from the factory configjson file that is compiled in the management server 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 53 configuration basics guide release 247 configuration management 4141 saving a rescue configuration procedure you can save a rescue configuration to be loaded automatically if the default configjson file fails when the system starts save the rescue configuration to a file with a tools command or using the save rescue command use these commands in running mode the system generates a rescueconfigjson file and saves it to the etcoptsrlinuxcheckpoint directory example save a rescue configuration the following tools command saves a rescue configuration  running    tools system configuration rescuesave system saved current running configuration as rescue configuration etcoptsrlinux checkpointrescueconfigjson the following save rescue command also saves a rescue configuration  running    save rescue system saved current running configuration as rescue configuration etcoptsrlinux checkpointrescueconfigjson example list contents of the checkpoint directory you can confirm the rescue configuration is saved by viewing the checkpoint directory the following example lists the checkpoint directory  running    file ls etcoptsrlinuxcheckpoint checkpoint0json rescueconfigjson 4142 clearing a rescue configuration procedure to remove an existing rescue configuration use the rescueclear command to clear the configuration from the etcoptsrlinuxcheckpoint directory use this command in running mode you can then save a new rescue configuration to replace the cleared configuration example the following tools command clears a previously saved rescue configuration  running    tools system configuration rescueclear system cleared rescue configuration etcoptsrlinuxcheckpointrescueconfigjson 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 54 configuration basics guide release 247 configuration management you can confirm the rescue configuration is cleared by viewing the checkpoint directory for example  running    file ls etcoptsrlinuxcheckpoint checkpoint0json 415 configuration upgrades when the sr linux is started following a software image upgrade it reads the configuration in the startup configjson file makes any necessary changes to ensure compatibility with the new software image and places the upgraded configuration into the running configuration this upgraded configuration is not saved automatically to save the contents of the running configuration use the following commands  save startup  saves the running configuration to the startup configuration file located at etcopt srlinuxconfigjson or configgz  save rescue  saves the running configuration to the rescue configuration file located at etcopt srlinuxcheckpointrescueconfigjson or rescueconfiggz  save checkpoint  saves the running configuration to a configuration checkpoint for example etc optsrlinuxcheckpointcheckpoint0json or checkpoint0gz  save file name from running  saves the running configuration to the specified file in json format 4151 upgrading configuration files procedure in addition to saving the upgraded running configuration to startup rescue and checkpoint configurations you can use tools commands to upgrade existing configuration files so they are compatible with the current software version example upgrade the startup configuration file  running    tools system configuration upgrade startup example upgrade the rescue configuration file  running    tools system configuration upgrade rescue example upgrade a configuration checkpoint file  running    tools system configuration upgrade checkpoint 0 example upgrade a specified jsonformatted configuration file  running    tools system configuration upgrade file etcoptsrlinuxconfigsmyconfigjson 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 55 configuration basics guide release 247 securing access 5 securing access the sr linux device is able to secure access to the device for users connecting via ssh or the console port as well as for applications and ftp access authentication can be performed for users configured within the underlying linux os and for administrative users configured within the sr linux device itself depending on the user type users are authenticated locally on the device or through interaction with the sr linux aaamgr application and an authentication server group for example tacacs or radius 51 user types the sr linux supports three user types linux users local users and remote users each user type is authenticated differently as described in the following sections 511 linux users linux users are those configured in the underlying linux os not in the sr linux configuration information about linux users is stored in etcpasswd in the underlying linux os by default the sr linux has a single linux user linuxadmin who has access to sudo to root and can run the sr linux cli with administrative permissions the default password for the linuxadmin user is nokiasrl1 which can be changed see configuring the password for the linuxadmin user nokia recommends that you change this default user and password as soon as possible other linux users can be added with the useradd command in the underlying linux os linux users with a uid less than 1500 are authenticated via the underlying linux os not through the sr linux aaamgr application this means that linux users are not subject to authentication settings configured within sr linux such as authentication by a tacacs server group a radius server group or password security for local users 512 local users local users are users configured within the sr linux itself by default sr linux supports a single local user named admin other local users can be added as necessarythe default password for the admin user is nokiasrl1 which you can change using the sr linux cli see configuring authentication for local users nokia recommends that you change this default password as soon as possible local users are authenticated via a grpc interface to the aaamgr application see authentication for local users for an example configuration 513 remote users remote users are users that are not configured either in etcpasswd or within the sr linux configuration remote users are configured on a remote server which is queried when the user attempts to log in to the sr linux device 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 56 configuration basics guide release 247 securing access 52 aaa functions the sr linux performs authentication authorization and accounting aaa functions for each user type as described in the following sections 521 authentication for linux users sr linux authenticates via the authentication mechanism built into the underlying linux os for local users including the sr linux admin user the sr linux uses its grpc interface to the aaamgr application for authentication authentication settings that apply to the local users including a local password and tacacs or radius server group can be configured see authentication for local users for information about configuring local users for remote users authentication is performed using the aaamgr application in coordination with the remote system sr linux supports yescrypt encryption in addition to the argon2 ar2 and sha512 sha2 algorithms all local users who authenticate using plain text or hashed passwords including the admin user are subject to these encryptions by default yescrypt encryption is used to secure cleartext passwords see password hashing for local users for the linuxadmin user password only the sha2 and yescrypt encryption options are supported if the ar2 encryption is selected the password is hashed using yescrypt instead 5211 superuser attribute for local users sr linux default admin user and local users have a configurable superuser parameter setting under systemaaaauthenticationuser when configuring the superuser attribute the local user gains elevated permissions and is included in the etcsudoers file the local user can now use the bash plugin and then sudo to run any command as the root user for information about configuring superuser attribute see configuring superuser attribute for local users 5212 password security for local users sr linux supports password security features that apply to local users who authenticate using plain text or hashed passwords the settings are systemwide configurations that apply to all locally configured users including the admin and the linuxadmin user the following password security features are supported  password complexity rules specifies rules that define the password requirements including minimum and maximum length minimum lowercase and uppercase characters minimum numeric and special characters and whether the password can include the users full username or only the first three characters the configuration of password complexity rules applies only to new passwords entered as clear text not to preexisting or prehashed ones  password aging specifies the number of days after which a password expires 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 57 configuration basics guide release 247 securing access note  users with aged out passwords are prompted to update their password at the next login to the cli this prompt only appears on the cli  sr linux does not provide advanced warning to users that their password is about to expire  aged out passwords expire indefinitely they are not controlled by the lockout policy described below  password change on first login specifies whether local users must change their password on first login the new password must match the defined password complexity rules  password history specifies the number of previous user passwords sr linux retains to prevent reuse of old passwords  lockout policy specifies how many times a user can attempt a failed login within a defined period before they are locked out for example three attempts within 1 minute the policy also defines whether the user is locked out indefinitely or only for a specified length of time 5213 password hashing for local users password hashing is applied to all locally configured users including the admin and the linuxadmin user sr linux supports yescrypt encryption in addition to the argon2 ar2 and sha512 sha2 algorithms you can choose to configure any of these supported methods the plain text user passwords are encrypted using the default hashing method yescrypt when entering a hashed password value the system verifies whether the entered password is encrypted using one of the supported algorithms the system only commits changes if the password has been hashed using a supported algorithm when you change the password the system encrypts the password using the configured hash method see configuring hashmethod for local user passwords the default hashing algorithm is yescrypt 522 authorization the sr linux implements authorization through rolebased access control where each authenticated user is assigned one or more predefined roles that specify the functions the user is allowed to perform on the system if no role is configured for a user then the user is assigned a role that allows access to cli plugins but no other functions all user types including the default local user admin are authorized through rolebased control on all interfaces cli gnmi and jsonrpc however the linuxadmin user is an exception and is granted write access to all commands in the command tree rolebased access control supports service and cli plugin authorization you can configure service authorization which can limit the interface types for which the functions in a role are authorized cli plugin authorization gives you control over how operator provided plugins are loaded 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 58 configuration basics guide release 247 securing access you can configure the sr linux to use information from a tacacs or radius server to assign roles to an authenticated user  in tacacs authorization the privlvl value in the authorization reply packet received from the tacacs server maps to a role configured on the sr linux the user is assigned the role that corresponds to the privlvl value  radius combines authentication and authorization the radius server authorizes the user by applying a profile based on username and password configurations the profiles are configured using vendorspecific attributes vsas on the radius server the actions an authenticated user can perform depend on the user profiles profiles consist of a suite of commands that the user is allowed or not allowed to execute see authorization using rolebased access control for information about configuring roles for users 5221 superuser role attribute for local users local users have a configurable superuser role setting under systemaaaauthorizationrole you can grant the sudo privileges to the individual users or groups following the standard linux semantics when a user has multiple roles with the superuser role setting enabled the combined roles grant superuser privileges a superuser inherits the following behaviors  when the superuser is a member of multiple roles the superuser is authorized to access all services specified in the assigned roles  when the superuser is not assigned any specific role the superuser is authorized to access all services note if a user has multiple roles and has no superuser role setting enabled the user is authorized only for the services specified in the assigned roles  a superuser can load all cli plugins provided the superuser is associated with a role that supports cli plugin authorization  a superuser has an implicit role added that allows the user to write to the root directory   a superuser is added to the etcsudoers file and can use the bash plugin and then sudo to run any command as the root user for information about configuring the superuser role attribute see configuring superuser role for local users 523 accounting the sr linux supports command accounting accounting records generated by the sr linux include the entire cli string that a user enters on the command line including any pipes or output redirects specified in the command you can configure the sr linux device to send accounting records to a destination specified in an accountingmethod list such as a tacacs or radius server group or the local system for each user type the sr linux device generates accounting records as follows 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 59 configuration basics guide release 247 securing access  for local users including the sr linux admin user command accounting records are sent to the destination specified in the accountingmethod list both for commands entered in the sr linux cli and for commands entered in the bash shell  for linux users and remote users command accounting records are sent for commands entered in the sr linux cli including linux commands entered in the sr linux cli using the bash command although not for commands entered in the bash shell see configuring tacacs accounting and configuring radius accounting for an example configurations 53 aaa server group configuration the sr linux supports the following server group types for aaa functions  local  uses local authentication including etcpasswd etcgroup and logging via syslog  tacacs  performs aaa via interaction with servers in a tacacs server group  radius  performs aaa via interaction with servers in a radius server group the aaa type that is configured is used for all aaa functions and cannot use different types for different functions users whose aaa functions are handled by the aaamgr application that is the sr linux admin user and local users can use one of these server groups for authentication and accounting each tacacs or radius server group can have up to five servers when authenticating a user or writing an accounting record the sr linux tries each server in the group in a roundrobin fashion until a response is received if no response is received within a specified timeout period the sr linux tries the next server in the group if no response is received from any of the servers in the group the sr linux moves to the next specified authentication or accounting method if no other authentication method is specified or the server group is the last method in the list then the authentication or accounting request is rejected 531 configuring an aaa server group procedure you can configure authentication server groups for aaa functions configuring server groups provides a way to group the aaa server hosts grouping server hosts allows you to select a subset of the configured server hosts and use them for an aaa service tacacs and radius requests are sourced from the mgmt networkinstance example configure tacacs and local server groups for aaa functions each server group consists of three servers the timeout period specifies that the sr linux wait 30 seconds for a response from a server before trying the next server in the group for the server group of type local no external servers can be specified the local server group uses etcpasswd and etcgroup for authentication and syslog for accounting the timeout period specifies that the sr linux wait a maximum of 60 seconds for an aaa function to complete sr linux allows you to configure the source ip address of the packets sent from the router to the tacacs server you can configure the sourceaddress parameter as either an ipv4 or ipv6 address under systemaaaservergroupnameserveraddress 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 60 configuration basics guide release 247 securing access tacacs within a network instance in the following example the tacacs requests are sent from the configured ipv4 or ipv6 sourceaddress in the mgmt network instance   candidate shared default    info system aaa system  aaa  servergroup localgroup  type local timeout 60  servergroup tacacsgroup  type tacacs timeout 30 server 10001  networkinstance mgmt tacacs  secretkey aes1awwxme8cnxaz28tyldbye6bovha14ikmpag sourceaddress 19216834   server 10002  networkinstance mgmt tacacs  secretkey aes1awuxmtqsezqvzg8ly73o0hetwx8umjiyienaq sourceaddress 19216834   server 10003  networkinstance mgmt tacacs  secretkey aes1awupuzthmjjsxg8no1xdn4ee8z1yca7qbwcg sourceaddress 19216834      example configure radius server group for aaa functions each server group consists of three servers the timeout period specifies that the sr linux wait 30 seconds for a response from a server before trying the next server in the group the server host entries are tried in the order in which they are configured by default the radius protocol uses port 1812 for authentication and authorization and port 1813 for accounting sr linux allows you to configure the source ip address of the packets sent from the router to the radius server you can configure the sourceaddress parameter as either an ipv4 or ipv6 address under systemaaaservergroupnameserveraddress radius within a network instance in the following example the radius requests are sent from the configured ipv4 or ipv6 sourceaddress in the mgmt network instance   candidate shared default   info system aaa system  aaa  servergroup radiusgroup  type radius timeout 30 server 10001  networkinstance mgmt 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 61 configuration basics guide release 247 securing access radius  authport 1812 acctport 1813 secretkey aes1awwdbq87riuvxm8a56muaolkx9qvgzbecw3g sourceaddress 19216834   server 10002  networkinstance mgmt radius  authport 1812 acctport 1813 secretkey aes1awxdsbxvcfuig83fzuwfpb3co1zvvybkfd1q sourceaddress 19216834   server 10003  networkinstance mgmt radius  authport 1812 acctport 1813 secretkey aes1awwhvcwdab4gt28jfpzjxra9kc82zv1vr2wsa sourceaddress 19216834      54 authentication for the linuxadmin user the sr linux linuxadmin user is installed by default in etcpasswd the linuxadmin user has access to sudo to root and can run the sr linux cli with admin permissions the default password for the linuxadmin user is nokiasrl1 you can change this password via the sr linux cli or any other supported interface 541 configuring the password for the linuxadmin user procedure you can set a password for the linuxadmin user note for the linuxadmin user password only the sha2 and yescrypt encryption options are supported if the ar2 encryption is selected the password is hashed using yescrypt instead example   candidate shared default    system aaa authentication linuxadminuser password newpass1234 when the user configuration is displayed the password is hashed for example   candidate shared default   3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 62 configuration basics guide release 247 securing access  info system aaa authentication linuxadminuser system  aaa  authentication  linuxadminuser  password yj9t2502d6515df892cfnz4dj0h7u7zscvrar3v0fx bike5xkl5nmux3w5uvp     55 authentication for local users local users are those configured in the sr linux cli for a local user you can configure a password and specify one or more authentication methods including local authentication or remote authentication using a tacacs or radius server note for authentication functionality such as password lockout and the failedloginattempts counter the ntp server must be enabled and in synchronization 551 configuring authentication for local users procedure by default there is a single local user configured on the sr linux admin the default password for the admin user is nokiasrl1 you can configure additional local users note when you change the password the system encrypts the password as per the configured hash method see configuring hashmethod for local user passwords default is argon2 ar2 example configure a password for the sr linux admin user   candidate shared default    system aaa authentication adminuser password newpass1234 example configure a password for a local user srlinux   candidate shared default    system aaa authentication user srlinux password sr1l234 when the user configuration is displayed the password is hashed  for example   candidate shared default    info system aaa system  aaa  authentication  user srlinux  password ar2kgsitqfju5gizz6xkxtxozogmbexo2ypg  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 63 configuration basics guide release 247 securing access    example change an existing users password to change an existing users password use the same command that created the user and configure the new password for example   candidate shared default    system aaa authentication user srlinux password newpasswordl234 example authentication methods the following example specifies authentication methods when a user attempts to log in the user is authenticated using local authentication first if local authentication fails the sr linux tries the servers in tacacs server group tacacsgroup if the user cannot be authenticated through any of these methods the authentication attempt is rejected   candidate shared default    info system aaa system  aaa  authentication  authenticationmethod  localgroup tacacsgroup     552 configuring superuser attribute for local users procedure to configure the superuser attribute set the superuser parameter under systemaaaauthenticationuser to true by default the superuser attribute is disabled this ensures backward compatibility with the previous releases example configuring the superuser attribute for a local user in this example the superuser attribute setting is enabled for the srltestuseruser   candidate shared default    info system aaa authentication user srltestuser superuser system  aaa  authentication  user srltestuser  superuser true    3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 64 configuration basics guide release 247 securing access  example configuring the superuser attribute for sr linux default admin user the following example configures the superuser attribute setting for the sr linux admin user by default the superuser attribute is enabled ensuring backward compatibility and making the superuser status of the admin user more explicit   candidate shared default    info system aaa authentication adminuser superuser system  aaa  authentication  adminuser  superuser true     553 configuring password security for local users procedure all local users who authenticate using plain text or hashed value passwords including the admin user are subject to password security and user lockout settings to configure password security and user lockout features set the following parameters under system aaa authentication  password aging 0 to 500 sets the number of days after which the user password expires and the user is prompted to update their password the default of 0 sets the password to never expire  password changeonfirstlogin true  false when set to true forces local users to change their password on the first login to the system the default is false  password history 0 to 20 specifies how many previous passwords sr linux matches a new password against such that the new password cannot be one of the previous 0 to 20 passwords the default is 0 which disables password history  password complexityrules sets the complexity rules that new passwords must match using the following options  minimumlength 1 to 12 sets the minimum password length the default is 1 which applies no minimum  maximumlength 1 to 1023 sets the maximum password length the default is 1023  minimumlowercase 0 to 10 sets the minimum required lowercase characters the default is 0 which applies no minimum  minimumuppercase 0 to 10 sets the minimum required uppercase characters the default is 0 which applies no minimum  minimumnumeric 0 to 10 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 65 configuration basics guide release 247 securing access sets the minimum required numeric characters the default is 0 which applies no minimum  minimumspecialcharacter 0 to 10 sets the minimum required number of special characters which can include the following   the default is 0 which applies no minimum note users must enter the double quote as  and the backslash as   allowusername true  false specifies whether the user can include their username as part of their password if set to false then sr linux allows only the first three consecutive characters of the username in the user password the default is true which allows the password to contain the full username  password lockoutpolicy specifies the user lockout policy using the following parameters  attempts 0 to 64 sets the number of failed login attempts that trigger the lockout the default is 0 which allows unlimited failed login attempts  time 0 to 1440 sets the time period in minutes within which the failed login attempts must occur to trigger the lockout the timer starts at the first failure the default is 1 minute  lockout 0 to 1440 sets the time period in minutes during which the user account remains locked out a value of 0 means that the user account is locked out indefinitely the default is 15 minutes  requirentpsync true  false when set to false this option forces the ntp synchronization check to be ignored and use only the system clock the default is true you can configure this setting in circumstances where the configured ntp servers are unreachable or unreliable the configurable setting to ignore the ntp sync status is included in the password changeonfirstlogin systemaaaauthenticationpasswordchangeonfirstlogin password aging systemaaaauthenticationpasswordaging and lockout policy mechanism systemaaaauthenticationpasswordlockoutpolicy when included in the above features the command requirentpsync disables ntp synchronization check however this command does not prevent the operator from syncing the system clock to ntp it simply removes the dependency on ntp synchronization for those features example configure password security and user lockout the following example sets the following password security and user lockout settings  user passwords expire after 365 days  users must change their password on first login  users cannot reuse any of their 10 previous passwords  forces the ntp synchronization check to be ignored and use only the system clock  passwords must contain  a minimum of eight and a maximum of 16 characters  one each of lowercase uppercase numeric and special characters  usernames are not allowed in the passwords 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 66 configuration basics guide release 247 securing access  after five failed attempts within 2 minutes users are locked out indefinitely   candidate shared default    info aaa authentication password aaa  authentication  password  aging 365 changeonfirstlogin true history 10 requirentpsync false complexityrules  minimumlength 8 maximumlength 16 minimumlowercase 1 minimumuppercase 1 minimumnumeric 1 minimumspecialcharacter 1 allowusername false  lockoutpolicy  attempts 5 time 2 lockout 0     554 configuring hashmethod for local user passwords procedure for localuser and adminuser passwords you can choose the password hashing method by setting the hashmethod parameter under systemaaaauthenticationpassword by default the hashmethod is set to yescrypt example configuring the yescrypt hashing algorithm   candidate shared default    info system aaa authentication password hashmethod system  aaa  authentication  password  hashmethod yescrypt     example configuring the ar2 hashing algorithm   candidate shared default    info system aaa authentication password hashmethod system  aaa  authentication  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 67 configuration basics guide release 247 securing access password  hashmethod ar2     example configuring the sha2 hashing algorithm   candidate shared default    info system aaa authentication password hashmethod system  aaa  authentication  password  hashmethod sha2     555 clearing lockedout local users procedure to display locked out users use the info from state system aaa authentication command which displays a lockout state of active true when a user is locked out to clear a local users lockout state use the following tools command tools system aaa authentication user username unlock example display user lockout state   candidate shared default   info from state system aaa authentication system  aaa  authentication  exitonreject false idletimeout 600 authenticationmethod  local  user srltest1  password btvbf0zgg8mgpihhkltqhi3vwvd04z8gh failedloginattempts 10 lastfailedlogin 20220729t223523801z passwordchangerequired true role  test  lockout  active true start 20220729t223523801z end 14 minutes from now   user srltest2  password bt2jbzbl6wautrexywpive5z10yxbiz06hjq 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 68 configuration basics guide release 247 securing access passwordchangerequired true role  test   example clear user lockout state   candidate shared default   tools system aaa authentication user srltest1 unlock systemaaaauthenticationuserusernamesrltest1 unlocked user srltest1 56 authorization using rolebased access control authorization via role based access control is performed for all user types including the default local user admin admin with the exception of the linuxadminroot users which are permitted write access to all commands in the command tree users can be configured with a set of one or more roles that define the privileges for which they are authorized in the system a role consists of one or more rules which specify a schema path the role can have privileges for and a corresponding action which can be read write or deny after authentication a user is authorized to perform the specified action defined in the path for the role the user is assigned rolebased access control supports service and cli plugin authorization  service authorization allows you to limit the actions a user is authorized to perform to specific access types such as cli and gnmi  cli plugin authorization gives you control over how operatorprovided plugins are loaded you can choose to load them from the global plugin directory or from the users home directory this feature also allows you to control the execution of cli plugins and the queries they make against the data model additionally you can manage the list of cli commands that are allowed or not allowed to execute 561 role configuration roles consist of a set of rules that define a schema pathreference and a corresponding action the path reference specifies system functions that are subject to authorization and the action specifies the privilege type for users assigned the role read write or deny the pathreference is specified relative to the root level for example the pathreference forward slash  indicates all cli functions at the root level and below the pathreference system indicates all cli functions at the system level and below and the pathreference system configuration indicates all cli functions at the system configuration level and below if no role is assigned to a user at login the user has access to all cli plugins but no access to cli commands at any level this configuration is equivalent to a rule with the forward slash  as the path reference and deny as the action when no roles are configured the admin retains its superuser privileges this ensures backward compatibility with previous releases that only allowed role configuration for all users except for the admin and linuxadmin users 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 69 configuration basics guide release 247 securing access up to 32 roles are supported each role can have a list of up to 256 paths the order of the pathreferences in a role does not matter the longest match is used when validating a command against a pathreference the syntax for the pathreference is sr linux cli format with the forward slash  representing the root wildcards and ranges can be used with pathreferences in the same way they can in cli syntax each entry within the pathreference must use double quotes unless the command string is a single word with no spaces if the path itself includes quotes use backslash characters to indicate the quotes for example to specify the following in a pathreference a b and c d you can configure the following for the pathreference pathreference a b c d the roles control the service and cli plugin authorization  5611 configuring a role procedure to configure a role you define one or more rules that specify a path indicating the command string that is subject to authorization and a corresponding action such as read write or deny example configure a role with multiple rules the following is an example of creating a role named testrole that contains two rules one rule to limit access to networkinstance red and another rule to give write access to the rest of the tree a user assigned this role on authentication is able to configure everything in the system except networkinstance red first define the role under the system aaa authorization context   candidate shared default    info system aaa system  aaa  authorization  role testrole      then specify the rules under the system configuration role context   candidate shared default    info system configuration system  configuration  role testrole  rule   action write  rule networkinstance red  action read    3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 70 configuration basics guide release 247 securing access  example configure a role with viewonly access permission the following example configures a role named aclapp that allows a user to view the state of the aclmgr application but no other information   candidate shared default    info system aaa system  aaa  authorization  role aclapp        candidate shared default    info system configuration system  configuration  role aclapp  rule system  action deny  rule system appmanagement application aclmgr state  action read     when a user that is assigned the aclapp role attempts to read information from the system state datastore only the state of the aclmgr application is displayed for example   candidate shared default    info from state system application aclmgr system  appmanagement  application aclmgr  state running    5612 configuring superuser role for local users procedure to configure the superuser role attribute set the superuser role parameter under systemaaaauthorizationrole to true by default the superuser role parameter is disabled this ensures backward compatibility with the previous releases 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 71 configuration basics guide release 247 securing access example configuring the superuser role attribute in this example the testrole is configured with the superuser role setting   candidate shared default    system aaa authorization role testrole system  aaa  authorization  role testrole  superuser true     example assigning the superuser role to a local user in the following example the previously configured superuser role testrole is assigned to the srltestuser user   candidate shared default    info system aaa authentication user srltestuser system  aaa  authentication  user srltestuser  role  testrole      562 assigning roles to users procedure you can assign a user one or more roles the rules configured in the users role specify the commands the user is authorized to issue up to 32 roles can be assigned to a user if a user has multiple roles assigned all of the rules configured in all of the roles apply to the user if multiple roles reference the same path the most specific rule is used for service authorization the system merges all roles that have the service cli gnmi and so on the user has logged in with and excludes any roles that omit the service when it comes to cli plugin authorization any user who has the necessary role to load the plugin can do so the system follows an additive and permissive approach example in the following example the default local user admin and user testuser are assigned the role testrole after the testuser user is authenticated the user is authorized to use the system according to the rules configured in the role testrole using the example from configuring a role this assignment 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 72 configuration basics guide release 247 securing access authorizes the testuser user to configure everything in the system except for the networkinstance red   candidate shared default    info system aaa system  aaa  authentication  idletimeout 7200 authenticationmethod  local  adminuser  role  testrole   linuxadminuser  password 6skwkudwwymmuycawpqjyax yrs0j6nzb8tim63w1hgknssorb4ja7piexf1q89pdualyqtyflq1qjj9qyve0cetf0csu87a  user testuser  role  testrole      563 authorization using a tacacs server you can configure the sr linux to use a tacacs server to provide authorization for rolebased access control when tacacs authorization is configured the actions an authenticated user can perform depend on the privlvl value configured for the user on a tacacs server if privlvlauthorization is not set to true the authenticated user is authorized as an admin user tacacs authorization for sr linux users works as follows 1 after a user is authenticated the sr linux sends the tacacs server an authorizationrequest message based on a shell exec session starting this authorizationrequest is sent immediately following user authentication but before the shell is started 2 the tacacs server returns an authorizationreply message that includes the privlvl value configured for the user for shell access 3 on the sr linux roles are configured which map to a privlvl value 4 in sr linux users perform actions specified in roles with a privlvl value equal or lower to the privlvl value returned by the tacacs server 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 73 configuration basics guide release 247 securing access 5631 configuring tacacs authorization procedure to configure tacacs authorization for sr linux users you enable privlvl authorization for the tacacs  server group and configure roles that specify the privlvl mapping for each role subject to authorization using a tacacs server example enable privlvl authorization for a tacacs server group the following configuration enables privlvl authorization for the tacacsgroup server group   candidate shared default    info system aaa servergroup tacacsgroup system  aaa  servergroup tacacsgroup  privlvlauthorization true    example configure roles with read access the following configuration specifies two roles interface operstate and networkinstance operstate the interface operstate role grants read access for all interface operstates and the networkinstance operstate role grants read access for all networkinstance oper states   candidate shared default    info system configuration role  system  configuration  role interface operstate  rule interface  operstate  action read   role networkinstance operstate  rule networkinstance  operstate  action read    example enable privlvl mapping for the configured roles the following configuration specifies the privlvl mapping for both roles in this example when a user is authenticated the sr linux sends an authorizationrequest based on a shell exec session starting the tacacs server returns an authorizationreply that specifies the privlvl value for the shell if the privlvl value returned by the tacacs server is 14 the user is assigned both roles that is read access to all interface operstates and all networkinstance operstates but no access to anything else in the system 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 74 configuration basics guide release 247 securing access if the privlvl value returned by the tacacs server is 13 the user is assigned only the network instance operstate role and can read the operstate for networkinstances but has no access to anything else in the system   candidate shared default    info system aaa authorization system  aaa  authorization  role interface operstate  tacacs  privlvl 14   role networkinstance operstate  tacacs  privlvl 13      example configure service authorization for a role the following example configures service authorization for a role that uses tacacs authorization see configuring service authorization in this example when a user is authenticated by a tacacs server in the server group tacacs group if the tacacs server returns privlvl 15 for the user then role1 is assigned to the user service authorization is configured for the role so that all services except gnmi are authorized for users assigned this role this means users assigned role1 are authorized for the functionality defined in the rules of role1 if they connect using the cli jsonrpc or ftp but are not authenticated if they connect using gnmi   candidate shared default    info system aaa authorization role role1 system  aaa  authorization  role role1  services  cli jsonrpc ftp  tacacs  privlvl 15      when a user is assigned multiple roles the user is authorized for all services specified in the roles they are assigned according to the rules defined in the roles for example if a user is assigned role1 which allows access to the system via cli and also assigned role2 which allows access via gnmi the user is authorized to use the cli to perform the functions defined in the rules of role 1 and is authorized to use the gnmi interface for the functions defined in the rules of role2 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 75 configuration basics guide release 247 securing access 564 authorization using a radius server radius combines authentication and authorization the radius server authorizes the user by applying a profile based on username and password configurations the profiles are configured using vsas on the radius server the actions an authenticated user can perform depend on the user profiles profiles consist of a suite of commands that the user is allowed or not allowed to execute sr linux supports the timetraprofile string vsa which is mapped to authorization roles configured on the router the radius dictionary file dictionaryfreeradiustxt in the support directory of the sr linux software distribution includes the supported vsas the nokiadefined attributes are encapsulated in a radius vendorspecific attribute with the vendor id field set to 6527 the vendor id number radius authorization for sr linux users works as follows 1 the sr linux sends the username and password to the radius server 2 if the username and password are recognized the radius server returns the user authorization information user profiles encoded into the vsa if the username and password are not recognized access is denied and passed on to the next configured authentication method if no other authentication method is configured or the radius server group is the last method in the list then the authenticationauthorization request is rejected note the user profiles downloaded from the radius server are stored on the sr linux only for the user session these profiles are considered temporary configurations and are not saved when the user session terminates 3 users authenticated with radius and a user profile use radius authorization and not local authorization when a user issues a command sr linux compares the command and the user information against the information present in the downloaded radius user profile the profile provides details about the command that the user is authorized and not authorized to execute the user can execute only the authorized commands if a user profile is not received the user can execute all commands 5641 configuring radius authorization procedure to configure radius authorization for sr linux users you enable authorization for the radius server group and configure the udp port number by default the radius protocol uses port 1812 for authentication and authorization example the following example configures services authorization for a role that uses radius authorization   candidate shared default    info system aaa system  aaa  authorization  role role1  services  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 76 configuration basics guide release 247 securing access cli gnmi ftp      565 service authorization service authorization allows you to block or allow access to a user depending on the interface they use to connect to the device you can use service authorization to restrict access to a controller allowing it to speak through programmatic interfaces but without credentials that can be used by someone logged into the cli you can configure the service and cli plugin authorization all user types including the default local user admin admin with the exception of the linuxadminroot users which are permitted write access to all commands in the command tree to configure service authorization you assign roles to local users that authorize them to issue commands using specified services such as the cli gnmi or jsonrpc interfaces for example you can define a role that grants read access to subinterface statistics and limits access to that information to the gnmi service when you assign that role to a user the user is allowed to read subinterface statistics only via the gnmi interface the following interface types can be configured for service authorization  cli  access to the system via cli  gnmi  access to the system via gnmi  jsonrpc  access to the system via jsonrpc  ftp  access to the system via ftp  p4rt  access to the system via p4runtime rpcs after a user is authenticated the system checks whether the user is assigned a role that allows access via the interface they used to connect to the device for example if a user connects using gnmi the system checks whether the user is assigned any roles that authorize access via the gnmi interface if the user is assigned a role that authorizes access via gnmi the user receives access to the system via gnmi according to the rules defined in the set of roles that includes gnmi if the user connects via gnmi but is not assigned any role that authorizes access via gnmi the authorization attempt is rejected and the session is closed if a user is assigned multiple roles the user is authorized for all services specified in the roles they are assigned according to the rules defined in the roles for example consider a user assigned role r1 which allows access to the system via cli and also assigned role r2 which allows access via gnmi the user is authorized to use the cli to perform the functions defined in the rules of role r1 and is authorized to use the gnmi interface for the functions defined in the rules of role r2 by default a role has no services configured for authorization when you configure a role you must specify the services that apply to the role users assigned the role are authorized to perform the functions defined in the role using the specified services 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 77 configuration basics guide release 247 securing access 5651 configuring service authorization procedure to configure service authorization you create a role that defines rules permitting or denying access to system functionality assign the role to one or more users and specify the services over which users assigned the role are authorized to perform the rules defined in the role example create a role the following example creates a role readoperstate that allows reading subinterface operstate but nothing else   candidate shared default    info system configuration role  system  configuration  role readoperstate  rule   action deny  rule interface  subinterface  operstate  action read     example assign the role to a user the following example assigns readoperstate role to the default local user admin additionally it creates a user gnmiuser that is assigned the readoperstate role when authenticated   candidate shared default    info system aaa authentication system  aaa  authentication  authenticationmethod  local  adminuser  role  readoperstate   user gnmiuser  role  readoperstate      example configure service authorization for the role the following example configures service authorization so that users assigned the readoper state role such as admingnmiuser can perform the functionality defined in the role only if they 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 78 configuration basics guide release 247 securing access have connected to the system via gnmi if the user connects via a different service such as by logging into the cli the user is not authorized for the functionality defined in the role   candidate shared default    info system aaa authorization system  aaa  authorization  role readoperstate  services  gnmi      566 cli plugin authorization for local users cli plugin authorization gives you control over how operatorprovided plugins are loaded you can choose to load them from the global plugin directory etcoptsrlinuxcliplugins or from the users home directory cliplugins this feature also allows you to control the execution of cli plugins and the queries they make against the data model additionally you can manage the list of cli commands that are allowed or not allowed to execute you can configure the cli plugin authorization for all user types including the default local user admin admin with the exception of the linuxadminroot users which are permitted write access to all commands in the command tree to configure cli plugin authorization you assign roles to users that authorize them to load plugins from either the global or user plugins directory additionally you can specify the list of cli commands that users assigned to the role are authorized to execute for example you can define a role that grants permission to load plugins only from users home directory when you assign this role to a user the user can only load plugins from the home directory after a user is authenticated the system checks whether the user is assigned a role that allows loading of plugins from the intended location and has permission to execute the intended cli commands if the authorization is successful the user can perform the functionality as defined in the role if the authorization fails the user is denied access to the functionality defined in the role to configure the cli plugin authorization set the following parameters under the following command system aaa authorization role rolename cli   allowcommandlist specify the list of cli commands allowed to execute  denycommandlist specify the list of cli commands not allowed to execute  loadglobalplugins true  false 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 79 configuration basics guide release 247 securing access specifies whether cli should load plugins from global plugin directory  etcoptsrlinuxcli plugins if set to false no plugins are loaded from the global plugin directory the default is true which allows plugins to be loaded from the global plugin directory  loaduserplugins true  false specifies whether cli should load plugins from users home directory  cliplugins if set to false no plugins are loaded from the users home directory the default is true which allows plugins to be loaded from the users home directory 5661 configuring cli plugin authorization procedure to configure cli plugin authorization you assign roles to users that authorize them to load plugins from either the global or user plugins directory additionally you can specify the list of cli commands that users assigned to the role are authorized to execute example configure cli plugin authorization for the role the following example configures cli authorization so that users assigned to the loadglobal plugins role such as cliuser can load only the global plugins and execute only the info and tools command without having access to the bash commands   candidate shared default    info system aaa authorization role loadglobalplugins cli system  aaa  authorization  role loadglobalplugins  cli  loadglobalplugins true loaduserplugins false denycommandlist  bash  allowcommandlist  info tools         candidate shared default    info system aaa authentication user cliuser system  aaa  authentication  user cliuser  role  loadglobalplugins      3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 80 configuration basics guide release 247 securing access 57 accounting configuration when accounting is enabled the sr linux device generates command accounting records as described in accounting the following is an example of accounting records generated by the sr linux device aug 7 223409 127001 bob ssh 1721701 start taskid2 timezoneutc serviceshell privlvl15 cmdtail f varlogtacplusacct aug 7 223409 127001 bob ssh 1721701 stop taskid2 timezoneutc serviceshell privlvl15 cmdtail f varlogtacplusacct aug 7 223414 127001 bob ssh 1721701 start taskid5 timezoneutc serviceshell privlvl15 cmdhelp aug 7 223414 127001 bob ssh 1721701 stop taskid5 timezoneutc serviceshell privlvl15 cmdhelp the following is an example of accounting records sent with the timetracmd vsa from the freeradius server wed feb 15 081305 2023 acctstatustype  start nasipaddress  0000 username  user151 acctsessionid  00003320230215t071254772z callingstationid  1721801 nasporttype  virtual timetracmd  show system aaa authentication session 33 eventtimestamp  feb 15 2023 081305 cet timestamp  1676445185 wed feb 15 081305 2023 acctstatustype  stop nasipaddress  0000 username  user151 acctsessionid  00003320230215t071254772z callingstationid  1721801 nasporttype  virtual timetracmd  show system aaa authentication session 33 eventtimestamp  feb 15 2023 081305 cet timestamp  1676445185 571 configuring tacacs accounting procedure to configure tacacs accounting for sr linux users enable accounting for the tacacs server group the sr linux generates an accounting record when a command is started and when it is stopped 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 81 configuration basics guide release 247 securing access example the following example configures accounting records to be sent to the tacacsgroup server group   candidate shared default    info system aaa system  aaa  accounting  accountingmethod  tacacsgroup  event commands  record startstop     572 configuring radius accounting procedure to configure radius accounting for sr linux users enable accounting for the radius server group and configure the accounting port the sr linux generates an accounting record when a command is started and when it is stopped the accounting records are sent to the radius server using udp packets on port 1813 example the following example configures the radius server group for accounting   candidate shared default    info system aaa system  aaa  accounting  accountingmethod  radiusgroup  event commands  record startstop     58 displaying user session information procedure to display information about users currently logged into the sr linux device use the show system aaa authentication session command 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 82 configuration basics guide release 247 securing access example  show system aaa authentication session   id  user  service  authentica  priv  tty  remote  login    name  name  cation  lvl   host  time      method        30  admin  sshd  localgroup   ssh  1721801  202311          02t0404          04040z   31  bob  sshd  tacacsgroup  15  ssh  1721801  202311          02t0405          36854z   32  user151  sshd  radiusgroup   ssh  1721801  202311          02t0405          36854z   59 disconnecting user sessions procedure to disconnect a user currently logged in to the sr linux device use the tools system disconnect sessionid sessionid command and specify the session id of the user to list the session ids of active users enter the show system aaa authentication session command example  show system aaa authentication session   id  user  service  authentica  priv  tty  remote  login    name  name  cation  lvl   host  time      method        30  admin  sshd  localgroup   ssh  1721801  202311          02t0404          04040z   31  bob  sshd  tacacsgroup  15  ssh  1721801  202311          02t0405          36854z   32  user151  sshd  radiusgroup   ssh  1721801  202311          02t0405          36854z    tools system disconnect sessionid 31 terminating cli session 31 owned by user bob logged from ssh systemaaaauthenticationsessionid31 disconnecting aaa cli sessions 31 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 83 configuration basics guide release 247 securing access 510 configuring the idletimeout period for user sessions procedure you can configure the idletimeout period for user sessions which disconnects a user session after a specified period of inactivity by default user sessions are disconnected after 10 minutes of inactivity the idletimeout period setting applies to sr linux users and remote users it does not apply to linux users or to jsonrpc or gnmi client sessions when a user session is inactive for onehalf of the idletimeout period a notification is displayed indicating that the user will be logged out if the session remains idle for the remainder of the idletimeout period example the following example configures the idletimeout period so that sr linux user sessions and remote user sessions are disconnected after 20 minutes of inactivity   candidate shared default    info system aaa system  aaa  authentication  idletimeout 1200    3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 84 configuration basics guide release 247 management servers 6 management servers you can configure the following management servers on the sr linux  grpc server  allows external grpc clients to connect to the device and modify the configuration and collect state information  jsonrpc server  allows you to issue jsonformatted requests to the device to retrieve and set configuration and state you can configure transport layer security tls profiles which contain tls settings that can be provided to the grpc and jsonrpc management servers 61 grpc server sr linux can enable a grpc server that allows external grpc clients gnmi gnoi gnsi p4runtime and gribi to connect to the device and modify the configuration and collect state information when the grpc server is enabled the sr linux grpc server functions as a target for grpc clients the grpc server validates grpc clients and passes rpcs to the sr linux mgmtserver application via the grpc interface configuration changes made by grpc clients are made within a private candidate configuration using a snapshot of the current running configuration as a baseline for the private candidate as with other types of candidate configurations the private candidate can operate in exclusive mode which locks out other users from concurrently modifying the private candidate configuration sessions between grpc clients and the sr linux device can be encrypted using tls you can specify tls settings within a tls profile and apply the tls profile when configuring a grpc server within a network instance when the grpc server is enabled grpc clients connect and authenticate to the sr linux device using the settings specified in the tls profile new connections between grpc clients and the sr linux device are mutually authenticated by default the sr linux device validates the x509 certificate of the grpc client and the other way around this behavior can be disabled in the tls profile the sr linux device after validating the x509 certificate of the grpc client performs local authentication if the metadataauthentication parameter is set to true in this case the grpc client is required to provide a username and password in the metadata of the rpcs the supplied username and password are authenticated by the sr linux aaamgr application in cases where the clients x509 certificate contains a spiffeid the spiffe id is checked for a match with any user in the system when a match is found the client receives the permissions granted to that user the user is rejected if there is no match for information about using spiffe for client authentication see using spiffe for client authentication mtls for more information about supported grpcs see the following  sr linux system management guide for gnoi gnmi and gnsi  sr linux gribi guide  sr linux p4runtime guide 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 85 configuration basics guide release 247 management servers 611 configuring a grpc server procedure sr linux supports configuring one or more grpc servers for one or more network instances each grpc server is distinguished by a unique configurable name for each server instance you can specify the services that the instance supports note  if no services are configured when the server instance is enabled all services are enabled by default  for upgrades from pre2431 releases grpc server instance mgmt is automatically created and all existing configurations are moved to this path you can limit the number of simultaneous active grpc client sessions as well as the number of connection attempts per minute by grpc clients you can also specify the ip address and port for grpc client connections as well as the tls profile used for authenticating grpc clients see tls profiles example the following example shows a configuration that enables a grpc server running gnmi on the sr linux device the grpc server is configured so that gnmi clients can connect to sr linux via the mgmt network instance on port 50052 default 57400 connecting gnmi clients are authenticated using the settings specified in the tls profile tlsprofile1 note 57400 is the default grpc server port value any other value requires that you configure an acl cpm filter to accept traffic on the configured port value in this case 50052   candidate shared default    info system grpcserver mgmt system  grpcserver mgmt  adminstate enable timeout 7200 ratelimit 60 sessionlimit 20 metadataauthentication true tlsprofile tlsprofile1 networkinstance mgmt port 50052 services  gnmi  sourceaddress  19216801  gnmi  commitconfirmedtimeout 10 commitsave false includedefaultsinconfigonlyresponses false unixsocket  adminstate enable    3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 86 configuration basics guide release 247 management servers 612 disconnecting clients from a grpc server procedure you can use a tools command to manually disconnect grpc clients from the server to do this obtain the identifier for the p4runtime client using the info from state system grpcserver name command then enter the following command to disconnect the client example disconnect client from the grpc server  running    tools system grpcserver mgmt client 4053 disconnect 613 displaying grpc client information procedure to display grpc service information for a client use the info from state system grpcserver mgmt client id command with the following optional parameters  electionid election id of the client  gnmi container for gnmi related session info  gribi container for gribi related session info  p4rt container for p4rt related session info    remotehost remote host of the client remoteport remote port of the client rpc the called package service and rpc  starttime time of the subscription creation  type client type  user authenticated username for the client  useragent user agent used for the client 614 displaying the rpcs that clients are using procedure to display the rpcs that a client is using get the identifier for the grpc client from the info from state system grpcserver name command then enter the following command to display the rpcs for that client example  running    info from state system grpcserver mgmt client 4053 rpc 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 87 configuration basics guide release 247 management servers 62 jsonrpc server you can enable a jsonrpc server on the sr linux device which allows you to issue jsonformatted requests to the device to retrieve and set configuration and state you can use the jsonrpc api to run cli commands and standard get and set methods the sr linux device returns responses in json format configuration changes made using the jsonrpc api are made within a private candidate configuration using a snapshot of the current running configuration as a baseline for the private candidate as with other types of candidate configurations the private candidate can operate in exclusive mode which locks out other users from concurrently modifying the private candidate configuration when the jsonrpc server is enabled the application passes the requests to the sr linux mgmtsvr application via the grpc interface this jsonrpc api uses http and https for transport and users are authenticated with the aaamgr application https requests can be authenticated using tls using settings specified in a tls profile see tls profiles see the sr linux system management guide for examples of using the get method to retrieve state information from the sr linux the set method to modify the sr linux configuration and the cli method to enter sr linux cli commands 621 configuring a jsonrpc server procedure the sr linux supports configuring a jsonrpc server under one or more networkinstances you can specify limits for the number of simultaneous active http or https connections and the tcp port used for http or https connections if the tcp port is in use when the jsonrpc server attempts to bind to it the commit operation fails example the following example shows a configuration that enables a jsonrpc server within the mgmt networkinstance on the sr linux device the jsonrpc server is configured so that http requests are accepted on tcp port 4000 and tcp port 443 https requests are authenticated using the settings in the tls profile tlsprofile1   candidate shared default    info system jsonrpcserver system  jsonrpcserver  adminstate enable networkinstance mgmt  http  adminstate enable useauthentication true sessionlimit 1 port 4000  https  adminstate enable useauthentication true sessionlimit 1 port 443 tlsprofile tlsprofile1 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 88 configuration basics guide release 247 management servers sourceaddress        note to connect to the configured jsonrpc server enter the sourceaddress defined in the system jsonrpcserver configuration followed by jsonrpc httpsssourceaddressjsonrpc 63 tls profiles tls is a protocol for enabling applications or devices to exchange information the sr linux supports configuring tls settings in tls profiles which can be provided to applications such as the grpc server and the jsonrpc server so that clients connecting to the sr linux device via these applications are authenticated using the settings in the tls profile 631 configuring a tls profile procedure a tls profile can specify whether authentication is performed for clients connecting to sr linux applications to which the profile is applied within a tls profile you can configure certificates keys and ciphers to use when negotiating tls connections with clients example   candidate shared default    info system tls system  tls  serverprofile clabprofile  key aes1atmxovggiuznww8c7pnlgcx62gdmsiklg8cqw6rbdwxl2lx tsrxlmeatdgupprjl8wrqvhewb0et4q1haz4cnwwbcwddjpowcvezvervdr5rkdt0demjpxs ctbxjxtfdxmxuotslkk80swngp97xumojdhajumvdflou7qpciyymrzlsvu3pmcg4vjafppsi xeuzuz4hnqahtxmcomcbdlqvgt1iw7ktssbvqtvplftxgdyuvalomglvvsjpy8fvtc8v1rlpovwfvxhb ywrfkyu2pnbkxvlcddbabgppd1juyvbq4sqz0c3mqxfg8kiwud0jkw1om9r6eqcgt6rfuyhon4crzrmsa guzxbuhuwter8dz1sj9d1ou4skaijju4rztixzbcxtnpar31abyn2mikcgotv4rxgcqzsjhqxg2o2wt6e vnls8bg1avg8tpnehfmv7wmzwjlp4bwte0hb3f4pzmn11r0z87ylgwactyxsowyiyfm1ffpx8nlwcgh9n okvrdda2xukfqhypwiu2ufujrolte8pifrsezksicwwqcjrs6qbg5qb4xt0gqs4odggxpsqesyrm0frsu0mrrc kcgeveyjdodynupebnlat598m3nq8qrldksnmsjqehhl4hqcqxtluiz00pfhy16xcsjx3eutjsv byfnsoee6ptc5jvw4atyiznzisy8wu0l2xyhx0tlhz1g9oh5fyqy9lbujbrtfrw55pno7eusb8c subqlmcbbubduexspifrmurpbredbspdl2tfhygwqal2iyuaqyfe8j3nmly9iyyzeqzmlzqsem0d5l paf6333ykdww1dzj85twbpt8sy3bshhouhaisnj5wjk1toztjz2cljdrqu8rukbldhdifo6hhnwazhegi g2ce8dpv4kban80ty9ezdxsopoelwctedbqbr32adytf4lrcrgoncnjzlnddbstdz7pktpb5co7vamg umptqwdygiumqcuczpmnlhst1hcdforx01xmc0rqqgx3qoi4fsbahykqke1wpee4bvbf5xdmfb8y4fmaedj rp98xneilhievhydlzu6mxb9pl9rmkhslsuiyviupvoaahd0h51mjurmwdl6kg5bozskw2ozaw tcghpqlopsmildvd8ldax7zumf2ugxyhrxnz3irctkrkuli13exj9vybd8ngxxhfyvlg5cr bed9vdishttawczxya8wdgeeaegxgtczk9oh9dot8d3ffasymedwdmuhcpewwfwf8xoaxcoza qo3cjrkp2hpqpifgjrbfxddii7b5blwnj4vsc4hof7sdfleefnq8jxleurlgmkr2adleeodlirgh sc2htz5i9qtanli08lc30txz4srzncix62e3xrkyryommkvu3u39oo94pazsuwwumvytqdhglu 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 89 configuration basics guide release 247 management servers elqugeqybmzmqixpl6driapo1rlqveyd7hptxmnuiwsjoyzspr12egzeg7dzfbrhnvgwgk2sxexmtw ms0nbpxk18lqnwgtskduamjwcikm6zkp8hikpntb4qd4nvykjwiwoh3o9iqqvprq7dn5ihqmm94nx toaqxubibmcpjcqslfeowy0czvdgsisgrfa45uuviautosaebn9fq4uhza3fc1tbtmlmqs kwcsn1qyutay5v6nvrhw6yifysakbnyagdi5slxx1osxqbqvzptoskrmu9rkgsp9hasqdmuepij uqdlktutoqom2nsleoxblzfwvuafuhq4efggqneoaue8penalfhkeaolnn9xgbdioehs dqlonlmabgivws5e2mj8a2kc3bjyxidltgg2a1xdi57zet0eh88tra5hkn7p8o3x8a1llgx60q1 7gstsyjhnfqqmgasfvhnzrgcznpkautqjuwq4cvngzcouxoummdm2awh5bsl6m8bgjpgpffk8reg61v cttv7cwc6syempq16k56icxmf6yvy6mloyij9jbrt1fjlqde67jbnyrrrstcopj0fliswld8gqtx19dd3h4gjve tzglme3vzuasnav8v31sywwdmfwypoxacbjo3pzhttrvrwlg9r5hputnp2lxoqa33ym3r 2i65ktkwcnrumcqinxam6zwhmayqaczmdizafrlz54we9mlaatgoi0n7tw certificate begin certificate miid2dccascgawibagicbnowdqyjkozihvcnaqelbqawuzejmacga1uebhmamqkw bwydvqqhewaxftatbgnvbaotdgnvbnrhaw5lcmxhyjejmacga1uecxmamrkwfwyd vqqdexbzcmxjzw9zmdegbgfiienbmb4xdti0mdixnja1mdywnfoxdti1mdixnja1 mdywnfowvdejmacga1uebhmamqkwbwydvqqhewaxftatbgnvbaotdgnvbnrhaw5l cmxhyjejmacga1uecxmamrowgaydvqqdexfzcmwxlnnybgnlb3mwms5pbzccasiw dqyjkozihvcnaqebbqadggepadccaqocggebankbum7tzljvc84vphkt3fwa9p zo94je1trefjdah5svifhckgfj0qucub9xczedo18py1xt14gdxoynwlpkxov nvjqxt8asszooa4ggtizz0klowdbyfehmcfixkoa5fic3nga2lymyhmtafyq ebyku6rcvm96yw4bfndhatefjf8sfo3wh4awaqok52hdxme7rwnbk7b3itpqkyg sezzhmc8o65wihjruxnd63aea6pbjzflazt1mauw3qfmkierllxetxg9yllgugm twv9jh4kwujtljchadhlrixwipqshtshg8vjuu8xeedgea4dzmrxnyzscawea aaobtdcbstaobgnvhq8baf8ebamcb4awhqydvr0lbbywfayikwybbquhawigccsg aqufbwmbma4ga1uddgqhbaubagmebjafbgnvhsmegdawgbsbdbzbxouhqi85egna fbectul2jbpbgnvhreesdbgggrzcmwxghnjbgfilxnybgnlb3mwms1zcmwxghfz cmwxlnnybgnlb3mwms5pb4cerbqua4cqiaebcgagacaaaaaaaaaaazanbgkqhkig 9w0baqsfaaocaqeaacazkqkjxx32lvwa78pnuzizmiur6k1zcimeslluqb1pb4jn gpiknxghesvoiamvuv2h7bbf6flgvqvrqcsgjwyt50mayrgahw8l7xnsjvvxpjmu ulkyvkuwewzqwzfy6nayhc1qr3fv3v9s1bbdybyelurcjpqzrrvnkg4zasz jr8yws3k8ftvybpfxcy7v5w7ovdcw36n17fma91x5nelk3reeqagmno7gwloffx b8gpxivu1jjiudib0ri8atzlsymwdlcvppmhfgixlewvlsaqmhndbcfmslmovroc ezt2sm6eulz4jovckfxtdptmmigeng9r0fp3ka end certificate authenticateclient false cipherlist  ecdheecdsaaes256gcmsha384 ecdheecdsaaes128gcmsha256 ecdhersaaes256gcmsha384 ecdhersaaes128gcmsha256     note the following tls 13 ciphers are always enabled and are nonconfigurable  tlsaes256gcmsha384  tlsaes128gcmsha256  tlschacha20poly1305sha256 by default the following tls 12 ciphers are used unless explicitly configured by a user  ecdheecdsaaes256gcmsha384  ecdheecdsaaes128gcmsha256  ecdhersaaes256gcmsha384  ecdhersaaes128gcmsha256 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 90 configuration basics guide release 247 management servers 632 configuring a tls profile with tpm device identity procedure sr linux supports configuring a tls serverprofile to use the tpm idevid initial device identity or oidevid owner issued initial device identity key and certificate instead of configuring the private key and certificate use the command systemtlsserverprofileusetpmdevid to configure the tls server to authenticate clients based on the tpm device ids and certificates during tls handshake and session establishment example configure tls profile to use idevid key with idevid certificate in the following example tls connections are authenticated using the tpm idevid key and certificate this profile affects any new tls sessions that use it   candidate shared default   info system tls serverprofile clabprofile system  tls  serverprofile clabprofile  usetpmdevid idevid    example configure tls profile to use idevid key with oidevid certificate in the following example tls connections are authenticated using the tpm idevid key and the operators device id certificate oidevid this profile affects any new tls sessions that use it info system tls serverprofile clabprofile system  tls  serverprofile clabprofile  usetpmdevid oidevid    note when the usetpmdevid parameter is set to oidevid and oidevid is not present the system does not revert to idevid  this ensures that the tls server is operational only if oidevid is present on the cpm 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 91 configuration basics guide release 247 management servers 633 generating a selfsigned certificate procedure from the sr linux cli you can create a selfsigned certificate and key by default sha256 hash functions with rsa encryption are used for the signature algorithm private keys are not encrypted using des3 and are 4096 bits in length example the following example generates a private key followed by the self signed certificate  tools system tls generateselfsigned email infonokiacom country us organization nokia systemtls begin private key miijraibadanbgkqhkig9w0baqefaasccs4wggkqageaaoicaqc3q7pncwjevlfn snip 1ecxrjvprvieduwyqvoiomfcawxjotjux6hgjiy0z9ktfwicex1ka4e3zxipec4p svzksoctqpqcik5pcsalhznoo6artpc4 end private key begin certificate miietccauwgawibagijakzaurebpiv1ma0gcsqgsib3dqebcwuambqxejaqbgnv snip bttcaiqniikdj0niqezconesgxp3dkeovwqbh3es2qlsqbdvbyjz4ebodigaaz kdnk207h3hiklaaxmbaqewgiu2zkokkdd4qe6ophow6t end certificate this tools command example is equivalent to the following openssl command  openssl req x509 newkey rsa4096 days 365 634 generating a certificate signing request procedure you can issue a cli command that returns a private key and certificate signing request csr this csr can be passed to a certificate authority the same one that the clientserver uses to validate certificates on either side for the certificate authority to sign the request the csr cannot be used asis example the following command returns the private key followed by the csr  tools system tls generatecsr email infonokiacom country us organization nokia systemtls begin private key miijraibadanbgkqhkig9w0baqefaasccs4wggkqageaaoicaqc3q7pncwjevlfn snip 1ecxrjvprvieduwyqvoiomfcawxjotjux6hgjiy0z9ktfwicex1ka4e3zxipec4p svzksoctqpqcik5pcsalhznoo6artpc4 end private key begin certificate request miic5tccac0caqawgz8xczajbgnvbaytalvtmrmweqydvqqidapdywxpzm9ybmlh vy3mje7rjtmwtg0ptfiuu4bfoazlhhrn1hl1mxue2m6xj8gvbpp2sn7svieucyl rvtsfmcc4vmjx3t0haewisd7dnekvq end certificate request 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 92 configuration basics guide release 247 management servers this tools command example is equivalent to the following openssl command  openssl req newkey rsa4096 635 spiffe spiffe secure production identity framework for everyone is a framework that enables services to bootstrap and obtain identity spiffe enables a central authority ca to issue signed certificates for identifying clients and servers establishing mutual trust among them based on their trust in the ca spiffe is applicable only for tls sessions and is not used when system is accessed over sshcli or any other nontls interfaces spiffe defines an identity document known as the spiffe verifiable identity document svid this is a cryptographicallyverifiable document that contains a spiffe id which represents the identity of a service svids can be encoded in two formats x509 certificates or jwt tokens1 note sr linux supports x509 certificates as svids only in an x509 svid the corresponding spiffe id is set as a uri type in the subject alternative name san extension subjectaltname field the svid only supports one uri field in the san extension you can add multiple ip or dns fields to the san but there must be only one uri in the san a spiffeid is a uri that starts with spiffe scheme followed by a fqdn and a path that identifies the user for example spiffenokiacomsaalice where nokiacom refers to the domain name and alice refers to the user spiffe is used for authentication only authorization is performed by the role assigned to the user referred by the spiffeid 6351 leveraging spiffe the highlevel steps for leveraging spiffe are as follows 1 create two sets of certificates one for the server and one for the client these certificates should be signed by a certificate authority ca 2 configure a tls profile on the system with authenticateclient parameter set to true and the trustanchor parameter set to the public certificate of the ca that was used to sign the client and server certificates for more information see configuring a tls profile 3 reference the tls profile to use on a tls supporting server for configuration examples see the sections that correspond to the tls server you are using  for grpc server configurations see configuring a grpc server  for gribi server configurations see the section enabling the gribi server for a networkinstance in sr linux gribi guide  for p4runtime server configurations see the section configuring the p4runtime server for a networkinstance in sr linux p4rt guide 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 93 configuration basics guide release 247 management servers note spiffe is not supported for jsonrpc servers 4 configure a spiffeid for a user for instructions see configuring spiffeid for users note the tls supporting server does not check the spiffeid in the clients x509 certificate unless you enable mtls set systemtlsserverprofileauthenticateclient to true additionally the presence of a spiffeid in the clients x509 certificate does not necessarily indicate support for mtls 6352 configuring spiffeid for users procedure the spiffeid list is configured under systemaaaauthenticationuser the format of spiffe id is spiffedomainnameuser example configure spiffeid for a local user   candidate shared default    info system aaa authentication user srltestuser spiffeids system  aaa  authentication  user srltestuser  spiffeids  spiffenokiacomsrltestuser      example configure spiffeid for a admin user   candidate shared default    info system aaa authentication adminuser spiffeids system  aaa  authentication  user adminuser  spiffeids  spiffenokiacomadminuser      6353 using spiffe for client authentication mtls in a handshake with tls client authentication authenticateclient enabled the server expects the client to present its x509 certificate 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 94 configuration basics guide release 247 management servers in cases where the clients x509 certificate contains a spiffeid the spiffeid is checked for a match with any spiffeid configured within the spiffeids field in the user configuration when a match is found the client receives the permissions granted to that user the user is rejected if there is no match if the x509 certificate provided by the client does not contain a spiffeid the behavior depends on whether the tls supporting server has enabled the useauthentication or not when enabled the http metadata is checked for the username and password to proceed with authentication both the username and password must be provided when the useauthentication is not enabled the client is rejected 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 95 configuration basics guide release 247 logging 7 logging sr linux implements logging via the standard linux rsyslogd package with dynamic configuration log filters can be defined and passed to remote servers or other specified destinations sr linux logmgr application supports the standard rfc5424 message format when relaying syslog messages to remote servers rfc 5424 introduces a more structured and extensible syslog message format designed to overcome the limitations of the earlier syslog formats such as rfc 3164 rfc 5424 includes features like highprecision timestamping with timezone information and support for embedding structured log data the main configuration file for rsyslogd is etcrsyslogconf sr linux installs a minimal version of the etcrsyslogconf file and maintains an sr linuxspecific configuration under the etc rsyslogd directory you can configure sr linux logging using the cli or a northbound api although you can add conf files manually in the etcrsyslogd directory it is not recommended sr linux conf files under etcrsyslogd use standard rsyslog syntax for configuring filters and actions within rules sr linux supports configuration of linux facilities and sr linux subsystems as sources for log messages to filter see the sr linux log events guide for properties and descriptions of the log messages that can be generated by sr linux subsystems logging configuration consists of specifying a source for input log messages possibly filtering messages by some pattern and specifying an output destination templates are easytoreuse message formats rsyslog contains predefined templates identified by the rsyslog prefix for information about the supported rsyslog templates see sections rsyslog templates for local buffer file or console output and rsyslog templates for forwarding messages to remote servers 71 input sources for log messages sr linux supports using messages logged to linux syslog facilities and messages generated by sr linux subsystems as input sources for log messages table 2 linux syslog facilities describes the linux syslog facilities that can be used as input sources for log messages table 2 linux syslog facilities facility description all audit auth all supported linux syslog facilities audit messages securityauthorization messages that do not contain secret information 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 96 configuration basics guide release 247 logging facility authpriv console cron description securityauthorization messages that may contain secret information alert messages messages generated by cron daemon messages generated by system daemons without their own facility ftp kern local0 local1 local2 local3 local4 local5 local6 local7 lpr mail news ntp messages generated by an ftp daemon messages generated by the kernel local use 0 local use 1 local use 2 local use 3 local use 4 local use 5 local use 6 local use 7 messages generated by the line printer subsystem messages generated by a mail client or server messages generated by the network news subsystem messages generated by ntp subsystem syslog messages generated internally by syslog user uucp messages generated by a user messages generated by the uucp unixtounix copy subsystem table 3 sr linux logging subsystem names lists the sr linux subsystems that produce messages that can serve as input sources for log messages by default sr linux subsystem messages are logged to linux syslog facility local6 table 3 sr linux logging subsystem names subsystem description aaa messages generated by the aaamgr application not including accounting messages 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 97 configuration basics guide release 247 logging subsystem description accounting accounting messages generated by the aaamgr application acl app messages generated through an acl log action messages generated by the appmgr application arpnd messages generated by the arpndmgr application bfd bgp messages generated by the bfdmgr application messages generated by the bgpmgr application chassis messages generated by the chassismgr application fib gnmi json linux lldp mgmt mpls netinst policy sdk messages generated by the fibmgr application messages generated by the grpcserver application messages generated by the jsonrpcserver application messages generated by the linuxmgr application messages generated by the lldpmgr application messages generated by the mgmtsvr application messages generated by the mplsmgr application messages generated by the netinstmgr application messages generated by the policymgr application messages generated by the sdkmgr application staticroute messages generated by the staticroutemgr application xdp messages generated by the xdpmgr application 72 filters for log messages you can configure filters to target specific messages or groups of log messages captured within the input message source a filter can specify the set of messages generated by a linux facility at a specified priority for example messages generated by the kernel that have a priority of warning or higher or mail facility messages that have a priority of critical filtering can be performed for messages generated by a specific sr linux subsystem for example messages generated by the aaamgr application or messages generated by the chassismgr application sr linux subsystem messages go to a specified linux facility by default it is local6 and you can create filters for subsystemspecific messages from this facility 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 98 configuration basics guide release 247 logging table 4 logging priorities describes the logging priorities in order of severity table 4 logging priorities code priority name description 0 1 2 3 4 5 6 7 emergency system is unusable alert critical error warning notice action must be taken immediately critical conditions error conditions warning conditions normal but significant conditions informational informational messages debug debuglevel messages 73 output destinations for log messages you can set the action that the sr linux takes for input messages that meet the criteria specified in a filter this action can include sending the messages to a destination such as a log file the console or a remote host for example you can configure the sr linux to send messages generated by the kernel that have priority warning to a file called varlogsrlinuxfilekernelwarning messages generated by an sr linux subsystem such as the bgpmgr or grpcserver application can be sent to specified destinations actions for messages matching a filter can include the following  send the messages to a specified file in the varlogsrlinuxfile directory  send the messages to a buffer a buffer is similar to a file but uses memory as storage and is not persistent across system reboots messages sent to a buffer are stored in the varlogsrlinux buffer directory  send the messages to the console that is the linux device devconsole which may be assigned to a serial device in hardware  send the messages to one or more remote servers you can specify a networkinstance where rsyslogd is run and which serves as the source for the messages 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 99 configuration basics guide release 247 logging 74 defining filters procedure filters target specific messages or groups of log messages in the input message source you can define the following filter criteria for log messages  specific text in a message  prefix text at the beginning of a message  linux facility that generated the message   regular expression matching text in the message syslog tag of the message example match kernel messages with warning or higher priority the following example shows a configuration that creates a filter that matches messages from the linux facility kernel that have a priority of warning or higher see table 4 logging priorities for a list of logging priorities   candidate shared default    info system logging system  logging  filter fl  facility kern  priority  matchabove warning      example match informational or higher accounting messages the following example creates a filter that matches messages from the linux facility local6 where sr linux subsystem messages are logged by default that have a priority of informational or higher and contain the text accounting this filter can be used to match messages from the sr linux accounting subsystem   candidate shared default    info system logging system  logging  filter f2  contains accounting facility local6  priority  matchabove informational      3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 100 configuration basics guide release 247 logging 75 logging destination configuration you can configure the sr linux to send logging information to the following destinations  log file  memory buffer storage  console devconsole  one or more remote servers 751 specifying a log file destination procedure the sr linux can send log messages to a specified log file by default the log file resides in the var logsrlinuxfile directory you can specify the retention policy for the file including the maximum size default 10 mb as well as the number of files to keep in the rotation default four files example send critical cron messages to a file the following example uses messages from linux facility cron as input filters the messages for those that have critical priority and sends the filtered messages to the file varlogsrlinuxfile croncritical   candidate shared default    info system logging system  logging  file croncritical  facility cron  priority  matchexact  critical       example send messages matching a filter to a file the following example sends messages matching criteria specified in filter f1 to the file varlog srlinuxfilef1match   candidate shared default    info system logging system  logging  file flmatch  filter  f1    3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 101 configuration basics guide release 247 logging  example send specific message types to a file the following example uses messages generated by the sr linux aaa subsystem that is messages generated by the aaamgr application but not including accounting messages as input the messages are filtered for those that have warning or informational priority and the filtered messages are sent to the file varlogsrlinuxfileaaawarninfo   candidate shared default    info system logging system  logging  file aaawarninfo  subsystem aaa  priority  matchexact  warning informational       752 specifying a buffer destination procedure you can configure sr linux to send log messages to a buffer a buffer is similar to a file except that a buffer uses memory as storage and is not persistent across system reboots when the sr linux device boots it creates a nonswappable tmpfs virtual filesystem at varlog srlinuxbuffer this tmpfs filesystem has a fixed size of 512 mb which is reserved for buffer usage when a buffer is created through a commit transaction the sr linux verifies that there is enough buffer space available to contain all configured buffers based on their retention policies if sufficient space is not available the commit transaction fails example the following example sends messages matching criteria specified in filter f1 to the buffer var logsrlinuxbufferf1match a retention policy is specified so that when the buffer reaches 5000000 bytes messages are written to a new buffer after five buffers are filled the oldest one is overwritten   candidate shared default    info system logging system  logging  buffer f1match  rotate 5 size 5000000 filter  f1   3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 102 configuration basics guide release 247 logging   753 specifying the console as destination procedure you can specify the console as a destination for log messages the console refers to linux device dev console the console may be assigned to a serial device in hardware example the following example uses messages generated by the sr linux accounting subsystem as input filters the messages for those that have informational priority or higher and sends the filtered messages to devconsole   candidate shared default    info system logging system  logging  console  subsystem accounting  priority  matchabove informational      754 specifying a remote server destination procedure the sr linux can send log messages to one or more remote servers you can specify the network instance that the sr linux uses to contact the remote servers the rsyslogd process is run within the specified networkinstance example the following example uses messages generated by the sr linux bgp subsystem that is messages generated by the bgpmgr application as input filters the messages for those that have alert priority or higher and sends the filtered messages to a remote server the messages are sourced from the mgmt networkinstance   candidate shared default    info system logging system  logging  networkinstance mgmt remoteserver 19216803  subsystem bgp  priority  matchabove alert   3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 103 configuration basics guide release 247 logging     76 specifying a linux syslog facility for sr linux subsystem messages procedure all of the messages generated by sr linux subsystems see table 3 sr linux logging subsystem names are logged to the same linux syslog facility this behavior allows you to filter messages from all sr linux subsystems by capturing logs from this facility by default sr linux subsystem messages are logged to the linux syslog facility local6 you can optionally specify a different syslog facility see table 2 linux syslog facilities for the syslog facilities example the following example changes the linux syslog facility where messages generated by sr linux subsystems are logged from the default of local6 to local7   candidate shared default    info system logging system  logging  subsystemfacility local7   77 specifying fqdn for logging hostnames procedure sr linux allows you to configure the logging system to use either the system hostname or the system fqdn in the hostname field of the message example the following example configures sr linux to use the system fqdn for logging messages   candidate shared default    info system logging system  logging  usefqdn true   when the usefqdn option is set to true the system fqdn is used in the syslog server hostname field the default is false this ensures backward compatibility with previous releases that only supported using the system hostname for logging messages the domain name must be configured for the fqdn to take effect see configuring a domain name 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 104 configuration basics guide release 247 logging 78 rsyslog templates for local buffer file or console output procedure sr linux logmgr application supports the following rsyslog templates for local buffer file or console output  rsyslogdebugformat  rsyslogtraditionalfileformat  rsyslogfileformat example using rsyslogdebugformat the rsyslogdebugformat template is mainly meant for debugging and diagnostic purposes and must not be used for remote forwarding or production environment   candidate shared default    info system logging file messages system  logging  file messages  format rsyslogdebugformat rotate 3 size 10000000 facility local6  priority  matchabove warning      example using rsyslogtraditionalfileformat the message formatrsyslogtraditionalfileformat has lowprecision timestamps   candidate shared default    info system logging file messages system  logging  file messages  format rsyslogtraditionalfileformat rotate 3 size 10000000 facility local6  priority  matchabove warning      3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 105 configuration basics guide release 247 logging example using rsyslogfileformat the default message format rsyslogfileformat supports highprecision timestamps and timezone information as described in rfc 3339   candidate shared default    info system logging file messages system  logging  file messages  format rsyslogfileformat rotate 3 size 10000000 facility local6  priority  matchabove warning      79 rsyslog templates for forwarding messages to remote servers procedure sr linux logmgr application supports the following rsyslog templates for forwarding messages to remote servers  rsyslogforwardformat  rsyslogsyslogprotocol23format  rsyslogtraditionalforwardformat example using rsyslogforwardformat the message format rsyslogforwardformat forwards logs with highprecision timestamps   candidate shared default    info system logging remoteserver 192021 format system  logging  remoteserver 192021  format rsyslogforwardformat    example using rsyslogsyslogprotocol23format the message format rsyslogsyslogprotocol23format guarantees reliable and efficient logging of important system events this default message format is defined in ietf internetdraft ietf syslogprotocol23 and closely adheres to the syslog standard rfc5424   candidate shared default    info system logging remoteserver 192021 format system  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 106 configuration basics guide release 247 logging logging  remoteserver 192021  format rsyslogsyslogprotocol23format    example using rsyslogtraditionalforwardformat the message format rsyslogtraditionalforwardformat forwards logs with lowprecision timestamps   candidate shared default    info system logging remoteserver 192021 format system  logging  remoteserver 192021  format rsyslogtraditionalforwardformat    3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 107 configuration basics guide release 247 networkinstances 8 networkinstances on the sr linux device you can configure one or more virtual routing instances known as network instances each networkinstance has its own interfaces its own protocol instances its own route table and its own fib when a packet arrives on a subinterface associated with a networkinstance it is forwarded according to the fib of that networkinstance transit packets are typically forwarded out another subinterface of the networkinstance the sr linux supports three types of networkinstances default ipvrf and macvrf type default is the default networkinstance and only one of this type is supported type ipvrf is the regular networkinstance you can create multiple networkinstances of this type type macvrf functions as a broadcast domain and is associated with an ipvrf networkinstance via an integrated routing and bridging irb to support tunneling of layer 2 traffic across an ip network see the macvrf networkinstance initially the sr linux has a default networkinstance and no ipvrf or macvrf networkinstances a management networkinstance which isolates management network traffic from other networkinstances configured on the device is created by default with the mgmt0 port automatically added to it see configuring the management networkinstance and the sr linux interfaces guide 81 basic networkinstance configuration the following example creates networkinstance black and associates two network subinterfaces and one loopback subinterface with it the configuration administratively enables the networkinstance specifies a description and assigns it a router id the router id is optional and is used as a default router identifier for protocols running within the networkinstance the networkinstance is configured to export routes and neighbors to the linux routing table  candidate shared default    info networkinstance black networkinstance black  type ipvrf adminstate enable description sample network instance routerid 19216821 ipforwarding  receiveipv4check true  interface ethernet111   interface ethernet121   interface lo01   protocols  linux  exportroutes true 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 108 configuration basics guide release 247 networkinstances exportneighbors true    in the preceding example the receiveipv4check parameter is set to true if an ipv4 packet is received on a subinterface of this networkinstance and the ipv4 operational status of the subinterface is down then the packet is discarded when the receiveipv4check parameter is set to false ipv4 packets are received on all subinterfaces of this networkinstance that are up even if they do not have ipv4 addresses 82 path mtu discovery path mtu discovery is the technique for determining the mtu size on the network path between hosts on the sr linux path mtu discovery is enabled by default for all networkinstances and can be manually enabled or disabled per networkinstance if path mtu discovery is disabled the system drops the mtu for the session to the number of bytes specified by the systemlevel minpathmtu parameter when an icmp fragmentationneeded message is received by default the minpathmtu setting is 552 bytes   candidate shared default    info networkinstance default networkinstance default  mtu  pathmtudiscovery true     candidate shared default    info system mtu system  mtu  minpathmtu 552   83 static routes within a networkinstance you can configure static routes each static route is associated with an ipv4 prefix or an ipv6 prefix which represents the packet destinations matched by the static route each static route belongs to a specific networkinstance different networkinstances can have overlapping routes static or otherwise because each networkinstance installs its own routes into its own set of route tables and fibs each static route must be associated with a statically configured nexthop group which determines how matching packets are handled either perform a blackhole discard action or a forwarding action the next hop group can specify a list of one or more nexthops up to 128 sr linux supports the following types of nexthops in a nexthop group  regular ipnumbered nexthops matching ip packets are forwarded without encapsulation towards the nexthop with one or more resolution steps deciding the outbound interface and mac address to use for forwarding if the resolve 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 109 configuration basics guide release 247 networkinstances flag is set to false only a direct route can be used to resolve the ipv4 or ipv6 nexthop address if the resolve flag is set to true any route in the fib can be used to resolve the ipv4 or ipv6 nexthop address  mpls nexthops 7250 ixr6106e10e systems only matching ip packets are forwarded with an added mpls label stack towards the nexthop with one resolution step deciding the outbound interface and mac address to use for forwarding the resolve flag must be set to false because only a direct route can be used to resolve the ipv4 or ipv6 nexthop address  gre tunnel nexthops 7250 ixr6106e10e systems only matching ip packets are forwarded with added ipgre encapsulation towards a remote gre tunnel endpoint a gre tunnel nexthop can be configured with an ipv4 or ipv6 address of the remote gre tunnel endpoint this is the destination address in the outer ip header of the ipgre packet a nexthop group can have up to 128 gre tunnel nexthops more than one nexthop implies ecmp an ecmp hash calculation using header fields of the payload packet before ipgre encapsulation selects one of these nexthops and in so doing selects an outer ip destination for the gre encapsulation a gre tunnel nexthop is resolved if the destination address is reachable using any route type in the route table if a gre tunnel endpoint is unresolved it is removed from the nexthopgroup ecmp set if a nexthop group has no resolved gre tunnel nexthops it is not usable and all referencing static routes are removed from the route table and fib each static route has a specified metric and preference the metric is the igp cost to reach the destination the preference specifies the relative degree this static route is preferred compared to other static and nonstatic routes available for the same ip prefix in the same networkinstance a static route is installed in the fib for the networkinstance if the following conditions are met  the route has the lowest preference value among all routes static and nonstatic for the ip prefix  the route has the lowest metric value among all static routes for the ip prefix if bgp is running in a networkinstance all static routes of that same networkinstance are automatically imported into the bgp local rib so that they can be redistributed as bgp routes subject to bgp export policies you can use bidirectional forwarding detection bfd to monitor reachability between the router and the configured next hops for a static route making bfd sessions between the local router and the defined next hops a condition for an associated static route and next hops to be operationally active see configuring failure detection for static routes 831 configuring static routes procedure to configure static routes you specify route prefixes to point to nexthop groups along with the metric and preference example configure ipv4 and ipv6 static routes the following example configures ipv4 and ipv6 static route prefixes to point to nexthop groups and specifies a preference and metric for each one   candidate shared default  networkinstance black  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 110 configuration basics guide release 247 networkinstances  info staticroutes staticroutes  route 19216818024  adminstate enable metric 1 preference 5 nexthopgroup staticipv4grp  route 2001119216818064  adminstate enable metric 1 preference 6 nexthopgroup staticipv6grp   example configure ipnumbered nexthop groups the following example configures the nexthop groups for the static routes   candidate shared default  networkinstance black   info nexthopgroups nexthopgroups  group staticipv4grp  adminstate enable nexthop 1  ipaddress 1920222  nexthop 2  ipaddress 1920245 resolve true   group staticipv6grp  adminstate enable blackhole      in this example an ipv4 nexthop group is configured with two nexthops the resolve true setting allows any route in the fib to be used to resolve the ipv4 nexthop address provided the resolution depth is not more than 2 the ipv6 nexthop group is configured to perform a blackhole discard action for matching packets example configure a mpls nexthop group the following example specifies a mpls nexthop for nhopgroup1 only one mpls nexthop is supported per nexthop group in this example the label for outgoing traffic to mpls nexthop 1923515 is swapped to 1001   candidate shared default    info networkinstance default nexthopgroups group nhopgroup1 networkinstance default  nexthopgroups  group nhopgroup1  nexthop 0  ipaddress 1923515 resolve false pushedmplslabelstack  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 111 configuration basics guide release 247 networkinstances 1001      example gre tunnel nexthop group the following example specifies a gre tunnel nexthop group packets are forwarded with added ip gre encapsulation towards a remote gre tunnel endpoint specified by the destinationip   candidate shared default    info networkinstance default nexthopgroups group nhg1 networkinstance default  nexthopgroups  group nhg1  nexthop 1  encapsulateheader gre gre  destinationip 2020201   nexthop 2  encapsulateheader gre gre  destinationip 2020202   nexthop 3  encapsulateheader gre gre  destinationip 2020203      you can optionally specify the sourceip for a nexthop in a gre nexthop group if the source ip is not specified the lowestnumbered loopback address of the associated networkinstance is used example configure a linklocal address in an ipv6 nexthop group ipv6 nexthop addresses in a static nexthop group can be global unicast ipv6 addresses or ipv6 link local addresses if you configure an ipv6 lla you specify it with a zone as a string in the following format linklocalipv6addresssubinterfacename where subinterfacename has the format interfacenamesubinterfaceindex and corresponds to a configured interfacesubinterface object in the interface configuration hierarchy on the sr linux device the following example configures an ipv6 lla for a subinterface and specifies it as a nexthop in a nexthop group   candidate shared default    info interface ethernet110 subinterface 1 ipv6 interface ethernet110  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 112 configuration basics guide release 247 networkinstances subinterface 1  ipv6  adminstate enable address fe8024164  type linklocalunicast       candidate shared default    info networkinstance default nexthopgroups group ecmp nexthop 1 networkinstance default  nexthopgroups  group g1  nexthop 1  ipaddress fe802512ethernet1101 resolve false failuredetection  enablebfd  localaddress fe802511       example associate a static route with a tagset you can associate a static route with a tagset which is defined under routingpolicy the following example defines a tagset then associates it with a static route   candidate shared default    info routingpolicy routingpolicy  tagset ts1  tagvalue  2 4      candidate shared default    info networkinstance default staticroutes networkinstance default  staticroutes  route 111132  tagset ts1    3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 113 configuration basics guide release 247 networkinstances 832 configuring failure detection for static routes procedure you can use bfd as a failure detection mechanism for monitoring the reachability of next hops for static routes when bfd is enabled for a static route it makes an active bfd session between the local router and the defined next hops required as a condition for a static route to be operationally active you enable bfd for specific nexthop groups as a result bfd is enabled for any static route that refers to the nexthop group if multiple next hops are defined within the nexthop group a bfd session is established between the local address and each next hop in the nexthop group a static route is considered operationally up if at least one of the configured nexthop addresses can establish a bfd session if the bfd session fails the associated next hop is removed from the fib as an active next hop example the following example enables bfd for a static route next hop   candidate shared default  networkinstance black   info nexthopgroups nexthopgroups  group staticipv4grp  adminstate enable nexthop 1  failuredetection  enablebfd  localaddress 192021      a bfd session is established between the address configured with the localaddress parameter and each nexthop address before that nexthop address is installed in the forwarding table all nexthop bfd sessions share the same timer settings which are taken from the bfd configuration for the subinterface where the address in localaddress parameter is configured see bidirectional forwarding detection in the sr linux oam and diagnostics guide 84 aggregate routes you can specify aggregate routes for a networkinstance each aggregate route is associated with an ipv4 prefix or an ipv6 prefix which represents the packet destinations matched by the aggregate route as with static routes each aggregate route belongs to a specific networkinstance though different network instances can have overlapping routes because each networkinstance installs its own routes into its own set of route tables and fibs an aggregate route can become active when it has one or more contributing routes a route contributes to an aggregate route if all of the following conditions are met  the prefix length of the contributing route is greater than the prefix length of the aggregate route 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 114 configuration basics guide release 247 networkinstances  the prefix bits of the contributing route match the prefix bits of the aggregate route up to the prefix length of the aggregate route  there is no other aggregate route that has a longer prefix length that meets the previous two conditions  the contributing route is actively used for forwarding and is not an aggregate route itself that is a route can only contribute to a single aggregate route and that aggregate route cannot recursively contribute to a lessspecific aggregate route aggregate routes have a fixed preference value of 130 if there is no route to the aggregate route prefix with a numerically lower preference value then the aggregate route when activated by a contributing route is installed into the fib with a blackhole next hop it is not possible to install an aggregate route into the routetable or as a bgp route without also installing it in the fib the aggregate routes are commonly advertised by bgp or another routing protocol so that the individual contributing routes no longer need to be advertised this process can speed up routing convergence and reduce rib and fib sizes throughout the network if bgp is running in a networkinstance all active aggregate routes of that networkinstance are automatically imported into the bgp local rib so they can be redistributed as bgp routes subject to bgp export policies 841 configuring aggregate routes procedure to specify an aggregate route you configure the aggregator address setting which identifies the aggregating router by default this is the configured router id of the bgp instance or 0 if bgp is not enabled example   candidate shared default  networkinstance black   info aggregateroutes aggregateroutes  route 19202024  aggregator  address 19216801  summaryonly true generateicmp true   when the summaryonly parameter is set to true activation of an aggregate route automatically blocks the advertisement of all of its contributing routes by bgp the generateicmp true setting causes the router to generate icmp unreachable messages for the dropped packets 85 route preferences a route can be learned by the router from different protocols in which case the costs are not comparable when a route is learned from different protocols the preference value is used to decide which route is 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 115 configuration basics guide release 247 networkinstances installed in the forwarding table if several protocols calculate routes to the same destination the route with the lowest preference value is selected different protocols must not be configured with the same preference if protocols are configured with the same preference the tiebreaker is per the default preference table as defined in table 5 route preference defaults by route type if multiple routes are learned with an identical preference using the same protocol the lowest cost route is used table 5 route preference defaults by route type route type preference configurable direct attached static routes ospf internal isis level 1 internal isis level 2 internal ospf external isis level 1 external isis level 2 external bgp aggregate routes note 0 5 10 15 18 150 160 165 170 130 no yes yes1 yes yes yes yes yes yes no 1 preference for ospf internal routes is configured with the preference command 86 ip tunnel decapsulation groups within the default networkinstance you can configure ip tunnel decapsulation groups in an ip tunnel decapsulation group you specify a terminationsubnet and an allowedpayload type an ipgre packet received on any routed subinterface of the default network instance that matches the terminationsubnet is decapsulated if the inner header of the decapsulated packet indicates the packet is an allowedpayload type it is forwarded according to the packets inner header if the decapsulated packet is not an allowed payload type it is dropped and not forwarded further a received ipgre packet that does not match the termination subnet in an ip tunnel decapsulation group is forwarded based on ip route lookup if the longest matching route is a host route then the packet is dropped unless it is explicitly allowed by a nondefault cpmfilter policy note  ip tunnel decapsulation groups are supported only on the default network instance 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 116 configuration basics guide release 247 networkinstances  the terminationsubnet lookup for a ipgre packet is done before ip longest prefix match lookup so decapsulation occurs for a packet matching the terminationsubnet even if the packets outer ip address matches a local interface ip address or ip route in the fib  decapsulation occurs regardless of whether the gre header specifies version 0 or 1  decapsulation does not occur if the gre version 0 header includes a key or sequence number in this case the packet is forwarded based on ip route lookup on the outer ip da if the longest matching route is a host route the packet is dropped unless it is explicitly allowed by a nondefault cpmfilter policy 861 configuring an ip tunnel decapsulation group procedure to configure an ip tunnel decapsulation group specify a terminationsubnet and an allowedpayload type example the following example configures an ip tunnel decapsulation group in the default network instance the terminationsubnet is 1921681024 and the allowedpayload type is mpls ipgre packets that match this subnet are decapsulated if the payload of the decapsulated packet is mpls it is forwarded based on its inner header otherwise the decapsulated packet is dropped   candidate shared default    info networkinstance default iptunneldecapsulation networkinstance default  iptunneldecapsulation  group dcgrp1  allowedpayloads  mpls  terminationsubnet 1921681024      87 displaying networkinstance status procedure use the show networkinstance command to display status information about networkinstances configured on the device example display information about all networkinstances to display information about all configured networkinstances including the router id description administrative and operational state  show   show networkinstance summary   name  type  admin  oper  router id  description     state  state    3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 117 configuration basics guide release 247 networkinstances   default  default  enable  up  5555  sample network instance   mgmt  ipvrf  enable  up   management network instance   red  ipvrf  enable  up 55555555  network instance for bgp tests   example display information about one networkinstance to limit the display to a single networkinstance  show   show networkinstance default summary   name  type  admin  oper  router  description     state  state  id     default  default  enable  up  5555  sample network instance   example display information about attached interfaces to display information about the interfaces attached to a networkinstance  show   show networkinstance default interfaces  net instance  default interface  ethernet111 oper state  up ip mtu  1500 prefix origin status  192351031 static 2001192351127 static preferred fe802015fffeff064 linklayer preferred  net instance  default interface  lo01 oper state  up prefix origin status  555532 static 20015555128 static preferred  the command displays the operational state ip mtu and assigned ipv4ipv6 prefix for each interface if the operational state for an interface is down the reason for the interface being down is shown example display interface information using an interface reference if you configure an interface reference for an interface see configuring interface references in the networkinstance configuration you can display information about the interface using the interface reference name the following example configures networkinstance black to use the interface reference red to refer to interface ethernet110 subinterface 1   candidate shared default    info networkinstance black networkinstance black  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 118 configuration basics guide release 247 networkinstances interface red  interfaceref  interface ethernet110 subinterface 1    in the context of network instance black you can use the name red to refer to interface ethernet110 subinterface 1 for example   running  networkinstance black   show interfaces red  net instance  black interface  ethernet1101 red type  routed oper state  down oper down reason subifdown ip mtu  1500  88 the macvrf networkinstance the networkinstance type macvrf is associated with a networkinstance of type default or ipvrf via an irb interface the macvrf networkinstance type functions as a broadcast domain each macvrf networkinstance builds a bridge table composed of mac addresses that can be learned via the data path on network instance interfaces or via static configuration you can configure the size of the bridge table for each mac vrf network instance as well as the aging for dynamically learned mac addresses and other parameters related to the bridge table the macvrf networkinstance type features a mac duplication mechanism that monitors mac address moves across networkinstance interfaces and across interfaces 881 mac selection each macvrf networkinstance builds a bridge table to forward layer 2 frames based on a mac address lookup the sr linux selects the mac addresses to be sent for installation to the line card extensible data path xdp based on the following priority 1 local application macs 2 local static macs 3 evpn static macs coming from a macip route with the static bit set 4 local duplicate macs 5 learned or evpnlearned macs 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 119 configuration basics guide release 247 networkinstances 882 mac duplication detection and actions mac duplication is the mechanism used by sr linux for loop prevention mac duplication monitors mac addresses that move between subinterfaces it consists of detection actions and process restarts 8821 mac duplication detection detection of duplicate mac addresses is necessary when extending broadcast domains to multiple leaf nodes sr linux supports a mac duplication mechanism that monitors mac address moves across networkinstance interfaces a mac address is considered a duplicate when its number of detected moves is greater than a configured threshold within a configured time frame where the moves are observed when exceeding the threshold the system holds on to the prior local destination of the mac and executes an action 8822 mac duplication actions the action taken when detecting one or more mac addresses as duplicate on a subinterface can be configured for the macvrf network instance or for the subinterface the following are the configurable actions  operdown when one or more duplicate mac addresses are detected on the subinterface the subinterface is brought operationally down  blackhole on detection of a duplicate mac on the subinterface the mac is blackholed  stoplearning on detection of a duplicate mac on the subinterface the mac address is no longer relearned on this or any subinterface this is the default action for a macvrf network instance  usenetinstanceaction only available for subinterfaces use the action specified for the macvrf network instance this is the default action for a subinterface 8823 mac duplication process restarts when at least one duplicate mac address is detected the duplicate mac addresses are visible in the state datastore and can be displayed with the info from state networkinstance bridgetable macduplication duplicateentries cli command 8824 configurable holddowntime the info from state networkinstance bridgetable macduplication duplicateentries command also displays the holddowntime for each duplicate mac address when the holddowntime expires for all of the duplicate mac addresses for the subinterface the operdown or stoplearning action is cleared and the subinterface is brought operationally up or starts learning again 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 120 configuration basics guide release 247 networkinstances the holddowntime is configurable from between 2 and 60 minutes you can optionally specify indefinite for the holddowntime which prevents the operdown or stoplearning action from being cleared after a duplicate mac address is detected in this case you can manually clear the operdown or stoplearning action by changing the macduplication configuration or using the tools networkinstance bridgetable macduplication command 883 bridge table configuration the bridge table its mac address limit and maximum number of entries can be configured on a per mac vrf or persubinterface basis when the size of the bridge table exceeds its maximum number of entries the mac addresses are removed in reverse order of the priority listed in mac selection you can also configure aging for dynamically learned mac addresses and other parameters related to the bridge table 8831 deleting entries from the bridge table procedure the sr linux features commands to delete duplicate or learned mac entries from the bridge table for a macvrf or subinterface you can delete all mac entries mac entries with a blackhole destination or a specific mac entry example clear mac entries with a blackhole destination the following example clears mac entries in the bridge table for a macvrf network instance that have a blackhole destination  candidate shared default    tools networkinstance macvrf1 bridgetable macduplication deletemacstype blackholeonly example clear a specified mac entry the following example deletes a specified learned mac address from the bridge table for a macvrf network instance  candidate shared default    tools networkinstance macvrf1 bridgetable maclearning learntentries mac 00005e005301 deletemac example clear duplicate mac entries for a subinterface the following example clears all duplicate mac entries in the bridge table for a subinterface  candidate shared default    tools interface ethernet111 bridgetable macduplication deleteallmacs 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 121 configuration basics guide release 247 networkinstances 884 the macvrf networkinstance type the following example configures a macvrf network instance and settings for the bridge table the bridge table is set to a maximum of 500 entries learned mac addresses are aged out of the bridge table after 600 seconds mac duplication detection is configured so that a mac address is considered a duplicate when its number of detected moves across network instance interfaces is greater than three over a 5minute interval in this example the mac address is blackholed after the holddowntime of 3 minutes the mac address is flushed from the bridge table and the monitoring process for the mac address is restarted the example includes configuration for a static mac address in the bridge table the macvrf networkinstance type is associated with a bridged interface and an irb interface  candidate shared default    info networkinstance macvrf1 networkinstance macvrf1  description sample macvrf network instance type macvrf adminstate enable interface ethernet111  interfaceref  interface ethernet11 subinterface 1   interface irb11  interfaceref  interface irb1 subinterface 1   bridgetable  maclimit  maximumentries 500  maclearning  adminstate enable aging  adminstate enable agetime 600   macduplication  adminstate enable monitoringwindow 5 nummoves 3 holddowntime 3 action blackhole staticmac  address mac1     3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 122 configuration basics guide release 247 networkinstances 89 networkinstance route leaking sr linux supports route leaking from one networkinstance to another an activebest ip route from an origin networkinstance can be leaked into any number of destination networkinstances the routes are leaked from an origin networkinstance to destination networkinstances based on import and export policies the policies specify which routes are leaked from the origin networkinstance to destination networkinstances as well as which routes can be accepted by a networkinstance from other network instances import policy matching can be based on prefix family and protocol the leaked routes are published with full forwarding information next hop networkinstance route leaking is typically used to allow leafs attached to multiple tenants to share services for example dns or ntp servers common software repositories and support leafs that provide hub functionality to spoke leafs figure 1 networkinstance route leaking shows an example configuration figure 1 networkinstance route leaking in this example leaf4 has two customer ipvrf networkinstances ipvrf20 and ipvrf30 network instance ipvrf40 is used to connect the shared dns server with ip address 40001 an interinstance export policy makes the shared dns server leakable and an interinstance import policy imports 40000 into ipvrf20 and ipvrf30 at this point the prefix 4000024 can be advertised via evpn and imported into leaf1 and leaf2 so that host 1 and host 2 have reachability to the dns server in the reverse direction for traffic from the hosts to the dns server interinstance import and export policies are configured so that the ipvrf20 and ipvrf30 prefixes are imported into ipvrf40 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 123 configuration basics guide release 247 networkinstances the hubandspoke functionality is shown on leaf3 where prefixes of ipvrf20 and ipvrf30 are leaked between each other allowing connectivity between host 1 and host 2 configuration considerations for originating and terminating traffic this feature does not prevent leaking of host routes however packets matching a local host route leaked from another networkinstance are dropped by xdp cpm for example if a router is leaking a local loopback address from ipvrfa into ipvrfb an icmp request packet from ipvrfb with a destination of the loopback address in ipvrfa is discarded packets matching a nonlocal host address belonging to a local subnet leaked from another network instance are dropped for example if a router is leaking local subnet 101010024 on subinterface1 from ipvrfa into ipvrfb and 10101010 is a server connected to subinterface1 in ipvrfa an icmp request packet coming from ipvrfb with destination 10101010 is discarded as a workaround subinterface1 can be configured with hostroute populate dynamic datapathprogramming true so that 10101010 creates and programs an arpnd host route in ipvrfa if the arpnd host route is leaked into ipvrfb traffic to 10101010 is forwarded from ipvrfb to ipvrfa another workaround is to configure a staticroute for 10101010 with next hop 10101010 and leak it into ipvrfb overall any route that creates an entry in the host table for ipvrfb provides a way to forward packets to a local subnet xdp cpm uses and does not ignore leaked routes when forwarding originated controlmanagement traffic if a leaked route is the best route to the destination then traffic egresses via a subinterface of the originnetworkinstance on 7220 ixrd1d2d3 and 7220 ixrd4d5 switches vxlan traffic received in a nondefault vrf is not terminated even if the destination ip address matches a leaked host route from the default network instance if the next hop of any nonleaked route can only be resolved by a leaked route the nonleaked route is considered unresolved for example if the bgp next hop of an evpnvxlan route received by the default networkinstance can only be resolved by a leaked route from another networkinstance the bgp route is considered unresolved this process ensures vxlan traffic is not originated from a nondefault vrf in the current release no leaked route is advertised in a routing protocol the only exception to this rule is leaked local routes and their advertisement into bgp ipv4ipv6evpnifl families 891 networkinstance route leaking configuration example figure 2 networkinstance route leaking example shows a configuration for a hosting provider that uses route leaking on evpnvxlan leaf switches 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 124 configuration basics guide release 247 networkinstances figure 2 networkinstance route leaking example the data center network in this example uses sr linux leaf switches and 7750 sr devices as data center dc gateways each customer is assigned an ipvrf and a macvrf on the leaf where their server is connected for example customer1 has a server connected to leaf1 1010101 and another server connected to leaf3 1010103 both servers are attached to a bridged subinterface no vlan tagging that is associated with macvrf bd1 regular evpnvxlan connectivity happens for each customer with servers attached to multiple leaf switches route leaking is necessary in this example because each customer also requires connectivity to some hosts that are connected to an ipvpn network in the wan and this connectivity is not directly programmed in the ipvrf of the customer the routeleaking example shown in figure 2 networkinstance route leaking example shows the following  customer1 customer2 and customer3 hosts and prefixes are learned on the ipvrf vrfglobal on pe1  pe1 advertises the three prefixes using ipvpn control plane dcgw1 and dcgw2 import those prefixes in vrfglobal as well  in addition to supporting ipvpn the vprn service on the 7750 dcgws is configured with an evpn vxlan instance that is used to advertise the customer legacy wan prefixes to the leaf switches and to import the customer prefixes of all customers attached to the leaf nodes  a networkinstance of type ipvrf called vrfglobal is also configured on the three leaf switches 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 125 configuration basics guide release 247 networkinstances note some ixr platforms have an issue where leaked packets sent to a local leaked subnet are blackholed as described in configuration considerations for originating and terminating traffic in the preceding figure 2 networkinstance route leaking example this means traffic from vrfglobal to vrf1 with the destination of a local subnet in vrf1 is blackholed as a workaround the vrf1 irb subinterface can be configured with host routepopulatedynamic and hostroutepopulatedynamicdatapath programming true so that active hosts create arpnd host routes and they are leaked into vrfglobal the commands create a host in the vrfglobal host table and traffic can successfully be forwarded to the arpnd learned hosts in vrf1 the following sections show the relevant configuration and state information for the pe and leaf devices in the route leaking example shown in figure 2 networkinstance route leaking example  pe1 configuration and route table  dcgw1 configuration and route table  leaf1 customer vrf configuration  leaf1 vrfglobal configuration  leaf1 routing policy configuration  leaf1 ipvrf routetables  leaf1 routetables state pe1 configuration and route table in the route leaking example shown in figure 2 networkinstance route leaking example pe1 is a 7750 sr wan pe device attached to vrfglobal where the three hosts are connected the following example shows the configuration and route table for pe1  vrfglobal config on pe1 exconfigure service vprn ipvrfglobal aadminpe1 info adminstate enable serviceid 1000 customer 1 bgpipvpn  mpls  adminstate enable routedistinguisher 100051000 vrftarget  community target645001000  autobindtunnel  resolution any    interface local100  ipv4  adminstate enable primary  address 100100100254 prefixlength 24   sap 11c110   3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 126 configuration basics guide release 247 networkinstances  interface local200  ipv4  adminstate enable primary  address 200200200254 prefixlength 24   sap 11c210    interface local300  ipv4  adminstate enable primary  address 130130130254 prefixlength 24   sap 11c3130     the ipvrfglobal routetable shows the routes 100100100024 customer1 2002002000 24 customer2 and 130130130024 customer3  pe1 also receives via ipvpn the corresponding prefixes from leaf1 so that each customer can have communication tofrom the legacy hosts exconfigure service vprn ipvrfglobal aadminpe1 show router 1000 routetable  route table service 1000  dest prefixflags type proto age pref next hopinterface name metric  101010024 remote bgp vpn 01h20m56s 170 10004 tunneledsrisis524290 10 202020024 remote bgp vpn 01h18m59s 170 10004 tunneledsrisis524290 10 100100100024 local local 07h55m03s 0 local100 0 130130130024 local local 07h55m03s 0 local300 0 200200200024 local local 07h55m03s 0 local200 0  no of routes 5 flags n  number of times nexthop is repeated b  bgp backup route available l  lfa nexthop available s  sticky ecmp requested  dcgw1 configuration and route table dcgw1 is also attached to vrfglobal and provides a gateway between ipvpn and evpnvxlan the following example shows the configuration and route table for dcgw1  vrfglobal config on dcgw1 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 127 configuration basics guide release 247 networkinstances exconfigure service vprn ipvrfglobal aadmindcgw1 info adminstate enable serviceid 1000 customer 1 bgpipvpn  mpls  adminstate enable routedistinguisher 100041000 vrftarget  community target645001000  autobindtunnel  resolution any    interface sdb1001  vpls sdb1001  evpntunnel  ipv6gatewayaddress mac   ipv6     dcgw1 learns the legacy prefixes via ipvpn and the leaf prefixes from evpn iff evpn vxlan aadmindcgw1 show router 1000 routetable  route table service 1000  dest prefixflags type proto age pref next hopinterface name metric  101010024 remote evpniff 00h00m13s 169 sdb1001 et1a8b08ff0000 0 202020024 remote evpniff 00h00m13s 169 sdb1001 et1a8b08ff0000 0 303030024 remote evpniff 00h00m13s 169 sdb1001 et1ab209ff0000 0 100100100024 remote bgp vpn 00h00m13s 170 10005 tunneledsrisis524290 10 130130130024 remote bgp vpn 00h00m13s 170 10005 tunneledsrisis524290 10 200200200024 remote bgp vpn 00h00m13s 170 10005 tunneledsrisis524290 10  no of routes 6 flags n  number of times nexthop is repeated b  bgp backup route available l  lfa nexthop available s  sticky ecmp requested  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 128 configuration basics guide release 247 networkinstances leaf1 customer vrf configuration leaf1 in the route leaking example shown in figure 2 networkinstance route leaking example is an sr linux device attached to customer ipvrfs vrf1 and vrf2 and their corresponding macvrfs the following is a configuration on leaf1 for the ipvrfs and macvrfs  relevant config for vrf1   candidate shared default  networkinstance   aleaf1 info networkinstance bd1  type macvrf interface ethernet111  interfaceref  interface ethernet11 subinterface 1   interface irb01  interfaceref  interface irb0 subinterface 1   vxlaninterface vxlan111   protocols  bgpevpn  bgpinstance 1  adminstate enable vxlaninterface vxlan111 evi 11 ecmp 8 routes  bridgetable  macip  advertisearpndonlywithmactableentry true      bgpvpn  bgpinstance 1  routetarget  exportrt target10011 importrt target10011      networkinstance ipvrf1  type ipvrf interinstancepolicies  applypolicy  importpolicy ipvrf1importcust1 exportpolicy ipvrfexportlocal   interface irb01   interface lo111  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 129 configuration basics guide release 247 networkinstances  vxlaninterface vxlan11   protocols  bgpevpn  bgpinstance 1  adminstate enable vxlaninterface vxlan11 evi 1 ecmp 8   bgpvpn  bgpinstance 1  routetarget  exportrt target1001 importrt target1001       arpnd  hostroute datapathprogramming under subinterface   candidate shared default  interface ethernet13 subinterface 1  adutb info adminstate enable ipv4  adminstate enable address 230130   arp  hostroute  populate dynamic  datapathprogramming true     ipv6  adminstate enable address 3ffe231124   neighbordiscovery  hostroute  populate dynamic  datapathprogramming true      relevant config for vrf2   candidate shared default  networkinstance   aleaf1 info networkinstance bd2  type macvrf interface irb02   interface lag11   vxlaninterface vxlan122   protocols  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 130 configuration basics guide release 247 networkinstances bgpevpn  bgpinstance 1  adminstate enable vxlaninterface vxlan122 evi 22 ecmp 8 routes  bridgetable  macip  advertisearpndonlywithmactableentry true      bgpvpn  bgpinstance 1  routetarget  exportrt target10022 importrt target10022      networkinstance ipvrf2  type ipvrf interinstancepolicies  applypolicy  importpolicy ipvrf2importcust2 exportpolicy ipvrfexportlocal   interface irb02   interface lo112   vxlaninterface vxlan12   protocols  bgpevpn  bgpinstance 1  adminstate enable vxlaninterface vxlan12 evi 2 ecmp 8   bgpvpn  bgpinstance 1  routetarget  exportrt target1002 importrt target1002      3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 131 configuration basics guide release 247 networkinstances leaf1 vrfglobal configuration sr linux leaf1 as well as the other leaf switches must be configured with vrfglobal so that the legacy prefixes for all customers are imported the following is a configuration for vrfglobal on leaf1   candidate shared default  networkinstance ipvrfglobal  aleaf1 info type ipvrf adminstate enable interinstancepolicies  applypolicy  importpolicy ipvrfglobalimportcustprefixes exportpolicy ipvrfglobalmakecustprefixesleakable   vxlaninterface vxlan11000   protocols  bgpevpn  bgpinstance 1  adminstate enable vxlaninterface vxlan11000 evi 1000 ecmp 8   bgpvpn  bgpinstance 1  routetarget  exportrt target1001000 importrt target1001000     leaf1 routing policy configuration in the route leaking example shown in figure 2 networkinstance route leaking example route leaking policies are required to guarantee communication between servers in the dc and hosts in the legacy ip vpn network vrfglobal requires the following interinstance policies  export policy ipvrfglobalmakecustprefixesleakable this policy makes the legacy prefixes 100100100024 200200200024 and 130130130024 in the vrfglobal routetable leakable the policy matches on and accepts protocol bgpevpn and prefix set routes and rejects everything else to ensure no other routes are made available for leaking leaked routes are ignored by the policy  import policy ipvrfglobalimportcustprefixes this policy imports all prefixes that are made leakable into the vrfglobal routetable vrf1 requires the following interinstance policies  export policy ipvrfexportlocal this policy matches on protocol local and protocol arpnd so that the localarpnd routes of vrf1 are made available for leaking  import policy ipvrf1importcust1 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 132 configuration basics guide release 247 networkinstances this policy matches on prefixset customer1 which comprises all prefixes in 100100100024 to accept only the routes of customer1 and reject the rest the policies for vrf2 are similar to those for vrf1 only replacing the prefixset with prefixset customer2 which covers all prefixes in 200200200024 the following are the policies configured on sr linux leaf1 similar policies are configured on the other leaf devices   candidate shared default  routingpolicy  aleaf1 info  prefix sets defined prefixset cust1  prefix 1001000016 masklengthrange 1624    prefixset cust2  prefix 2002000016 masklengthrange 1624    prefixset cust3  prefix 1301300016 masklengthrange 1624    communityset target1001000  member  target1001000   policy ipvrf1importcust1   leaks into ipvrf1 only the prefixset of customer 1 defaultaction  policyresult reject  statement 1  match  prefixset cust1  action  policyresult accept    policy ipvrf2importcust2   leaks into ipvrf2 only the prefixset of customer 1 defaultaction  policyresult reject  statement 1  match  prefixset cust2  action  policyresult accept    policy ipvrfglobalimportcustprefixes   leaks into ipvrfglobal all the prefixes made leakable defaultaction  policyresult accept   policy ipvrfglobalmakecustprefixesleakable  defaultaction  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 133 configuration basics guide release 247 networkinstances policyresult reject  statement 10  match  protocol bgpevpn  action  policyresult accept    policy ipvrfexportlocal   applied to ipvrf1 and ipvrf2 makes leakable the routes that are either local or arpnd defaultaction  policyresult reject  statement 10  match  protocol local  action  policyresult accept   statement 20  match  protocol arpnd  action  policyresult accept    policy importlocalcust   applied as import on the ipvrfglobal imports only the legacy prefixes of the local customers defaultaction  policyresult reject  statement 10  match  prefixset cust1 bgp  communityset target1001000   action  policyresult accept   statement 20  match  prefixset cust2 bgp  communityset target1001000   action  policyresult accept    3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 134 configuration basics guide release 247 networkinstances leaf1 ipvrf routetables based on the preceding policies the route tables in leaf1 shows the leaked routes as follows   candidate shared default   aleaf1 show networkinstance ipvrf routetable  ipv4 unicast route table of network instance ipvrf1    prefix  id route  route  activemetricpref nexthop  nexthop     type  owner     type interface    1010100  0  bgpevpn bgpevpnmgr false  0  170 1000332           indirectvxlan    101010024  4  local  netinstmgr true  0  0  101010254 direct irb01   101010132  4  arpnd  arpndmgr  true  0  1  1010101 direct  irb01   10101025432  4  host  netinstmgr true  0  0  none extract  none   10101025532  4  host  netinstmgr true  0  0  none broadcast    1111111132  7  host  netinstmgr true  0  0  none extract  none   3131313132  0  bgpevpn bgpevpnmgr true  0  170 1000332           indirectvxlan    100100100024  0  bgpevpn bgpevpnmgr true  0  170     ipv4 routes total ipv4 prefixes with active routes  7 ipv4 prefixes with active ecmp routes 0   ipv4 unicast route table of network instance ipvrf2    prefix  id route  route  activemetricpref nexthop  nexthop     type  owner     type interface    1212121232  8  host  netinstmgr true  0  0  none extract  none   202020024  0  bgpevpn bgpevpnmgr false  0  170 1000232           indirectvxlan    202020024  5  local  netinstmgr true  0  0  202020254 direct irb02   2020201232  0  bgpevpn bgpevpnmgr true  0  170 1000232           indirectvxlan    20202025432  5  host  netinstmgr  0  0  none extract  none   20202025532  5  host  netinstmgr true  0  0  none broadcast    2222222232  0  bgpevpn bgpevpnmgr true  0  170 1000232           indirectvxlan    200200200024  0  bgpevpn bgpevpnmgr true  0  170     ipv4 routes total  8 ipv4 prefixes with active routes  7 ipv4 prefixes with active ecmp routes 0   ipv4 unicast route table of network instan    prefix  id route  route  activemetricpref nexthop  nexthop     type  owner     type interface    101010024  4  local  netinstmgr true  0  0     101010132  4  arpnd  arpndmgr  true  0  1     202020024  5  local  netinstmgr true  0  0     100100100024  0  bgpevpn bgpevpnmgr true  0  170 1000432   3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 135 configuration basics guide release 247 networkinstances         indirectvxlan    200200200024  0  bgpevpn bgpevpnmgr true  0  170 1000432           indirectvxlan     ipv4 routes total  5 ipv4 prefixes with active routes  5 ipv4 prefixes with active ecmp routes 0    candidate shared default   leaf1 routetables state the info from state information shows the origin of the leaked routes   candidate shared default  networkinstance ipvrf  aleaf1 info from state routetable networkinstance ipvrf1  routetable  ipv4unicast  route 101010024 id 0 routetype bgpevpn routeowner bgpevpnmgr origin networkinstance ipvrf1  leakable false metric 0 preference 170 active false lastappupdate 20230126t145931386z nexthopgroup 538392877111 nexthopgroupnetworkinstance ipvrf1 resilienthash false fibprogramming  suppressed false lastsuccessfuloperationtype modify lastsuccessfuloperationtimestamp 20230126t145931387z pendingoperationtype none lastfailedoperationtype none   snip route 100100100024 id 0 routetype bgpevpn routeowner bgpevpnmgr originnetworkinstance ipvrfglobal  leakable true metric 0 preference 170 active true lastappupdate 20230126t145931386z nexthopgroup 538392877123 nexthopgroupnetworkinstance ipvrfglobal resilienthash false targetnetworkinstances  ipvrf1  fibprogramming  suppressed false lastsuccessfuloperationtype modify lastsuccessfuloperationtimestamp 20230126t145931397z pendingoperationtype none lastfailedoperationtype none   statistics  activeroutes 7 activerouteswithecmp 0 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 136 configuration basics guide release 247 networkinstances resilienthashroutes 0 fibfailedroutes 0 totalroutes 8  routesummary  routetype arpnd  activeroutes 1  routetype bgpevpn  activeroutes 3  routetype host  activeroutes 3  routetype local  activeroutes 1    ipv6unicast   nexthopgroup 538392877076  backupnexthopgroup 0 fibprogramming  lastsuccessfuloperationtype add lastsuccessfuloperationtimestamp 20230126t145931393z pendingoperationtype none lastfailedoperationtype none  nexthop 0  nexthop 538392877074 resolved notapplicable   nexthopgroup 538392877085  backupnexthopgroup 0 fibprogramming  lastsuccessfuloperationtype add lastsuccessfuloperationtimestamp 20230126t145931393z pendingoperationtype none lastfailedoperationtype none  nexthop 0  nexthop 538392877081 resolved notapplicable   nexthopgroup 538392877086  backupnexthopgroup 0 fibprogramming  lastsuccessfuloperationtype add lastsuccessfuloperationtimestamp 20230126t145931393z pendingoperationtype none lastfailedoperationtype none  nexthop 0  nexthop 538392877082 resolved notapplicable   nexthopgroup 538392877087  backupnexthopgroup 0 fibprogramming  lastsuccessfuloperationtype add 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 137 configuration basics guide release 247 networkinstances lastsuccessfuloperationtimestamp 20230126t145931393z pendingoperationtype none lastfailedoperationtype none  nexthop 0  nexthop 3 resolved notapplicable   nexthopgroup 538392877111  backupnexthopgroup 0 fibprogramming  lastsuccessfuloperationtype add lastsuccessfuloperationtimestamp 20230126t145931393z pendingoperationtype none lastfailedoperationtype none  nexthop 0  nexthop 538392877104 resolved true   nexthopgroup 538392877120  backupnexthopgroup 0 fibprogramming  lastsuccessfuloperationtype add lastsuccessfuloperationtimestamp 20230126t145931393z pendingoperationtype none lastfailedoperationtype none  nexthop 0  nexthop 538392877111 resolved notapplicable   nexthop 3  type broadcast  nexthop 538392877074  type extract  nexthop 538392877081  type direct ipaddress 101010254 subinterface irb01  nexthop 538392877082  type extract  nexthop 538392877104  type indirect ipaddress 10003 resolvingtunnel  ipprefix 1000332 tunneltype vxlan tunnelowner vxlanmgr  vxlan  vni 1 sourcemac 1a8b08ff0000 destinationmac 1a4d0aff0000   nexthop 538392877111  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 138 configuration basics guide release 247 networkinstances type direct ipaddress 1010101 subinterface irb01    networkinstance ipvrf2  routetable  ipv4unicast  route 1212121232 id 8 routetype host routeowner netinstmgr origin networkinstance ipvrf2  leakable false metric 0 preference 0 active true lastappupdate 20230126t145931384z nexthopgroup 538392877077 nexthopgroupnetworkinstance ipvrf2 resilienthash false fibprogramming  suppressed false lastsuccessfuloperationtype modify lastsuccessfuloperationtimestamp 20230126t145931387z pendingoperationtype none lastfailedoperationtype none   snip route 200200200024 id 0 routetype bgpevpn routeowner bgpevpnmgr originnetworkinstance ipvrfglobal  leakable false metric 0 preference 170 active true lastappupdate 20230126t145931386z nexthopgroup 538392877123 nexthopgroupnetworkinstance ipvrfglobal resilienthash false fibprogramming  suppressed false lastsuccessfuloperationtype modify lastsuccessfuloperationtimestamp 20230126t145931387z pendingoperationtype none lastfailedoperationtype none   statistics  activeroutes 7 activerouteswithecmp 0 resilienthashroutes 0 fibfailedroutes 0 totalroutes 8  routesummary  routetype bgpevpn  activeroutes 4  routetype host  activeroutes 3  routetype local  activeroutes 1   3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 139 configuration basics guide release 247 networkinstances  ipv6unicast   nexthopgroup 538392877077  backupnexthopgroup 0 fibprogramming  lastsuccessfuloperationtype add lastsuccessfuloperationtimestamp 20230126t145931393z pendingoperationtype none lastfailedoperationtype none  nexthop 0  nexthop 538392877075 resolved notapplicable   nexthopgroup 538392877082  backupnexthopgroup 0 fibprogramming  lastsuccessfuloperationtype add lastsuccessfuloperationtimestamp 20230126t145931393z pendingoperationtype none lastfailedoperationtype none  nexthop 0  nexthop 538392877079 resolved notapplicable   nexthopgroup 538392877083  backupnexthopgroup 0 fibprogramming  lastsuccessfuloperationtype add lastsuccessfuloperationtimestamp 20230126t145931393z pendingoperationtype none lastfailedoperationtype none  nexthop 0  nexthop 538392877080 resolved notapplicable   nexthopgroup 538392877084  backupnexthopgroup 0 fibprogramming  lastsuccessfuloperationtype add lastsuccessfuloperationtimestamp 20230126t145931393z pendingoperationtype none lastfailedoperationtype none  nexthop 0  nexthop 3 resolved notapplicable   nexthopgroup 538392877105  backupnexthopgroup 0 fibprogramming  lastsuccessfuloperationtype add lastsuccessfuloperationtimestamp 20230126t145931393z pendingoperationtype none lastfailedoperationtype none  nexthop 0  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 140 configuration basics guide release 247 networkinstances nexthop 538392877098 resolved true   nexthop 3  type broadcast  nexthop 538392877075  type extract  nexthop 538392877079  type direct ipaddress 202020254 subinterface irb02  nexthop 538392877080  type extract  nexthop 538392877098  type indirect ipaddress 10002 resolvingtunnel  ipprefix 1000232 tunneltype vxlan tunnelowner vxlanmgr  vxlan  vni 2 sourcemac 1a8b08ff0000 destinationmac 1ab209ff0000     networkinstance ipvrfglobal  routetable  ipv4unicast  route 101010024 id 4 routetype local routeowner netinstmgr origin networkinstance ipvrf1  leakable false metric 0 preference 0 active true lastappupdate 20230126t145931384z nexthopgroup 538392877085 nexthopgroupnetworkinstance ipvrf1 resilienthash false fibprogramming  suppressed false lastsuccessfuloperationtype modify lastsuccessfuloperationtimestamp 20230126t145931387z pendingoperationtype none lastfailedoperationtype none   route 101010132 id 4 routetype arpnd routeowner arpndmgr origin networkinstance ipvrf1  leakable false metric 0 preference 1 active true lastappupdate 20230126t145931385z nexthopgroup 538392877120 nexthopgroupnetworkinstance ipvrf1 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 141 configuration basics guide release 247 networkinstances resilienthash false fibprogramming  suppressed false lastsuccessfuloperationtype modify lastsuccessfuloperationtimestamp 20230126t145931387z pendingoperationtype none lastfailedoperationtype none   route 202020024 id 5 routetype local routeowner netinstmgr origin networkinstance ipvrf2  leakable false metric 0 preference 0 active true lastappupdate 20230126t145931384z nexthopgroup 538392877082 nexthopgroupnetworkinstance ipvrf2 resilienthash false fibprogramming  suppressed false lastsuccessfuloperationtype modify lastsuccessfuloperationtimestamp 20230126t145931387z pendingoperationtype none lastfailedoperationtype none   route 100100100024 id 0 routetype bgpevpn routeowner bgpevpnmgr originnetworkinstance ipvrfglobal  leakable true metric 0 preference 170 active true lastappupdate 20230126t145931386z nexthopgroup 538392877123 nexthopgroupnetworkinstance ipvrfglobal resilienthash false fibprogramming  suppressed false lastsuccessfuloperationtype modify lastsuccessfuloperationtimestamp 20230126t145931387z pendingoperationtype none lastfailedoperationtype none   route 200200200024 id 0 routetype bgpevpn routeowner bgpevpnmgr originnetworkinstance ipvrfglobal  leakable true metric 0 preference 170 active true lastappupdate 20230126t145931386z nexthopgroup 538392877123 nexthopgroupnetworkinstance ipvrfglobal resilienthash false fibprogramming  suppressed false lastsuccessfuloperationtype modify lastsuccessfuloperationtimestamp 20230126t145931387z pendingoperationtype none lastfailedoperationtype none   statistics  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 142 configuration basics guide release 247 networkinstances activeroutes 5 activerouteswithecmp 0 resilienthashroutes 0 fibfailedroutes 0 totalroutes 5  routesummary  routetype arpnd  activeroutes 1  routetype bgpevpn  activeroutes 2  routetype local  activeroutes 2    ipv6unicast   nexthopgroup 538392877123  backupnexthopgroup 0 fibprogramming  lastsuccessfuloperationtype add lastsuccessfuloperationtimestamp 20230126t145931393z pendingoperationtype none lastfailedoperationtype none  nexthop 0  nexthop 538392877114 resolved true   nexthop 538392877114  type indirect ipaddress 10004 resolvingtunnel  ipprefix 1000432 tunneltype vxlan tunnelowner vxlanmgr  vxlan  vni 1000 sourcemac 1a8b08ff0000 destinationmac 0000dc000001     810 configuring interface references an interface reference is a userdefined name for a configured interface and subinterface within a network instance you can refer to the interface by the defined name within the context of the network instance the following example configures interface ethernet110 subinterface 1 on the sr linux device in network instance black an interface named red is created interface red is defined as interface ethernet110 subinterface 1   candidate shared default   3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 143 configuration basics guide release 247 networkinstances  info interface interface ethernet110  subinterface 1      candidate shared default    info networkinstance black networkinstance black  interface red  interfaceref  interface ethernet110 subinterface 1    in the context of network instance black you can use the name red to refer to interface ethernet110 subinterface 1 for example   running  networkinstance black   show interfaces red  net instance  black interface  ethernet1101 red type  routed oper state  down oper down reason subifdown ip mtu  1500  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 144 configuration basics guide release 247 sr linux applications 9 sr linux applications the sr linux is a suite of modular lightweight applications running like any others in a linux environment each sr linux application supports a different protocol or function such as bgp lldp aaa and so on these applications use grpc and apis to communicate with each other and external systems over tcp one sr linux application the application manager appmgr is responsible for monitoring the health of the process ids running each sr linux applications and restarting them if they fail the application manager reads in applicationspecific yaml configuration and yang models and starts each application or allows an application not to start if there no configuration exists for it there is an instance of the appmgr that handles applications running on the cpm and an instance of the appmgr on each imm that handles applications running on the line card in addition to the nokiaprovided sr linux applications the sr linux supports installation of userdefined applications which are managed and configured in the same way as the default sr linux applications userdefined sr linux applications can be loaded reloaded and unloaded from the system as necessary 91 installing an application about this task to install an application copy the application files into the appropriate sr linux directories then reload the application manager and start the application the example in this topic installs an application called fibagent the application consists of files named fibagentyml fibagentsh fibagentpy and fibagentyang the fibagentyml file is installed in the etcoptsrlinuxappmgr directory the yml file for a userdefined application must reside in this directory in order for the appmgr to read its yaml configuration the yml file defines the locations of the other application files the other application files can reside anywhere in the system other than in the optsrlinux directory or any tempfs file system in this example the fibagentsh and fibagentpy files are installed in the directory user agents and the fibagentyang file is installed in the directory yang the locations for these files are defined in the fibagentyml file procedure step 1 copy the application files into the sr linux directories example  candidate    bash  cp fibagentyml etcoptsrlinuxappmgr  cp fibagentsh useragents  cp fibagentpy useragents  cp fibagentyang yang  exit step 2 from the sr linux cli reload the application manager 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 145 configuration basics guide release 247 sr linux applications example  candidate    tools system appmanagement application appmgr reload step 3 apply the changes to the configuration example  candidate    fibagent  candidate  fibagent   commit stay all changes have been committed starting new transaction  candidate  fibagent  step 4 verify that the application is running example  show system application fibagent   name  pid  state  version  last change    fibagent  227  running  v213061gd19567393  20210113t201645697z   92 starting an application procedure to start an sr linux application instance use the start option in the tools system appmanagement command example to start an sr linux application instance  running    tools system appmanagement application mplsmgr start systemappmanagementapplicationnamemplsmgr application mplsmgr was started 93 restarting applications sr linux applications that are currently running can be restarted that is stopped then started again sr linux supports two types of application restarts warm restart and cold restart the difference between the two types involves how the application state is maintained in the idb  warm restart warm restart allows forwarding to continue based on the previous state of the application a warm restart causes the application to leave its state information in idb during the restart then recover it after 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 146 configuration basics guide release 247 sr linux applications the restart this restart type results in less disruption to surrounding applications that depend on the restarting applications state  cold restart cold restart results in a typical stop and start of the application including purging its state in idb not all sr linux applications support warm restart for a list of applications that support warm restart see the sr linux release notes you can also determine if an application supports warm restart by using an info from state command for example  info from state system appmanagement application chassismgr supportedrestarttypes system  appmanagement  application chassismgr  supportedrestarttypes  cold warm     applications can be restarted automatically by appmgr for example if an application fails and needs to be restarted or you can restart an application manually from the cli using a tools command when appmgr restarts an application the application is warmrestarted if the application supports it otherwise the application is coldrestarted if you restart an application using a tools command you can specify whether the application is cold or warm restarted if you do not specify the restart type the application is warmrestarted if the application supports it otherwise the application is coldrestarted 931 restarting an application procedure you can restart an application from the sr linux cli the application can be coldrestarted or warm restarted if the application supports warm restart using an info from state command you can display the type of restart cold or warm that was used the last time the application was restarted example restart an sr linux application instance  running    tools system appmanagement application chassismgr restart cold systemappmanagementapplicationnamechassismgr application chassismgr was killed with signal 9 systemappmanagementapplicationnamechassismgr application chassismgr was restarted example display the type of restart used the last time the application was restarted  running    info from state system appmanagement application chassismgr laststarttype system  appmanagement  application chassismgr  laststarttype cold   3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 147 configuration basics guide release 247 sr linux applications  94 terminating an application procedure you can use the stop quit or kill options in the tools system appmanagement command to terminate an sr linux application  stop gracefully terminates the application allowing it to clean up before exiting  quit terminates the application and generates a core dump the core dump files are saved in the var core directory  kill terminates the application immediately without allowing it to clean up before exiting example terminate an application gracefully  candidate    tools system appmanagement application mplsmgr stop systemappmanagementapplicationnamemplsmgr application mplsmgr was killed with signal 15 example terminate an application and generate a core dump  candidate    tools system appmanagement application mplsmgr quit systemappmanagementapplicationnamemplsmgr application mplsmgr was killed with signal 3 example terminate an application immediately  candidate    tools system appmanagement application mplsmgr kill systemappmanagementapplicationnamemplsmgr application mplsmgr was killed with signal 9 95 reloading application configuration procedure to reload the application configuration reload the application manager reloading the application manager causes it to process any changes in the installed applications yaml configuration and restart the applications applications that are no longer present in the system are stopped and their yang modules are removed from the management server applications removed from the system have their nodes or augmentations removed from the system schema 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 148 configuration basics guide release 247 sr linux applications example   running    tools system appmanagement application appmgr reload 96 clearing application statistics procedure you can display statistics collected for an application with the info from state command to reset the statistics counters for the application use the statistics clear option in the tools system app management command example to reset the statistics counters for an application  running    tools system appmanagement application mplsmgr statistics clear 97 restricted operations for applications an application may have one or more operations that are restricted by default for example the linuxmgr application has stop quit and kill as restricted operations meaning that these options are not available when entering the tools system appmanagement command for the linuxmgr application table 6 restricted operations for sr linux applications lists the restricted operations for each sr linux application table 6 restricted operations for sr linux applications application restricted operations aaamgr aclmgr appmgr arpndmgr bfdmgr bgpmgr chassismgr devicemgr reload reload start stop restart quit kill reload reload reload stop quit kill reload reload dhcpclientmgr stop reload 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 149 configuration basics guide release 247 sr linux applications application fibmgr grpcserver idbserver restricted operations reload reload start stop restart quit kill reload jsonrpcconfig reload linuxmgr lldpmgr logmgr mgmtserver mplsmgr netinstmgr oammgr plcymgr qosmgr sdkmgr staticroutemgr supportd xdpcpm xdplc stop quit kill reload reload start stop quit kill reload reload start stop quit kill reload reload reload reload reload reload reload stop restart quit kill reload reload restricted options are specified in the restrictedoperations setting in the yaml file for the application 98 configuring an application about this task to configure an sr linux application edit settings in the application yaml file then reload the application manager to activate the changes the example in this section shows how to configure an application to specify the action the sr linux device takes when the application fails if an sr linux application fails a specified number of times over a specified time period the sr linux device can reboot the system or attempt to restart the application after waiting a specified number of seconds 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 150 configuration basics guide release 247 sr linux applications for example if the aaamgr application stops responding five times within a 500second window the sr linux device can be configured to wait 100 seconds then restart the aaamgr application the following actions can be taken if an sr linux application fails  reboot the system  wait a specified number of seconds then attempt to restart the failed application  move the failed application to error state without rebooting the system or attempting to restart the application if you stop or restart an application using the tools system appmanagement command in the sr linux cli it is not considered an application failure the failure action for the application if one is configured does not occur however if the failed application waits a specified period of time or forever to be restarted or has been moved into error state you can restart the application manually with the tools system appmanagement application restart cli command to configure the failure action for an application procedure step 1 check the status of the sr linux applications example  running    show system application   name  pid  state  version  last change    aaamgr  242  error  v223034ge0ee326f8  20220121t201510967z   aclmgr  193  running  v223034ge0ee326f8  20220121t201510967z   appmgr  118  running  v223034ge0ee326f8  20220121t201511161z   arpndmgr  104  running  v223034ge0ee326f8  20220121t201510967z   bfdmgr   waitingforconfig     bgpmgr  109  running  v223034ge0ee326f8  20220121t201513156z   chassismgr  115  running  v223034ge0ee326f8  20220121t201510967z   devmgr  150  running  v223034ge0ee326f8  20220121t201510001z   fibmgr  168  running  v223034ge0ee326f8  20220121t201510968z   grpcserver  157  running  v223034ge0ee326f8  20220121t201513296z   idbserver  171  running  v223034ge0ee326f8  20220121t201510228z   igmpmgr   waitingforconfig     isismgr   waitingforconfig     jsonrpc  166  running   20220121t201513234z   labelmgr  139  running  v223034ge0ee326f8  20220121t201513186z   lagmgr  103  running  v223034ge0ee326f8  20220121t201510968z   ldpmgr   waitingforconfig     linuxmgr  116  running  v223034ge0ee326f8  20220121t201510968z   lldpmgr  149  running  v223034ge0ee326f8  20220121t201513206z   logmgr  127  running  v223034ge0ee326f8  20220121t201510968z   mgmtserver  149  running  v223034ge0ee326f8  20220121t201510968z   mirrormgr   waitingforconfig     mplsmgr   waitingforconfig     netinstmgr  160  running  v223034ge0ee326f8  20220121t201510968z   oammgr  160  running  v223034ge0ee326f8  20220121t201513231z   ospfmgr   waitingforconfig     p4rtserver  641  running  v223034ge0ee326f8  20220121t215647935z   plcymgr  177  running  v223034ge0ee326f8  20220121t201513242z   qosmgr  186  running  v223034ge0ee326f8  20220121t201513322z   sshdmgmt  192  running   20220121t201519710z   xdpcpm  197  running  v223034ge0ee326f8  20220121t201510968z   xdplc1  108  running   20220121t201510968z  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 151 configuration basics guide release 247 sr linux applications  step 2 use the info from state command to check the current failure action settings for the application to configure the following failure action settings can be configured for an application  failurethreshold number of times that the application must fail during the failurewindow period before the failureaction is taken the default is three times  failurewindow number of seconds over which the application must fail the failurethreshold number of times before the failureaction is taken the default is 300 seconds  failureaction action to take if the application fails failurethreshold times over failurewindow seconds this action can be one of the following  reboot  reboot the system this is the default failureaction  wait  seconds  wait this number of seconds then attempt to restart the application  wait  forever  move the application to error state and do not reboot the system or attempt to restart the application these settings are highlighted in the following example example  running    info from state system appmanagement application aaamgr system  appmanagement  application aaamgr  pid 242 state error lastchange 20220121t201510967z author nokia failurethreshold 3 failurewindow 300 failureaction reboot path optsrlinuxbin launchcommand sraaamgr searchcommand sraaamgr version v223034ge0ee326f8 restrictedoperations  reload  statistics  restartcount 0  yang  modules  srlnokiaaaa srlnokiaaaatypes  sourcedirectories  optsrlinuxmodelsietf optsrlinuxmodelssrlnokiamodelscommon optsrlinuxmodelssrlnokiamodelsnetworkinstance optsrlinuxmodelssrlnokiamodelssystem 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 152 configuration basics guide release 247 sr linux applications      step 3 edit the yaml configuration for the application the yaml configuration files for sr linux applications are located in the directory opt srlinuxappmgr on the sr linux device they are named srapplicationname configyml for example sraaamgrconfigyml step 4 in the yml file add or change the settings for the failurethreshold failurewindow and failureaction parameters example in the following example the failure action settings in the sraaamgrconfigyml file are configured so that if the aaamgr application fails five times over a 500second period the sr linux device waits 100 seconds then attempts to restart the aaamgr application aaamgrsetup path optsrlinuxbin launchcommand aaamgrsetenvsh runasuser root nevershow yes neverrestart yes startorder 1 aaamgr path optsrlinuxbin launchcommand sraaamgr searchcommand sraaamgr runasuser root restrictedoperations reload failurethreshold 5 failurewindow  500 failureaction wait100 yangmodules names  srlnokiaaaa  srlnokiaaaatypes sourcedirectories  optsrlinuxmodelsietf  optsrlinuxmodelssrlnokiamodelscommon  optsrlinuxmodelssrlnokiamodelssystem  optsrlinuxmodelssrlnokiamodelsnetworkinstance step 5 save and close the yml configuration file step 6 in the sr linux cli reload the application manager example  running    tools system appmanagement application appmgr reload this command reloads any application whose yml configuration file has changed it does not affect any service step 7 use the info from state command to verify that the changes to the failure action settings are now in effect 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 153 configuration basics guide release 247 sr linux applications example  running    info from state system appmanagement application aaamgr system  appmanagement  application aaamgr  pid 242 state running lastchange 20220121t201510967z author nokia failurethreshold 5 failurewindow 500 failureaction wait100 path optsrlinuxbin launchcommand sraaamgr searchcommand sraaamgr version v223034ge0ee326f8 restrictedoperations  reload  statistics  restartcount 0  yang  modules  srlnokiaaaa srlnokiaaaatypes  sourcedirectories  optsrlinuxmodelsietf optsrlinuxmodelssrlnokiamodelscommon optsrlinuxmodelssrlnokiamodelsnetworkinstance optsrlinuxmodelssrlnokiamodelssystem      99 removing an application from the system about this task to remove an application from the system remove the application files from the sr linux directories where they are located then reload the application manager when an application is removed from the system sr linux stops sending updates for the paths that the application would populate if the application is subsequently reloaded sr linux resumes sending updates for active cli sessions the schema is updated to remove the application if an active cli session exists in a context that is no longer present because of the application being removed the cli context is changed to the next highest valid context userdefined applications can be removed from the system but removing nokiaprovided sr linux applications is not supported 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 154 configuration basics guide release 247 sr linux applications in the following example the fibagent application consisting of files named fibagentyml fib agentsh fibagentpy and fibagentyang is removed from the system procedure step 1 remove the application files from the sr linux directories example  candidate    bash  rm etcoptsrlinuxappmgrfibagentyml  rm useragentsfibagentsh  rm useragentsfibagentpy  rm yangfibagentyang  exit step 2 from the sr linux cli reload the application manager example  candidate    tools system appmanagement application appmgr reload the application manager stops any application that is no longer present and removes the applications yang module from the management server 910 partioning and isolating application resources the sr linux protects system processes through the use of control groups cgroups which impose resource consumption limits on resourceintensive customer applications 9101 cgroup profiles cgroup profiles define how usage limits are applied on the sr linux cgroup profiles are supported for cpu and memory and are defined in cgroupprofilejson configuration files sr linux provides a default cgroup profile customers can configure additional cgroup profiles 91011 default cgroup profile the sr linuxprovided default cgroup profile is located in the optsrlinuxappmgrcgroup profilejson directory note editing the default cgroup profile is not recommended if the default cgroup profile fails to parse or be read by the appmgr the sr linux does not start the following shows the default cgroupprofilejson file definition  profiles  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 155 configuration basics guide release 247 sr linux applications  name workloadprimary path workloadsliceprimary controller  memory  max 08 swapmax 0 low 0  cpu  weight 10000 period 100000 quota 0  cpuset  cpus  mems      name workloaddatapath path workloadslicedatapath controller  memory  max 08 swapmax 0 low 0  cpu  weight 10000 period 100000 quota 0  cpuset  cpus all mems      name workloadsecondary path workloadslicesecondary controller  memory  max 05 swapmax 0 low 0  cpu  weight 10000 period 100000 quota 0  cpuset  cpus  mems      name userdefault path userslicedefault controller  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 156 configuration basics guide release 247 sr linux applications memory  max 025 swapmax 0 low 0  cpu  weight 1000 period 100000 quota 0  cpuset  cpus  mems       table 7 default cgroup profile parameters describes the default cgroup profile parameters table 7 default cgroup profile parameters parameter description name the cgroup profile name type string path the cgroup directory path relative to a unified root path a typical unified root path is sysfscgroup or mntcgroupunified type string controller the memory controller configuration  max this number denotes the percentage of total memory the actual memory value is calculated as max  totalmemory and is set in the memorymax interface file of the cgroup if the value is 0 this configuration is ignored the range is from 0 to 1 the default is 08  low this number denotes the percentage of total memory the actual memory value is calculated as max  totalmemory and is set in the memorylow interface file of the cgroup the range is from 0 to 1 the default is 08 cpu the cpu controller configuration  weight this value is set in the cpuweight interface file of the cgroup the range is from 1 to 10 000 the default is 100  period this value specifies a period of time in microseconds for how regularly a cgroups access to cpu resources must be reallocated 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 157 configuration basics guide release 247 sr linux applications parameter description this value is set in the cpumax interface file of the cgroup the range is from 1000 to 1 000 000 the default is 100 000  quota this value specifies the total length of time in microseconds for which all tasks in a cgroup can run during one period as defined in the period parameter if quota is set to 0 it translates to max in the cpumax interface file the range is from 1000 to 1 000 000 the default is max cpuset cpu usage information for the cgroup  cpus this value indicates the cpus used by the cgroup this value can be  meaning use all cpus except for the isolated cpus this is the default the value all means include the isolated cpus for cgroup usage the value x yz where x y and z are cpu numbers means use a specific cpu or a range of cpus  mems this value is used for scheduling multiple numa nonuniform memory access aware applications in the cgroup 91012 customerdefined cgroup profile customers can configure cgroup profiles in the etcoptsrlinuxappmgrcgroupprofilejson directory the appmgr creates this directory at boot up if it does not exist if a customerdefined cgroup profile fails to load the system continues to function and applications that are loaded into the customer cgroup are loaded using the following nokia default behaviors  nokiawritten applications run in the workloadsliceprimary cgroup along with any processes that are started by linuxadmin including srcli  nonnokiawritten applications run in the workloadslicesecondary cgroup if a customer builds an application and launches it using the appmgr without specifying a cgroup the application runs in this cgroup  all interactive user applications run in the userslicedefault cgroup including srcli when not started by linuxadmin the admin user is treated as any other user in the system its processes fall into the userslicedefault cgroup 9102 configuring a cgroup customers can configure up to three cgroups in the etcoptsrlinuxappmgrcgroup profilejson directory customer applications are assigned to these groups any more than three configured cgroups are ignored the depth of cgroups is limited to two levels where for example workload is one level and primarysecondary are two levels any levels beyond this are also ignored 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 158 configuration basics guide release 247 sr linux applications if a cgroup with the same name is used in multiple customerdefined profiles the system ignores it and uses the cgroup defined in the default profile 91021 cgroup configuration example about this task the following example shows the configuration of two customerdefined cgroups one for a lightweight database that needs priority access to resources and one for storing the users of the database the following procedure describes the steps and the outputs the preceding configuration created two cgroup profiles one for the database slice and one for the frontend slice the profile for the database slice is configured to limit the database to 50 of system memory the profile for the frontend slice is configured to limit the web front end to 20 of system memory in addition both cgroup profiles are configured to limit cpu resources for their respective cgroup the database server cpu is weighted at 10 000 the maximum cpu weight and the frontend server cpu is weighted at 5000 half the cpu weight of the database the weights are added together and each group is allocated its ratio of cpu as a proportion of the sum the periods are kept the same and no guaranteed cpu is granted procedure step 1 install the application including the yaml binary file and optional yang module in this example yaml defines two applications dtwdatabase and dtwfrontend these applications are placed into their own cgroups distributethewebslicedatabase and distributethewebslicefrontend the appmgr creates the cgroups the following output shows the installation of the database and a web front end dtwdatabase path optdistributethewebbin launchcommand rundb searchcommand rundb failurethreshold 100 failureaction wait60 cgroup distributethewebslicedatabase oomscoreadj 500 yangmodules names  database sourcedirectories  optdistributethewebyang dtwfrontend path optdistributethewebbin launchcommand runfrontend searchcommand runfrontend failurethreshold 100 failureaction wait60 cgroup distributethewebslicefrontend oomscoreadj 200 yangmodules names  frontend sourcedirectories 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 159 configuration basics guide release 247 sr linux applications  optdistributethewebyang step 2 configure the cgroup profiles in the etcoptsrlinuxappmgrcgroupprofilejson directory the following output shows the configuration  profiles   name distributethewebdatabase path distributethewebslicedatabase controller  memory  max 05 swapmax 0 low 0  cpu  weight 10000 period 100000 quota 0     name distributethewebfrontend path distributethewebslicefrontend controller  memory  max 02 swapmax 0 low 0  cpu  weight 5000 period 100000 quota 0      9103 kernel lowmemory killer the kernel lowmemory killer driver monitors the memory state of a running system it reacts to high memory pressure by killing the least essential processes to keep the system performing at acceptable levels when the system is low in memory and cannot find free memory space the outofmemory function is called the outofmemory function makes memory available by killing one or more processes when an outofmemory oom failure occurs the outofmemory function is called and it obtains a score from the selectbadprocess function the process with the highest score is the one that is killed criteria used to identify a bad process include the following  the kernel needs a minimum amount of memory for itself  try to reclaim a large amount of memory 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 160 configuration basics guide release 247 sr linux applications  do not kill a process that is using a small amount of memory  try to kill the minimum number of processes  algorithms that elevate the sacrifice priority on processes the user wants to kill in addition to this list the oom killer checks the oom score the oom killer sets the oom score for each process and then multiplies that value by memory usage the processes with higher values have a high probability of being terminated by the oom killer 91031 sr linux process kill strategy the kernel calculates the oomscore using the formula 10  percentage of memory used by the process the maximum score is 10  100  1000 the oomscore of a process can be found in the proc directory procpidoomscore an oomscore of 1000 means the process is using all the memory an oomscore of 500 means it is using half the memory and an oomscore of 0 means it is using no memory the oom killer checks the oomscoreadj file in the procpidoomscoreadj directory to adjust its final calculated score the default value is 0 the oomscoreadj value can range from 1000 to 1000 a score of 1000 results in a process using 100 of the memory and in not being terminated by the oom killer however a score of 1000 causes the linux kernel to terminate the process even when it uses minimal memory a score of 100 results in a process using 10 of the memory before it is considered for termination as its score remains 0 until its unadjusted score reaches 100 the oomscoreadj value for each process is defined in its corresponding yaml definition file the system groups the processes based on their score which the sr linux oom killer uses as the hierarchy for terminating a rogue process as follows  group1  998 for processes that should never be killed such as appmgr idbserver and all processes on the imm  group2  200 for processes that ideally should not be killed because doing so has a substantial impact on the system such as mgmtserver chassismgr and netinstmgr a score of 200 means the process gets to use 20 of the memory before their memory use starts being counted  group3  0 for process that should be killed if they are using too much memory such as bgp isis and ospf  group4  500 for processes that should be preferentially killed such as cli and oammgr table 8 oom adjust score per process lists the oom adjust score for each process table 8 oom adjust score per process process name oom adjust score aaamgr aclmgr 0 0 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 161 configuration basics guide release 247 sr linux applications process name oom adjust score appmgr sarpndmgr bfdmgr bgpmgr chassismgr devmgr dhcpclientmgr dhcprelaymgr 998 200 200 0 200 200 0 0 ethswitchmgr 200 evpnmgr fibmgr grpcserver idbserver isismgr jsonrpc l2maclearnmgr l2macmgr l2staticmacmgr lagmgr linuxmgr lldpmgr logmgr mcidmgr mgmtserver mplsmgr netinstmgr oammgr 0 0 500 998 0 500 0 0 0 0 0 0 0 0 200 0 200 500 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 162 configuration basics guide release 247 sr linux applications process name oom adjust score ospfmgr plcymgr qosmgr sdkmgr sflowsamplemgr sshdmgmt staticroutemgr supportd timesrv vrrpmgr vxlanmgr xdpcpm 0 0 0 500 500 0 0 0 0 0 0 200 9104 application manager extensions for cgroups the cgroup feature provides two additional parameters in the appmgr yaml file the cgroup parameter and the oomscoreadj parameter the appmgr uses the cgroup parameter to launch an application within a specific cgroup a valid value for the cgroup parameter is the path of a cgroup as specified in the cgroup profile equivalent to  profilesnamepath from the cgroupv2 root if this cgroup does not exist the appmgr launches the user application from the default cgroup profile path workloadslicesecondary the appmgr uses the oomscoreadj parameter to set the oom adjust score for a process this score is fed into the sr linux oom killer valid oomscoreadj scores are any value in the range of 1000 to 1000 a process with a score of 1000 is least likely to be killed while a process with a score of 1000 is most likely to be killed at 1000 a process can use 100 of memory and still avoid being terminated by the oom killer however sr linux kills the process more frequently the cgroup parameter and the oomscoreadj parameter are shown in the following output bgpmgr path srlinuxbinaryinstallprefix launchcommand yamllaunchenvironment srbgpmgr searchcommand srbgpmgr oomscoreadj 0 waitforconfig yes author nokia restrictedoperations reload cgroup workloadsliceprimary yangmodules names  srlnokiabgp 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 163 configuration basics guide release 247 sr linux applications  srlnokiabgpvpn  srlnokiaribbgp  srlnokiasystemnetworkinstancebgpvpn tools  srlnokiatoolsbgp sourcedirectories  srlinuxfileinstallprefixmodelsietf  srlinuxfileinstallprefixmodelssrlnokiamodelscommon  srlinuxfileinstallprefixmodelssrlnokiamodelsinterfaces  srlinuxfileinstallprefixmodelssrlnokiamodelsnetwork instance  srlinuxfileinstallprefixmodelssrlnokiamodelsroutingpolicy  srlinuxfileinstallprefixmodelssrlnokiamodelssystem 9105 debugging cgroups cgroup debugging capability is available through  sr linux cli commands  linuxprovided cli commands 91051 sr linux cgroup debugging commands the sr linux provides cli commands to perform the following     check the usage of existing cgroups show information about the oom adjust score of applications managed by the appmgr show information about the cgroups that are associated with the applications that are managed by the appmgr list all of the applications associated with a specified cgroup 910511 checking existing cgroup usage the following output is an example of checking existing cgroup usage  running    info from state platform control a cgroup  platform  control a  cgroup mntcgroupunifieduserslicedefault  memorystatistics  current 0 currentswap 0 anon 0 kernelstack 0 slab 0 sock 0 anonthp 0 file 0 filewriteback 0 filedirty 0  cpuacctstatistics  user 0 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 164 configuration basics guide release 247 sr linux applications system 0   cgroup mntcgroupunifiedworkloadsliceprimary  memorystatistics  current 1621110784 currentswap 0 anon 1327427584 kernelstack 2396160 slab 12939264 sock 151552 anonthp 855638016 file 250916864 filewriteback 0 filedirty 0  cpuacctstatistics  user 22082989551 system 11252275018   cgroup mntcgroupunifiedworkloadslicesecondary  memorystatistics  current 7827456 currentswap 0 anon 4501504 kernelstack 73728 slab 2453504 sock 8192 anonthp 0 file 0 filewriteback 0 filedirty 0  cpuacctstatistics  user 34323091 system 12342430     910512 showing current oom adjust scores the following output is an example of showing information about the current oom adjust scores for all applications that are managed by the appmgr  running    info from state system appmanagement application  oomscoreadj system  appmanagement  application aaamgr  oomscoreadj 0  application aclmgr  oomscoreadj 0  application appmgr  oomscoreadj 998  application arpndmgr  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 165 configuration basics guide release 247 sr linux applications oomscoreadj 200     application vxlanmgr  oomscoreadj 0  application xdplc1  oomscoreadj 200    910513 showing cgroup information the following output is an example of showing information about cgroups that are associated with applications managed by the appmgr  running    info from state system appmanagement application  cgroup system  appmanagement  application aaamgr  cgroup mntcgroupunifiedworkloadsliceprimary  application aclmgr  cgroup mntcgroupunifiedworkloadsliceprimary  application arpndmgr  cgroup mntcgroupunifiedworkloadsliceprimary  application bgpmgr  cgroup mntcgroupunifiedworkloadsliceprimary     application sshdmgmt  cgroup mntcgroupunifiedworkloadslicesecondary  application supportd  cgroup mntcgroupunifiedworkloadsliceprimary  application vxlanmgr  cgroup mntcgroupunifiedworkloadsliceprimary  application xdplc1  cgroup mntcgroupunifiedworkloadsliceprimary    3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 166 configuration basics guide release 247 sr linux applications 910514 listing all the applications associated with a specified cgroup use the tools system cgroup command pgrep cgroup cgroupname command to list all the applications associated with a specified group the following output shows an example  running    tools system cgroup command pgrep cgroup workloadsliceprimary   pid  process    3373  srappmgr   3385  srsupportd   3402  srdevicemgr   3460  sridbserver   3471  sraaamgr   3482  sraclmgr   3518  srarpndmgr   3542  srchassismgr   3560  srdhcpclientmgr   3574  srevpnmgr   3586  srfibmgr   3598  srl2maclearnmgr   3611  srl2macmgr   3621  srlagmgr   3631  srlinuxmgr   3641  srlogmgr   3651  srmcidmgr   3681  srmgmtserver   3702  srnetinstmgr   3724  sroammgr   3743  srsdkmgr   3753  srsflowsamplemgr   3772  srxdplc1   3874  sudo   3895  sudo   3902  sudo   3921  sudo   3930  srqosmgr   3953  srgrpcserver   3979  srjsonrpc   3990  srvxlanmgr   16740  srjsonwkr   16742  python3   17013  python3   18474  srjsonwkr   18478  python3   18671  python3   20671  srlldpmgr   21177  srbgpmgr   21190  srplcymgr   12753  srl2staticmacmgr   27353  rsyslogd   9777  python   91052 linuxprovided cgroup debugging commands the following linuxprovided cli commands are available for debugging cgroups 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 167 configuration basics guide release 247 sr linux applications   the systemdcgls command the systemdcgtop command the systemdcgls command dumps the cgroup hierarchy the following output shows an example of the systemdcgls command linuxadminsrlinux unified systemdcgls 1 usrlibsystemdsystemd switchedroot system deserialize 22 systemslice rngdservice  2725 sbinrngd f systemdudevdservice  868 usrlibsystemdsystemdudevd systemserialx2dgettyslice  serialgettyttys0service  1120 login  linuxadmin  8320 bash  9262 sendacct systemdcgls  9263 systemdcgls  9264 less srlinuxservice   3092 usrbinsudo optsrlinuxbinsrlinux   3120 runuser user srlinux group srlinux  optsrlinuxbinsrlinux   4019 binbash optsrlinuxbinsrlinux userenvswitched   4039 srappmgr   4051 srsupportd servermode   4068 srdevicemgr   4219 sridbserver   4229 srethswitch   4288 sraaamgr   4299 sraclmgr   4314 srarpndmgr   4324 srchassismgr   4337 srdhcpclientmgr   4365 srevpnmgr   4381 srfibmgr   4395 srl2maclearnmgr   4411 srl2macmgr   4423 srlagmgr   4445 srlinuxmgr   4494 srlogmgr   4510 ntpd c etcntpsconf g   4526 srmcidmgr   4574 srmgmtserver   4608 srnetinstmgr   4626 sroammgr   4640 srsdkmgr   4658 srsflowsamplemgr   4681 srxdpcpm   5197 usrbinsudo enu root usrbinsudo enu gnmirpc bash c srgnmi   5224 usrbinsudo enu root usrbinsudo enu jsonrpc bash c srjson   5243 usrbinsudo enu gnmirpc bash c srgrpcserver   5248 srqosmgr   5261 usrbinsudo enu jsonrpc bash c srjsonrpc   5290 srgrpcserver   5302 srjsonrpc   5693 usrsbinsshd f etcsshsshdconfigmgmt   6361 usrsbinrsyslogd i varrunsrlinuxrsyslogdpid  21936 srbfdmgr  22018 srbgpmgr  22132 srisismgr  22242 srlldpmgr  22321 srmplsmgr 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 168 configuration basics guide release 247 sr linux applications  22437 srospfmgr  22588 srplcymgr  22701 srstaticroutemgr  22796 srjsonwkr  22797 python3 m srlinuxmgmtjsonrpcjsonrpcservermain bind40  22953 ntpd c etcmntpconf g  23023 python3 m srlinuxmgmtjsonrpcjsonrpcservermain bind40  23736 srjsonwkr  23741 python3 m srlinuxmgmtjsonrpcjsonrpcservermain bind40  24009 python3 m srlinuxmgmtjsonrpcjsonrpcservermain bind40  27488 dnsmasq conffileetcdnsmasqconf polkitservice  2701 usrlibpolkit1polkitd nodebug ztpapiservice  1114 optsrlinuxztpvirtualenvbinpython m ztpztphttp systemdjournaldservice  840 usrlibsystemdsystemdjournald sshdservice  985 usrsbinsshd d crondservice  1133 usrsbincrond n srwatchdogservice  1155 srwd dbusservice  991 usrbindbusdaemon system addresssystemd nofork nopidfile systemdlogindservice 1062 usrlibsystemdsystemdlogind the systemdcgtop command dumps the current usage of each cgroup the following output shows an example of the systemdcgtop command path tasks cpu memory inputs outputs  186     systemslicecrondservice 1     systemslicedbusservice 1     systemslicepolkitservice 1     systemslicerngdservice 1     systemslicesrwatchdogservice 1     systemslicesrlinuxservice 53     systemslicesshdservice 1     systemslicialgettyttys0service 3     systemslicesystemdjournaldservice 1     systemslicesystemdlogindservice 1     systemslicesystemdudevdservice 1     systemsliceztpapiservice 1     3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 169 configuration basics guide release 247 datapath resource management 10 datapath resource management the 7220 ixrd1d2d3d4d5 and 7220ixr h2h3h4 systems have forwarding pipelines that access a set of shared banks that are partitioned to support the following types of forwarding table entries    learned mac addresses ip host entries ip longestprefixmatch routes the default settings for the shared bank allocations can be changed through different configuration parameters as follows  7220 ixrd1d2d3 systems support configuration of the alpm mode alpm  algorithmic longest prefix match the requestedextraiphostentries value and the ipv6128bitlpmentries value  for alpm three settings are supported disabled enabled and highscale alpm disabled completely disables alpm mode and provides maximum resources to be split between ip host entries and mac table entries alpm enabled is only available on d1 systems and uses more shared table resources suitable for supporting moderate ip fib scale alpm highscale is only available on d2d3 systems and uses all available shared resources for ip fib tables resulting in only the base allocation for ip host entries and mac table entries  requestedextraiphostentries should be configured with the number of ip host entries needed beyond the base allocation it is possible depending on the alpm mode setting that not all the requested entries can be allocated the allocated number of entries can viewed in info from state as discussed in the section displaying datapath resource management information  7220 ixrd4d5 systems support configuration of only the alpm mode and only two settings are available  enabled  enables alpm using less shared table resources supporting only moderate ip fib scale  highscale  enables alpm using more shared table resources supporting the highest possible ip fib scale  7220 ixrh2h3 systems support configuration of the ipv6128bitlpmentries value for more information see lpm table partitioning 101 lpm table partitioning on 7220 ixrd1d2d3 and 7220 ixrh2h3 systems ip fib scale depends on the partitioning of the hardware lpm table if the ipv6128bitlpmentries parameter is configured to be greater than zero the hardware lpm table is partitioned into two subblocks a singlewide subblock and a doublewide subblock  the singlewide subblock can store ipv4 routes each consuming half of a singlewide entry and ipv6 routes up to 64 prefix length each consuming a singlewide entry  the size of the doublewide subblock is controlled by the ipv6128bitlpmentries parameter and this subblock can store ipv6 routes up to 128 prefix length each consuming a doublewide entry 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 170 configuration basics guide release 247 datapath resource management it can also store ipv4 routes and ipv6 routes up to 64 prefix length inside the doublewide subblock ipv4 routes consume half of a singlewide entry and ipv6 routes up to 64 prefix length require a doublewide entry 102 changing datapath resource management settings procedure you can change the datapath resource management settings discussed in lpm table partitioning in order to provider higher scale for one entry type at the expense of lower scale for another entry type this is illustrated in the following examples example configure settings for 7220 ixrd1 the following example changes datapath resource management settings on a 7220 ixrd1 system this configuration enables algorithmic longest prefix matching alpm to achieve higher ip fib scale and it requests an extra 32k ipv4 host entries on top of the fixed base amount of 16k entries any remaining datapath resources if any will be allocated to storing mac addresses this configuration also sets the hardware lpm table partition to the default value of 1024   candidate shared default    info platform resourcemanagement unifiedforwardingresources platform  resourcemanagement  unifiedforwardingresources  alpm enabled requestedextraiphostentries 32768 ipv6128bitlpmentries 1024    example configure settings for 7220 ixrd5 the following example changes datapath resource management settings on a 7220 ixrd5 system this configuration enables alpm but not in the highscale mode to achieve moderate ip fib scale and leave more resources for ip host and mac table entries   candidate shared default    info platform resourcemanagement unifiedforwardingresources platform  resourcemanagement  unifiedforwardingresources  alpm enabled    example restart xdp to activate changes datapath resource management configuration changes do not take effect immediately when the changes are committed they take effect the next time xdp is restarted the following example shows a tools command that restarts xdp  running   3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 171 configuration basics guide release 247 datapath resource management  tools system appmanagement application xdplc1 restart systemappmanagementapplicationnamexdplc1 application xdplc1 was killed with signal 9 systemappmanagementapplicationnamexdplc1 application xdplc1 was restarted on 7220 ixrd1 d2 d3 d4 and d5 systems and 7220 ixrh2 h3 and h4 systems this command also restarts xdpcpm which causes a temporary loss of management connectivity 103 displaying datapath resource management information procedure use the info from state command to display the allocated number of extra host entries and extra mac address entries allocated from datapath resource management shared banks example  running    info from state platform resourcemanagement unifiedforwardingresources platform  resourcemanagement  unifiedforwardingresources  xdprestartrequired true alpm enabled requestedextraiphostentries 32768 allocatedextraiphostentries 32768 allocatedextramacentries 0 ipv6128bitlpmentries 1024    in the example the xdprestartrequired leaf is shown as true if a change has been committed to one or more of the configurable values in the unifiedforwardingresources container but xdp has not yet been restarted until xdp is restarted the operational values are still the values initialized at the last xdp restart 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 172 configuration basics guide release 247 maintenance mode 11 maintenance mode sr linux maintenance mode allows you to take a network element out of service so that maintenance actions can be performed for example to upgrade the software image on a router using sr linux maintenance mode you can do this with minimal impact on traffic sr linux maintenance mode works as follows 1 a maintenance group is configured that specifies the resources to be taken out of service see configuring a maintenance group 2 a maintenance profile is configured that specifies policy changes to apply when the group is in maintenance mode a maintenance profile is associated with each maintenance group see configuring a maintenance profile the usual intent of the policy changes is to depreference paths through the maintenance group so that traffic is diverted elsewhere 3 the maintenance group is placed into maintenance mode which applies the policies in the associated maintenance profile see placing a maintenance group into maintenance mode 4 the user monitors the traffic on the interfaces in the maintenance group when the traffic rate falls below a threshold the user shuts down the members of the maintenance group and performs the required service see taking a maintenance group out of service 5 after the service is completed the user takes the maintenance group out of maintenance mode which disables the policies in the associated maintenance profile and restores traffic on the original paths see restoring the maintenance group to service 111 configuring a maintenance group procedure a maintenance group specifies a set of network resources to be taken out of service when maintenance mode is enabled for example a maintenance group can consist of one or more bgp neighbors or peer groups belonging to a one or more network instances specify a set of network resources in a maintenance group the network resources in the maintenance group are taken out of service when maintenance mode is enabled example the following example configures maintenance group mgroup1 consisting of the bgp neighbors in peer group headquarters1 which exists in the default network instance as well as bgp neighbors in peer group headquarters2 which exists in network instance black in the example maintenance group mgroup1 is associated with maintenance profile mprof1  candidate shared default    info system maintenance system  maintenance  group mgroup1  maintenanceprofile mprof1 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 173 configuration basics guide release 247 maintenance mode maintenancemode  adminstate disable  members  bgp  networkinstance default  peergroup  headquarters1  networkinstance black  peergroup  headquarters2        112 configuring a maintenance profile procedure in a maintenance profile you specify policy changes that are applied to members of a maintenance group when maintenance mode is enabled for the group example the following example configures a routing policy and a maintenance profile that references the routing policy the following defines the routing policy drainwithaspathprepend  candidate shared default    info routingpolicy policy drainwithaspathprepend routingpolicy  policy drainwithaspathprepend  defaultaction  accept  bgp  aspath  prepend  asnumber auto repeatn 3        the following defines a maintenance profile that references the routing policy drainwithaspath prepend  candidate shared default    info system maintenance system  3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 174 configuration basics guide release 247 maintenance mode maintenance  profile mprof1  bgp  importpolicy drainwithaspathprepend exportpolicy drainwithaspathprepend     113 placing a maintenance group into maintenance mode procedure when a maintenance group is placed into maintenance mode it applies the policies in the associated maintenance profile to the resources in the maintenance group to place a maintenance group into maintenance mode change the setting for maintenancemode in the group configuration to enable then commit the configuration example the following example enables maintenance mode for maintenance group mgroup1 and commits the configuration the policies configured in the maintenance profile mprof1 are applied to the resources configured in maintenance group mgroup1  candidate shared default    info system maintenance group mgroup1 system  maintenance  group mgroup1  maintenancemode  adminstate enable       candidate shared default    commit stay all changes have been committed starting new transaction 114 taking a maintenance group out of service procedure after enabling maintenance mode for a maintenance group monitor the traffic on the interfaces in the group when the traffic rate drops to an acceptable level shut down the members of the maintenance group and perform the required service monitor traffic for an interface using the info from state command to show interface traffic statistics when the traffic rate reaches a lowenough level administratively disable the interface 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 175 configuration basics guide release 247 maintenance mode example to monitor an interface  running    info from state interface ethernet12 statistics interface ethernet12  statistics  inoctets 46969 inunicastpkts 492 inbroadcastpkts 0 inmulticastpkts 34 indiscards 0 inerrors 0 inunknownprotos 0 infcserrors 0 outoctets 46169 outunicastpkts 490 outbroadcastpkts 1 outmulticastpkts 25 outdiscards 0 outerrors 0 carriertransitions 1 to shut down the interface   candidate shared default    interface ethernet12 adminstate disable  commit stay all changes have been committed starting new transaction 115 restoring the maintenance group to service procedure after performing the required maintenance operations restore the maintenance group to service to restore the maintenance group to service change the setting for the maintenancemode state in the group configuration to disable then commit the configuration example the following example takes maintenance group mgroup1 out of maintenance mode  candidate shared default    info system maintenance group mgroup1 system  maintenance  group mgroup1  maintenancemode  adminstate disable       candidate shared default    commit stay 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 176 configuration basics guide release 247 maintenance mode all changes have been committed starting new transaction 3he 20653 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 177 customer document and product support customer documentation customer documentation welcome page technical support product support portal documentation feedback customer documentation feedback nokia service router linux release 247 routing protocols guide 3he 20668 aaaa tqzza edition 01 july 2024  2024 nokia use subject to terms available at wwwnokiacomterms nokia is committed to diversity and inclusion we are continuously reviewing our customer documentation and consulting with standards bodies to ensure that terminology is inclusive and aligned with the industry our future customer documentation will be updated accordingly this document includes nokia proprietary and confidential information which may not be distributed or disclosed to any third parties without the prior written consent of nokia this document is intended for use by nokias customers youyour in connection with a product purchased or licensed from any company within nokia group of companies use this document as agreed you agree to notify nokia of any errors you may find in this document however should you elect to use this document for any purposes for which it is not intended you understand and warrant that any determinations you may make or actions you may take will be based upon your independent judgment and analysis of the content of this document nokia reserves the right to make changes to this document without notice at all times the controlling version is the one available on nokias site no part of this document may be modified no warranty of any kind either express or implied including but not limited to any warranty of availability accuracy reliability title non infringement merchantability or fitness for a particular purpose is made in relation to the content of this document in no event will nokia be liable for any damages including but not limited to special direct indirect incidental or consequential or any losses such as but not limited to loss of profit revenue business interruption business opportunity or data that may arise from the use of this document or the information in it even in the case of errors in or omissions from this document or its content copyright and trademark nokia is a registered trademark of nokia corporation other product names mentioned in this document may be trademarks of their respective owners the registered trademark linux is used pursuant to a sublicense from the linux foundation the exclusive licensee of linus torvalds owner of the mark on a worldwide basis  2024 nokia routing protocols guide release 247 table of contents table of contents 1 about this guide 7 11 precautionary and information messages7 12 conventions 7 2 whats new 9 3 ospf 10 31 ospf global configuration 10 311 configuring basic ospf parameters 11 312 configuring the router id 12 313 configuring an area 13 314 configuring a stub area 13 315 configuring a notsostubby area14 316 configuring an interface14 4 bgp 16 41 bgp global configuration 16 411 configuring an asn 16 412 configuring the router id 17 42 configuring a bgp peer group 17 43 configuring bgp neighbors 18 44 bgp peer import and export policies18 45 ebgp multihop 20 451 configuring ebgp multihop 21 46 as path options21 461 configuring allowownas 22 462 configuring replacepeeras22 463 configuring removeprivateas 23 47 bgp med 24 471 configuring alwayscomparemed25 48 route reflection 25 481 configuring route reflection25 49 bgp addpath26 491 configuring bgp addpath27 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 3 routing protocols guide release 247 table of contents 410 bgp graceful restart29 4101 configuring graceful restart29 411 bgp unnumbered peering30 4111 configuring bgp unnumbered peering 33 412 prefixlimit for bgp peers 33 4121 configuring the prefixlimit for bgp peers34 413 rt constrained route advertisement36 4131 rtconstrain on sr linux for various router types 36 4132 bestpath selection and rtc route readvertisement37 4133 using rtc routes to filter advertised routes 38 4134 bgp rib yang model for rtc routes 39 414 bgp configuration management 39 4141 modifying an asn 39 4142 deleting a bgp neighbor 40 4143 deleting a bgp peer group 40 4144 resetting bgp peer connections40 415 bgp shortcuts 41 4151 configuring bgp shortcuts over segment routing 42 416 bgp tcp mss44 4161 configuring bgp tcp mss44 417 error handling for bgp update messages46 418 bgp multipath 46 4181 configuring bgp multipath 46 5 seamless mpls with bgp labeled unicast bgplu 48 51 seamless mpls with bgplu configuration48 52 initial configuration for seamless mpls 49 521 configuring interfaces 49 522 configuring isis 51 523 configuring mpls label blocks52 524 configuring ldp 52 53 bgp configuration for seamless mpls53 531 configuring bgp on abrs 54 532 configuring bgp on the core rr 55 533 configuring bgp on ans toward abrs56 54 export policy configuration for seamless mpls57 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 4 routing protocols guide release 247 table of contents 541 configuring export policies on ans and abrs 57 6 segment routing with bgplu prefix sid 59 61 segment routing with bgplu prefix sid topology example 60 62 configuring segment routing with bgplu prefix sid61 7 isis 66 71 basic isis configuration68 711 enabling an isis instance 68 712 configuring the router level 69 713 configuring the network entity title 69 714 configuring global parameters70 715 configuring interface parameters70 716 configuring authentication keys71 72 isis graceful restart 72 721 configuring isis graceful restart 73 73 displaying isis information74 74 clearing isis information 78 75 isis weighted ecmp 78 751 enabling weighted ecmp 79 752 configuring weighted loadbalancing over interface nexthops 80 753 normalizing datapath weights81 76 multiinstance isis 81 761 configuring the iid 82 762 enabling the iidtlv82 763 displaying miisis information83 77 multitopology isis mt0 and mt2 84 771 configuring an ipv6 routing 84 772 configuring mt2 topology85 78 isis extensions for traffic engineering te 85 781 enabling advertisement of isis te tlvssubtlvs 85 782 te router id tlv86 7821 advertising ipv4 te router id tlv 88 7822 advertising ipv6 te router id tlv 89 783 advertising te attributes using legacy and asla tlvs 90 7831 enabling advertisement of te attributes in legacy mode 91 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 5 routing protocols guide release 247 table of contents 8 protocol authentication92 81 configuring protocol authentication92 9 routing policies95 91 routing policy match conditions 95 911 specifying match conditions in a routing policy97 92 routing policy actions 98 921 specifying actions in a routing policy 100 922 specifying a default action101 923 policy actions for setting med in bgp routes 101 93 applying a routing policy103 931 applying a default policy to ebgp sessions104 932 replacing an as path105 933 as path sets105 9331 configuring an as path set 106 934 bgp communitysets107 9341 configuring a bgp communityset 108 935 prefix sets109 9351 configuring a prefix set 109 94 resequencing statements in a routing policy 110 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 6 routing protocols guide release 247 about this guide 1 about this guide this document describes routing protocols used with the nokia service router linux sr linux examples of commonly used commands are provided this document is intended for network technicians administrators operators service providers and others who need to understand how the router is configured note this manual covers the current release and may also contain some content that will be released in later maintenance loads see the sr linux release notes for information on features supported in each load configuration and command outputs shown in this guide are examples only actual displays may differ depending on supported functionality and user configuration 11 precautionary and information messages the following are information symbols used in the documentation danger danger warns that the described activity or situation may result in serious personal injury or death an electric shock hazard could exist before you begin work on this equipment be aware of hazards involving electrical circuitry be familiar with networking environments and implement accident prevention procedures warning warning indicates that the described activity or situation may or will cause equipment damage serious performance problems or loss of data caution caution indicates that the described activity or situation may reduce your component or system performance note note provides additional operational information tip tip provides suggestions for use or best practices 12 conventions nokia sr linux documentation uses the following command conventions  bold type indicates a command that the user must enter  input and output examples are displayed in courier text  an open rightangle bracket indicates a progression of menu choices or simple command sequence often selected from a user interface example start  connect to  a vertical bar  indicates a mutually exclusive argument 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 7 routing protocols guide release 247 about this guide  square brackets   indicate optional elements  braces   indicate a required choice when braces are contained within square brackets they indicate a required choice within an optional element  italic type indicates a variable generic ip addresses are used in examples replace these with the appropriate ip addresses used in the system 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 8 routing protocols guide release 247 whats new 2 whats new topic location support for multitopology isis multitopology isis mt0 and mt2 isis te extensions for te isis extensions for traffic engineering te segment routing with bgplu prefix sid segment routing with bgplu prefix sid bgp addpath support for bgplu address families bgp addpath new configuration for bgp multipath bgp multipath rtconstrain support rt constrained route advertisement support for additional routing policy actions routing policy actions  nextstatement action  nextpolicy action and policy chaining for bgp import and export policies  bgp nexthopself action  routepreference action 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 9 routing protocols guide release 247 ospf 3 ospf open shortest path first ospf is a hierarchical link state protocol ospf is an interior gateway protocol igp used within large autonomous systems ass ospf routers exchange state cost and other relevant interface information with neighbors the information exchange enables all participating routers to establish a network topology map each router applies the dijkstra algorithm to calculate the shortest path to each destination in the network the resulting ospf forwarding table is submitted to the routing table manager to calculate the routing table when a router is started with ospf configured ospf along with the routingprotocol data structures is initialized and waits for indications from lowerlayer protocols that its interfaces are functional the hierarchical design of ospf allows a collection of networks to be grouped into a logical area an areas topology is concealed from the rest of the as which significantly reduces ospf protocol traffic with the correct network design and area route aggregation the size of the route table can be greatly reduced resulting in decreased ospf route calculation time and topological database size routers that belong to more than one area are called area border routers abrs an abr maintains a separate topological database for each area it is connected to every router that belongs to the same area has an identical topological database for that area key ospf areas are  backbone areas  the backbone distributes routing information between areas  stub areas  a designated area that does not allow external route advertisements routers in a stub area do not maintain external routes a single default route to an abr replaces all external routes  notsostubby areas nssas  nssas are similar to stub areas in that no external routes are imported into the area from other ospf areas external routes learned by ospf routers in the nssa area are advertised as type7 lsas within the nssa area and are translated by abrs into type5 external route advertisements for distribution into other areas of the ospf domain 31 ospf global configuration the minimal ospf parameters that should be configured to deploy ospf are  ospf version sr linux supports ospf version 2 and version 3 the ospf version number must be specified in the configuration if configuring ospfv3 you must also specify the address family to be used either ipv4 or ipv6  ospf instance id when configuring multiple instances an ospf instance id must be defined when configuring multiple instances or the instance being configured is not the base instance if an instance id is not configured the default instance ids are as follows  0 for ospfv2  0 for ospf v3 with address family ipv6 unicast  64 for ospf v3 with address family ipv4 unicast 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 10 routing protocols guide release 247 ospf  router id each router running ospf must be configured with a unique router id the router id is used by both ospf and bgp routing protocols in the routing table manager when you configure a new router id ospf is automatically disabled and reenabled to initialize the new router id  an area at least one ospf area must be created an interface must be assigned to each ospf area  interfaces an interface is the connection between a router and one of its attached networks an interface has state information associated with it which is obtained from the underlying lower level protocols and the routing protocol itself an interface to a network has associated with it a single ip address and mask unless the network is an unnumbered pointtopoint network an interface is sometimes also referred to as a link 311 configuring basic ospf parameters procedure to create a basic ospf configuration the minimal ospf parameters required are the following  ospf version number either v2 or v3 if configuring ospfv3 you must specify the address family either ipv4 or ipv6  a router id  one or more areas  interfaces example configure basic ospfv2 parameters   candidate shared default  networkinstance default protocols   info ospf ospf  instance default  adminstate enable version ospfv2 routerid 1111 area 0001  interface ethernet111  interfacetype broadcast  interface ethernet121  interfacetype broadcast  interface ethernet1161  interfacetype broadcast  interface lo01  interfacetype broadcast     3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 11 routing protocols guide release 247 ospf example configure basic ospfv3 parameters   candidate shared default  networkinstance default protocols   info ospf ospf  instance default  adminstate enable version ospfv3 addressfamily ipv6unicast routerid 1111 area 0001  interface ethernet111  interfacetype broadcast  interface ethernet121  interfacetype broadcast  interface ethernet1161  interfacetype broadcast  interface lo01  interfacetype broadcast     312 configuring the router id procedure you can configure the router id either at the networkinstance level or at the ospf protocol level the router id expressed like an ip address uniquely identifies the router within an as in ospf routing information is exchanged between ass groups of networks that share routing information it can be set to be the same as the loopback system interface address subscriber services also use this address as farend router identifiers when service distribution paths sdps are created the router id is used by both ospf and bgp routing protocols when you configure a new router id ospf is automatically disabled and reenabled to initialize the new router id if a router id is configured at the ospf protocol level ospf uses it instead of the router id configured at the networkinstance level example configure router id at the networkinstance level ospf uses this router id unless a different router id is configured at the ospf protocol level   candidate shared default    info networkinstance default networkinstance default  routerid 101010104   example configure router id for the ospf instance at the ospf protocol level   candidate shared default   3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 12 routing protocols guide release 247 ospf  info networkinstance default networkinstance default  protocols  ospf  instance default  version ospfv2 routerid 2222     313 configuring an area procedure an ospf area consists of routers configured with the same area id to include a router in a specific area the common area id must be assigned and an interface identified if your network consists of multiple areas you must also configure a backbone area 0000 on at least one router the backbone comprises the area border routers and other routers not included in other areas the backbone distributes routing information between areas the backbone is considered to be a participating area within the autonomous system to maintain backbone connectivity there must be at least one interface in the backbone area the minimal configuration must include an area id and an interface modifying other command parameters are optional example the following example configures an area at the ospf level   candidate shared default    info networkinstance default networkinstance default  protocols  ospf  instance default  version ospfv2 area 1111      314 configuring a stub area procedure you can configure stub areas to control external advertisement flooding and to minimize the size of the topological databases on an areas routers a stub area cannot also be configured as an nssa by default summary route advertisements are sent into stub areas 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 13 routing protocols guide release 247 ospf example the following example configures an ospf stub area   candidate shared default    info networkinstance default networkinstance default  protocols  ospf  instance default  version ospfv2 area 1111  stub       315 configuring a notsostubby area procedure you can explicitly configure an area to be a notsostubby area nssa nssas are similar to stub areas in that no external routes are imported into the area from other ospf areas an nssa has the capability to flood external routes it learns throughout its area and by an area border router to the entire ospf domain an area cannot be both a stub area and an nssa example the following is an ospf nssa configuration example   candidate shared default    info networkinstance default networkinstance default  protocols  ospf  instance default  version ospfv2 area 1111  nssa       316 configuring an interface procedure you can configure an interface to act as a connection between a router and one of its attached networks an interface includes state information that was obtained from underlying lower level protocols and from the routing protocol itself an interface to a network is associated with a single ip address and mask 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 14 routing protocols guide release 247 ospf unless the network is an unnumbered pointtopoint network if the address is merely changed then the ospf configuration is preserved example the following is an ospf interface configuration example   candidate shared default    info networkinstance default networkinstance default  protocols  ospf  instance default  version ospfv2 area 1111  interface ethernet12       3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 15 routing protocols guide release 247 bgp 4 bgp border gateway protocol bgp is an interas routing protocol an autonomous system as is a network or a group of routers logically organized and controlled by common network administration bgp enables routers to exchange network reachability information including information about other ass that traffic must traverse to reach other routers in other ass ass share routing information such as routes to each destination and information about the route or as path with other ass using bgp routing tables contain lists of known routers reachable addresses and associated path cost metrics for each router bgp uses the information and path attributes to compile a network topology to set up bgp routing participating routers must have bgp enabled and be assigned to an as and the neighbor peer relationships must be specified a router typically belongs to only one as this section describes the minimal configuration necessary to set up bgp on sr linux this includes the following  global bgp configuration including specifying the autonomous system number asn of the router as well as the router id  bgp peer group configuration which specifies settings that are applied to bgp neighbor routers in the peer group  bgp neighbor configuration which specifies the peer group to which each bgp neighbor belongs as well as settings specific to the neighbor including the as to which the router is peered for information about all other bgp settings see the sr linux online help as well as the sr linux advanced solutions guide and the sr linux data model reference 41 bgp global configuration global bgp configuration includes specifying the autonomous system number asn of the router and the router id 411 configuring an asn procedure you can configure an autonomous system number asn for a router an asn is a globally unique value that associates a router to a specific as each router participating in bgp must have an asn specified example the following example configures an asn for a router   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 16 routing protocols guide release 247 bgp autonomoussystem 65002    412 configuring the router id procedure the router id expressed like an ip address uniquely identifies the router and indicates the origin of a packet for routing information exchanged between ass the router id is configured at the bgp level example the following example configures a router id   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  routerid 2222   42 configuring a bgp peer group procedure you can configure a bgp peer group a bgp peer group is a collection of related bgp neighbors the group name should be a descriptive name for the group all parameters configured for a peer group are inherited by each peer neighbor in the peer group but a group parameter can be overridden for specific neighbors in the configuration of that neighbor example the following example configures the administrative state and trace options for a bgp peer group these settings apply to all of the bgp neighbors that are members of this group unless specifically overridden in the neighbor configuration   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  group headquarters1  adminstate enable traceoptions  flag events   flag gracefulrestart     3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 17 routing protocols guide release 247 bgp  43 configuring bgp neighbors procedure after configuring a bgp peer group and assigning options you can add neighbors within the same as to create internal bgp ibgp connections and or neighbors in a different as to create external bgp ebgp peers all parameters configured for the peer group to which the neighbor is assigned are applied to the neighbor but a peer group parameter can be overridden on a specific neighbor basis example the following example configures parameters for two bgp neighbors the peergroup parameter configures both nodes to use the settings specified for the headquarters1 peer group the peer group settings apply unless they are specifically overridden in the neighbor configuration   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  neighbor 192168111  peergroup headquarters1 description default networkinstance bgp neighbor to node a peeras 65001 localas asnumber 65002   multihop  adminstate enable maximumhops 3  failuredetection  enablebfd true fastfailover true   neighbor 192168132  peergroup headquarters1 description default networkinstance bgp neighbor to node c peeras 65003 localas asnumber 65002   failuredetection  enablebfd true fastfailover true      44 bgp peer import and export policies sr linux supports bgp import policies and export policies 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 18 routing protocols guide release 247 bgp  an import policy is a sequence of match conditions and action rules that are run on certain routes received from bgp peers if a received route is rejected by an import policy rule then depending on the address family and bgp configuration options the route may be discarded or it may be stored in the rib but considered invalid and not considered during bestpath selection  an export policy is a sequence of match conditions and action rules that are run on routes that have been selected for advertisement to a bgp peer if a route that would normally be advertised to a peer ribout is rejected by an export policy rule then the actual advertisement of the route to the peer is blocked bgp import and export policy rules you can configure bgp import or export policies at the bgp global peergroup and neighbor levels the policies operate according to the following rules for bgp import policies     if the configuration of a bgp neighbor explicitly specifies an import policy then this is the policy used to filter inbound routes from the peer and import policies defined at higher levels of configuration group or bgp instance as a whole are ignored if the configuration of a bgp neighbor does not specify an import policy but the peer group to which it belongs does specify an import policy then the peergroup import policy is used to filter inbound routes from the peer and the import policy defined at the bgp instance level is ignored if the configuration of a bgp neighbor does not specify an import policy and the peer group to which it belongs also does not specify an import policy then the bgpinstance importpolicy is used to filter inbound routes from the peer if there is no importpolicy at any level of configuration that applies to a bgp neighbor then the handling of received routes depends on the peer session type as follows  if the peer session type is ibgp then all received routes are accepted  if the peer session type is ebgp then all received routes are rejected by default however this can be changed by configuring the ebgpdefaultpolicy importrejectall setting to false for bgp export policies     if the configuration of a bgp neighbor explicitly specifies an export policy then this is the policy used to filter outbound routes sent to the peer and export policies defined at higher levels of configuration group or bgp instance as a whole are ignored if the configuration of a bgp neighbor does not specify an export policy but the peer group to which it belongs does specify an export policy then the peergroup export policy is used to filter outbound routes sent to the peer and the export policy defined at the bgp instance level is ignored if the configuration of a bgp neighbor does not specify an export policy and the peer group to which it belongs also does not specify an export policy then the bgpinstance export policy is used to filter outbound routes sent to the peer if there is no export policy at any level of configuration that applies to a bgp neighbor then the advertisement of routes in the local ribin depends on the ribin type and the peer session type as follows  if the peer session type is ibgp then all nonimported bgp ribins are accepted and therefore eligible for advertisement  if the peer session type is ebgp then all routes are rejected by default meaning that no routes are eligible for advertisement however this can be changed by configuring the ebgpdefault 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 19 routing protocols guide release 247 bgp policy exportrejectall setting to false in which case all nonimported bgp ribins are accepted and eligible for advertisement afisafi policy attachment rules the openconfig bgp model supports the attachment of afisafispecific route policies to selected peers peergroups or to the bgp instance as a whole this implies for example that for one single peer you could have one export policy for ipv4unicast routes advertised to the peer and a different export policy for ipv6unicast routes advertised to the peer to accommodate this kind of configuration sr linux includes the following contexts supporting attachment of import and export policies  networkinstanceprotocolsbgp  networkinstanceprotocolsbgpafisafi  networkinstanceprotocolsbgpgroup  networkinstanceprotocolsbgpgroupafisafi  networkinstanceprotocolsbgpneighbor  networkinstanceprotocolsbgpneighborafisafi the policy that applies to a route is based on the following order of priority 1 afisafi at neighbor level 2 afisafi at group level 3 afisafi at instance level 4 general policy at neighbor level 5 general policy at group level 6 general policy at instance level 7 default policy 45 ebgp multihop external bgp ebgp multihop can be used to form adjacencies when ebgp neighbors are not directly connected to each other for example when a nonbgp router is between the ebgp neighbors bgp tcpip packets sent toward an ebgp neighbor by default have a ttl value of 1 if the bgp tcpip packets need to pass through more than one router to reach their destination the ttl decrements to 0 and the packets are dropped to prevent this you can enable multihop for the ebgp neighbor and specify the maximum number of hops for bgp tcpip packets sent to the neighbor this allows the ebgp neighbor to be indirectly connected by up to the specified number of hops when multihop is not enabled the ip ttl for ebgp sessions is set to 1 and the ip ttl for ibgp sessions is set to 64 by enabling multihop and configuring the maximum number of hops to a neighbor it allows an ebgp session to have multiple hops and an ibgp session to have a single hop if required if multihop is enabled and the maximumhops parameter is configured for a bgp peer group the settings are applied to the members of the group if the multihop configuration for a neighbor is changed the session with the neighbor must be disconnected and reestablished for the change to take effect 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 20 routing protocols guide release 247 bgp 451 configuring ebgp multihop procedure to configure ebgp multihop you enable it for the ebgp neighbor and specify a value for the maximum hops parameter additionally the nexthop to the neighbor must be configured so that the two systems can establish a bgp session example enable multihop for an ebgp neighbor the maximumhops parameter is set to 2 which increases the ttl for bgp tcpip packets sent toward the ebgp neighbor allowing the neighbor to be indirectly connected by up to 2 hops   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  neighbor 192168111  multihop  adminstate enable maximumhops 2      example configure a route to the nexthop toward the ebgp neighbor   candidate shared default    info networkinstance default staticroutes networkinstance default  staticroutes  route 19216811024  nexthopgroup staticipv4grp      candidate shared default    info networkinstance default nexthopgroups group staticipv4grp networkinstance default  nexthopgroups  group staticipv4grp  nexthop 1  ipaddress 1921682222     46 as path options you can set the following options for handling the aspath in received bgp routes 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 21 routing protocols guide release 247 bgp  allow own as  configures the router to process received routes when its own asn appears in the aspath  replace peer as  configures the router to replace the asn of the peer router in the aspath with its own asn  remove private as path numbers  configures the router to either delete private as numbers shortening the as path length or replace private as numbers with the local as number used toward the peer maintaining the as path length 461 configuring allowownas procedure you can use the allowownas option to configure the router to process received routes when its own asn appears in the aspath normally when the asn of a router appears in the aspath of received routes it is considered a loop and the routes are discarded specifically it configures the maximum number of times the global asn of the router can appear in any received aspath before it is considered a loop and considered invalid default is 0 example the following example configures the router to process received routes where its own asn appears in the aspath a maximum of 1 time   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  autonomoussystem 65001 aspathoptions  allowownas 1     462 configuring replacepeeras procedure you can configure the router to replace the peer asn in aspath with its own asn normally two sites having the same asn would not be able to reach each other directly because the receiving router would see its own asn in the aspath and consider it a loop you can overcome this by configuring the router to replace the peer asn in the aspath with its own asn when the replacepeeras option is set to true the router replaces every occurrence of the peer as number that is present in the advertised aspath with the local asn used toward the peer example the following example configures the router to replace the asn of the peer with its own asn   candidate shared default    info networkinstance default 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 22 routing protocols guide release 247 bgp networkinstance default  protocols  bgp  aspathoptions  replacepeeras true      463 configuring removeprivateas procedure you can configure how the router handles private as numbers either delete them shortening the as path length or replace private as numbers with the local asn used toward the peer which maintains the as path length you can configure the router to delete or replace private as numbers that appear before the first occurrence of a nonprivate asn in the sequence of most recent asns in the as path you can also configure the router to ignore private as numbers when they are the same as the peer asn example configure the router to delete private as numbers the following example configures the router to delete private as numbers 2byte and 4byte from the advertised as path toward all peers this shortens the as path   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  aspathoptions  removeprivateas  mode delete      example the following example configures the router to replace private as numbers with the local asn used toward the peer this keeps the as path the same length   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  aspathoptions  removeprivateas  mode replace     3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 23 routing protocols guide release 247 bgp  example the following example configures the router to replace only private as numbers that appear before the first occurrence of a nonprivate asn in the sequence of most recent asns in the as path   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  aspathoptions  removeprivateas  mode replace leadingonly true      example the following example configures the router to ignore private as numbers not replace them when they are the same as the peer as number   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  aspathoptions  removeprivateas  mode replace ignorepeeras true      47 bgp med the multiexit discriminator med attribute is an optional attribute that can be added to routes advertised to an ebgp peer to influence the flow of inbound traffic to the as the med attribute carries a 32bit metric value a lower metric is better than a higher metric when med is compared by the bgp decision process by default the med attribute is compared only if the routes come from the same neighbor as you can optionally configure sr linux to compare the med value from different ass when selecting the best route 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 24 routing protocols guide release 247 bgp 471 configuring alwayscomparemed procedure to configure sr linux to use med values from different ass in the bgp decision process tiebreak between routes for the same nlri set the alwayscomparemed option to true by default this option is set to false which uses med values in the bgp decision process only for routes from the same neighbor as example the following example sets the alwayscomparemed option to true  candidate shared default    info networkinstance default protocols bgp bestpathselection networkinstance default  protocols  bgp  bestpathselection  alwayscomparemed true     48 route reflection in a standard ibgp configuration all bgp speakers within an as must have full bgp mesh to ensure that all externally learned routes are redistributed through the entire as configuring route reflection provides an alternative to the full bgp mesh requirement instead of peering with all other ibgp routers in the network each ibgp router only peers with a router configured as a route reflector an as can be divided into multiple clusters with each cluster containing at least one route reflector which redistributes routes to the clients in the cluster the clients within the cluster do not need to maintain a full peering mesh between each other they only require a peering to the route reflectors in their cluster the route reflectors must maintain a full peering mesh between all nonclients within the as 481 configuring route reflection procedure to configure a route reflector you assign it a cluster id and specify which neighbors are clients and which are nonclients clients receive reflected routes and nonclients are treated as a standard ibgp peer example the following example configures the router to be a route reflector for two clients srl1 and srl2 the router is assigned cluster id 0001   candidate shared default    info networkinstance default 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 25 routing protocols guide release 247 bgp networkinstance default  protocols  bgp  routereflector  clusterid 0001   neighbor srl1  routereflector  clusterid 0001 client true  neighbor srl2  routereflector  clusterid 0001 client true      49 bgp addpath normally if the sr linux device receives an advertisement of an nlri and path from a specific peer and that peer subsequently advertises the same nlri with different path information a different nexthop and or different path attributes the new path effectively overwrites the existing path if bgp addpath has been negotiated with the peer there is a different behavior the newly advertised path is stored in the ribin along with all of the paths previously advertised and not withdrawn by the peer for router a to receive multiple paths per nlri from peer b for a particular address family the bgp capabilities advertisement during session setup must indicate that peer b needs to send multiple paths for the address family and router a is willing to receive multiple paths for the address family when the addpath receive capability for an address family has been negotiated with a peer all advertisements and withdrawals of nlri within that address family by that peer includes a path identifier    if the combination of nlri and path identifier in an advertisement from a peer is unique does not match an existing route in the ribin from that peer the route is added to the ribin if the combination of nlri and path identifier in a received advertisement is the same as an existing route in the ribin from the peer the new route replaces the existing one if the combination of nlri and path identifier in a received withdrawal matches an existing route in the ribin from the peer that route is removed from the ribin bgp addpath is supported by bgp running in the default networkinstance and bgp running in any ip vrf networkinstance bgp addpath is configurable per address family at the networkinstance group and neighbor levels inheritance of addpath configuration from networkinstance to group to neighbor is per address family the following address families are supported   ipv4 unicast ipv6 unicast  layer 3 vpn ipv4 unicast 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 26 routing protocols guide release 247 bgp  layer 3 vpn ipv6 unicast   ipv4 labeled unicast ipv6 labeled unicast  evpn  route target 491 configuring bgp addpath procedure sr linux supports the following addpath options  receive  negotiate with a peer to receive multiple path advertisements from a single peer for a single nlri belonging to the address family  send  negotiate with a peer to send multiple path advertisements to a single peer for a single nlri belonging to the address family  sendmax  send the best paths for a single nlri up to a configured maximum or as many as possible until there are no more valid paths to send  sendmultipath  send the used paths for a single nlri including all paths that are multipaths  eligibleprefixpolicy  control addpath send behavior using a routing policy this option is not supported at the group or neighbor levels example enable bgp addpath send for an address family the following example enables the sr linux device to negotiate with a bgp peer to send multiple path advertisements for a single nlri belonging to an address family  candidate shared default    info networkinstance default protocols bgp neighbor 1111 networkinstance default  protocols  bgp  neighbor 1111  afisafi ipv4unicast  addpaths  send true       example send up to a maximum number of paths the following example enables the sr linux device to send up to 10 advertisements for a single nlri belonging to the ipv4 unicast address family  candidate shared default    info networkinstance default protocols bgp afisafi ipv4unicast networkinstance default  protocols  bgp  3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 27 routing protocols guide release 247 bgp afisafi ipv4unicast  addpaths  sendmax 10      example use a routing policy to control bgp addpath behavior the following example configures a routing policy that matches prefixes in a prefixset with a policy result action of accept the routing policy is specified in the addpaths configuration to control the bgp addpath send behavior for matching prefixes   candidate shared default    info routingpolicy routingpolicy  prefixset pset1  prefix 103192021 masklengthrange 2124   prefix 103191021 masklengthrange exact    policy ap1  statement st1  match  prefixset pset1  action  policyresult accept      candidate shared default    info networkinstance default protocols bgp afisafi ipv4unicast networkinstance default  protocols  bgp  afisafi ipv4unicast  addpaths  eligibleprefixpolicy ap1      the routing policy referenced by eligibleprefixpolicy can have the following match conditions  prefixset   family community set the action in the routing policy can be accept or reject route property modification actions in the routing policy are ignored 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 28 routing protocols guide release 247 bgp note     if no routing policy is configured to control addpath send behavior it is advertised for all prefixes for the specified address family if a routing policy is configured but there is no match addpath capability is advertised for the prefix according to the afisafi configuration if the routing policy is matched and the action is accept addpath capability is advertised for the prefix according to the afisafi configuration if the routing policy is matched and the action is reject addpath capability is not advertised for the prefix 410 bgp graceful restart bgp graceful restart allows a router whose control plane has temporarily stopped functioning because of a system failure or a software upgrade to return to service with minimal disruption to the network to do this the router relies on neighbor routers which have also been configured for graceful restart to maintain forwarding state while the router restarts these neighbor routers are known as helper routers the helper routers and the restarting router continue forwarding traffic using the previously learned routing information from the restarting router other routers in the network are not notified about the restarting router so network traffic is not disrupted when graceful restart is enabled on the sr linux and its neighbor the two routers exchange information about graceful restart capability including the address family identifier afi and subsequent address family identifier safi of the routes supported for graceful restart while the router restarts the helper router marks the routes from the restarting router as stale but continues to use them for traffic forwarding when the bgp session is reestablished the restarting router indicates to the helper router that it has restarted the helper router then sends the restarting router any bgp rib updates followed by an endofrib eor marker indicating that the updates are complete the restarting router then makes its own updates and sends them to the helper router followed by an eor marker graceful restart is used in conjunction with the inservice software upgrade issu feature which can be used to upgrade 7220 ixrd2 and d3 systems while maintaining nonstop forwarding during the issu a warm reboot brings down the control and management planes while the nos reboots and graceful restart maintains the forwarding state in peers you can use a tools command to validate that the sr linux and its peers support warm reboot including graceful restart configuration see the sr linux software installation guide for more information 4101 configuring graceful restart procedure you can configure graceful restart for the bgp instance the sr linux operates as a helper router for neighbor routers when they are restarting assuming graceful restart is also enabled on the neighbors enabling graceful restart also indicates to the neighbors that they can serve as helper routers when the sr linux itself is restarting 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 29 routing protocols guide release 247 bgp example when operating as a helper router the sr linux marks the routes from the restarting router as stale but continues to use them for forwarding for a period of time while the neighbor router restarts after this period expires the sr linux deletes the routes the staleroutestime parameter configures the amount of time in seconds the routes remain stale before they are deleted the requestedrestarttime parameter configures the amount of time in seconds to wait for a graceful restartcapable neighbor to reestablish a tcp connection after this period expires the helper router deletes the stale routes it preserved on behalf of its neighbor routers   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  gracefulrestart  adminstate enable staleroutestime 300 requestedrestarttime 300     following a restart by default the system waits 600 seconds 10 minutes to receive eor markers from all helper routers for all address families that were up before the restart after this time elapses the system assumes convergence has occurred and sends its own eor markers to its peers you can configure the amount of time the system waits to receive eor markers to be from 0 to 3600 seconds for example the following configures the amount of time the system waits to receive eor markers to 270 seconds   candidate shared default    info system warmreboot system  warmreboot  bgpmaxwait 270   411 bgp unnumbered peering in a typical largescale data center using bgp leaf and spine switches are interconnected in a clos topology and each device establishes a singlehop ebgp session with each of its physically connected peers the sessions come up as ebgp because of the asn allocation scheme it is common practice to assign a unique asn to every leaf switch tor in a cluster and a different unique asn to the set of spine switches to which those tors are connected the allocated asns are typically private asns in the range 4200000000 to 4294967294 although this is not always the case for this type of configuration bgp unnumbered peering can be a useful solution bgp unnumbered peering is the dynamic setup of one or more singlehop bgp sessions over a network segment that has no globallyunique ipv4 or ipv6 addresses each router connected to the network segment is assumed to 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 30 routing protocols guide release 247 bgp have an ipv6enabled interface to the network and these interfaces have ipv6 linklocal addresses that are typically autogenerated by each router from the interface mac addresses how sessions are established using bgp unnumbered peering the set of bgp speakers configured for bgp unnumbered peering on a network segment discover each other by sending and receiving icmpv6 router advertisement ra messages consider an example of router a and router b which are both connected to an unnumbered interface and configured for bgp unnumbered dynamic session setup the bgp session between the two routers is established in the following sequence 1 router b sends an icmpv6 ra message on its interface b1 assuming the ra message is unsolicited the source ip address of this message is the linklocal address of interface b1 fe807efe90fffefc7ad8 and the destination ip address is the allnodes multicast address 2 asynchronously router a sends an icmpv6 ra message on its interface a1 the source ip address is the linklocal address of interface a1 fe807efe90fffefc7bd8 and the destination ip address is the allnodes multicast address 3 router a receives the ra message on interface a1 and the software process responsible for icmpv6 relays the information to bgp because in the bgp configuration a1 is a subinterface that is configured as a dynamic neighbor interface that is added to the bgp dynamicneighbors interface list 4 bgp checks if it already has a bgp session with fe807efe90fffefc7ad8   if bgp already has this session and it is up or bgp is in the process of establishing this session then do nothing possibly router b started the same process moments before router a if bgp does not have a session with this linklocal address then a new tcp connection is initiated toward fe807efe90fffefc7ad8 5 when the tcp connection is established the bgp open message sent by router a encodes a local as and other capabilities that come from the configuration of the peergroup associated with interface a1 6 router a receives a bgp open message from router b and accepts that open message proceeding to move toward the bgp established state if the open message encodes an acceptable peer as number in one of the allowedpeeras ranges configured for interface a1 the address families supported by the session are based on the usual mpbgp negotiation bgp dynamicneighbors interface list to enable dynamic peering you add subinterfaces to the bgp dynamicneighbors interface list in the sr linux configuration when a subinterface is added to the dynamicneighbors interface list  bgp automatically accepts incoming bgp connections to the ipv6 linklocal address of that subinterface subject to the configured maxsessions limit for the subinterface for the connection to be accepted the source address must be an ipv6 linklocal address that may or may not also be a defined neighbor address and the reported asn of the peer must match relevant configuration if the source address does not match a configured neighbor address the session is set up according to the peergroup associated with the subinterface not the peergroup associated with the dynamicneighbors accept matchprefix entry matching the source ipv6 linklocal address if a matching entry exists 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 31 routing protocols guide release 247 bgp  bgp registers for ipv6 ra messages on the subinterface whenever the source of one of these ra messages matches an ipv6 linklocal address for which there is currently no established bgp session the system attempts to create a bgp session to that address as long as this does not exceed the configured maxsessions limit for the subinterface the session is set up according to the configured peergroup associated with the subinterface when a bgp session is established over a subinterface in the dynamicneighbors interface list  changes to the allowedpeeras ranges associated with the subinterface only take effect from the next time bgp attempts to establish the sessions  nonarrival of expected icmpv6 ra messages on the subinterface do not trigger teardown of associated sessions  existing triggers for tearing down a session apply as normal for example holdtimer expiration bfd timeout clear bgp neighbor commands and so on  if the linklocal address of a dynamic peer is configured as a static neighbor address the dynamic session is immediately torn down and replaced by the static session when a subinterface is deleted from the dynamicneighbors interface list all dynamic sessions associated with that subinterface excluding sessions set up by static configuration of the neighbor are torn down immediately a bgp session that was previously established on an unnumbered interface and subsequently torn down can only be reestablished if the subinterface is configured in the dynamicneighbors interface list and a recent icmpv6 ra message is received configuration overrides for dynamic peers on unnumbered interfaces when a dynamic bgp session is initiated or accepted on an interface that is tied to a peergroup most of the parameters relevant to that session come from the configuration of that peergroup with the following exceptions  multihop maximumhops is always 1 for both ebgp and ibgp peers  transport localaddress is always the linklocal address of the specified interface  nexthopself is always true the neighbor is not presumed to have reachability to offlink destinations  transport passivemode is always false bgp always initiates a connection when informed by icmpv6 unless it already has a connection  afisafi ipv4unicast ipv4unicast receiveipv6nexthops is always true  afisafi ipv4unicast ipv4unicast advertiseipv6nexthops and evpn advertiseipv6nexthops are always true peer as validation for dynamic peers on unnumbered interfaces when a bgp open message is received from an unnumbered dynamic neighbor the reported as number of the peer is checked to determine if it is acceptable to allow the peering to proceed for a dynamic session associated with a subinterface the peer as is acceptable only if it matches one of the allowedpeeras elements of the dynamicneighbors interface list entry for the subinterface or if the peer as is equal to the local as implying an ibgp session 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 32 routing protocols guide release 247 bgp 4111 configuring bgp unnumbered peering procedure to configure bgp unnumbered peering you add subinterfaces to the bgp dynamicneighbors interface list and specify the peer autonomous system numbers from which incoming tcp connections to the bgp wellknown port are accepted example the following example adds a subinterface to the bgp dynamicneighbors interface list  candidate shared default    info networkinstance default protocols bgp dynamicneighbors interface ethernet111 networkinstance default  protocols  bgp  dynamicneighbors  interface ethernet111  peergroup bgppeergroup0 allowedpeeras  4294967200       in this example subinterface ethernet111 is added to the bgp dynamicneighbors interface list this subinterface must be enabled for ipv6 and configured to accept and send ipv6 ra messages it does not require any ipv4 addresses or globalunicast ipv6 addresses incoming tcp connections to port 179 received on this subinterface that are sourced from an ipv6 linklocal address and destined for the ipv6 link local address of this subinterface are automatically accepted ipv6 ra messages received on this subinterface automatically trigger bgp session setup toward the sender of these messages if there is not already an established bgp session peer group bgppeergroup0 is associated with dynamic bgp neighbors on this subinterface parameters configured for this peergroup are used for establishing the dynamic bgp session with the exceptions described in configuration overrides for dynamic peers on unnumbered interfaces asn 4294967200 is configured as an allowed peer as for dynamic bgp neighbors on this subinterface if the bgp open message from a peer on this subinterface contains a myas number that is not an allowed peer as then a notification is sent to the peer with the indication bad peer as 412 prefixlimit for bgp peers sr linux places a limit on the number of ipv4 ipv6 or evpn route prefixes that can be received from a peer or from individual members of a peer group when this prefixlimit is exceeded sr linux tears down the bgp session with the peer then reestablishes the session you can configure the following settings for the prefixlimit  maxreceivedroutes 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 33 routing protocols guide release 247 bgp by default the prefixlimit that triggers a bgp session teardown is 4294967295 routes which is the maximum number of routes that can be received from the peer counting routes accepted and rejected by import policy you can configure a different prefixlimit by setting a value for maxreceived routes  prefixlimitrestarttimer by default after a bgp session is torn down because the prefix limit was exceeded the bgp session is reestablished immediately you can configure the number of seconds the system waits before re establishing the session by setting a value for prefixlimitrestarttimer  preventteardown you can prevent the bgp session from being torn down when the prefixlimit is exceeded by setting preventteardown to true  warningthresholdpct you can set a warning threshold for the prefixlimit when the number of routes received from the peer counting routes accepted and rejected by import policy reaches a specified percentage of the max receivedroutes setting bgp raises a warning log event the default threshold is 90 when upgrading from a release earlier than 2331 to release 2331 or later the upgrade script checks the configured maxreceivedroutes setting for ipv4 and ipv6 routes if the configured max receivedroutes setting is equal to 4295967295 for ipv4 or ipv6 routes then preventteardown for ipv4 or ipv6 routes is set to true 4121 configuring the prefixlimit for bgp peers procedure to configure the prefixlimit you can set the maximum number of routes from a peer number of seconds the system waits to reestablish a session following a teardown and disable the prefixlimit for a peer the commands to set maximum number of routes from a peer and disable the prefixlimit can be applied to ipv4 and ipv6 routes the settings can be applied to a specific peer or to a peer group if there is no setting for a specific peer the setting for the peer group applies if there is no setting for the peer and peer group the system default applies example configure maximum number of routes from a peer the following example configures the maximum number of ipv4 routes that can be received from a peer  candidate shared default    info networkinstance default protocols bgp neighbor 192168111 afisafi ipv4unicast ipv4unicast networkinstance default  protocols  bgp  neighbor 192168111  afisafi ipv4unicast  ipv4unicast  prefixlimit  maxreceivedroutes 30000000      3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 34 routing protocols guide release 247 bgp   if maxreceivedroutes is not configured for the peer the maxreceivedroutes setting for the peer group applies if maxreceivedroutes is not configured for the peer group the system default maximum of 4294967295 routes applies example configure prefixlimit restart timer the following example sets the number of seconds the system waits to reestablish a bgp session with a peer after the session was torn down because the maxreceivedroutes value was exceeded  candidate shared default    info networkinstance default protocols bgp neighbor 192168111 timers networkinstance default  protocols  bgp  neighbor 192168111  timers  prefixlimitrestarttimer 60      if the prefixlimitrestarttimer is not configured for the peer the prefixlimit restarttimer setting for the peer group applies if the prefixlimitrestarttimer is not configured for the peer group the bgp session with the peer is reestablished immediately after teardown that is prefixlimitrestarttimer  0 seconds example disable the prefixlimit the following example disables the prefixlimit for ipv4 routes received from a peer so that the bgp session is not torn down if the maximum number of ipv4 routes received from the peer is exceeded  candidate shared default    info networkinstance default protocols bgp neighbor 192168111 afisafi ipv4unicast ipv4unicast networkinstance default  protocols  bgp  neighbor 192168111  afisafi ipv4unicast  ipv4unicast  prefixlimit  preventteardown true        3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 35 routing protocols guide release 247 bgp 413 rt constrained route advertisement rt constrained route advertisement rtconstrain is a mechanism that allows a bgp router to advertise route target rt membership information to its bgp peers to indicate interest in receiving only bgp routes tagged with specific rt extended communities upon receiving this information bgp peers restrict the advertised bgp routes to only those requested routes which can minimize controlplane load for protocol traffic and rib memory the rt membership information is carried in a special type of mpbgp route called an rtc route the associated afi is 1 and the safi is 132 for two routers to exchange rt membership nlri they must advertise the corresponding afisafi to each other during capability negotiation the use of mpbgp means rt membership nlri is propagated loopfree within an as and between ases using wellknown bgp route selection and advertisement rules note extended communitybased orf can also be used for rtbased route filtering but rtconstrain has distinct advantages over extended communitybased orf rtconstrain is more widely supported simpler to configure and its distribution scope is not limited to a direct peer 4131 rtconstrain on sr linux for various router types this section describes how rtconstrain operates on sr linux for pe route reflector and asbr routers pe routers a pe router originates rt membership nlri to its peers often route reflectors to prevent these peers from sending unnecessary vpn routes to the pe usually a pe originates one rtc route for each import routetarget associated with a local vprn service or ipvrf networkinstance an rt is an extended community with type subcode value 0x02 and type code value 0x00 0x01 or 0x02 rtc routes originated by a pe are by default automatically advertised to all rtc peers without the need for an export policy to accept them each rtc route has a prefix carried in the mpreachnlri and mpunreachnlri attributes and path attributes for example origin aspath the prefix length in bits of an rtc route can be 0 for the default rtc route 32 or a number in the range 48 to 96 the prefix value is the concatenation of the origin as a 4byte value representing the 2 or 4octet as of the originating router as configured under networkinstanceprotocolsbgpautonomous system and 0 or 1664 bits of an rt extended community this nlri format allows rts originated by the same as and having the same n most significant bits to be advertised in a single rtc route with prefix length 32n n  16 but sr linux implementation does not make use of this flexibility when originating rtc routes only the default rtc route with a prefix length of 0 or fullyspecified rtc routes with a prefix length of 96 are advertised to rtc peers route reflectors a route reflector rr propagates rtc routes according to a special set of rules outlined below an rr typically advertises the default rtc route to each of its clients so that it receives all vpn routes belonging to the cluster this is achieved by enabling setting to true afisafiroutetargetsenddefaultroute in the group or neighbor configuration context the default rtc route is a special type of rtc route encoded in one of the following ways  prefixlength  0 sr linux routers always generate default rtc routes with this encoding 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 36 routing protocols guide release 247 bgp  prefixlength  32 encoding only the origin as value  prefixlength  48 encoding the origin as value plus 16 bits of an rt type sending the default rtc route to a peer conveys a request to receive all vpn routes regardless of rt extended community from that peer the advertisement of the default rtc route to a peer does not suppress other morespecific rtc routes from being sent to that peer asbrs an asbr for example a modelb asbr or modelc route reflector propagates route target membership nlri to ebgp peers in other autonomous systems to limit received routes to only those needed for services in the local as and those to be propagated through the local as when the rtc route propagation path includes multiple asns sr linux routers choose only the single best path for reverse advertisement of vpn routes advertisement of vpn routes using rtc multipaths is not supported 4132 bestpath selection and rtc route readvertisement if multiple rtc routes are received for the same prefix then standard bgp bestpath selection procedures determine the best of these routes bgp does not check for reachability of the bgp nexthop of rtc routes so this does not factor into bestpath selection the best rtc route per prefix is readvertised to rtc peers based on the following rules  the best path for a default rtc route prefixlength 0 origin as only with prefixlength 32 or origin as plus 16 bits of an rt type with prefixlength 48 is never propagated to another peer  a pe with only ibgp rtc peers that is neither a route reflector or an asbr does not readvertise the best rtc route to any rtc peer due to standard ibgp split horizon rules  a route reflector that receives its best rtc route for a prefix from a client peer readvertises that route subject to export policies to all of its client and nonclient ibgp peers including the originator per standard rr operation when the route is readvertised to client peers the rr should i set the originatorid to its own router id and ii modify the nexthop to be its local address for the sessions eg system ip  a route reflector that receives its best rtc route for a prefix from a nonclient peer readvertises that route subject to export policies to all of its client peers per standard rr operation normally no route is advertised to nonclient peers in this scenario but if the rr has a nonbest path for the prefix from any of its clients it should advertise the best of the clientadvertised paths to all nonclient peers no originatorid or nexthop manipulation is required in this case  an asbr which is neither a pe nor a route reflector that receives its best rtc route for a prefix from an ibgp peer readvertises that route subject to export policies to its ebgp peers it modifies the nexthop and aspath of the readvertised route per standard bgp rules no aggregation of rtc routes is supported  an asbr that is neither a pe nor a route reflector that receives its best rtc route for a prefix from an ebgp peer readvertises that route subject to export policies to its ebgp and ibgp peers when readvertised routes are sent to ebgp peers the absr modifies the nexthop and aspath per standard bgp rules no aggregation of rtc routes is supported 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 37 routing protocols guide release 247 bgp 4133 using rtc routes to filter advertised routes when rtconstrain is configured on a session that also supports vpn address families using route targets for example vpnipv4 vpnipv6 mvpn evpn advertisement of the vpn routes is affected as follows  when the session comes up the advertisement of all vpn routes is delayed until the initial set of rtc routes has been received from the peer that is all rtc routes in the peers ribout this is the waiting state the waiting state ends when an endofrib marker for afisafi1132 is received from the peer or a certain amount of time has elapsed since the session was established this amount of time is hardcoded to 60 seconds and applies when the peer does not support sending the endof rib marker when the waiting state ends vpn routes are sent to the peer based on received rtc routes see below and the session transitions to the ready state  when the session is in the ready state received rtc routes are acted upon immediately sr linux does not expect and wait for a route refresh message from the peer if s1 is the set of routes previously advertised to the peer and s2 is the set of routes to be advertised based on the most recent received rtc routes then      the set of routes in s1 but not in s2 are withdrawn immediately subject to mrai  the set of routes in s2 but not in s1 are advertised immediately subject to mrai if a default rtc route best or nonbest is received from an ebgp or ibgp peer the vpn routes advertised to the peer is the set of vpn routes in the locrib that meet all of the following conditions  are eligible for advertisement to the ebgp or ibgp peer per bgp route advertisement rules  have not been rejected by manually configured export policies  have not been advertised to the peer if an rtc route for a prefix originas  a1 rt  a2n n  48 best or nonbest is received from an ibgp peer in autonomous system a1 the vpn routes advertised to the ibgp peer is the set of vpn routes in the locrib that meet all of the following conditions  are eligible for advertisement to the ibgp peer per bgp route advertisement rules  have not been rejected by manually configured export policies  carry at least one route target extended community with value a2 in the n mostsignificant bits  have not been advertised to the peer if the best rtc route for a prefix originas  a1 rt  a2n n  48 is received from an ibgp peer in autonomous system b the vpn routes advertised to the ibgp peer is the set of vpn routes in the loc rib that meet all of the following conditions  are eligible for advertisement to the ibgp peer per bgp route advertisement rules  have not been rejected by manually configured export policies  carry at least one route target extended community with value a2 in the n mostsignificant bits  have not been advertised to the peer if the best rtc route for a prefix originas  a1 rt  a2n n  48 is received from an ebgp peer the vpn routes advertised to the ebgp peer is the set of vpn routes in the locrib that meet all of the following conditions  are eligible for advertisement to the ebgp peer per bgp route advertisement rules  have not been rejected by manually configured export policies 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 38 routing protocols guide release 247 bgp  carry at least one rt extended community with value a2 in the n mostsignificant bits  have not been advertised to the peer 4134 bgp rib yang model for rtc routes the following table lists the information available in the sr linux bgp rib yang model for rtc routes in the ribin and ribout contexts table 1 rtc route information available in the sr linux bgp rib yang model bgpribafisafiroutetargetribin outribinpreroutes contains the full set of rtc routes received from all peers bgpribafisafiroutetargetribin outribinpostroutes contains the full set of rtc routes received from all peers after import policy modification bgpribafisafiroutetargetribin outriboutpostroutes contains the full set of rtc routes advertised to each peer after export policy modification 414 bgp configuration management managing the bgp configuration on sr linux can include the following tasks  modifying an as number  deleting a bgp neighbor  deleting a bgp peer group  resetting bgp peer connections 4141 modifying an asn procedure you can modify the asn on the router but the new asn does not take effect until the bgp instance is restarted either by administratively disablingenabling the bgp instance or by rebooting the system with the new configuration example   candidate shared default  networkinstance default   protocols bgp autonomoussystem 95002  protocols bgp adminstate disable  protocols bgp adminstate enable all established bgp sessions are taken down when the bgp instance is disabled 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 39 routing protocols guide release 247 bgp 4142 deleting a bgp neighbor procedure use the delete command to delete a bgp neighbor from the configuration example   candidate shared default  networkinstance default   delete protocols bgp neighbor 192168111 4143 deleting a bgp peer group procedure use the delete command to delete the settings for a bgp peer group from the configuration example   candidate shared default  networkinstance default   delete protocols bgp group headquarters1 4144 resetting bgp peer connections procedure to refresh the connections between bgp neighbors you can issue a hard or soft reset a hardreset tears down the tcp connections and returns to idle state a softreset sends routerefresh messages to each peer the hard or soft reset can be issued to a specific peer to peers in a specific peergroup or to peers with a specific asn example issue a hard reset the following command hardresets the connections to the bgp neighbors in a peer group that have a specified asn the hard reset applies both to configured peers and dynamic peers  tools networkinstance default protocols bgp group headquarters1 resetpeer peeras 95002 networkinstancenamedefaultprotocolsbgpgroupgroupnameheadquarters1 successfully executed the tools clear command example issue a soft reset the following command softresets the connection to bgp neighbors that have a specified asn the soft reset applies both to configured peers and dynamic peers  tools networkinstance default protocols bgp softclear peeras 95002 networkinstancenamedefaultprotocolsbgp successfully executed the tools clear command 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 40 routing protocols guide release 247 bgp 415 bgp shortcuts with bgp shortcuts sr linux can include ldp lsps or segment routing srisis tunnels in the bgp algorithm calculations in this case tunnels operate as logical interfaces directly connected to remote nodes in the network because the bgp algorithm treats the tunnels in the same way as a physical interface being a potential output interface the algorithm can select a destination node together with an output tunnel to resolve the nexthop using the tunnel as a shortcut through the network to the destination note bgp shortcuts can only be used for nexthop resolution of ipv4unicast ribins with an ipv4 nexthop address bgp nexthop resolution describes the procedures that bgp uses to resolve the nexthop address of each bgp ribin that forms part of a bgp route the following table defines bgp ribin and bgp route in the context of bgp nexthop resolution table 2 bgp ribin and bgp route bgp term definition bgp ribin one of the following  a received ipv4unicast bgp route with an ipv4 nexthop address  a received ipv4unicast bgp route with an ipv6 nexthop address allowed as a result of sending an extendednhencoding capability to the peer  a received ipv6unicast bgp route with an ipv6 nexthop address bgp route a route submitted by bgp to the fibmgr that resulted from the grouping of one or more bgp ribins multiple bgp ribins per route describes a multipath scenario with bgp shortcuts enabled nexthop resolution determines whether to use a local interface or a tunnel to resolve the bgp nexthop tunnel resolution mode as part of the configuration for bgp shortcuts you must define the tunnelresolution mode preferrequired disabled this mode determines the order of preference and fallback of using tunnels in the tunnel table to resolve the nexthop instead of using routes in the fib as described in the following sections nexthop resolution of ipv4unicast ribins with ipv4 nexthop the following table describes the nexthop resolution steps for ipv4unicast ribins with ipv4 nexthops depending on the specified tunnel resolution mode table 3 nexthop resolution for ipv4 unicast ribins with ipv4 nexthop address tunnel resolution mode nexthop resolution steps in bgp prefer 1 start with ttm lookup a find all the tunnels in ttm with an endpoint that matches the bgp nexthop address and that have one of the types listed in the allow list 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 41 routing protocols guide release 247 bgp tunnel resolution mode nexthop resolution steps in bgp b if there is a single tunnel select that tunnel the ribin is resolved exit c if there are multiple tunnels select the tunnel with the numerically lowest ttm preference and if a further tiebreak is needed select the tunnel with the lowest ttm metric the ribin is resolved exit 2 if there are no tunnels fallback to fib lookup a find the longest match active route in the fib that matches the bgp nexthop address there are presently no restrictions on this route it can be an igp route a static blackhole route a default route or another bgp route b if there is a longest match route and it eventually resolves to a blackhole next hop interface or tunnel then the ribin is resolved exit c if there is no matching route the ribin is unresolved require perform ttm lookup only as described in 1 above if there is no matching tunnel the ribin is unresolved disabled perform fib lookup only as described in 2 above nexthop resolution of ipv4unicast and ipv6unicast ribins with ipv6 nexthop if the nexthop address for the ipv4unicast ribin is an ipv6 address the nexthop is resolved by the longest prefix match ipv6 route in the fib this is the only option because there are no ipv6 tunnels in the ttm the same logic applies to bgp ribins with ipv6unicast nlri address family as they can only have an ipv6 nexthop address the nexthop resolution logic is the same as the fib lookup described in the preceding table 4151 configuring bgp shortcuts over segment routing procedure step 1 in the default network instance define the tunnelresolution mode for the bgp protocol this setting determines the order of preference and the fallback when using tunnels in the tunnel table instead of routes in the fib available options are as follows  require requires tunnel table lookup only  prefer prefers tunnel table lookup over fib lookup  disabled default performs fib lookup only step 2 set the allowed tunnel types for nexthop resolution 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 42 routing protocols guide release 247 bgp example configure ipv4 bgp shortcuts the following example shows the bgp nexthop resolution configuration to allow ipv4 srisis tunnels with the tunnel mode set to prefer   candidate shared default    info networkinstance default protocols bgp afisafi ipv4unicast ipv4unicast nexthop resolution ipv4nexthops tunnelresolution networkinstance default  protocols  bgp  afisafi ipv4unicast  ipv4unicast  nexthopresolution  ipv4nexthops  tunnelresolution  mode prefer allowedtunneltypes  srisis          example configure ipv6 bgp shortcuts the following example shows the bgp nexthop resolution configuration to allow ipv6 srisis tunnels with the tunnel mode set to prefer   candidate shared default    info networkinstance default protocols bgp afisafi ipv6unicast ipv6unicast nexthop resolution ipv6nexthops tunnelresolution networkinstance default  protocols  bgp  afisafi ipv6unicast  ipv6unicast  nexthopresolution  ipv6nexthops  tunnelresolution  mode prefer allowedtunneltypes  srisis          3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 43 routing protocols guide release 247 bgp 416 bgp tcp mss bgp uses tcp transport and bgp messages are carried as tcp segments sr linux allows you to control the maximum segment size mss for each tcp segment based on the path mtu discovery settings path mtu discovery can be enabled or disabled per network instance in sr linux the default is enabled within the bgp hierarchy path mtu discovery can be enabled and disabled at different configuration levels the supported configuration paths are  networkinstanceprotocolsbgptransportmtudiscovery  networkinstanceprotocolsbgpgrouptransportmtudiscovery  networkinstanceprotocolsbgpneighbortransportmtudiscovery bgp path mtu discovery by default inherits the value from the network instance for all bgp sessions it can be overruled by the above config when an icmp fragmentationneeded message is received and bgp path mtu discovery is disabled the system reduces the mtu for the bgp session according to the icmp message subject to the lower bound configured under the systemlevel minpathmtu   candidate shared default    info networkinstance default networkinstance default  mtu  pathmtudiscovery true     candidate shared default    info system mtu system  mtu  minpathmtu 552   4161 configuring bgp tcp mss procedure the maximum size of each tcp segment is controlled by configuring the tcp mss tcpmss value sr linux supports configuring tcp mss at bgp instance peer group and neighbor configuration levels the supported range for the tcpmss value is 5369446 bytes and the default value is 1024 bytes the value of tcpmss gets inherited down the configuration levels within the bgp hierarchy if no tcp mss is configured for a bgp neighbor the tcpmss value is taken from the bgp peer group if it is configured there or else is taken from the bgp instance the default bgp instance tcpmss value is used if neither the bgp peer group or the neighbor has a configured tcpmss if the configured or inherited tcpmss value is higher than the bgp path mtu value the tcpmss value is ignored and the bgp path mtu value is used as the operational tcp mss 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 44 routing protocols guide release 247 bgp example configuring bgp instance tcpmss the following example configures the bgp instance tcpmss value info from state networkinstance default protocols bgp trans port tcpmss networkinstance default  protocols  bgp  transport  tcpmss 1024     example configuring bgp peer group tcpmss the following example configures the bgp peer group tcpmss info from state networkinstance default protocols bgp group trans port tcpmss networkinstance default  protocols  bgp  group test  transport  tcpmss 1024      example configuring bgp neighbor tcpmss the following example configures the bgp neighbor tcpmss  info from state networkinstance default protocols bgp neighbor 1111 transport tcpmss networkinstance default  protocols  bgp  neighbor 19216801  transport  tcpmss 1012      if the configured or inherited tcpmss value is higher than the operational path mtu value the tcp mss value is ignored and the path mtu value is used as the operational tcp mss 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 45 routing protocols guide release 247 bgp 417 error handling for bgp update messages bgp update messages are used to transfer routing information between bgp peers errors in some bgp update messages are considered critical for example if the network layer reachability information nlri cannot be extracted and parsed from an update message it is a critical error errors in other bgp update messages are considered noncritical for example errors such as incorrect attribute flag settings missing mandatory path attributes incorrect nexthop length or format and so on are noncritical errors in sr linux critical errors in bgp update messages trigger a session reset noncritical errors are handled using the treataswithdraw or attributediscard approaches to error handling this errorhandling behavior for bgp update messages is not configurable in sr linux 418 bgp multipath bgp multipath is the ability to install a bgp route into the fib so that the ecmp algorithm loadbalances traffic across multiple bgp nexthops that come from different multipatheligible ribins for the same prefix or nlri address family in a networkinstance you can enable bgp multipath for an address family and specify the maximum number of bgp ecmp nexthops for bgp routes that have an nlri belonging to the address family 4181 configuring bgp multipath procedure to configure bgp multipath set the allowmultipleas parameter to true when you do this bgp is allowed to build a multipath set using bgp routes with a different neighbor as the most recent as in the aspath when allowmultipleas is set to false the default bgp is only allowed to use nonbest paths for ecmp if they meet the multipath criteria and they have the same neighbor as as the best path the maximumpaths parameter configures the maximum number of bgp ecmp nexthops for bgp routes with an nlri belonging to the specified address family note the following note  when a bgp prefix is covered by a resilienthashprefix entry the maximum number of bgp nexthops used for load balancing is controlled by the networkinstance ip loadbalancing resilienthashprefix ipprefix maxpaths value  when bgp is resolved by an unweighted nonresilienthash igp route the maximum number of paths towards the bgp nexthop is controlled by the igp configuration for example the is is maxecmppaths value  when bgp is resolved by a weighted nonresilienthash igp route the maximum number of paths towards the bgp nexthop is controlled by the igp configuration for example the isis maxecmphashbucketspernexthopgroup value  when bgp is resolved by a static nonresilienthash route the maximum number of paths towards the bgp nexthop is controlled by the static nhg configuration 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 46 routing protocols guide release 247 bgp example enable bgp multipath the following example enables bgp multipath and specifies the maximum number of bgp ecmp nexthops for bgp routes with an nlri belonging to the ipv4unicast address family   candidate shared default    info networkinstance n1 protocols bgp afisafi ipv4unicast networkinstance n1  protocols  bgp  afisafi ipv4unicast  multipath  allowmultipleas true maximumpaths 10      3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 47 routing protocols guide release 247 seamless mpls with bgp labeled unicast bgplu 5 seamless mpls with bgp labeled unicast bgplu seamless multiprotocol label switching mpls is a network architecture that extends mpls networks to integrate access and aggregation networks into a single mpls domain to solve the scaling problems in flat mplsbased deployments seamless mpls transport partitions the core aggregation and access networks into isolated igpldp domains seamless mpls does not define any new protocols or technologies and is based on existing and wellknown ones seamless mpls provides endtoend service independent transport separating the service and transport plane therefore it removes the need for servicespecific configurations in network transport nodes service provisioning is restricted only at the points of the network where it is required note service configuration is not yet supported with bgplu in the current release when bgp is used to distribute a route it can also distribute an mpls label that is mapped to that route the label mapping information is appended to the bgp update message that is used to distribute the route this is described in rfc 3107 carrying label information in bgp4 an routers in a regional area learn the reachability of an routers in other regional areas through bgp labeled routes redistributed by the local abrs rfc 3107 the label stack contains three labels for packets sent in a vpn service between the access nodes  the ans push a service label to the packets sent in the vpn service the service label remains unchanged endtoend between ans the service label is popped by the remote an and is the inner label of the label stack note service configuration is not yet supported with bgplu in the current release  the bgp label is the middle label of the label stack and should be regarded as a transport label the transport label stack is increased to two labels bgp and ldp transport labels the bgp label is pushed by the iler an and is swapped at the bgp next hop which can be one of the two local abrs both abrs are configured with nexthopself the bgp label is also swapped by the remote abr  the iler an pushes an ldp transport label to the packets sent to the remote an to reach the bgp next hop at the local abr the ldp transport label is popped and a new ldp transport label is pushed to reach the bgp next hop remote abr the ldp transport label is swapped in every label switching router lsr and popped by the abr nearest to the remote an that abr pops the ldp transport label swaps the bgp label and pushes an ldp transport label to reach the remote eler an 51 seamless mpls with bgplu configuration the following diagram shows the example topology that is used in this chapter in the regional areas and in the core area isis l2 capability is used 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 48 routing protocols guide release 247 seamless mpls with bgp labeled unicast bgplu figure 1 seamless mpls  igpldp domains to configure seamless mpls see the following sections  initial configuration for seamless mpls  bgp configuration for seamless mpls  configuring bgp on ans toward abrs note example configurations are not provided for all nodes in the domain the provided examples do illustrate the basic configuration required to enable seamless mpls which can be repurposed for other nodes as required 52 initial configuration for seamless mpls the following sections describe the initial configurations required on all nodes to enable seamless mpls  configuring interfaces  configuring isis  configuring mpls label blocks  configuring ldp 521 configuring interfaces procedure configure the required routing interfaces and add them to the networkinstance 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 49 routing protocols guide release 247 seamless mpls with bgp labeled unicast bgplu example configure interfaces abr2 the following example output shows the interface configuration on abr2  on abr2 interface ethernet12  description abr2an1 adminstate enable subinterface 1  adminstate enable ipv4  adminstate enable address 19216812230      interface ethernet11  description abr2p3 adminstate enable subinterface 1  adminstate enable ipv4  adminstate enable address 19216823130      interface system0  adminstate enable subinterface 0  adminstate enable ipv4  adminstate enable address 19202232      example add interfaces to the network instance  on abr2 networkinstance default  interface abr2p3  interfaceref  interface ethernet11 subinterface 1   interface abr2an1  interfaceref  interface ethernet12 subinterface 1   interface system00   3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 50 routing protocols guide release 247 seamless mpls with bgp labeled unicast bgplu 522 configuring isis procedure configure isis on each of the nodes the core area and regional areas run isolated isis instances abrs run two isis instances instance 0 belongs to the core and instance 1 belongs to the access network example configure isis on the core instance on the core instance all abrs and ps require level 2 l2 capability as shown in the following example  on abr2 networkinstance default  protocols  isis  instance isis0  adminstate enable instanceid 0 levelcapability l2 iidtlv true net  49000000000000000200  ipv4unicast  adminstate enable  interface ethernet111  circuittype pointtopoint ipv4unicast  adminstate enable  level 2    interface system00  adminstate enable passive true ipv4unicast  adminstate enable  level 2     example configure isis on the access instance on the access instance all abrs and ans also require l2 capability as shown in the following example  on abr2 networkinstance default  protocols  isis  instance isis1  adminstate enable instanceid 1 levelcapability l2 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 51 routing protocols guide release 247 seamless mpls with bgp labeled unicast bgplu iidtlv true net  49000100000000000200  interface ethernet121  circuittype pointtopoint ipv4unicast  adminstate enable  level 2    interface system00  adminstate enable passive true ipv4unicast  adminstate enable  level 2        523 configuring mpls label blocks procedure configure label blocks for ldp and for bgplu labels example configure label blocks for ldp and bgplu   candidate shared default    info system mpls labelranges system  mpls  labelranges  dynamic d1  startlabel 200 endlabel 299  dynamic bgplublock  startlabel 12001 endlabel 13000     524 configuring ldp procedure enable link ldp on all router interfaces on all nodes 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 52 routing protocols guide release 247 seamless mpls with bgp labeled unicast bgplu example configure link ldp abr2  on abr2 networkinstance default  protocols  ldp  adminstate enable dynamiclabelblock d1 discovery  interfaces  interface ethernet111  ipv4  adminstate enable   interface ethernet121  ipv4  adminstate enable        53 bgp configuration for seamless mpls bgp is configured on all abrs and all ans p3 acts as a core route reflector rr to allow for separation of coreaccess igp domains the abrs become rrs inline and implement nexthopself on labeled ipv4 bgp prefixes the following diagram shows the exchange of ibgp labeled unicast lu routes figure 2 seamless mpls  bgplu the following sections describe the bgp configurations required on all nodes to enable seamless mpls  configuring bgp on abrs  configuring bgp on the core rr  configuring bgp on ans toward abrs 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 53 routing protocols guide release 247 seamless mpls with bgp labeled unicast bgplu 531 configuring bgp on abrs procedure configure two bgp groups on the abrs one group toward the core rr and another group toward the an enable advertiseinactive on the bgp group toward the core the 32 system ip addresses learned in labeled bgp are also learned in isis because isis has a lower preference compared to ibgp the isis routes are installed in the routing table bgp default behavior only advertises those prefixes that were elected by rtm and used note while the bgp examples show ipv4labeledunicast configurations ipv6labeledunicast is also supported example configure bgp core on abrs  on abr2 networkinstance default protocols  bgp  adminstate enable autonomoussystem 64496 routerid 192022 bestpathselection  advertiseinactive true  bgplabel  labeledunicast  dynamiclabelblock bgplublock   afisafi ipv4labeledunicast  adminstate enable ipv4labeledunicast  nexthopresolution  ipv4nexthops  routeresolution  ignoredefaultroutes true  tunnelresolution  allowedtunneltypes  ldp       group an  adminstate enable peeras 64496  group core  adminstate enable peeras 64496 routereflector  clusterid 10222 client true   3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 54 routing protocols guide release 247 seamless mpls with bgp labeled unicast bgplu neighbor 192021  description an1 nexthopself true peergroup an  neighbor 192023  description corerrp3 nexthopself true peergroup core   note  to enable ecmp set afisafi ipv4labeledunicast  ipv6labeledunicast multipath maxpathlevel1 to a value greater than 1 the value of maxpathlevel1 sets the maximum number of ecmp forwarding paths including the best path for a bgp prefix the additional nonbestpath labeled ribins are added to the ecmp nhg  under tunnelresolution allowedtunneltypes you can specify srisis to enable the use of srisis tunnels for nexthop resolution of bgplu traffic as an alternative to ldp if srisis is configured in your domain 532 configuring bgp on the core rr example configure bgp on the core rr  on p3 networkinstance default protocols  bgp  adminstate enable autonomoussystem 64496 routerid 192023 bestpathselection  advertiseinactive true  bgplabel  labeledunicast  dynamiclabelblock bgplublock   afisafi ipv4labeledunicast  adminstate enable ipv4labeledunicast  nexthopresolution  ipv4nexthops  tunnelresolution  allowedtunneltypes  ldp       group core  adminstate enable peeras 64496 afisafi ipv4labeledunicast  3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 55 routing protocols guide release 247 seamless mpls with bgp labeled unicast bgplu adminstate enable  routereflector  clusterid 10333   neighbor 192022  description abr2 peergroup core routereflector  clusterid 10333 client true   neighbor 192024  description abr4 peergroup core routereflector  clusterid 10333 client true    533 configuring bgp on ans toward abrs example configure bgp on an1 toward abr configuring afisafi ipv4labeledunicast indicates that all advertised ipv4 prefixes are sent to the remote bgp peer as an rfc 3107 formatted label the nexthopself command only applies to labeled ipv4 prefixes  on an1 networkinstance default protocols  bgp  adminstate enable autonomoussystem 64496 routerid 192021 bestpathselection  advertiseinactive true  bgplabel  labeledunicast  dynamiclabelblock bgplublock   afisafi ipv4labeledunicast  adminstate enable ipv4labeledunicast  nexthopresolution  ipv4nexthops  routeresolution  ignoredefaultroutes true  tunnelresolution  allowedtunneltypes  ldp    3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 56 routing protocols guide release 247 seamless mpls with bgp labeled unicast bgplu    group abrs  adminstate enable peeras 64496 afisafi ipv4labeledunicast  adminstate enable   neighbor 192022  description abr2 peergroup abrs   you can show the bgp sessions with the show networkinstance default protocols bgp neighbor command 54 export policy configuration for seamless mpls a policy is required on the ans to advertise the system ip address in labeled bgp toward the abrs the same policy is required on the abrs to advertise their system ip address in labeled bgp toward the core and the an 541 configuring export policies on ans and abrs example configure a policy on ans and abrs  on an1 and abr2 routingpolicy  prefixset localloopback  prefix 19202132 masklengthrange exact    policy exportsystem  statement 10  match  prefixset localloopback protocol local  action  policyresult accept     example apply the policy on an1 you can apply the export policy to bgp in one of the following bgp contexts  protocols bgp  protocols bgp neighbor  protocols bgp group 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 57 routing protocols guide release 247 seamless mpls with bgp labeled unicast bgplu or to apply the policy to bgplu only use one of the following contexts  protocols bgp afisafi ipv4labeledunicast  protocols bgp neighbor afisafi ipv4labeledunicast  protocols bgp group afisafi ipv4labeledunicast in this example the export policy is applied to bgplu in the group abrs on an1 as follows  on an1 networkinstance default  protocols  bgp  group abrs  afisafi ipv4labeledunicast  exportpolicy exportsystem      example apply the policy on abr2 the same export policy is applied in the group core on abr2 as follows  on abr2 networkinstance default  protocols  bgp  group core  afisafi ipv4labeledunicast  exportpolicy exportsystem      a similar export policy is required to export prefix 192025 from an5 to abr4 and from abr4 to the rr in the core network p3 use the show networkinstance default routetable command to display the route table the prefix of the remote an should be added to the routing table in an1 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 58 routing protocols guide release 247 segment routing with bgplu prefix sid 6 segment routing with bgplu prefix sid segment routing sr allows a router to source route a packet by prepending an sr header containing an ordered list of sids a sid can have a local impact to one particular node or it can have a global impact within the sr domain with srmpls each sid is an mpls label and the complete sid list is a stack of labels in the mpls header traditionally the association of the sid with an ip prefix is propagated by an igp routing protocol however in some cases the sid must be propagated beyond the igp protocol boundaries for these cases you can enable the prefix sid path attribute for bgplu to associate an srmpls sid with an ip prefix in a labeled unicast route the prefix sid attribute associates a prefix with the advertised sid representing networkwide instructions to forward packets along the bgp ecmpaware best path back to the prefix to advertise the prefix sid attribute in bgplu sr linux derives the advertised label from the igpsignaled label index which has the effect of stitching the bgp segment routing tunnel to the igp segment routing tunnel as a result the segment routingenabled routers can establish an lsp with a consistent label value endtoend across igp domains the prefix sid attribute is an optional transitive bgp path attribute with type code 40 this attribute encodes a 32bit label index into the srgb space and can provide details about the srgb space of the originating router the encoding of this bgp path attribute and its semantics are further described in draft ietfidrbgpprefixsid sr linux attaches a meaning to a prefix sid attribute only when it is attached to routes belonging to the labeled unicast ipv4 and labeled unicast ipv6 address families when attached to routes of unsupported address families the prefix sid attribute is ignored but still propagated as with any other optional transitive attribute label assignment and conflicts a unique label index value is assigned to each unique ipv4 or ipv6 prefix that is advertised with a bgp prefix sid if label index n1 is assigned to a bgpadvertised prefix p1 and n1 plus the srgb start label creates a label value that conflicts with another sr programmed entry in the label forwarding information base lfib the conflict situation is addressed according to the following rules   if the conflict is with another bgp route for prefix p2 that was advertised with a prefix sid attribute all the conflicting bgp routes for p1 and p2 are advertised with a normal bgplu label from the dynamic label range if the conflict is with an igp route and bgp is attempting to redistribute that igp route as a labelipv4 or labelipv6 route with a route table import policy action that includes the bgp labelallocation prefix sid reuseigp true option this is not considered a conflict and bgp uses the igpsignaled label index to derive its advertised label this has the effect of stitching the bgp segment routing tunnel to the igp segment routing tunnel any 32 labelipv4 or 128 labelipv6 bgp routes containing a prefix sid attribute are resolvable and used in the same way as 32 labelipv4 or 128 labelipv6 routes without a prefix sid attribute these routes are installed in the route table and tunnel table these routes can have ecmp next hops and can be used as bgplu transport tunnels 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 59 routing protocols guide release 247 segment routing with bgplu prefix sid note receiving a 32 labelipv4 or 128 labelipv6 route with a prefix sid attribute does not create a tunnel in the segmentrouting database it only creates a label swap entry when the route is readvertised with a new next hop 61 segment routing with bgplu prefix sid topology example the following figure shows the example topology referenced in the subsequent procedure which builds on the bgplu configurations shown in seamless mpls with bgplu configuration the bgplu routers along the shortest path advertise consistent labels for prefix 1000132 on an1 and for prefix 1000532 on an5 providing consistent label usage endtoend across the multiple isis domains note unlike the seamless mpls example the following configurations assume that srisis is used in the igp domain and not ldp figure 3 segment routing with bgplu prefix sid topology  srisisibgplu domains in this example all nodes at minimum have protocols bgp segmentroutingmpls enabled and are configured with an srmpls srgb of 1600016999 the nodes operate as follows  an1 advertises its loopback address 1000132 to its neighbor abr2 using a statically configured prefix sid label 16101 in srisis note on an1 bgplu is not advertising the an1 prefix sid to abr2 instead this advertisement is handled by srisis 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 60 routing protocols guide release 247 segment routing with bgplu prefix sid  abr2 uses a route table import policy to import the an1 prefix sid into its bgp rib and an export routing policy to export the an1 prefix sid to its neighbors the route table import policy includes the bgp labelallocation prefixsid reuseigp action with this option enabled abr2 derives a bgplu label for the an1 prefix sid by reusing both the srmpls srgb and the srisis label index for an1 as a result bgplu advertises the same prefix sid label 16101 toward p3 as it received from an1 these policies result in stitching the bgplu path from p3 to abr2 to the srisis tunnel abr2 to an1  to propagate prefix label 16101 from abr2 to abr4 p3 uses only bgplu advertising routes to its ibgp neighbors on p3 srisis carries no prefix sid for an1 as a result no import or export policy is required on p3  abr4 also uses bgplu to advertise the an1 prefix sid label 16101 to an5  after the an1 prefix sid is propagated endtoend when an5 wants to reach an1 it can simply apply label 16101 to the packets  the basic steps outlined above also apply for an5 advertising its loopback address 1000532 and prefix sid label 16105 in the opposite direction toward an1 the result being that when an1 wants to reach an5 it can apply label 16105 to the packets 62 configuring segment routing with bgplu prefix sid prerequisites  configure srmpls in your network  configure bgplu about this task to configure bgplu with prefix sid for segment routing perform the following steps procedure step 1 on the access abr and p nodes enable segment routing for bgp step 2 on the access nodes associate a static segment routing local prefix sid label with the loopback interface note no dedicated label block for bgplu prefix sid labels is required step 3 on the abr nodes configure a route table import policy to import the prefix sids with the reuse igp true option and apply the route table import policy to the bgp rib note when reusing the label index from the igp bgplu prefix sid label values are drawn from the srgb defined as part of the srmpls configuration and not from the label block defined in the bgplu configuration step 4 on the abr nodes configure an export routing policy to export prefix sids from the bgp rib and apply the export policy to the applicable bgp peer groups or neighbors step 5 as required block propagation of prefix sids outside of the segment routing domain where they apply 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 61 routing protocols guide release 247 segment routing with bgplu prefix sid example segment routing with bgplu prefix sid configurations the example configurations that follow apply for an1 and abr2 to advertise a prefix sid for 1000132 similar configurations not shown are required for an5 and abr4 to advertise a prefix sid for 1000532 example enable segment routing for bgp on all nodes the following example enables segment routing using the bgp segmentroutingmpls command  candidate shared default   allnodes info networkinstance default protocols bgp networkinstance default  protocols  bgp  segmentroutingmpls  adminstate enable     example associate local prefix sid label with the loopback interface on the access node an1 shown the following example associates local prefix sid label 101 with the loopback interface lo00 on an1  candidate shared default   an1 info interface lo0 interface lo0  adminstate enable subinterface 0  ipv4  address 1000132       candidate shared default   an1 info networkinstance default interface lo00 networkinstance default  interface lo00  interfaceref  interface lo0 subinterface 0     candidate shared default   an1 info networkinstance default segmentrouting networkinstance default  segmentrouting  mpls  localprefixsid 1  interface lo00 ipv4labelindex 101     3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 62 routing protocols guide release 247 segment routing with bgplu prefix sid example configure the abr route table import policy abr2 shown the following example defines a route table import policy for importing prefix 1000132 into the bgp rib on abr2 using the routingpolicy command it also sets the bgp labelallocation prefixsid reuseigp action which directs bgplu to use the igpsignaled labelindex to derive its advertised label this has the effect of stitching the bgp segment routing tunnel to the igp segment routing tunnel the example also applies the route table import policy to the bgp rib on abr2 using the bgp rib management command to populate the local bgplu table with the segment routing label for prefix 1000132  candidate shared default   abr2 info routingpolicy routingpolicy  policy importprefixsid2  statement 10  match  prefixset 1000132  action  policyresult accept bgp  labelallocation  prefixsid  reuseigp true         candidate shared default   abr2 info networkinstance default protocols bgp ribmanagement networkinstance default  protocols  bgp  ribmanagement  table ipv4labeledunicast  routetableimport importprefixsid2      example configure the export routing policy for the abrs abr2 shown the following example defines a policy for abr2 to export prefix 1000132 to bgp neighbors using the routingpolicy command it applies the policy on abr2 using the bgp neighbor command it also configures bgp group ibgp with bgplu enabled and applies the group to the peer the policy advertises the segment routing label for prefix 1000132 from the abr2 bgplu table to neighbor p3 192023  candidate shared default   abr2 info routingpolicy routingpolicy  policy exportprefixsid1  statement 10  3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 63 routing protocols guide release 247 segment routing with bgplu prefix sid match  prefixset 1000132  action  policyresult accept      candidate shared default   abr2 info networkinstance default protocols bgp networkinstance default  protocols  bgp  group ibgp  afisafi ipv4labeledunicast  adminstate enable   neighbor 192023  peeras 64496 peergroup abrs exportpolicy  exportprefixsid1      example block propagation of prefix sids by default the prefix sid attribute propagates without restriction to prevent the prefix sid from propagating outside the segment routing domain where it is applicable use the networkinstance protocols bgp group  neighbor optionalattributes blockprefixsid command the command removes the prefix sid attribute from all routes sent to and received from the ibgp and ebgp peers included in the scope of the command the following example blocks the propagation of prefix sids to and from bgp neighbor 1920210 not shown in the topology diagram   candidate shared default   anynode info networkinstance default protocols bgp neighbor 1920210 networkinstance default  protocols  bgp  neighbor 1920210  optionalattributes  blockprefixsid true      example diplay the prefix sid path attribute to display the path attributes of the advertised bgplu routes including the prefixsid attribute use the info from state bgprib attrsets attrset command the following example shows the bgp 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 64 routing protocols guide release 247 segment routing with bgplu prefix sid lu path attributes advertised from abr2 to p3 in this example the info from state command is entered from the networkinstance context  candidate shared default  networkinstance default  p3 info from state bgprib attrsets attrset attrid origin igp atomicaggregate false nexthop 192022 med 0 localpref 100 prefixsid  tlv labelindex  labelindex  labelindex 101   tlv srgboriginator  srgboriginator  srgb  160001000     3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 65 routing protocols guide release 247 isis 7 isis intermediate system to intermediate system isis is a linkstate igp that uses the shortest path first spf algorithm to determine routes routing decisions are made using the linkstate information isis evaluates topology changes and if necessary performs spf recalculations entities within isis include networks intermediate systems and end systems in isis a network is an autonomous system as or routing domain with end systems and intermediate systems a router is an intermediate system that sends receives and forwards protocol data units pdus end systems are network devices that send and receive pdus end system and intermediate system protocols allow routers and nodes to identify each other isis sends out linkstate updates periodically throughout the network so each router can maintain current network topology information isis supports large ass by using a twolevel hierarchy a large as can be administratively divided into smaller more manageable areas a system logically belongs to one area level 1 routing is performed within an area level 2 routing is performed between areas you can configure routers as level 1 level 2 or both level 1 and 2 the following summarizes sr linux support for isis  level 1 level 2 and level 12 is types  configurable network entity title net per isis instance  support for ipv4v6 routing  ecmp with up to 64 next hops per destination  isis export policies redistribution of other types of routes into isis  authentication of lsp csnp psnp and hello pdus using an authentication key or keychain specified as follows  per instance or per level for all pdu types  per interface or per interface and level for hello pdus  authentication keychains with a single key per named keychain  purge originator id tlv rfc 6232  options to ignore and suppress the attached bit  ability to set the overload bit immediately or after each subsequent restart of the isis manager application and leave it on for a configurable duration each time   control over the linkstate pdu lsp mtu size with range from 490 bytes to 9490 bytes configuration control over timers for lsp lifetime lsp refresh interval spf calculation triggers and lsp generation  hello padding strict loose and adaptive modes  graceful restart acting in restarting router mode and helper router mode  level 1 to level 2 route summary  bfd for fast failure detection 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 66 routing protocols guide release 247 isis  configurable hello timer with multiple per interface and level  wide metrics configurable per level  configurable route preference for each route type level 1internal level 1external level 2internal and level 2external  detailed statistics for interfaces adjacencies and levels  multiinstance isis miisis which allows multiple instances of isis to operate on a single circuit  multitopology mtid 0 and mtid 2 support with mtid2 reserved for ipv6 network topology  multitopology intermediate system to intermediate system mtisis mt0 and mt2 support the info detail command displays default values for an isis instance on sr linux as shown in the following example   candidate shared default  networkinstance default protocols isis   info detail instance i1  adminstate disable levelcapability l2 maxecmppaths 1 poitlv false attachedbit  ignore false suppress false  overload  advertiseinterlevel false advertiseexternal false immediate  setbit false maxmetric false  onboot  setbit false maxmetric false   timers  lsplifetime 1200 lsprefresh  interval 600 halflifetime true  spf  initialwait 1000 secondwait 1000 maxwait 10000  lspgeneration  initialwait 1000 secondwait 1000 maxwait 5000   transport  lspmtusize 1492  ipv4unicast  adminstate enable  ipv6unicast  3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 67 routing protocols guide release 247 isis adminstate enable multitopology false  gracefulrestart  helpermode false  autocost   authentication  csnpauthentication false psnpauthentication false helloauthentication false  interlevelpropagationpolicies  level1tolevel2     71 basic isis configuration to configure isis perform the following tasks  enable an isis instance  if necessary modify the level capability on the global isis instance level  define area addresses  configure isis interfaces 711 enabling an isis instance procedure on sr linux you can enable an isis instance within a networkinstance the following example enables an isis instance within the default networkinstance example   candidate shared default    info networkinstance default protocols isis networkinstance default  protocols  isis  instance i1      3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 68 routing protocols guide release 247 isis 712 configuring the router level procedure you can configure routers as level 1 level 2 or both level 1 and 2 when isis is enabled the default levelcapability value is level 2 this means that the router operates with level 2 routing capabilities to change the default value in order for the router to operate as a level 1 router or a level 12 router you must explicitly modify the level value the levelcapability value can be configured on the global isis instance level and also on the interface level the levelcapability value determines which level values can be assigned on the router level or on an interfacebasis in order for the router to operate as a level 1 only router or as a level 2 only router you must explicitly specify the levelnumber value  specify level 1 to route only within an area  specify level 2 to route to destinations outside an area toward other eligible level 2 routers example the following example configures the level capability for an isis instance to level 2   candidate shared default  networkinstance default protocols   info isis isis  instance i1  levelcapability l2   713 configuring the network entity title procedure on sr linux you can configure the network entity title net per isis instance the net is 820 octets long and consists of 3 parts the area address 113 octets the system id 6 octets and the nselector 1 octet must be 00 the area address portion of the net defines the isis area to which the router belongs at least one area address should be configured on each router participating in isis the area address portion of the net identifies a point of connection to the network such as a router interface the routers in an area manage routing tables about destinations within the area the net value is used to identify the isis area to which the router belongs the net value is divided into three parts only the area id portion is configurable 1 area id  a variable length field between 1 and 13 bytes this includes the authority and format identifier afi as the most significant byte and the area id 2 system id  a 6byte system identifier this value is not configurable the system id is derived from the system or router id 3 selector id  a 1byte selector identifier that must contain zeros when configuring a net this value is not configurable the selector id is always 00 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 69 routing protocols guide release 247 isis example the following example configures a net for an isis instance   candidate shared default  networkinstance default protocols   info isis isis  instance i1  net 49000119216800100200    714 configuring global parameters procedure you can configure the commands and parameters on the global isis instance level commands and parameters configured on the global isis instance level are inherited by the interface levels parameters specified in the interface and interfacelevel configurations take precedence over global configurations example the following example shows the command usage to configure globallevel isis the lsp pdu authentication setting references a keychain defined at the system level see protocol authentication   candidate shared default  networkinstance default protocols   info isis isis  instance i1  levelcapability l2 overload  onboot  timeout 90   authentication  lspauthentication  generate true checkreceived strict keychain isisglobal     715 configuring interface parameters procedure there are no interfaces associated with isis by default an interface belongs to all areas configured on a router interfaces cannot belong to separate areas there are no default interfaces applied to the router is is instance you must configure at least one isis interface in order for isis to work 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 70 routing protocols guide release 247 isis you can configure both the level 1 parameters and the level 2 parameters on an interface the level capability value determines which level values are used example the following example configures interface parameters for an isis instance   candidate shared default  networkinstance default protocols isis   info instance i1 instance i1  interface ethernet121  circuittype pointtopoint ipv4unicast  adminstate enable  level 1  authentication  helloauthentication  generate true checkreceived strict keychain hello     level 1    716 configuring authentication keys procedure isis supports authentication for pdus using shared keys which are changed at regular intervals using keys configured in a keychain this authentication mechanism is described in protocol authentication in addition to using shared keys authentication for isis hello csnp psnp and lsp pdus can be done using directly configured keys you can specify the key used for authenticating isis pdus associated with a specific isis instance received or transmitted on a specific interface and associated with a specific level if a hello pdu is received or transmitted on a specific interface it is authenticated using the key configured for that interface if no key exists for the interface the key configured for the instance is used for csnp psnp and lsp pdus authentication is performed using the key configured for the level if no key exists for the level the key configured for the instance is used to configure a key you specify the secret key authpassword and cryptographic algorithm to be used for generating the key example the following example configures keys for an isis instance interface and level  candidate shared default    info networkinstance default protocols isis networkinstance default  protocols  isis  instance i1  3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 71 routing protocols guide release 247 isis authentication  key  cryptoalgorithm cleartext authpassword aes9g3xrtckzzmgin9wuovkpstw6ehdx5ylga   interface ethernet111  authentication  key  cryptoalgorithm hmacmd5 authpassword aes97mfua4swx6ipff02mtu0guxh5lwtltqq    level 1  authentication  key  cryptoalgorithm hmacsha256 authpassword aes9yhcltkxalgw7hxuqhhr4wpxwifkgekfaq        72 isis graceful restart isis graceful restart is a mechanism to prevent routing protocol reconvergence during a control plane switchover reset or upgrade without graceful restart when an isis router restarts its isis neighbors detect that the router has gone down and remove routes that pass through that neighbor resulting in data loss even if the restarting router is able to maintain its forwarding table state configuring graceful restart can prevent this data loss to do this the restarting router relies on neighbor routers which have also been configured for graceful restart to maintain forwarding state while the router restarts these neighbor routers are known as helper routers for isis graceful restart sr linux can operate in the following modes  restarting router mode when its own isis manager application isismgr restarts or the application is killed  helper router mode when it detects that an adjacent isis router has restarted restarting router mode when the router is configured to operate in restarting router node if the sr linux isis manager application restarts or is killed routes that are published by the isis manager associated with any is is instance and used for programming the fib remain programmed for a duration of time sufficient to allow a warm restart of the isis manager application the system starts sending periodic isis hello iih pdus with the restart request rr flag set on all isis interfaces so that neighbors do not time out their adjacencies the helper router on each interface responds with an iih pdu containing a restart acknowledgement ra the exchange of iih pdus on each interface causes adjacencies to reform after each adjacency 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 72 routing protocols guide release 247 isis comes up the helper router on the associated interface transmits a complete set of csnps to the restarting router helper router mode when the router is configured to operate in helper router node sr linux advertises tlv 211 in iih pdus sent on all isis interfaces which indicates that the isis instance is able to help any adjacent neighbor that signals a restart when the router receives an iih pdu with the rr flag set from an adjacent neighbor the router maintains its adjacency with the neighbor responds with an iih pdu with the ra flag set and sends a complete set of csnp pdus to the restarting router 721 configuring isis graceful restart procedure you can configure sr linux to operate as a restarting router informing adjacent routers when the is is manager application restarts or is killed and as a helper router indicating to adjacent routers that it can help those signaling a restart by default both restarting router mode and helper router mode are disabled example configure restarting router mode to configure the router to operate in restarting router mode for isis graceful restart enable non stopforwarding for isis for example  candidate shared default    info networkinstance green protocols isis networkinstance default  protocols  isis  nonstopforwarding  adminstate enable     example configure helper router mode the following example enables the router to operate in helper router mode  candidate shared default    info networkinstance green protocols isis instance i1 gracefulrestart networkinstance default  protocols  isis  instance i1  gracefulrestart  helpermode true acceptableduration 120      3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 73 routing protocols guide release 247 isis the acceptableduration parameter sets the amount of time in seconds that sr linux advertises as the remaining time in the restart tlv with the ra flag set when this router starts to help another router that has entered restart mode by default this is 60 seconds 73 displaying isis information procedure use the commands shown in this section to display the following information for an isis instance running in a specified network instance  interface information  adjacency information  isis link state database information example isis summary information to display summary information for an isis instance  show networkinstance greendefault protocols isis summary  network instance greendefault isis instance default is enable and up level capability  l1l2 export policy  none  systemid  005005005005 net   49000100500500500500  areaid   490001   ipv4 routing is enable ipv6 routing is enable using none max ecmp path  1  ldp synchronization is disabled  overload current status  not in overload  metric reference bandwidth na l1 metric style wide l2 metric style wide  graceful restart helper mode  disabled current status  not helping any neighbors  timers lsp lifetime  1200 lsp refresh  600 spf initial wait  1000 spf second wait  1000 spf max wait  10000 lsp generation initial wait  10 lsp generation second wait  1000 lsp generation max wait  5000  route preference l1 internal  15 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 74 routing protocols guide release 247 isis l1 external  160 l2 internal  18 l2 external  165  l1l2 summary addresses not configured  instance statistics spf run  29 last spf  20220323t161616200z partial spf run  16 last partial spf  20220323t161617200z  pdu statistics   pduname  received  processed  dropped  sent    lsp  460  457  3  528   iih  308  281  27  497   csnp  52  51  1  116   psnp  30  30  0  3   example isis interface information to display interface information for an isis instance  show networkinstance greendefault protocols isis interface  network instance  greendefault instance  default   interface name  oper state  level  circuit id  circuit type  ipv4 metric l1l2  ipv6 metric l1l2   ethernet111  up  l1l2  2  pointtopoint  1010  1010  ethernet121  up  l1l2  2  broadcast  1010  1010  ethernet131  up  l1l2  3  broadcast  1010  1010  ethernet116  up  l1l2  4  broadcast  1010  1010  1        lo01  up  l1l2  5  broadcast  00  00  example isis interface detail information to display detail information for a specific isis interface  show networkinstance greendefault protocols isis interface ethernet111 detail  network instance  greendefault instance  default  interfacename  ethernet111 status  isis is admin enabled oper up circuit  id 1 is broadcast and not passive hello authentication generate  true hello authentication check received  strict hello padding  disable csnp interval  10 lsp pacing  100 ldp sync state  disabled ldp sync duration  3274  level  1 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 75 routing protocols guide release 247 isis status  enabled adjacencies  1 hello authentication generate  true hello authentication check received  strict priority  64 hello interval  9 hello multiplier  3 ipv4 metric  10 ipv6 metric  10  level  2 status  enabled adjacencies  1 hello authentication generate  true hello authentication check received  strict priority  64 hello interval  9 hello multiplier  3 ipv4 metric  10 ipv6 metric  10  example isis adjacency information to display isis adjacency information  show networkinstance default protocols isis adjacency  networkinstance  default isis instance  global  systemid adjlevel interface ipv4address state uptime remhold hostname1 l1 ethernet110 10001 up 0d 004643 19s hostname1 l2 ethernet110 10001 up 0d 004643 19s  adjacencies 2  example isis link state database information to display information for the isis link state database  show networkinstance greendefault protocols isis database  networkinstance  greendefault isis instance  default   level number  lsp id  sequence  checksum  lifetime  attributes    1  0010010010010000  0x33  0x1672  1167  l1 l2   1  0020020020020000  0x35  0xd562  1014  l1 l2   1  0030030030030000  0x38  0xf447  640  l1 l2   1  0030030030030100  0x2f  0x4db6  1005  l1 l2   1  0030030030030200  0x2e  0xd355  709  l1 l2   1  0040040040040000  0x39  0x6f2a  638  l1 l2   1  0040040040040100  0x2f  0xf0ef  822  l1 l2   1  0040040040040200  0x2f  0xa5f8  999  l1 l2   1  0050050050050000  0x38  0xfbbb  905  l1 l2   1  0050050050050100  0x31  0x3937  745  l1 l2   1  0050050050050200  0x2f  0xd19  657  l1 l2   1  0060060060060000  0x37  0xf287  967  l1 l2   1  0060060060060100  0x2f  0xadfb  753  l1 l2   1  0060060060060200  0x2f  0x5f95  819  l1 l2  3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 76 routing protocols guide release 247 isis  1  0070070070070000  0x33  0x48dd  1058  l1 l2   1  0070070070070100  0x2f  0xadb2  1164  l1 l2   1  0070070070070200  0x2e  0xdf8e  852  l1 l2   2  0010010010010000  0x3e  0xb92f  1150  l1 l2   2  0010010010010001  0x3c  0x1875  818  l1 l2   2  0020020020020000  0x41  0x540f  1177  l1 l2   2  0020020020020001  0x3f  0x2db9  699  l1 l2   2  0030030030030000  0x3c  0x302f  1058  l1 l2   2  0030030030030001  0x3f  0x5150  668  l1 l2   2  0030030030030100  0x30  0xb518  915  l1 l2   2  0030030030030200  0x2f  0xe113  1035  l1 l2   2  0040040040040000  0x3e  0xa17b  657  l1 l2   2  0040040040040001  0x3e  0x260b  1018  l1 l2   2  0040040040040100  0x30  0x1511  1066  l1 l2   2  0040040040040200  0x2f  0x27a7  1035  l1 l2   2  0050050050050000  0x41  0x59d6  608  l1 l2   2  0050050050050001  0x44  0xf165  1110  l1 l2   2  0050050050050100  0x33  0x7709  584  l1 l2   2  0050050050050200  0x31  0xa74  657  l1 l2   2  0060060060060000  0x3d  0xd5ed  903  l1 l2   2  0060060060060001  0x44  0xdc97  666  l1 l2   2  0060060060060100  0x30  0x9024  1145  l1 l2   2  0060060060060200  0x30  0xbc66  1020  l1 l2   2  0070070070070000  0x3a  0x81fd  862  l1 l2   2  0070070070070001  0x3e  0xf82a  765  l1 l2   2  0070070070070100  0x30  0xbad5  658  l1 l2   2  0070070070070200  0x2f  0x1ecb  675  l1 l2   lsp count 41  to display information for a specific isis link state database  show networkinstance greendefault protocols isis database 1  networkinstance  greendefault isis instance  default   level number  lsp id  sequence  checksum  lifetime  attributes    1  0010010010010000  0x33  0x1672  1048  l1 l2   1  0020020020020000  0x35  0xd562  894  l1 l2   1  0030030030030000  0x39  0x7762  1179  l1 l2   1  0030030030030100  0x2f  0x4db6  886  l1 l2   1  0030030030030200  0x2f  0x4ace  1188  l1 l2   1  0040040040040000  0x3a  0xcd9f  1135  l1 l2   1  0040040040040100  0x2f  0xf0ef  703  l1 l2   1  0040040040040200  0x2f  0xa5f8  879  l1 l2   1  0050050050050000  0x38  0xfbbb  785  l1 l2   1  0050050050050100  0x31  0x3937  625  l1 l2   1  0050050050050200  0x30  0xb86e  1148  l1 l2   1  0060060060060000  0x37  0xf287  847  l1 l2   1  0060060060060100  0x2f  0xadfb  633  l1 l2   1  0060060060060200  0x2f  0x5f95  700  l1 l2   1  0070070070070000  0x33  0x48dd  938  l1 l2   1  0070070070070100  0x2f  0xadb2  1044  l1 l2   1  0070070070070200  0x2e  0xdf8e  733  l1 l2   lsp count 17  3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 77 routing protocols guide release 247 isis 74 clearing isis information procedure to clear information for an isis instance use the tools commands below example clear statistics to clear statistics for an isis instance running in a specified network instance  tools networkinstance default protocols isis instance i1 statistics clear example clear link state database information to clear link state database information for a level  tools networkinstance default protocols isis instance i1 linkstatedatabase clear example clear isis adjacency information to clear isis adjacency information for an interface  tools networkinstance default protocols isis instance i1 interface ethernet111 adjacencies clear 75 isis weighted ecmp weighted ip ecmp also known as ucmp unequal cost multipath allows the installation of a multipath route in the fib where the ecmp flow hashing distributes traffic by directing flows to each nexthop in a ratio proportional to the weight assigned to each nexthop multipath routes are the routes that have multiple nexthops weighted ecmp wecmp distributes traffic unequally over multiple paths and uses available bandwidth more efficiently for better load balancing for example if you have four equalcost paths to a destination but one path has a lower bandwidth than the other three you can use wecmp to assign more traffic to the higher bandwidth path and less traffic to the lower bandwidth paths the wecmp feature is available on 7250 ixr6106e10e and 7250 ixrx platforms it is supported for both isis ipv4 and ipv6 routes the highlevel steps for configuring wecmp are 1 enabling weighted ecmp 2 configuring weighted loadbalancing over interface nexthops the system normalizes the weights used in weighted ecmp according to the algorithm described in normalizing datapath weights note when a bgp nexthop is resolved by an isis route with weighted ecmp nexthops any traffic using the bgp route and directed to the bgp nexthop in case the bgp route has multiple paths inherits the weighted ecmp loadbalancing of the resolving isis route 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 78 routing protocols guide release 247 isis 751 enabling weighted ecmp procedure you can enable the weighted ecmp per isis instance wecmp can be configured for an isis instance under a default network instance or network instance of type ipvrf  enabling weighted ecmp triggers weighted ecmp programming for all eligible multipath isis routes associated with the instance to program an isis route as a multipath route all the multipaths must have an equal total path cost to the destination the ecmp weights loadbalancingweight are normalized based on the number of hash buckets per nexthop group nhg the sum of all normalized datapath weights must not exceed the hash bucket limit you must configure the maximum number of ecmp hash buckets used for isis weighted ecmp routing on a per isis instance basis if the hash bucket limit is t and the normalized datapath weight of each next hop is ni then the sum of all ni in each mutipath set nhg cannot exceed t the system normalizes the weights used in weighted ecmp according to the algorithm described in normalizing datapath weights the 7250 ixr6106e10e and 7250 ixrx platforms have a 128 hash bucket limit datapath resources can be conserved by configuring a lower value for the bucket size however this reduces the granularity or fine distribution of the traffic with a smaller bucket size there are fewer nexthop options available for load balancing which can limit the flexibility and precision of traffic distribution you cannot reduce the hash bucket limit below the ecmp limit of the isis instance the following example enables weighted ecmp per isis instance example enabling weighted ecmp   candidate shared default    info networkinstance default protocols isis networkinstance mgmt  protocols  isis  instance test  weightedecmp  adminstate enable maxecmphashbucketspernexthopgroup 56      where  adminstate when set to enable triggers weighted ecmp programming for all eligible multipath isis routes associated with the instance the default is disable this ensures backward compatibility with previous releases that only supported ecmp wherein the traffic was distributed in equal proportion  maxecmphashbucketspernexthopgroup specify the maximum number of ecmp hash buckets per nexthopgroup default bucket size is 128 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 79 routing protocols guide release 247 isis note the configured value of maxecmphashbucketspernexthop group must always be greater than or equal to maxecmppaths network instanceprotocolsisisinstancemaxecmppaths example disabling weighted ecmp   candidate shared default    info networkinstance default protocols isis networkinstance mgmt  protocols  isis  instance test  weightedecmp  adminstate disable maxecmphashbucketspernexthopgroup 1      you can disable the weighted ecmp per isis instance when you disable the weighted ecmp in an isis instance all isis routes computed by this instance is programmed in the fib with classic ecmp programming this means no weights are assigned to the nexthops even if some or all of the nexthop interfaces in a multipath set have a nonzero load balancing weight loadbalancing weight configured 752 configuring weighted loadbalancing over interface nexthops procedure when the weighted ecmp feature is enabled the isis route linked to the routing instance can be programmed into the datapath this allows for weighted loadbalancing across the interface nexthops of the route in order for weighted ecmp to be supported across the interface nexthops of an isis route the following conditions must be met  all ecmp nexthops must be interface nexthops  all nexthop interfaces are configured with nonzero loadbalancing weights to configure loadbalancing weight set the parameter loadbalancingweight under network instanceprotocolsisisinstanceinterfacelevelweightedecmp this parameter can be set to a static value or you can choose to use the options auto or none the static value assigned must be between 1 and 4294967295 if all the nexthop interfaces in the multipath set have a loadbalancingweight which is either automatically derived from the portlag bandwidth using the auto option or configured with a static value then the route is programmed in the fib with wecmp if one or more nexthop interfaces have zero weight loadbalancingweight  none then the wecmp loadbalancing falls back to classic ecmp operation and equally distributes the traffic 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 80 routing protocols guide release 247 isis in the nhg for the isis route each nexthop is assigned a nonzero weight in sr linux the wecmp programming capability is available even if some multipath nexthop interfaces are connected to different adjacent routers the following example configures weighted loadbalancing over interface nexthops example configuring weighted loadbalancing over interface nexthops   candidate shared default    info networkinstance default protocols isis networkinstance mgmt  protocols  isis  instance test  interface mgmt00  weightedecmp  loadbalancingweight auto       here the loadbalancingweight value is automatically derived from the portlag bandwidth 753 normalizing datapath weights the ecmp weights loadbalancingweight are normalized based on the number of hash buckets max ecmphashbucketspernexthopgroup defined per nhg the sum of all normalized datapath weights must not exceed the hash bucket limit the datapath programming of the nhg assigns ni hash buckets to each nexthop the value of ni is determined by normalizing it using the following method 1 calculate the greatest common divisor gcd of all datapath weights 2 divide all datapath weights by the gcd 3 if the sum of normalized weights is less than the maximum number of buckets weight determination process is complete or 4 if the sum of normalized weights exceeds the bucket size a assign each nexthop a minimum of one bucket b distribute the remaining buckets maxbuckets  numnexthops to each nexthop based on the ratio of each nexthops weight to the total weight rounded down there may be cases where no extra buckets are assigned 76 multiinstance isis multiinstance isis miisis defined in rfc 8202 allows multiple instances of isis to operate on a single circuit to configure miisis in sr linux you set the instance identifier iid which identifies an is 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 81 routing protocols guide release 247 isis is instance and enable sending of the iidtlv in isis pdus the iidtlv identifies the isis instance and topology miisis uses the following routeselection tiebreak mechanism  when multiple miisis instances contain an identical route the route with the lowest metric is selected as the active route and used for forwarding  when multiple miisis instances have an identical route with identical metric the route from the instance with the lowest iid is selected as the active route and used for forwarding when miisis is used in combination with ecmp then only active rtm routes of the same miisis instance can be loadbalanced ecmp loadbalancing between miisis instances is not supported 761 configuring the iid procedure the iid is a numerical instance identification number 0127 and is used to identify the local isis instance and to populate the iidtlv when miisis is configured in an miisis configuration each isis instance must have a unique name and can only be associated with a single unique iid within a network instance the default isis instance has an iid of 0 example the following example configures an iid for an isis instance   candidate shared default    info networkinstance default protocols isis instance i1 instanceid networkinstance default  protocols  isis  instance i1  instanceid 2     762 enabling the iidtlv procedure to configure miisis you enable sr linux to include the iidtlv for the isis instance in isis pdus the iidtlv includes the configured iid and identifies the instancespecific topology or topologies to which the pdu applies example the following example enables the system to send the iidtlv for an isis instance    candidate shared default    info networkinstance default protocols isis networkinstance default  protocols  isis  instance i1  3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 82 routing protocols guide release 247 isis iidtlv true     if iidtlv is set to false the configured iid has only local relevance interfaces enabled in such isis instances establish adjacencies unaware of any other instances the router originates link state packets without the iidtlv and expects other routers in the area not to advertise any iidtlv either 763 displaying miisis information procedure you can display information about the miisis configuration using show reports or info from state output example display iidtlv information the following example displays the configured iidtlv and any received iidtlvs for an isis instance   candidate shared default    info from state networkinstance default protocols isis instance myinstance2 adminstate enable instanceid 2 levelcapability l2 maxecmppaths 1 poitlv false iidtlv true exportpolicy mypolicy hellopadding disable enablecsnponp2plinks true operstate up opersystemid 000000008521 net  4900000000852100  operareaid  49   snip  level 2  metricstyle wide snip linkstatedatabase  lsp 0000000085210000  maximumareaaddresses 3 snip tlvs  snip tlv instanceid  instanceids  instanceid 2  topologyid  0   3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 83 routing protocols guide release 247 isis   77 multitopology isis mt0 and mt2 sr linux supports multitopology mt routing for isis as defined in rfc 5120 multitopology isis mtisis allows multiple independent ip routing topologies within a single isis domain mtisis support within sr linux enables the creation of separate ipv4 unicast and ipv6 unicast topologies within the isis domain these topologies contribute routes to specific route tables allowing for non congruent topologies between different routing tables as a result networks can control the links or nodes that are used for forwarding different types of traffic for example mtisis can enable all links to carry ipv4 traffic while only a subset of links can also carry ipv6 traffic sr linux supports the following multitopologies  mtid 0 standard ipv4 and ipv6 topology  mtid 2 ipv6only topology ipv4 or ipv6 routing when an isis instance is created ipv4 routing is enabled by default and is restricted to multitopology is is mtisis with topology identifier mt0 this configuration ensures that the isis instance is initially set up to handle ipv4 routing within the default topology mt0 as specified by rfc 5120 unlike mt0 which is the default for ipv4 mt2 is not enabled by default and must be configured to manage ipv6 traffic you must explicitly enable ipv6 routing in an isis instance ipv6 routing can be configured for either the mt0 or mt2 topology with mt0 being the default topology for ipv6 for information about enabling ipv6 routing see configuring an ipv6 routing  and for mt2 topology configuration details see configuring mt2 topology 771 configuring an ipv6 routing procedure use the command networkinstancenameprotocolsisisinstanceinstance nameipv6unicastadminstateenable to enable ipv6 unicast routing for an isis instance example the following example enables ipv6 unicast routing for an isis instance  candidate shared default   info networkinstance default protocols isis instance srlisisinstance networkinstance default  protocols  isis  instance srlisisinstance  ipv6unicast  adminstate enable   3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 84 routing protocols guide release 247 isis    772 configuring mt2 topology procedure to configure the default mt2 topology for an ipv6 routing set the parameter multitopology under the networkinstancenameprotocolsisisinstanceinstancenameipv6unicast context to true example the following config example enables ipv6 routing for an isis instance  candidate shared default   info networkinstance default protocols isis instance srlisisinstance networkinstance default  protocols  isis  instance srlisisinstance  ipv6unicast  adminstate enable multitopology true      78 isis extensions for traffic engineering te isis te extensions allow network operators to encode and flood traffic engineering information throughout a network using teenabled links igps isisospf use only an interface metric to find the shortest path to a destination without considering factors such as bandwidth and link delay for traffic engineering computations link attributes such as available bandwidth maximum reservable bandwidth te metric and link affinity are required the isis te extensions contain the tlvs and subtlvs that specify these link attributes isis linkstate pdus include these tlvs flooding algorithms used by linkstate igps ensure that link attributes are distributed evenly across all routers in the routing domain 781 enabling advertisement of isis te tlvssubtlvs procedure sr linux supports the transmission and reception of traffic engineering terelated tlv and sub tlv fields in isis link state packets lsps to share network resource information the network instancetrafficengineering container enables and configures te functionality for both ipv4 and ipv6 when te is enabled the terelated tlvs and subtlvs are incorporated into the lsps generated by the interior gateway protocol igp 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 85 routing protocols guide release 247 isis to enable advertising of tlvs and subtlvs set the advertisement parameter to true within the networkinstanceprotocolsisisinstancetrafficengineering container by default the te advertisement parameter is set to false example in the following example the isis te tlvs and subtlvs are included in the isis lsp   candidate shared default    info networkinstance default protocols isis instance test trafficengineering advertisement networkinstance default  protocols  isis  instance test  trafficengineering  advertisement true      782 te router id tlv a te router id uniquely identifies a router in an igp te domain the router id must be operationally active within the isis instance and associated with a system or loopback address for the ipv4 and ipv6 address families isis advertises the ipv4 router id using tlv 134 as specified in rfc5305 and the ipv6 router id using tlv 140 as specified rfc6119 for use within an isis area ipv4 te router id tlv the ipv4 traffic engineering te router id tlv type 134 contains the 4octet router id of the router originating the lsp according to rfc5305 the te router id tlv can be advertised by a router regardless of whether ipv4 te is enabled if ipv4 te is disabled the ipv4 te router id tlv is advertised only if the network instancedefaultrouterid parameter is configured regardless of whether the router id is reachable if the networkinstancedefaultrouterid parameter is not configured then ipv4 te router id tlv is not advertised if ipv4 te is enabled the value of the advertised ipv4 te router id tlv is selected based on a specific order of preference which is as follows 1 networkinstancedefaultprotocolisisinstancetrafficengineeringipv4te routerid 2 if not available networkinstancedefaulttrafficengineeringipv4terouterid value is selected 3 if neither is available networkinstancedefaultrouterid value is selected note when ipv4 te is enabled only the ipv4 te router id that is operationally active within the isis instance and associated with a system or loopback address is eligible to be advertised as per the above priority list 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 86 routing protocols guide release 247 isis when ipv4 routing is disabled and ipv6 te is enabled with router capability advertised the ipv4 router id tlv is not advertised however another ipv4routerid tlv set to 0000 is included within the router capability toplevel tlv ensuring compliance with the rfc7981 standard ipv6 te router id tlv the ipv6 router id can be advertised in toplevel tlv 140 defined in rfc6119 or within the router capability subtlv12 as defined in rfc5305 the ipv6 te router id tlv is advertised when all of the following conditions are satisfied  ipv6 and te must be enabled and  a configured routable ipv6 te router interface address must exist and  the advertisement of terelated tlvs and subtlvs must be enabled by setting the advertisement parameter to true within the networkinstancetrafficengineering container if ipv6 or te is disabled the ipv6 te router id tlv 140 is not advertised the value of the advertised ipv6 router id is selected based on a specific order of preference as follows 1 networkinstancedefaultprotocolisisinstancetrafficengineeringipv6te routerid value 2 if not available networkinstancedefaulttrafficengineeringipv6terouterid value is selected 3 if neither is available interfacesubinterfaceipv6address xxxxxx128 is selected note a configured and enabled ipv6 loopback address is selected for advertisement note only the ipv6terouterid that is operationally active within the isis instance and associated with a system or loopback address is eligible for advertisement in accordance with the above priority list rfc 7981 implication to ipv6 router ids rfc 7981 defines isis router capability tlv which allows routers to announce their capabilities within an isis level or across the entire routing domain the isis router capability tlv consists of multiple sub tlvs enabling ipv6 te and advertising router capability results in the advertisement of both the ipv6 router id tlv 140 and the ipv6 router id tlv 12 within the router capability tlv the router capability subtlv12 as defined in rfc 5316 is used when the ipv6 te router id must be distributed to all routers within an entire isis routing domain instead of being restricted to an area scope in sr linux subtlv 12 is advertised only when ipv4 unicast routing is explicitly disabled using the networkinstancedefaultprotocolsisisinstanceipv4unicastadminstate disable command 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 87 routing protocols guide release 247 isis 7821 advertising ipv4 te router id tlv procedure a te router id must be a unique and stable address within the isis domain when ipv4 te is enabled the advertised ipv4 te router id tlv value is selected in a specific order of preference for preference details see ipv4 te router id tlv the following configurations enable the advertisement of the ipv4 router id and te link parameters using the legacy te encoding defined in rfc 5305 example advertising ipv4 router id tlv using isis te router id in the following configuration example ipv4 router id 19216800 configured within the isis te instance is selected for advertising ipv4 te router id tlv   candidate shared default    info networkinstance default protocols isis instance test trafficengineering ipv4te routerid networkinstance default  protocols  isis  instance test  trafficengineering  ipv4terouterid 19216800      example advertising ipv4 router id tlv using network instance te router id in the following configuration example ipv4 router id 192168111 configured within a default network instance with te capabilities is selected for advertising ipv4 te router id tlv   candidate shared default    info networkinstance default trafficengineering ipv4terouterid networkinstance default  trafficengineering  ipv4terouterid 192168111   example advertising ipv4 router id tlv using default network instance router id in the following configuration example ipv4 router id 192051 configured within a default network instance is selected for advertising ipv4 te router id tlv   candidate shared default    info networkinstance default networkinstance default  routerid 192051  3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 88 routing protocols guide release 247 isis 7822 advertising ipv6 te router id tlv procedure a te router id must be a unique and stable address within the isis domain when ipv6 te is enabled the advertised ipv6 te router id tlv value is selected in a specific order of preference for preference details see ipv6 te router id tlv the following configurations enable the traffic engineering behavior with ipv6 te links the isis instance automatically advertises the ipv6 te tlvs and subtlvs defined in rfc6119 for information about ipv6 te router id tlv see ipv6 te router id tlv example advertising ipv6 router id tlv using an isis te router id in the following configuration example ipv6 router id 2001db81 configured within the isis te instance is selected for advertising ipv4 te router id tlv   candidate shared default    info networkinstance default protocols isis instance test trafficengineering ipv6te routerid networkinstance default  protocols  isis  instance test  trafficengineering  ipv6terouterid 2001db81      example advertising ipv6 router id tlv using default network instance te router id in the following configuration example ipv6 router id 2001db88 configured within a default network instance with te capabilities is selected for advertising ipv4 te router id tlv   candidate shared default    info networkinstance default trafficengineering ipv6terouterid networkinstance default  trafficengineering  ipv6terouterid 2001db88   example advertising ipv6 router id tlv using subinterface ipv6 address in the following configuration example the value of ipv6 address 20021234abcdffffc0a810164 configured within a subinterface is selected for advertising ipv6 te router id tlv   candidate shared default    info interface ethernet11 subinterface 0 ipv6 interface ethernet11  subinterface 0  ipv6  address 20021234abcdffffc0a810164    3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 89 routing protocols guide release 247 isis   783 advertising te attributes using legacy and asla tlvs when networkinstancedefaultprotocolsisis instancedefault traffic engineering advertisement is enabled the router advertises te tlvs isis allows advertising the protocol enabled on a telink by using the application specific link attributes asla subtlv as per draftietfisisteapp rfc 8919 the router receiving the link te attributes can identify the enabled application on the advertising router for backward compatibility the router continues to support the legacy mode of advertising link te attributes as recommended in rfc 5305 for information about the legacy mode of advertising link te attributes see enabling advertisement of te attributes in legacy mode sr linux supports decoding of received tlvs and maintains the details in the lsdb yang state model table 4 te attributes advertised by legacy tlv and subtlvs name tlv sub tlv decoding in lsdb yang admin group link localremote identifiers ipv4 interface address ipv4 neighbor address 22 22 22 22 maximum link bandwidth 22 ipv6 interface address ipv6 neighbor address te metric unidirectional link delay minmax unidirectional link delay te ipv4 router id ipv4 srlg ipv6 srlg te ipv6 router id 22 22 22 22 22 134 138 139 140 3 4 6 8 9 12 13 18 33 34 na na na na yes yes yes yes no yes yes yes yes yes yes yes yes yes the table below lists the te attributes that are advertised using the asla te tlvs 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 90 routing protocols guide release 247 isis table 5 te attributes advertised by asla tlv and subtlvs name tlv sub tlv subsub tlv decoding in lsdb yang admin group maximum link bandwidth te metric minmax unidirectional link delay 22 22 22 22 16 16 16 16 3 9 18 34 yes yes yes yes 7831 enabling advertisement of te attributes in legacy mode procedure sr linux supports advertising of te attributes using either the legacylinkattributeadvertisement or asla applicationspecific link attributes encodings or both for disabling the advertisement of te attributes in legacy mode set the legacylinkattributeadvertisement parameter to false example the following example configuration disables advertisement of te attributes in legacy mode for enabling set legacylinkattributeadvertisement to true   candidate shared default    info networkinstance default protocols isis instance test trafficengineering legacy linkattributeadvertisement networkinstance default  protocols  isis  instance test  trafficengineering  legacylinkattributeadvertisement false      3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 91 routing protocols guide release 247 protocol authentication 8 protocol authentication on the sr linux authentication of routing control messages for bgp as well as other protocols such as ldp and isis is done using shared keys message authentication between two routers involves sharing knowledge of a secret key and a cryptographic algorithm such as md5 this secret key together with the message data are used to generate a message digest the message digest is added to each message transmitted by the sender and validated by the receiver with the expectation that only a sender in possession of the secret key and algorithm details could generate the same message digest computed by the receiver of the message to limit exposure in the event a key is compromised the secret key is changed at regular intervals using keys configured in a keychain a keychain defines a list of one or more keys each key is associated with a secret string an algorithm identifier and a start time when a protocol references a keychain for securing its messages with a set of peers it uses the active key in the keychain with the most recent start time to generate the message digest in its sent messages and it drops every received message that does not have an acceptable message digest 81 configuring protocol authentication procedure to configure protocol authentication you configure an authentication keychain at the system level and configure a protocol to use the keychain all protocol authentication is done using keychains if a protocol requires authentication with a single neighbor using a single key the key is configured within a keychain and the protocol references the keychain example configure a keychain the following example configures a keychain consisting of two keys  candidate shared default    info system authentication system  authentication  keychain k1  key 1  adminstate enable algorithm md5 authenticationkey zcvseljzjxwbz9bict  key 2  adminstate enable algorithm md5 authenticationkey e7xdklyo2dom7v3ijv    3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 92 routing protocols guide release 247 protocol authentication example configure bgp to use the keychain for protocol authentication the following example configures bgp to use the keys in the keychain above for protocol authentication  candidate shared default    info networkinstance default protocols bgp authentication networkinstance default  protocols  bgp  authentication  keychain k1      example configure bgp to use a password without a keychain for protocol authentication sr linux supports configuring passwords without a keychain for authentication between bgp peers you must configure the authentication with the same password on both bgp peers otherwise the connection between them cannot be established  the following example configures bgp to use a password without a keychain for protocol authentication  candidate shared default    info networkinstance default protocols bgp authentication networkinstance default  protocols  bgp  authentication  password aes0k0sdpvdqxcucny0jelb0jmt8crznxsyzq      the following example illustrates the authentication password configuration at group level  candidate shared default    info networkinstance default protocols bgp group dutcdutd authentication networkinstance default  protocols  bgp  group dutcdutd  authentication  password aes9gpwmalbtcc59vovqpuxue5btrvvzfq      the following example illustrates the authentication password configuration at neighbor level  candidate shared default   3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 93 routing protocols guide release 247 protocol authentication  info networkinstance default protocols bgp neighbor 3401 authentication networkinstance default  protocols  bgp  neighbor 3401  authentication  password aescjhwoywwjvvumomvtos2av5cgxbpdjvxuq      3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 94 routing protocols guide release 247 routing policies 9 routing policies routing policies allow detailed control of ip routes learned and advertised by routing protocols such as bgp isis or ospf each routing policy has a sequence of rules called entries or statements and a default action each policy statement has zero or more match conditions such as whether a route is owned by a specific protocol and a main action such as to accept or reject the routes the statement may also have routemodifying actions a route matches a statement if it meets all of the specified match conditions each statement has a specified position in the policy if a policy has multiple statements they are processed in the order they are put in the policy in addition you can specify a default action that applies to routes that do not match any statement in the policy the first statement that matches the route determines the actions that are applied to the route if the route is not matched by any statements the default action of the policy is applied if there is no default action then a protocol and contextspecific default action is applied all routes match a statement with no match conditions when a route fulfills the match conditions of a statement the base action of the statement is applied along with all of its routemodifying actions 91 routing policy match conditions the following table summarizes the match conditions supported in sr linux routing policies table 6 match conditions for routing policies match condition protocol description test if the route is owned by a specific protocol the following options are supported  aggregate  arpnd  bgp  bgpevpn  bgpipvpn  bgplabel  dhcp  host   isis local  ospfv2  ospfv3 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 95 routing protocols guide release 247 routing policies match condition family description  static test if the prefix is associated with any of the afisafi address families listed the following options are supported       ipv4unicast ipv6unicast l3vpnipv4unicast l3vpnipv6unicast ipv4labeledunicast ipv6labeledunicast  evpn  routetarget test if the route matches any entry in a configured prefixset see prefix sets test if the route contains members of a configured tagset see configuring route internal tags in the sr linux evpn guide test if a bgp community attached to the route matches the list of member elements and match setoption in the bgp communityset see bgp communitysets test if the aspath length of the route is a specific value or in a range test if the route has an as path that matches the regular expression in the configured aspath set see as path sets prefixset internaltagstagset bgpcommunityset bgpaspathlength bgpaspathset bgpevpnroutetype test if the evpn route type is a specific type 15 isislevel isisroutetype ospfareaid test if the isis route is associated with l1 or l2 test if the isis route is internal or external redistributed from another protocol an ipv4 prefix is external if it is signaled in tlv 130 or tlv135 with rfc 7794 x flag1 an ipv6 prefix is external if tlv 236tlv 237 external bit  1 test if the ospfv2 or ospfv3 route is associated with the specified area id 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 96 routing protocols guide release 247 routing policies match condition ospfroutetype ospfinstanceid description test if the ospfv2 or ospfv3 route is a specific route type any of intraarea interarea type1ext type2ext type1nssa type2nssa summary aggregate or nssaaggregate test if the ospfv2 or ospfv3 route is associated with the specified instance id 911 specifying match conditions in a routing policy procedure you can specify the match conditions listed in table 6 match conditions for routing policies in a policy statement if a statement has no match conditions defined all routes evaluated by the policy are considered to be matches example test if the route is owned by bgp the following example specifies bgp protocol as a match condition in a policy statement  candidate shared default    info routingpolicy policy policy01 routingpolicy  policy policy01  statement 100  match  protocol bgp     example test if the route prefix is associated with an address family the following example matches routes with a prefix belonging to the ipv4 or ipv6 labeled unicast address family  candidate shared default    info routingpolicy policy policy02 routingpolicy  policy policy02  statement 100  match  family  ipv4labeledunicast ipv6labeledunicast      3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 97 routing protocols guide release 247 routing policies example test if an ospf route is a specific route type the following example matches ospf type 2 external routes  candidate shared default    info routingpolicy policy policy03 routingpolicy  policy policy03  statement 100  match  protocol ospfv2 ospf  routetype type2ext      92 routing policy actions if a route matches a policy statement the actions configured in the policy are applied to the route including route property modifications depending on the configured action the route may continue to be analyzed by further routing policy statements if any or the final disposition either accept or reject of the route is determined default routing policy action each routing policy can optionally be configured with a default action which is applied to routes that do not match any policy statement the default action specifies a main action and optionally one or more route property modification actions the default action is applied to all routes evaluated by the policy that do not match any statement or are only matched by statements that are nonterminating such as next statement if the default action is explicitly configured as accept or reject evaluation ends at the current policy even if there are further policies in the chain if a policy does not have a configured default action or the default action for the policy is nextpolicy or nextstatement then routes that do not match any statement in the policy are automatically evaluated by the next policy in the chained list see specifying a default action for a configuration example main routing policy actions the following table lists the main routing policy actions these actions can be configured for the policy result for the default action or at the statement action level in a routing policy table 7 main routing policy actions action accept description the route is accepted route property modifications are applied and evaluation stops immediately further statements and policies are not considered 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 98 routing protocols guide release 247 routing policies action reject nextstatement nextpolicy description the route is dropped and evaluation stops immediately further statements and policies are not considered no immediate decision is made about whether to accept or reject the route route policy modifications are applied and evaluation continues automatically to the next statement if there are no further statements in this policy the default action of the current policy applies no immediate decision is made about whether to accept or reject the route route policy modifications are applied and evaluation skips the remainder of the statements in the current policy continuing automatically to the first statement in the next policy in the chained list if there are no further policies then the default action of the last policy in the chain applies if no value is configured for policyresult then the implicit default is nextstatement if not configured at the statement action level or nextpolicy if not configured at the defaultaction level route property modification actions the following table lists the route property modification actions that can be specified in a routing policy table 8 route property modification actions action bgpaspathprepend bgpaspathremove bgpaspathreplace bgpcommunitiesadd bgpcommunitiesremove bgpcommunitiesreplace bgplocalpreferenceset bgpmedset bgpnexthopresolutionsettagset description prepend a specific as number one or more times to the as path clear the as path to make it empty clear the existing as path and replace it a new assequence containing the listed as numbers add all of the nonregex community members in the referenced communityset remove all of the communities that match any regex or nonregex member in the referenced communityset delete all of the existing communities and then add all of the nonregex community members in the referenced communityset set or modify the localpref to the specified value in matching bgp routes set or modify the med to the specified value in matching bgp routes see policy actions for setting med in bgp routes reference a tagset to be used for controlling next hop resolution 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 99 routing protocols guide release 247 routing policies action bgpnexthopset bgporiginset internaltagstagset routepreferenceset description set or modify the bgp nexthop address to a specified ipv4 or ipv6 address or to the keyword self set or modify the bgp origin attribute value to the specified value add the tags in the tagset as internal tags overwrite the route preference with the specified value 921 specifying actions in a routing policy procedure you can specify the actions listed in routing policy actions to routes that match a policy statement example accept static routes the following example configures a routing policy statement to accept static routes   candidate shared default    info routingpolicy policy policy01 routingpolicy  policy policy01  statement st1  match  protocol static  action  policyresult accept     example set origin attribute for matching bgp routes the following example specifies a policy with two statements if a bgp route matches the first statement the action is to proceed to the next statement if the route matches the second statement the action is to specify a new value for the origin attribute of the bgp route  candidate shared default    info routingpolicy routingpolicy  policy policy02  statement 100  match  protocol bgp  action  policyresult nextstatement   statement 101  3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 100 routing protocols guide release 247 routing policies match  prefixset western  action  bgp  origin  set egp       922 specifying a default action procedure you can optionally specify the policy action for routes that do not match the conditions defined in the policy statements the default action can be set to all available action states including accept reject nextentry and nextpolicy   if a default action is defined and no matches occur with the statements in the policy the default action is used if no default action is specified the default behavior of the protocol controls whether the routes match for bgp the default import action is to accept all routes from bgp for internal routes the default export action is to advertise them to bgp peers for external routes the default export action is not to advertise them to bgp peers example the following example defines a policy where the default action for nonmatching routes is to reject them  candidate shared default    info routingpolicy routingpolicy  policy policy01  defaultaction  policyresult reject    923 policy actions for setting med in bgp routes the following describes the supported policy actions for received bgp routes based on the contents of the med attribute in the route if any when a bgp export policy matches a nonbgp route for advertisement to neighbors  if the route is matched by an export policy statement that applies the action bgp med set routetable cost then a med attribute is added to the bgp route and its value is the routetable metric for the non bgp route 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 101 routing protocols guide release 247 routing policies   if the route is matched by an export policy statement that applies the action bgp med set number then a med attribute is added to the bgp route and its value is number if neither case applies no med is added to the route when a bgp route is received with a med attribute    if the route is matched by an import policy statement that applies the action bgp med set routetable cost then the med attribute is replaced and the new value is the routetable metric of the route that resolves the bgp nexthop if the route is matched by an import policy statement that applies the action bgp med set number then the med attribute is replaced and the new value is number if neither case applies the ribin med attribute is unmodified when a bgp route is received without a med attribute    if the route is matched by an import policy statement that applies the action bgp med set routetable cost then a med attribute is added to the bgp route and the new value is the routetable metric of the route that resolves the bgp nexthop if the route is matched by an import policy statement that applies the action bgp med set number then a med attribute is added to the bgp route and its value is number if neither case applies no med attribute is added to the route when a bgp route is received with a med attribute from one ebgp peer and the route must be advertised to other ebgp peers    if the route is matched by an export policy statement that applies the action bgp med set routetable cost then the med attribute is replaced and the new value is the routetable metric of the route that resolves the bgp nexthop 0 when receiving a route from a single hop ebgp peer if the route is matched by an export policy statement that applies the action bgp med set number then the med attribute is replaced and the new value is number if neither case applies the med is stripped when a bgp route is received without a med attribute from one ebgp peer and the route must be advertised to other ebgp peers    if the route is matched by an export policy statement that applies the action bgp med set routetable cost then a med attribute is added to the bgp route and its value is the routetable metric of the route that resolves the bgp nexthop 0 when receiving a route from a single hop ebgp peer if the route is matched by an export policy statement that applies the action bgp med set number then a med attribute is added to the bgp route and its value is number if neither case applies no med is added to the route when a bgp route is received with a med attribute from one ebgp peer and the route must be advertised to ibgp peers or else the route was received with a med attribute from an ibgp peer for propagation to other ibgp peers    if the route is matched by an export policy statement that applies the action bgp med set routetable cost then the med attribute is replaced and the new value is the routetable metric of the route that resolves the bgp nexthop if the route is matched by an export policy statement that applies the action bgp med set number then the med attribute is replaced and the new value is number if neither case applies the med is unmodified 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 102 routing protocols guide release 247 routing policies when a bgp route is received with a med attribute from one ebgpibgp peer and the route must be advertised to other ebgp peers the med is stripped by default if the route is not matched by a policy when a bgp route is received without a med attribute from one ebgp peer and the route must be advertised to ibgp peers or else the route was received without a med attribute from an ibgp peer for propagation to other ebgp or ibgp peers    if the route is matched by an export policy statement that applies the action bgp med set routetable cost then a med attribute is added to the bgp route and its value is the routetable metric of the route that resolves the bgp nexthop if the route is matched by an export policy statement that applies the action bgp med set number then a med attribute is added to the bgp route and its value is number if neither case applies no med is added to the route 93 applying a routing policy procedure routing policies can be applied to routes received from other routers imported routes as well as routes advertised to other routers exported routes routing policies can be applied at the networkinstance level peergroup level and neighbor level example apply a routing policy to imported routes the following example specifies that bgp in the default networkinstance applies policy01 to imported routes  candidate shared default    info networkinstance default protocols bgp importpolicy networkinstance default  protocols  bgp  importpolicy  policy01     example apply a routing policy to bgp routes exported from a peergroup the following example applies policy02 to bgp routes exported from the peers in peergroup headquarters1  candidate shared default    info networkinstance default protocols bgp group headquarters1 networkinstance default  protocols  bgp  group headquarters1  exportpolicy  policy02     3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 103 routing protocols guide release 247 routing policies  example apply a routing policy to bgp routes exported from a bgp neighbor the following example applies policy02 to bgp routes exported from a specific bgp neighbor   candidate shared default    info networkinstance default protocols bgp neighbor 192168111 networkinstance default  protocols  bgp  neighbor 192168111  exportpolicy  policy02      931 applying a default policy to ebgp sessions procedure you can specify the action to take for routes exported to or imported from ebgp peers to which no configured policy applies this is set with the ebgpdefaultpolicy command and the exportrejectall and importrejectall parameters  the exportrejectall parameter when set to true causes all outbound routes that do not match a configured export policy to be rejected as if they had been rejected by a configured export policy the default is true  the importrejectall parameter when set to true causes all inbound routes that do not match a configured import policy to be rejected as if they had been rejected by a configured import policy the default is true example the following example allows a bgp neighbor to export a default route even though the route is not subject to any configured policy   candidate shared default    info networkinstance default networkinstance default  protocols  bgp  ebgpdefaultpolicy  exportrejectall false  neighbor 2001db8c11  senddefaultroute  ipv6unicast true      3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 104 routing protocols guide release 247 routing policies 932 replacing an as path procedure you can configure a routing policy where the as path in matching routes is replaced by a list of as numbers specified in the policy for routes that match the policy the current as path is deleted and replaced with an asseq element containing the as numbers listed in the policy in their configured sequence if you configure an empty as list in the policy then the current as path in a matching route is deleted and it would then have a null aspath attribute example the following is an example of a routing policy that matches bgp routes the action for the policy is nextpolicy so routes that match the first policy are evaluated by the second policy whose action is to replace the as path in matching routes  candidate shared default    info routingpolicy routingpolicy  policy policy01  statement 100  match  protocol bgp  action  policyresult nextpolicy    policy policy02  statement 100  match  prefixset western  action  bgp  aspath  replace  12 13 14        933 as path sets in a routing policy an as path set groups one or more as paths using a regular expression an as path regular expression is a string consisting of as numbers and usually one or more regular expression operators 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 105 routing protocols guide release 247 routing policies when a route is compared to an as path regular expression each 4byte as number is extracted one byone from the as path starting with the most recent as and proceeding to the oldest or originating as and checked for a match against the regular expression if there is any as number that does not match the pattern then the route is considered not a match for the as path regular expression and therefore not a match for the policy statement where this match condition is used the following table lists supported operators for an as path regular expression table 9 operators for as path regular expressions operator description            mn m m     matches the term on alternate sides of the pipe matches multiple occurrences of the term matches 0 or 1 occurrence of the term matches 1 or more occurrence of the term used to parenthesize so a regular expression is considered as one term used to demarcate a set of elementary or range terms used to demarcate a set of elementary or range terms that are explicitly not matching used between the start and end of a range matches least m and at most n repetitions of the term matches exactly m repetitions of the term matches m or more repetitions of the term matches the beginning of the string matches the end of the string an escape character to indicate that the following character is a match criteria and not a grouping delimiter matches any as path numbers containing a confederation set or seq 9331 configuring an as path set procedure to use an as path set in a routing policy you configure a regular expression for the as path set then specify the as path set as a match condition in the routing policy example the following example configures an as path set that consists of a regular expression 100  and the as path set is specified as a match condition in a routing policy the policy matches routes whose as path matches the regular expression an as path set can have a maximum of one regular expression configured see table 9 operators for as path regular expressions for a list of valid operators 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 106 routing protocols guide release 247 routing policies in this example a route with as path 100 200 matches the regular expression in the as path set and the action specified in the policy is applied to the route  candidate shared default    info routingpolicy routingpolicy  aspathset a1  expression 100   policy p1  statement s1  match  bgp  aspathset a1   action  bgp  aspath  replace  300 400        934 bgp communitysets you can configure a bgp communityset that can be used as a match condition in a routing policy a bgp communityset contains a list of member elements and a matchsetoption that indicates what constitutes a matching route an element in a bgp communityset can be a standard bgp community value regular expression or wellknown name or else a large bgp community value or regular expression see table 10 supported communityset member formats the matchsetoption can be one of the following  all a route matches the communityset if every element in the communityset is matched by a community attached to the route if you do not specify a matchsetoption this is the default  any a route matches the communityset if there is at least one element in the communityset that is matched by a community attached to the route  invert a route matches the communityset if none of the elements in the communityset are matched by a community attached to the route table 10 supported communityset member formats string format 065535065535 04294967295042949672950 4294967295 definition standard community matched exactly large community matched exactly 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 107 routing protocols guide release 247 routing policies string format regex1regex2 regex1regex2regex3 definition standard community matched by two regular expressions large community matched by three regular expressions bgptunnelencapmplsvxlan bgp tunnel encapsulation extended community colornn04294967295 color extended community matched exactly noadvertise noexport noexportsubconfed welldefined standard community no advertise welldefined standard community noexport welldefined standard community noexport subconfed nopeer welldefined standard community nopeer origin06553504294967295 origin04294967295065535 originipv4address065535 originregex1regex2 target06553504294967295 target04294967295065535 targetipv4address065535 targetregex1regex2 type0 routeorigin extended community matched exactly type2 routeorigin extended community matched exactly type1 routeorigin extended community matched exactly routeorigin extended community matched by two regular expressions type0 routetarget extended community matched exactly type2 routetarget extended community matched exactly type1 routetarget extended community matched exactly routetarget extended community matched by two regular expressions 9341 configuring a bgp communityset procedure to configure a bgp communityset for a routing policy you specify the member elements and matchset option then specify the community set as a match condition in the routing policy example the following example configures a bgp communityset that consists of two member elements the matchsetoption is invert so a route matches this communityset if neither of the elements in the 3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 108 routing protocols guide release 247 routing policies communityset are matched by a community attached to the route the communityset is specified as a match condition in a routing policy  candidate shared default    info routingpolicy routingpolicy  communityset cs1  matchsetoptions invert member  noadvertise noexport   policy p1  statement 1  match  bgp  communityset cs1      935 prefix sets in a routing policy a prefix set groups one or more ipv4 and or ipv6 prefix matching entries a prefix matching entry has two components  an ipv4 or ipv6 prefix specifying an ipv4 or ipv6 address with zeroed host bits and a prefix length for example 1921681021  a masklengthrange specifying either exact or a range in the format ab where a is the starting prefix length 032 for ipv4 0128 for ipv6 and b is the ending prefix length 032 for ipv4 0128 for ipv6 9351 configuring a prefix set procedure to configure a prefix set for a routing policy you specify the member elements then specify the prefix set as a match condition in the routing policy example the following example configures a prefix set that consists of two member elements the prefix set is specified as a match condition in a routing policy  candidate shared default    info routingpolicy routingpolicy  prefixset pset1  prefix 19216810021 masklengthrange 2124   prefix 1921681024 masklengthrange exact    3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 109 routing protocols guide release 247 routing policies policy p1  statement s1  match  prefixset pset1  action  policyresult accept     94 resequencing statements in a routing policy procedure each routing policy statement has a numerical sequence identifier that determines its order relative to other statements in that policy when a route is analyzed by a policy it is evaluated by each statement in sequential order the definition of the sequence of statements is fully flexible and can be defined as required using the insert command if the insert command is not used new statements are added to the end of the policy in the following examples routing policy policy01 consists of three statements red green and blue   candidate shared default    info routingpolicy policy policy01 routingpolicy  policy policy01  statement red  match  protocol bgp  action  policyresult accept   statement green  match  prefixset pset1  action  policyresult reject   statement blue  match  family  ipv4unicast ipv6unicast   action  policyresult nextpolicy     3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 110 routing protocols guide release 247 routing policies example move a statement to the end of a routing policy the following example moves statement red to the end of the routing policy   candidate shared default    routingpolicy policy policy01   candidate shared default  routingpolicy policy policy01   insert statement red last   candidate shared default  routingpolicy policy policy01   info statement green  match  prefixset pset1  action  policyresult reject   statement blue  match  family  ipv4unicast ipv6unicast   action  policyresult nextpolicy   statement red  match  protocol bgp  action  policyresult accept   example move a statement to the beginning of a routing policy the following example moves statement blue to the beginning of the routing policy   candidate shared default    routingpolicy policy policy01   candidate shared default  routingpolicy policy policy01   insert statement blue first   candidate shared default  routingpolicy policy policy01   info statement blue  match  family  ipv4unicast ipv6unicast   action  policyresult nextpolicy   statement red  match  protocol bgp  3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 111 routing protocols guide release 247 routing policies action  policyresult accept   statement green  match  prefixset pset1  action  policyresult reject   example move a statement before an existing statement the following example moves statement blue before statement green   candidate shared default    routingpolicy policy policy01   candidate shared default  routingpolicy policy policy01   insert statement blue before green   candidate shared default  routingpolicy policy policy01   info statement red  match  protocol bgp  action  policyresult accept   statement blue  match  family  ipv4unicast ipv6unicast   action  policyresult nextpolicy   statement green  match  prefixset pset1  action  policyresult reject   example move a statement after an existing statement the following example moves statement red after statement green   candidate shared default    routingpolicy policy policy01   candidate shared default  routingpolicy policy policy01   insert statement red after green   candidate shared default  routingpolicy policy policy01   info statement green  match  3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 112 routing protocols guide release 247 routing policies prefixset pset1  action  policyresult reject   statement red  match  protocol bgp  action  policyresult accept   statement blue  match  family  ipv4unicast ipv6unicast   action  policyresult nextpolicy   3he 20668 aaaa tqzza spacer text  2024 nokia use subject to terms available at wwwnokiacomterms 113 customer document and product support customer documentation customer documentation welcome page technical support product support portal documentation feedback customer documentation feedback aizasyagcgb0wgpuc8tsm6fe3r8lktecnfqfg gemini api